import{_ as v,H as P,b as f,r as k,o as d,c as i,e as F,a as s,t as l,l as h,g as b,w as m,v as p,f as c,F as g,d as x}from"./index-69700282.js";const A={components:{Header:P},data(){return{loading:!0,error:null,user:{},showAddressDialog:!1,editingAddressId:null,addressForm:{building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""},addressSuccess:!1,showResetPasswordModal:!1,password:"",password_confirmation:"",resetPasswordLoading:!1,resetPasswordError:null,resetPasswordSuccess:null}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"},goToResetPassword(){this.$router.push({name:"ResetPassword",query:{email:this.user.email}})},formatAddress(t){let e="";return t.country?e=this.$i18n&&this.$i18n.locale==="ar"?t.country.name_ar:t.country.name_en:t.country_id&&(e=t.country_id),[t.building_name,t.floor_number,t.apartment_number,t.postal_code,t.landmark,t.city_id,e].filter(Boolean).join(", ")},openEditDialog(t){this.editingAddressId=t.id,this.addressForm={...t},this.showAddressDialog=!0},closeEditDialog(){this.showAddressDialog=!1,this.editingAddressId=null,this.addressForm={building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""}},async saveAddress(t){var e,n;try{const a=await f.post(`api/address/${t}`,this.addressForm,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),o=this.user.address.findIndex(u=>u.id===t);o!==-1&&a.data&&a.data.data&&this.$set(this.user.address,o,a.data.data),this.addressSuccess=!0,this.$toast&&this.$toast.success(a.data.message||"Address updated successfully!"),setTimeout(()=>{this.addressSuccess=!1,this.closeEditDialog()},1200)}catch(a){const o=((n=(e=a==null?void 0:a.response)==null?void 0:e.data)==null?void 0:n.message)||"Failed to update address";this.$toast&&this.$toast.error(o)}},async resetPassword(){var t,e;if(this.resetPasswordError=null,this.resetPasswordSuccess=null,this.password!==this.password_confirmation){this.resetPasswordError=this.$t("profile.passwordsDoNotMatch");return}if(this.password.length<8){this.resetPasswordError=this.$t("profile.passwordTooShort");return}this.resetPasswordLoading=!0;try{const n=await f.post("api/reset-password",{email:this.user.email,password:this.password,password_confirmation:this.password_confirmation});n.data.status&&n.data.data?(this.resetPasswordSuccess=n.data.message||this.$t("profile.passwordResetSuccess"),setTimeout(()=>{this.showResetPasswordModal=!1,this.password="",this.password_confirmation=""},1500)):this.resetPasswordError=n.data.message||this.$t("profile.passwordResetFailed")}catch(n){this.resetPasswordError=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||this.$t("profile.passwordResetFailed")}finally{this.resetPasswordLoading=!1}}},async created(){var t,e;try{const n=await f.get("api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.user=n.data.data.user}catch(n){this.error=((e=(t=n.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch profile"}finally{this.loading=!1}}},D={class:"profile-outer container my-5"},E={key:0,class:"d-flex flex-column align-items-center justify-content-center py-5"},S={key:1,class:"text-center text-danger"},C={key:2,class:"card p-4 shadow"},N={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},V={class:"d-flex align-items-center gap-3"},j={class:"avatar bg-primary text-white rounded-circle d-flex justify-content-center align-items-center",style:{width:"60px",height:"60px","font-size":"24px"}},I={class:"mb-0"},R={class:"text-muted"},M={key:0,class:"modal-overlay"},U={class:"modal-dialog-centered"},B={class:"modal-content bg-white p-4 rounded shadow w-100"},L={class:"mb-4"},T={class:"form-group"},H={class:"form-group"},z={key:0,class:"alert alert-danger"},q={key:1,class:"alert alert-success"},G={class:"d-flex justify-content-end gap-2 mt-2"},J=["disabled"],K={key:0,class:"spinner-border spinner-border-sm"},O={class:"d-flex flex-column gap-3"},Q={class:"d-flex justify-content-between border-bottom pb-2"},W={class:"d-flex justify-content-between border-bottom pb-2"},X={class:"d-flex justify-content-between border-bottom pb-2"},Y={key:1,class:"mt-4"},Z={class:"mb-3"},$=["onClick"],ss={key:3,class:"modal-overlay"},es={class:"modal-dialog-centered"},os={class:"modal-content bg-white p-4 rounded shadow w-100"},ts={class:"form-group"},rs={class:"form-group"},ls={class:"form-group"},ns={class:"form-group"},ds={class:"form-group"},is={class:"form-group"},as={class:"form-group"},us={class:"d-flex justify-content-end gap-2 mt-2"},ms={key:0,class:"alert alert-success d-flex align-items-center mt-3"};function ps(t,e,n,a,o,u){var w;const _=k("Header");return d(),i(g,null,[F(_),s("div",D,[o.loading?(d(),i("div",E,[e[14]||(e[14]=s("span",{class:"loader mb-2"},null,-1)),s("span",null,l(t.$t("profile.loading")),1)])):o.error?(d(),i("div",S,[s("span",null,l(o.error),1)])):(d(),i("div",C,[s("div",N,[s("div",V,[s("div",j,l(o.user.name?o.user.name.charAt(0).toUpperCase():"?"),1),s("div",null,[s("h5",I,l(o.user.name),1),s("small",R,l(o.user.role),1)])]),s("button",{class:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:e[0]||(e[0]=r=>o.showResetPasswordModal=!0),"aria-label":"Reset Password"},[e[15]||(e[15]=s("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24"},[s("path",{d:"M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a8 8 0 11-16 0 8 8 0 0116 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),h(" "+l(t.$t("profile.resetPassword")),1)])]),o.showResetPasswordModal?(d(),i("div",M,[s("div",U,[s("div",B,[s("h5",L,l(t.$t("profile.resetPassword")),1),s("form",{onSubmit:e[4]||(e[4]=b((...r)=>u.resetPassword&&u.resetPassword(...r),["prevent"])),class:"d-flex flex-column gap-3"},[s("div",T,[s("label",null,l(t.$t("profile.newPassword")),1),m(s("input",{type:"password","onUpdate:modelValue":e[1]||(e[1]=r=>o.password=r),class:"form-control",required:""},null,512),[[p,o.password]])]),s("div",H,[s("label",null,l(t.$t("profile.confirmPassword")),1),m(s("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=r=>o.password_confirmation=r),class:"form-control",required:""},null,512),[[p,o.password_confirmation]])]),o.resetPasswordError?(d(),i("div",z,l(o.resetPasswordError),1)):c("",!0),o.resetPasswordSuccess?(d(),i("div",q,l(o.resetPasswordSuccess),1)):c("",!0),s("div",G,[s("button",{type:"submit",class:"btn btn-primary",disabled:o.resetPasswordLoading},[o.resetPasswordLoading?(d(),i("span",K)):c("",!0),h(" "+l(t.$t("profile.submit")),1)],8,J),s("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=r=>o.showResetPasswordModal=!1)},l(t.$t("profile.cancel")),1)])],32)])])])):c("",!0),s("div",O,[s("div",Q,[s("strong",null,l(t.$t("profile.name")),1),s("span",null,l(o.user.name),1)]),s("div",W,[s("strong",null,l(t.$t("profile.email")),1),s("span",null,l(o.user.email),1)]),s("div",X,[s("strong",null,l(t.$t("profile.phone")),1),s("span",null,l(o.user.phone),1)])]),(w=o.user.address)!=null&&w.length?(d(),i("div",Y,[s("h6",Z,l(t.$t("profile.address")),1),(d(!0),i(g,null,x(o.user.address,(r,y)=>(d(),i("div",{key:r.id||y,class:"d-flex justify-content-between align-items-center border rounded p-3 mb-2"},[s("span",null,l(u.formatAddress(r)),1),s("button",{class:"btn btn-sm btn-outline-primary",onClick:cs=>u.openEditDialog(r)},"Edit",8,$)]))),128))])):c("",!0)])),o.showAddressDialog?(d(),i("div",ss,[s("div",es,[s("div",os,[e[25]||(e[25]=s("h5",{class:"mb-4"},"Edit Address",-1)),s("form",{onSubmit:e[13]||(e[13]=b(r=>u.saveAddress(o.editingAddressId),["prevent"])),class:"d-flex flex-column gap-3"},[s("div",ts,[e[16]||(e[16]=s("label",null,"Building Name",-1)),m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>o.addressForm.building_name=r),class:"form-control",placeholder:"Building Name"},null,512),[[p,o.addressForm.building_name]])]),s("div",rs,[e[17]||(e[17]=s("label",null,"Floor Number",-1)),m(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.addressForm.floor_number=r),class:"form-control",placeholder:"Floor Number"},null,512),[[p,o.addressForm.floor_number]])]),s("div",ls,[e[18]||(e[18]=s("label",null,"Apartment Number",-1)),m(s("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.addressForm.apartment_number=r),class:"form-control",placeholder:"Apartment Number"},null,512),[[p,o.addressForm.apartment_number]])]),s("div",ns,[e[19]||(e[19]=s("label",null,"Postal Code",-1)),m(s("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.addressForm.postal_code=r),class:"form-control",placeholder:"Postal Code"},null,512),[[p,o.addressForm.postal_code]])]),s("div",ds,[e[20]||(e[20]=s("label",null,"Landmark",-1)),m(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.addressForm.landmark=r),class:"form-control",placeholder:"Landmark"},null,512),[[p,o.addressForm.landmark]])]),s("div",is,[e[21]||(e[21]=s("label",null,"City ID",-1)),m(s("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.addressForm.city_id=r),class:"form-control",placeholder:"City ID"},null,512),[[p,o.addressForm.city_id]])]),s("div",as,[e[22]||(e[22]=s("label",null,"Country ID",-1)),m(s("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>o.addressForm.country_id=r),class:"form-control",placeholder:"Country ID"},null,512),[[p,o.addressForm.country_id]])]),s("div",us,[e[23]||(e[23]=s("button",{type:"submit",class:"btn btn-primary"},"Save",-1)),s("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=(...r)=>u.closeEditDialog&&u.closeEditDialog(...r))},"Cancel")]),o.addressSuccess?(d(),i("div",ms,e[24]||(e[24]=[s("i",{class:"bi bi-check-circle-fill me-2"},null,-1),h(" Address updated successfully! ")]))):c("",!0)],32)])])])):c("",!0)])],64)}const hs=v(A,[["render",ps],["__scopeId","data-v-4bb9f3ee"]]);export{hs as default};

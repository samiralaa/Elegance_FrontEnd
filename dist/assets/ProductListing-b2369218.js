import{_ as K,B as G,K as C,x as u,y as Q,C as W,N as A,r as N,o as l,c as d,e as m,a as s,t as n,g as X,D as w,F,d as V,w as S,v as T,f as g,b as P,H as Y,l as Z,ae as ee,p as U,n as te,E as _}from"./index-441719fd.js";const se={class:"axil-breadcrumb-area mt-5"},ae={class:"container"},oe={class:"row align-items-center"},ie={class:"col-lg-6 col-md-8"},re={class:"inner"},ne={class:"title"},ce=["dir"],le={class:"container"},de={class:"filter col-12"},ue={class:"sidebar"},ve={class:"sidebar-container"},_e={class:"sidebar-title"},me={class:"checkbox-container"},ge=["value"],he={class:"sidebar-title"},pe={class:"price-range"},fe=["min","max"],be=["min","max"],ye={class:"price-values"},xe={class:"products-grid"},ke={class:"image-container mb-3 bg-light rounded"},Ce=["src","alt"],we={key:0,class:"sale-badge"},Fe={class:"product-actions d-flex justify-content-center gap-5 w-100"},Se=["onClick","title"],Pe={class:"card-body"},De={class:"card-title"},Ee={class:"price-container"},Le={key:0,class:"price-old"},$e={key:1,class:"discount-badge"},Ie={class:"card-text card-price"},Ae={class:"addToCart-btn"},Ne=["disabled","onClick"],Ve={__name:"ProductListing",setup(Te){const{locale:D,t:c}=G(),B=C(()=>D.value==="ar"?"rtl":"ltr"),E=u([]),L=u([]);u(!1),u("");const h=u([]),i=u({min:0,max:2e3}),v={min:0,max:2e3},p=u(!1),f=Q(),y=C(()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"}),$=(e,a,r)=>{const o={AED:1,USD:.2724795640326976};return a===r?parseFloat(e):o[r]?parseFloat((e*o[r]).toFixed(2)):parseFloat(e)},x=()=>{p.value=!p.value;const e=document.querySelector(".sidebar"),a=document.body;e&&(e.classList.toggle("active",p.value),e.classList.contains("active")?a.classList.add("no-scroll"):a.classList.remove("no-scroll"))},M=e=>`https://backend.webenia.org/public/storage/${e}`,b=e=>f.favorites.some(a=>a.product_id===e),q=e=>{const a=f.favorites.find(r=>r.product_id===e);return a?a.favorite_id||a.id:null},O=async e=>{var a,r;try{if(b(e.id)){const o=q(e.id);o&&(await f.removeFromFavorites(o),_({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const o=await f.addToFavorites(e.id);_({title:c("success"),message:o.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(o){console.error("Favorite error:",o),_({title:c("error"),message:((r=(a=o.response)==null?void 0:a.data)==null?void 0:r.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},R=async()=>{try{const e=await P.get("https://backend.webenia.org/api/website");E.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},I=async()=>{try{const e=await P.get("https://backend.webenia.org/api/all/products");L.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},z=async e=>{var a,r;try{const o=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},t=await P.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:parseFloat(e.price)},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:o.code}});t.data.status?_({title:c("success"),message:t.data.message,type:"success"}):_({title:c("error"),message:t.data.message,type:"error"})}catch(o){console.error("Error adding to cart:",o),_({title:c("error"),message:(r=(a=o.response)==null?void 0:a.data)==null?void 0:r.message,type:"error"})}};W(()=>{R(),I(),window.addEventListener("currency-changed",()=>{I()})});const H=C(()=>L.value.filter(e=>{const a=h.value.length===0||h.value.includes(e.category_id),r=i.value.min===v.min&&i.value.max===v.max,o=$(e.price,e.currency_code||"AED",y.value),t=r?!0:o>=i.value.min&&o<=i.value.max;return a&&t})),J=e=>{let a=e.discount&&e.discount.is_active?parseFloat(e.converted_price||e.price)*(1-parseFloat(e.discount.discount_value)/100):parseFloat(e.converted_price||e.price);return $(a,e.currency_code||"AED",y.value).toFixed(2)},j=e=>e.discount&&e.discount.is_active?Math.round(parseFloat(e.discount.discount_value)):0;return A(()=>i.value.min,e=>{e>i.value.max&&(i.value.min=i.value.max)}),A(()=>i.value.max,e=>{e<i.value.min&&(i.value.max=i.value.min)}),(e,a)=>{const r=N("router-link"),o=N("fa");return l(),d(F,null,[m(Y),s("div",se,[s("div",ae,[s("div",oe,[s("div",ie,[s("div",re,[s("h1",ne,n(e.$t("products.title")),1)])])])])]),s("div",{class:"shop-container",dir:B.value},[s("div",le,[s("div",de,[s("a",{href:"#",onClick:X(x,["prevent"])},n(e.$t("products.filter")),1)]),s("aside",ue,[s("div",ve,[s("button",{class:"close-btn",onClick:x},"Ã—"),s("h3",_e,n(w(c)("products.categories")),1),a[4]||(a[4]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(l(!0),d(F,null,V(E.value,t=>(l(),d("div",{key:t.id,class:"filter-item"},[s("label",me,[Z(n(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),S(s("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=k=>h.value=k),value:t.id},null,8,ge),[[ee,h.value]]),a[3]||(a[3]=s("span",{class:"checkmark"},null,-1))])]))),128)),s("h3",he,n(w(c)("products.converted_price")),1),a[5]||(a[5]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),s("div",pe,[S(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=t=>i.value.min=t),min:v.min,max:v.max},null,8,fe),[[T,i.value.min,void 0,{number:!0}]]),S(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=t=>i.value.max=t),min:v.min,max:v.max},null,8,be),[[T,i.value.max,void 0,{number:!0}]]),s("div",ye,[s("span",null,n(i.value.min)+" - "+n(i.value.max)+" "+n(y.value),1)])])])]),p.value?(l(),d("div",{key:0,class:"overlay",onClick:x})):g("",!0),s("section",xe,[(l(!0),d(F,null,V(H.value,t=>(l(),d("div",{key:t.id,class:"product-card"},[s("div",ke,[m(r,{to:`/read/products/${t.id}`},{default:U(()=>[t.images&&t.images.length?(l(),d("img",{key:0,src:M(t.images[0].path),alt:t.name},null,8,Ce)):g("",!0)]),_:2},1032,["to"]),t.is_available?g("",!0):(l(),d("div",we,n(e.$t("products.outOfStock")),1)),s("div",Fe,[m(r,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:U(()=>[m(o,{icon:"eye"})]),_:2},1032,["to"]),s("button",{onClick:k=>O(t),class:te(["btn rounded-circle shadow-sm btn-light",b(t.id)?"text-danger":""]),title:b(t.id)?"Remove from favorites":"Add to favorites"},[m(o,{icon:b(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,Se)])]),s("div",Pe,[s("h5",De,n(w(D)==="ar"?t.name_ar:t.name_en),1),s("div",Ee,[t.discount&&t.discount.is_active?(l(),d("span",Le,n(t.converted_price)+" "+n(t.currency_code),1)):g("",!0),t.discount&&t.discount.is_active?(l(),d("span",$e,n(j(t))+"% OFF ",1)):g("",!0),s("span",Ie,n(J(t))+" "+n(t.currency_code),1)])]),s("div",Ae,[s("button",{disabled:!t.is_available,onClick:k=>z(t),class:"btn"},n(e.$t("products.addToCart")),9,Ne)])]))),128))])])],8,ce)],64)}}},Be=K(Ve,[["__scopeId","data-v-c50c010b"]]);export{Be as default};

import{_ as ge,B as fe,K as z,L as he,M as ke,y as ye,z as be,x as y,C as we,u as M,N as Ce,O as Fe,r as q,o as c,c as l,a as i,e as v,p as w,t as r,D as P,F as E,d as U,f as h,b as K,H as Se,n as F,l as te,w as $e,v as xe,E as m}from"./index-69700282.js";import{$ as b}from"./slick-theme-5fa53dbf.js";const Ie=["dir"],Te={class:"container"},ze={class:"product-details"},qe={class:"product-title"},Pe=["innerHTML"],Ee={class:"price-block"},Ae={class:"d-flex"},Ne={key:0,class:"price-old"},Ve={key:1,class:"discount-badge"},Le={class:"price-new"},Be=["title"],Me={class:"product-actions"},Ue={key:0,class:"sale-badge"},De={key:0,class:"weight"},Oe={class:"weight-title"},Re={class:"weight-container"},He={class:"row g-4"},Qe=["onClick"],Je={key:0,class:"amount-details",style:{"margin-top":"1rem"}},je={key:1},Ke={class:"buttons-section"},Ge={key:0,class:"quantity-section"},We={class:"quantity-control"},Xe=["src"],Ye={class:"slider-wrapper"},Ze=["onClick"],et=["src"],tt={key:0,class:"children-products-section"},st={class:"title section-header d-flex align-items-center mb-4"},at={class:"mb-0"},ot={class:"row g-3"},it={class:"product-card card border-0 h-100"},nt={class:"position-relative overflow-hidden bg-light"},rt=["src","alt"],ct={key:0,class:"sale-badge"},lt={class:"product-actions d-flex justify-content-center gap-2 w-100"},dt=["onClick","disabled"],ut=["onClick","disabled"],vt=["onClick","title"],_t={class:"card-body"},pt={class:"card-title"},mt={class:"price-container"},gt={key:0,class:"discount-badge"},ft={key:1,class:"price-old"},ht={class:"card-text card-price"},se=1,ae=99,G="/default-image.jpg",kt={__name:"showProduct",setup(yt){const{locale:C,t:u}=fe(),oe=z(()=>C.value==="ar"?"rtl":"ltr"),W=he();ke();const k=ye(),X=be(),t=y({}),f=y(1),A=y(null);y(0);const S=y(null),$=y(null),D=y(3),O=y(3),x=e=>k.favorites.some(s=>s.product_id===e),ie=e=>{var s,o;return((s=k.favorites.find(n=>n.product_id===e))==null?void 0:s.favorite_id)||((o=k.favorites.find(n=>n.product_id===e))==null?void 0:o.id)},ne=async e=>{var s,o;try{if(x(e.id)){const n=ie(e.id);n&&(await k.removeFromFavorites(n),m({title:u("success"),message:u("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await k.addToFavorites(e.id);m({title:u("success"),message:n.message||u("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Favorite error:",n),m({title:u("error"),message:((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)||u("login_required_favorite")||"Login required to favorite product",type:"error"})}},re=async()=>{var e,s;try{let o=0;if(_.value?o=parseFloat(_.value.price):o=parseFloat(t.value.price),t.value.discount&&t.value.discount.is_active){const p=parseFloat(t.value.discount.discount_value);o=o-o*(p/100)}const n={product_id:t.value.id,quantity:f.value,price:o};_.value&&(n.amount_id=_.value.id);const d=await K.post("https://backend.webenia.org/api/cart-items",n,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});d.data.status?(m.success(d.data.message),X.incrementCount(),await X.fetchCartCount()):m.error(d.data.message)}catch(o){m.error(((s=(e=o.response)==null?void 0:e.data)==null?void 0:s.message)||u("Error adding product to cart"))}},N=e=>e?`https://backend.webenia.org/public/storage/${e}`:G,Y=e=>{e.target.src=G},V=e=>{A.value=e,M(()=>{const s=document.querySelector(".main-image");s&&(s.src=N(e))})},R=async()=>{var e;try{const s=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},o=await K.get(`https://backend.webenia.org/api/website/show/products/${W.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:s.code}});o.data.status&&(t.value=o.data.data,t.value._original_price=t.value.price,(e=t.value.images)!=null&&e.length&&(A.value=t.value.images[0].path,M(()=>{Q(),J()})))}catch(s){console.error("Error fetching product:",s)}},Z=async e=>{var s,o,n;try{let d=0;if(e.discount&&e.discount.is_active){const g=parseFloat(e.discount.discount_value),B=parseFloat(e.price);d=B-B*(g/100)}else d=parseFloat(e.price);const p={product_id:e.id,quantity:1,price:d},T=(s=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:s.id;T&&(p.user_id=T),e.amounts&&(p.amount_id=e.amount_id);const a=await K.post("https://backend.webenia.org/api/cart-items",p,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&m({title:u("success"),message:a.data.message,type:"success"})}catch(d){console.error("Error adding child product to cart:",d),m({title:"❌",message:((n=(o=d.response)==null?void 0:o.data)==null?void 0:n.message)||u("add_to_cart_error")||"Login required to add to cart",type:"error"})}},I=y(null),H=(e,s)=>{I.value=e,t.value.amount_id=s.id,t.value.price=s.price,s.converted_price!==void 0?t.value.converted_price=s.converted_price:t.value.converted_price=s.price},ce=()=>{I.value=null,t.value.amount_id=null,t.value.price=t.value._original_price!==void 0?t.value._original_price:t.value.price,t.value.converted_price=void 0},Q=()=>{var n;const e=b(S.value),s=b($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick");const o=((n=t.value.images)==null?void 0:n.length)||0;O.value=o,D.value=o>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:D.value,slidesToScroll:1,infinite:o>1,focusOnSelect:!0,rtl:C.value==="ar",asNavFor:s,afterChange:function(d){const p=t.value.images[d];p&&V(p.path)}}),s.slick({slidesToShow:1,slidesToScroll:1,infinite:o>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:C.value==="ar",asNavFor:e,afterChange:function(d){const p=t.value.images[d];p&&V(p.path)}})},le=()=>{const e=b(S.value),s=b($.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),s.slick("slickPrev"),ee())},de=()=>{const e=b(S.value),s=b($.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),s.slick("slickNext"),ee())},ee=()=>{const e=b(S.value);if(e.length&&e.hasClass("slick-initialized")){const o=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");V(o)}};we(async()=>{var e,s;await R(),(s=(e=t.value)==null?void 0:e.amounts)!=null&&s.length&&H(0,t.value.amounts[0]),M(()=>{Q(),J()}),window.addEventListener("currency-changed",R)}),Ce(()=>W.params.id,async e=>{var s,o;await R(),(o=(s=t.value)==null?void 0:s.amounts)!=null&&o.length&&H(0,t.value.amounts[0]),M(()=>{Q(),J()})}),Fe(()=>{const e=b($.value),s=b(S.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick")});const L=e=>k.isInFavorites(e.id),ue=async e=>{var s,o;try{if(L(e)){const n=k.favorites.find(d=>d.product_id===e.id);if(n){const d=n.favorite_id||n.id;await k.removeFromFavorites(d),m({title:u("success"),message:u("favorite_removed")||"Product removed from favorites",type:"success"})}}else{const n=await k.addToFavorites(e.id);n&&m({title:u("success"),message:n.message||u("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Error toggling child favorites:",n),m({title:u("error"),message:((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)||u("login_required_favorite")||"Login required to favorite product",type:"error"})}},ve=()=>{f.value<ae?f.value++:m({title:u("warning"),message:u("max_quantity_reached"),type:"warning"})},_e=()=>{f.value>se?f.value--:m({title:u("warning"),message:u("min_quantity_reached"),type:"warning"})},J=()=>{x(t.value.id)},pe=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),o=parseFloat(e.converted_price);return(o-o*(s/100)).toFixed(2)}return e.converted_price},j=z(()=>_.value?(_.value.converted_price!==void 0,_.value.converted_price):t.value.converted_price!==void 0?t.value.converted_price:t.value.price);z(()=>{if(t.value.discount&&t.value.discount.is_active){const e=parseFloat(t.value.discount.discount_value),s=parseFloat(j.value);return(s-s*(e/100)).toFixed(2)}return j.value});const _=z(()=>t.value.amounts&&t.value.amounts.length>0&&I.value!==null?t.value.amounts[I.value]:null),me=z(()=>{let e=_.value?parseFloat(_.value.price):parseFloat(t.value.price);if(t.value.discount&&t.value.discount.is_active){const s=parseFloat(t.value.discount.discount_value);return(e-e*(s/100)).toFixed(2)}return e});return(e,s)=>{const o=q("fa"),n=q("el-button"),d=q("el-col"),p=q("el-row"),T=q("router-link");return c(),l(E,null,[s[3]||(s[3]=i("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap",rel:"stylesheet"},null,-1)),v(Se),i("div",{class:"product-show",dir:oe.value},[i("div",Te,[v(p,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:w(()=>[v(d,{xs:24,sm:24,md:12,lg:14},{default:w(()=>[i("div",ze,[i("h1",qe,r(P(C)==="ar"?t.value.name_ar:t.value.name_en),1),i("div",{innerHTML:P(C)==="ar"?t.value.description_ar:t.value.description_en,class:"description"},null,8,Pe),i("div",Ee,[i("div",Ae,[t.value.discount&&t.value.discount.is_active?(c(),l("span",Ne,r(j.value)+" "+r(t.value.currency_code),1)):h("",!0),t.value.discount&&t.value.discount.is_active?(c(),l("span",Ve," -"+r(t.value.discount.discount_value)+"% ",1)):h("",!0)]),i("span",Le,r(me.value)+" "+r(t.value.currency_code),1)]),i("button",{onClick:s[0]||(s[0]=a=>ne(t.value)),class:F(["btn rounded-circle shadow-sm btn-light",x(t.value.id)?"text-danger":""]),title:x(t.value.id)?"Remove from favorites":"Add to favorites"},[v(o,{icon:x(t.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Be),i("div",Me,[t.value.is_available?h("",!0):(c(),l("div",Ue,r(e.$t("products.outOfStock")),1))]),t.value.amounts&&t.value.amounts.length>0?(c(),l("div",De,[i("h1",Oe,r(e.$t("amount.weight")),1),i("div",{class:"reset",onClick:ce},[v(o,{icon:"rotate-right"}),i("a",null,r(e.$t("amount.reset")),1)]),i("div",Re,[i("div",He,[(c(!0),l(E,null,U(t.value.amounts,(a,g)=>(c(),l("div",{key:a.id,class:F(["weight-item",{active:I.value===g}]),onClick:B=>H(g,a)},[i("p",null,r(a.weight)+" "+r(a.unit.name_en)+" For "+r(a.converted_price)+" "+r(t.value.currency_code),1)],10,Qe))),128))])]),_.value?(c(),l("div",Je,[i("p",null,[i("strong",null,r(e.$t("amount.selected"))+":",1),te(" "+r(_.value.weight)+" "+r(_.value.unit.name_en)+" - "+r(_.value.price)+" "+r(t.value.currency_code),1)])])):(c(),l("div",je,[i("p",null,r(e.$t("amount.noAmount")),1)]))])):h("",!0),i("div",Ke,[v(n,{class:"add-to-cart btn",disabled:!t.value.is_available,type:"primary",size:"large",round:"",onClick:re},{default:w(()=>[te(r(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),t.value.is_available?(c(),l("div",Ge,[i("div",We,[v(n,{size:"small",onClick:_e,disabled:f.value<=se,class:"qty-btn"},{default:w(()=>[v(o,{icon:"minus"})]),_:1},8,["disabled"]),$e(i("input",{class:"qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":s[1]||(s[1]=a=>f.value=a),onInput:s[2]||(s[2]=a=>f.value=Math.min(f.value))},null,544),[[xe,f.value,void 0,{number:!0}]]),v(n,{size:"small",onClick:ve,disabled:f.value>=ae,class:"qty-btn"},{default:w(()=>[v(o,{icon:"plus"})]),_:1},8,["disabled"])])])):h("",!0)])])]),_:1}),v(d,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:w(()=>[i("div",{class:"image-wrapper",ref_key:"main",ref:$},[(c(!0),l(E,null,U(t.value.images,(a,g)=>(c(),l("div",{key:a.id,class:"slide"},[i("img",{src:N(A.value),class:"main-image",onError:Y},null,40,Xe)]))),128))],512),i("div",Ye,[O.value>1?(c(),l("button",{key:0,class:"btn nav-button left",onClick:le},[v(o,{icon:"arrow-left"})])):h("",!0),i("div",{class:F(["slider-container",{"centered-slides":D.value<3}])},[i("div",{class:"slider",ref_key:"slider",ref:S},[(c(!0),l(E,null,U(t.value.images,(a,g)=>(c(),l("div",{key:a.id,class:"slide",onClick:B=>V(a.path)},[i("img",{src:N(a.path),class:F({active:A.value===a.path}),onError:Y},null,42,et)],8,Ze))),128))],512)],2),O.value>1?(c(),l("button",{key:1,class:"btn nav-button right",onClick:de},[v(o,{icon:"arrow-right"})])):h("",!0)])]),_:1})]),_:1}),t.value.children&&t.value.children.length>0?(c(),l("div",tt,[i("div",st,[v(o,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),i("h2",at,r(P(u)("products.relatedProducts")),1)]),i("div",ot,[(c(!0),l(E,null,U(t.value.children,a=>(c(),l("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[i("div",it,[i("div",nt,[v(T,{to:`/read/products/${a.id}`},{default:w(()=>{var g;return[i("img",{src:(g=a.images)!=null&&g.length?N(a.images[0].path):G,alt:P(C)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,rt)]}),_:2},1032,["to"]),a.is_available?h("",!0):(c(),l("div",ct,r(e.$t("products.outOfStock")),1)),i("div",lt,[v(T,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:w(()=>[v(o,{icon:"eye"})]),_:2},1032,["to"]),i("button",{onClick:g=>Z(a),class:F(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},r(e.$t("home.add-to-cart")),11,dt),i("button",{onClick:g=>Z(a),class:F(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[v(o,{icon:"cart-plus"})],10,ut),i("button",{onClick:g=>ue(a),class:F(["btn rounded-circle shadow-sm btn-light",L(a)?"text-danger":""]),title:L(a)?"Remove from favorites":"Add to favorites"},[v(o,{icon:L(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,vt)])]),i("div",_t,[i("h5",pt,r(P(C)==="ar"?a.name_ar:a.name_en),1),i("div",mt,[a.discount&&a.discount.is_active?(c(),l("span",gt," -"+r(a.discount.discount_value)+"% ",1)):h("",!0),a.discount&&a.discount.is_active?(c(),l("span",ft,r(a.converted_price||a.price)+" "+r(a.currency_code||"UAE"),1)):h("",!0),i("span",ht,r(pe(a))+" "+r(a.currency_code||"UAE"),1)])])])]))),128))])])):h("",!0)])],8,Ie)],64)}}},Ct=ge(kt,[["__scopeId","data-v-414a48e6"]]);export{Ct as default};

import{_ as ge,C as fe,K as L,L as he,M as ke,z as ye,B as be,y as h,D as we,x as M,N as Ce,O as Fe,r as z,o as r,c as l,a as o,e as d,q as C,t as n,E as q,F as A,d as R,f,b as G,H as Se,n as S,m as te,w as $e,v as xe,G as p}from"./index-ae750e8a.js";import{$ as k}from"./slick-theme-e84a4209.js";const Ie=["dir"],Te={class:"container"},ze={class:"product-details"},qe={class:"product-title"},Ae=["innerHTML"],Ee={class:"price-block"},Ne={class:"d-flex"},Pe={key:0,class:"price-old"},Ve={key:1,class:"discount-badge"},Be={class:"price-new"},Le=["title"],Me={class:"product-actions"},Re={key:0,class:"sale-badge"},Ue={key:0,class:"weight"},De={class:"weight-container"},Oe={class:"row g-4"},He=["onClick"],Qe={key:0,class:"amount-details",style:{"margin-top":"1rem"}},Je={key:1},je={class:"buttons-section"},Ge={key:0,class:"quantity-section"},Ke={class:"quantity-control"},We=["src"],Xe={class:"slider-wrapper"},Ye=["onClick"],Ze=["src"],et={key:0,class:"children-products-section"},tt={class:"title section-header d-flex align-items-center mb-4"},st={class:"mb-0"},at={class:"row g-3"},it={class:"product-card card border-0 h-100"},ot={class:"position-relative overflow-hidden bg-light"},nt=["src","alt"],rt={key:0,class:"sale-badge"},lt={class:"product-actions d-flex justify-content-center gap-2 w-100"},ct=["onClick","disabled"],dt=["onClick","disabled"],ut=["onClick","title"],vt={class:"card-body"},_t={class:"card-title"},pt={class:"price-container"},mt={key:0,class:"discount-badge"},gt={key:1,class:"price-old"},ft={class:"card-text card-price"},se=1,ae=99,K="/default-image.jpg",ht={__name:"showProduct",setup(kt){const{locale:F,t:u}=fe(),ie=L(()=>F.value==="ar"?"rtl":"ltr"),W=he();ke();const y=ye(),X=be(),s=h({}),g=h(1),E=h(null);h(0);const $=h(null),x=h(null),U=h(3),D=h(3),I=e=>y.favorites.some(t=>t.product_id===e),oe=e=>{var t;return(t=y.favorites.find(i=>i.product_id===e))==null?void 0:t.id},ne=async e=>{var t,i;try{if(I(e.id)){const c=oe(e.id);c&&(await y.removeFromFavorites(c),p.success(u("Product Removed From Favorites")))}else{const c=await y.addToFavorites(e.id);p.success(c.message||u("Product Added To Favorites"))}}catch(c){console.error("Favorite error:",c),p.error(((i=(t=c.response)==null?void 0:t.data)==null?void 0:i.message)||u("Login required to favorite product"))}},re=async()=>{var e,t;try{let i=0;if(s.value.discount&&s.value.discount.is_active){const _=parseFloat(s.value.discount.discount_value),w=parseFloat(s.value.converted_price||s.value.price);i=w-w*(_/100)}else i=parseFloat(s.value.converted_price)||parseFloat(s.value.price);const c={product_id:s.value.id,quantity:g.value,price:i};s.value.amounts&&(c.amount_id=s.value.amount_id);const v=await G.post("https://backend.webenia.org/api/cart-items",c,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});v.data.status?(p.success(v.data.message),X.incrementCount(),await X.fetchCartCount()):p.error(v.data.message)}catch(i){p.error(((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||u("Error adding product to cart"))}},N=e=>e?`https://backend.webenia.org/public/storage/${e}`:K,Y=e=>{e.target.src=K},P=e=>{E.value=e,M(()=>{const t=document.querySelector(".main-image");t&&(t.src=N(e))})},O=async()=>{var e;try{const t=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},i=await G.get(`https://backend.webenia.org/api/website/show/products/${W.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:t.code}});i.data.status&&(s.value=i.data.data,s.value._original_price=s.value.price,(e=s.value.images)!=null&&e.length&&(E.value=s.value.images[0].path,M(()=>{Q(),J()})))}catch(t){console.error("Error fetching product:",t)}},Z=async e=>{var t,i,c;try{let v=0;if(e.discount&&e.discount.is_active){const m=parseFloat(e.discount.discount_value),B=parseFloat(e.converted_price||e.price);v=B-B*(m/100)}else v=parseFloat(e.converted_price)||parseFloat(e.price);const _={product_id:e.id,quantity:1,price:v},w=(t=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:t.id;w&&(_.user_id=w),e.amounts&&(_.amount_id=e.amount_id);const a=await G.post("https://backend.webenia.org/api/cart-items",_,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&p({title:u("success"),message:a.data.message,type:"success"})}catch(v){console.error("Error adding child product to cart:",v),p({title:"❌",message:((c=(i=v.response)==null?void 0:i.data)==null?void 0:c.message)||u("add_to_cart_error")||"Login required to add to cart",type:"error"})}},T=h(null),H=(e,t)=>{T.value=e,s.value.amount_id=t.id,s.value.price=t.price,t.converted_price!==void 0?s.value.converted_price=t.converted_price:s.value.converted_price=t.price},le=()=>{T.value=null,s.value.amount_id=null,s.value.price=s.value._original_price!==void 0?s.value._original_price:s.value.price,s.value.converted_price=void 0},Q=()=>{var c;const e=k($.value),t=k(x.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick");const i=((c=s.value.images)==null?void 0:c.length)||0;D.value=i,U.value=i>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:U.value,slidesToScroll:1,infinite:i>1,focusOnSelect:!0,rtl:F.value==="ar",asNavFor:t,afterChange:function(v){const _=s.value.images[v];_&&P(_.path)}}),t.slick({slidesToShow:1,slidesToScroll:1,infinite:i>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:F.value==="ar",asNavFor:e,afterChange:function(v){const _=s.value.images[v];_&&P(_.path)}})},ce=()=>{const e=k($.value),t=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),t.slick("slickPrev"),ee())},de=()=>{const e=k($.value),t=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),t.slick("slickNext"),ee())},ee=()=>{const e=k($.value);if(e.length&&e.hasClass("slick-initialized")){const i=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");P(i)}};we(async()=>{var e,t;await O(),(t=(e=s.value)==null?void 0:e.amounts)!=null&&t.length&&H(0,s.value.amounts[0]),M(()=>{Q(),J()}),window.addEventListener("currency-changed",O)}),Ce(()=>W.params.id,async e=>{var t,i;await O(),(i=(t=s.value)==null?void 0:t.amounts)!=null&&i.length&&H(0,s.value.amounts[0]),M(()=>{Q(),J()})}),Fe(()=>{const e=k(x.value),t=k($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick")});const V=e=>y.isInFavorites(e.id),ue=async e=>{try{if(V(e)){const t=y.favorites.find(i=>i.product_id===e.id);t&&(await y.removeFromFavorites(t.id),p({title:u("Removed From Favorites"),message:u("Product Removed From Favorites"),type:"success"}))}else await y.addToFavorites(e.id)&&p({title:u("Added To Favorites"),message:u("Product Added To Favorites"),type:"success"})}catch(t){console.error("Error toggling child favorites:",t),p({title:u("error"),message:t.message||u("failed_to_toggle_favorite"),type:"error"})}},ve=()=>{g.value<ae?g.value++:p({title:u("warning"),message:u("max_quantity_reached"),type:"warning"})},_e=()=>{g.value>se?g.value--:p({title:u("warning"),message:u("min_quantity_reached"),type:"warning"})},J=()=>{I(s.value.id)},pe=e=>{if(e.discount&&e.discount.is_active){const t=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(t/100)).toFixed(2)}return e.converted_price||e.price},j=L(()=>b.value?b.value.converted_price!==void 0?b.value.converted_price:b.value.price:s.value._original_price!==void 0?s.value._original_price:s.value.price),me=L(()=>{if(s.value.discount&&s.value.discount.is_active){const e=parseFloat(s.value.discount.discount_value),t=parseFloat(j.value);return(t-t*(e/100)).toFixed(2)}return j.value}),b=L(()=>s.value.amounts&&s.value.amounts.length>0&&T.value!==null?s.value.amounts[T.value]:null);return(e,t)=>{const i=z("fa"),c=z("el-button"),v=z("el-col"),_=z("el-row"),w=z("router-link");return r(),l(A,null,[t[7]||(t[7]=o("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap",rel:"stylesheet"},null,-1)),d(Se),o("div",{class:"product-show",dir:ie.value},[o("div",Te,[d(_,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:C(()=>[d(v,{xs:24,sm:24,md:12,lg:14},{default:C(()=>[o("div",ze,[o("h1",qe,n(q(F)==="ar"?s.value.name_ar:s.value.name_en),1),o("div",{innerHTML:q(F)==="ar"?s.value.description_ar:s.value.description_en,class:"description"},null,8,Ae),o("div",Ee,[o("div",Ne,[s.value.discount&&s.value.discount.is_active?(r(),l("span",Pe,n(j.value)+" "+n(s.value.currency_code),1)):f("",!0),s.value.discount&&s.value.discount.is_active?(r(),l("span",Ve," -"+n(s.value.discount.discount_value)+"% ",1)):f("",!0)]),o("span",Be,n(me.value)+" "+n(s.value.currency_code),1)]),o("button",{onClick:t[0]||(t[0]=a=>ne(s.value)),class:S(["btn rounded-circle shadow-sm btn-light",I(s.value.id)?"text-danger":""]),title:I(s.value.id)?"Remove from favorites":"Add to favorites"},[d(i,{icon:I(s.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Le),o("div",Me,[s.value.is_available?f("",!0):(r(),l("div",Re,n(e.$t("products.outOfStock")),1))]),s.value.amounts&&s.value.amounts.length>0?(r(),l("div",Ue,[t[6]||(t[6]=o("h1",{class:"weight-title"},"Select Weight",-1)),o("div",{class:"reset",onClick:le},[d(i,{icon:"rotate-right"}),t[3]||(t[3]=o("a",null,"reset",-1))]),o("div",De,[o("div",Oe,[(r(!0),l(A,null,R(s.value.amounts,(a,m)=>(r(),l("div",{key:a.id,class:S(["weight-item",{active:T.value===m}]),onClick:B=>H(m,a)},[o("p",null,n(a.weight)+" "+n(a.unit.name_en)+" For "+n(a.price)+" "+n(s.value.currency_code),1)],10,He))),128))])]),b.value?(r(),l("div",Qe,[o("p",null,[t[4]||(t[4]=o("strong",null,"Selected:",-1)),te(" "+n(b.value.weight)+" "+n(b.value.unit.name_en)+" - "+n(b.value.price)+" "+n(s.value.currency_code),1)])])):(r(),l("div",Je,t[5]||(t[5]=[o("p",null,"No amount selected.",-1)])))])):f("",!0),o("div",je,[d(c,{class:"add-to-cart btn",disabled:!s.value.is_available,type:"primary",size:"large",round:"",onClick:re},{default:C(()=>[te(n(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),s.value.is_available?(r(),l("div",Ge,[o("div",Ke,[d(c,{size:"small",onClick:_e,disabled:g.value<=se,class:"qty-btn"},{default:C(()=>[d(i,{icon:"minus"})]),_:1},8,["disabled"]),$e(o("input",{class:"qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),onInput:t[2]||(t[2]=a=>g.value=Math.min(g.value))},null,544),[[xe,g.value,void 0,{number:!0}]]),d(c,{size:"small",onClick:ve,disabled:g.value>=ae,class:"qty-btn"},{default:C(()=>[d(i,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),d(v,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:C(()=>[o("div",{class:"image-wrapper",ref_key:"main",ref:x},[(r(!0),l(A,null,R(s.value.images,(a,m)=>(r(),l("div",{key:a.id,class:"slide"},[o("img",{src:N(E.value),class:"main-image",onError:Y},null,40,We)]))),128))],512),o("div",Xe,[D.value>1?(r(),l("button",{key:0,class:"btn nav-button left",onClick:ce},[d(i,{icon:"arrow-left"})])):f("",!0),o("div",{class:S(["slider-container",{"centered-slides":U.value<3}])},[o("div",{class:"slider",ref_key:"slider",ref:$},[(r(!0),l(A,null,R(s.value.images,(a,m)=>(r(),l("div",{key:a.id,class:"slide",onClick:B=>P(a.path)},[o("img",{src:N(a.path),class:S({active:E.value===a.path}),onError:Y},null,42,Ze)],8,Ye))),128))],512)],2),D.value>1?(r(),l("button",{key:1,class:"btn nav-button right",onClick:de},[d(i,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),s.value.children&&s.value.children.length>0?(r(),l("div",et,[o("div",tt,[d(i,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),o("h2",st,n(q(u)("products.relatedProducts")),1)]),o("div",at,[(r(!0),l(A,null,R(s.value.children,a=>(r(),l("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[o("div",it,[o("div",ot,[d(w,{to:`/read/products/${s.value.id}`},{default:C(()=>{var m;return[o("img",{src:(m=a.images)!=null&&m.length?N(a.images[0].path):K,alt:q(F)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,nt)]}),_:2},1032,["to"]),a.is_available?f("",!0):(r(),l("div",rt,n(e.$t("products.outOfStock")),1)),o("div",lt,[d(w,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:C(()=>[d(i,{icon:"eye"})]),_:2},1032,["to"]),o("button",{onClick:m=>Z(a),class:S(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},n(e.$t("home.add-to-cart")),11,ct),o("button",{onClick:m=>Z(a),class:S(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[d(i,{icon:"cart-plus"})],10,dt),o("button",{onClick:m=>ue(a),class:S(["btn rounded-circle shadow-sm btn-light",V(a)?"text-danger":""]),title:V(a)?"Remove from favorites":"Add to favorites"},[d(i,{icon:V(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,ut)])]),o("div",vt,[o("h5",_t,n(q(F)==="ar"?a.name_ar:a.name_en),1),o("div",pt,[a.discount&&a.discount.is_active?(r(),l("span",mt," -"+n(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(r(),l("span",gt,n(a.converted_price||a.price)+" "+n(a.currency_code||"UAE"),1)):f("",!0),o("span",ft,n(pe(a))+" "+n(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,Ie)],64)}}},wt=ge(ht,[["__scopeId","data-v-6c477f41"]]);export{wt as default};

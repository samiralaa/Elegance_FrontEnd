import{_ as ge,C as fe,L as z,M as he,D as ke,z as ye,B as be,y,E as we,x as U,N as Ce,O as Fe,r as q,o as l,c as d,e as v,a as i,p as w,t as r,G as P,F as E,d as D,f as h,b as W,H as Se,n as S,m as se,w as $e,v as Ie,j as xe,I as m}from"./index-2c18e476.js";import{$ as b}from"./slick-theme-c7a72e66.js";const Te=["dir"],ze={class:"container"},qe={class:"product-details"},Pe={class:"product-title"},Ee=["innerHTML"],Ae={class:"price-block"},Ne={class:"d-flex"},Ve={key:0,class:"price-old"},Le={key:1,class:"discount-badge"},Be={class:"price-new"},Me=["title"],Ue={class:"product-actions"},De={key:0,class:"sale-badge"},Oe={key:0,class:"weight"},Re={class:"weight-title"},He={class:"weight-container"},Qe={class:"row g-4"},Je=["onClick"],je={key:0,class:"amount-details",style:{"margin-top":"1rem"}},Ge={key:1},Ke={class:"buttons-section"},We={key:0,class:"quantity-section"},Xe={class:"quantity-control"},Ye=["src"],Ze={class:"slider-wrapper"},et=["onClick"],tt=["src"],st={key:0,class:"children-products-section"},at={class:"title section-header d-flex align-items-center mb-4"},ot={class:"mb-0"},it={class:"row g-3"},nt={class:"product-card card border-0 h-100"},rt={class:"position-relative overflow-hidden bg-light"},ct=["src","alt"],lt={key:0,class:"sale-badge"},dt={class:"product-actions d-flex justify-content-center gap-2 w-100"},ut=["onClick","disabled"],vt=["onClick","disabled"],_t=["onClick","title"],pt={class:"card-body"},mt={class:"card-title"},gt={class:"price-container"},ft={key:0,class:"discount-badge"},ht={key:1,class:"price-old"},kt={class:"card-text card-price"},ae=1,oe=99,X="/default-image.jpg",yt={__name:"showProduct",setup(bt){const{locale:C,t:c}=fe(),O=z(()=>C.value==="ar"?"rtl":"ltr"),Y=he();ke();const k=ye(),A=be(),t=y({}),f=y(1),N=y(null);y(0);const $=y(null),I=y(null),R=y(3),H=y(3),x=e=>k.favorites.some(s=>s.product_id===e),ie=e=>{var s,o;return((s=k.favorites.find(n=>n.product_id===e))==null?void 0:s.favorite_id)||((o=k.favorites.find(n=>n.product_id===e))==null?void 0:o.id)},ne=async e=>{var s,o;try{if(x(e.id)){const n=ie(e.id);n&&(await k.removeFromFavorites(n),m({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await k.addToFavorites(e.id);m({title:c("success"),message:n.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Favorite error:",n),m({title:c("error"),message:((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},re=async()=>{var e,s,o;try{let n=0;if(_.value?n=parseFloat((e=_.value)==null?void 0:e.price):n=parseFloat(t.value.converted_price),t.value.discount&&t.value.discount.is_active){const F=parseFloat(t.value.discount.discount_value);n=n-n*(F/100)}const u={product_id:t.value.id,quantity:f.value,price:n};_.value&&(u.amount_id=_.value.id);const p=await W.post("https://backend.webenia.org/api/cart-items",u,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});p.data.status?(m({title:c("success"),message:c("Products.addedSussess"),type:"success"}),A.incrementCount(),await A.fetchCartCount()):m.error(p.data.message)}catch(n){m.error(((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)||c("Error adding product to cart"))}},V=e=>e?`https://backend.webenia.org/public/storage/${e}`:X,Z=e=>{e.target.src=X},L=e=>{N.value=e,U(()=>{const s=document.querySelector(".main-image");s&&(s.src=V(e))})},Q=async()=>{var e;try{const s=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},o=await W.get(`https://backend.webenia.org/api/website/show/products/${Y.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:s.code}});o.data.status&&(t.value=o.data.data,t.value._original_price=t.value.converted_price,(e=t.value.images)!=null&&e.length&&(N.value=t.value.images[0].path,U(()=>{j(),G()})))}catch(s){console.error("Error fetching product:",s)}},ee=async e=>{var s,o,n;try{let u=0;if(e.discount&&e.discount.is_active){const g=parseFloat(e.discount.discount_value),M=parseFloat(e.price);u=M-M*(g/100)}else u=parseFloat(e.price);const p={product_id:e.id,quantity:1,price:u},F=(s=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:s.id;F&&(p.user_id=F),e.amounts&&(p.amount_id=e.amount_id);const a=await W.post("https://backend.webenia.org/api/cart-items",p,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&(m({title:c("success"),message:a.data.message,type:"success"}),A.incrementCount(),await A.fetchCartCount())}catch(u){console.error("Error adding child product to cart:",u),m({title:"❌",message:((n=(o=u.response)==null?void 0:o.data)==null?void 0:n.message)||c("add_to_cart_error")||"Login required to add to cart",type:"error"})}},T=y(null),J=(e,s)=>{T.value=e,t.value.amount_id=s.id,t.value.price=s.price,s.converted_price!==void 0?t.value.converted_price=s.converted_price:t.value.converted_price=s.price},ce=()=>{T.value=0,t.value.amount_id=null,t.value.price=t.value._original_price!==void 0?t.value._original_price:t.value.price,t.value.converted_price=void 0},j=()=>{var n;const e=b($.value),s=b(I.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick");const o=((n=t.value.images)==null?void 0:n.length)||0;H.value=o,R.value=o>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:R.value,slidesToScroll:1,infinite:o>1,focusOnSelect:!0,rtl:C.value==="ar",asNavFor:s,afterChange:function(u){const p=t.value.images[u];p&&L(p.path)}}),s.slick({slidesToShow:1,slidesToScroll:1,infinite:o>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:C.value==="ar",asNavFor:e,afterChange:function(u){const p=t.value.images[u];p&&L(p.path)}})},le=()=>{const e=b($.value),s=b(I.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),s.slick("slickPrev"),te())},de=()=>{const e=b($.value),s=b(I.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),s.slick("slickNext"),te())},te=()=>{const e=b($.value);if(e.length&&e.hasClass("slick-initialized")){const o=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");L(o)}};we(async()=>{var e,s;await Q(),(s=(e=t.value)==null?void 0:e.amounts)!=null&&s.length&&J(0,t.value.amounts[0]),U(()=>{j(),G()}),window.addEventListener("currency-changed",Q)}),Ce(()=>Y.params.id,async e=>{var s,o;await Q(),(o=(s=t.value)==null?void 0:s.amounts)!=null&&o.length&&J(0,t.value.amounts[0]),U(()=>{j(),G()})}),Fe(()=>{const e=b(I.value),s=b($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick")});const B=e=>k.isInFavorites(e.id),ue=async e=>{var s,o;try{if(B(e)){const n=k.favorites.find(u=>u.product_id===e.id);if(n){const u=n.favorite_id||n.id;await k.removeFromFavorites(u),m({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"})}}else{const n=await k.addToFavorites(e.id);n&&m({title:c("success"),message:n.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Error toggling child favorites:",n),m({title:c("error"),message:((o=(s=n.response)==null?void 0:s.data)==null?void 0:o.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},ve=()=>{f.value<oe?f.value++:m({title:c("warning"),message:c("max_quantity_reached"),type:"warning"})},_e=()=>{f.value>ae?f.value--:m({title:c("warning"),message:c("min_quantity_reached"),type:"warning"})},G=()=>{x(t.value.id)},pe=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),o=parseFloat(e.converted_price);return(o-o*(s/100)).toFixed(2)}return e.converted_price},K=z(()=>_.value?_.value.converted_price!==void 0?_.value.converted_price:_.value.price:t.value.converted_price!==void 0?t.value.converted_price:t.value.price);z(()=>{if(t.value.discount&&t.value.discount.is_active){const e=parseFloat(t.value.discount.discount_value),s=parseFloat(K.value);return(s-s*(e/100)).toFixed(2)}return K.value});const _=z(()=>t.value.amounts&&t.value.amounts.length>0&&T.value!==null?t.value.amounts[T.value]:null),me=z(()=>{var s;let e;if(e=_.value?parseFloat((s=_.value)==null?void 0:s.converted_price):parseFloat(t.value.converted_price),t.value.discount&&t.value.discount.is_active){const o=parseFloat(t.value.discount.discount_value);return e=e-e*(o/100),e.toFixed(2)}return e});return(e,s)=>{const o=q("fa"),n=q("el-button"),u=q("el-col"),p=q("el-row"),F=q("router-link");return l(),d(E,null,[v(Se),i("div",{class:"product-show",dir:O.value},[i("div",ze,[v(p,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:w(()=>[v(u,{xs:24,sm:24,md:12,lg:14},{default:w(()=>[i("div",qe,[i("h1",Pe,r(P(C)==="ar"?t.value.name_ar:t.value.name_en),1),i("div",{innerHTML:P(C)==="ar"?t.value.description_ar:t.value.description_en,class:"description"},null,8,Ee),i("div",Ae,[i("div",Ne,[t.value.discount&&t.value.discount.is_active?(l(),d("span",Ve,r(K.value)+" "+r(t.value.currency_code),1)):h("",!0),t.value.discount&&t.value.discount.is_active?(l(),d("span",Le," -"+r(t.value.discount.discount_value)+"% ",1)):h("",!0)]),i("span",Be,r(me.value||0)+" "+r(t.value.currency_code),1),i("button",{onClick:s[0]||(s[0]=a=>ne(t.value)),class:S(["love-btn btn rounded-circle shadow-sm btn-light",x(t.value.id)?"text-danger":""]),title:x(t.value.id)?"Remove from favorites":"Add to favorites"},[v(o,{icon:x(t.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Me)]),i("div",Ue,[t.value.is_available?h("",!0):(l(),d("div",De,r(e.$t("products.outOfStock")),1))]),t.value.amounts&&t.value.amounts.length>0?(l(),d("div",Oe,[i("h1",Re,r(e.$t("amount.weight")),1),i("div",{class:"reset",onClick:ce},[v(o,{icon:"rotate-right"}),i("a",null,r(e.$t("amount.reset")),1)]),i("div",He,[i("div",Qe,[(l(!0),d(E,null,D(t.value.amounts,(a,g)=>(l(),d("div",{key:a.id,class:S(["weight-item",{active:T.value===g}]),onClick:M=>J(g,a)},[i("p",null,r(O.value==="rtl"?a.weight+""+a.unit.name_en:a.weight+" "+a.unit.name_en)+" For "+r(a.converted_price)+" "+r(t.value.currency_code),1)],10,Je))),128))])]),_.value?(l(),d("div",je,[i("p",null,[i("strong",null,r(e.$t("amount.selected"))+":",1),se(" "+r(O.value==="rtl"?_.value.weight+""+_.value.unit.name_en:_.value.unit.name_en+" "+_.value.weight)+" - "+r(_.value.converted_price)+" "+r(t.value.currency_code),1)])])):(l(),d("div",Ge,[i("p",null,r(e.$t("amount.noAmount")),1)]))])):h("",!0),i("div",Ke,[v(n,{class:"add-to-cart btn",disabled:!t.value.is_available,type:"primary",size:"large",round:"",onClick:re},{default:w(()=>[se(r(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),t.value.is_available?(l(),d("div",We,[i("div",Xe,[v(n,{size:"small",onClick:_e,disabled:f.value<=ae,class:"qty-btn"},{default:w(()=>[v(o,{icon:"minus"})]),_:1},8,["disabled"]),$e(i("input",{dir:"ltr",class:"form-control qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":s[1]||(s[1]=a=>f.value=a),onInput:s[2]||(s[2]=a=>f.value=Math.min(f.value))},null,544),[[Ie,f.value,void 0,{number:!0}]]),v(n,{size:"small",onClick:ve,disabled:f.value>=oe,class:"qty-btn"},{default:w(()=>[v(o,{icon:"plus"})]),_:1},8,["disabled"])])])):h("",!0)])])]),_:1}),v(u,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:w(()=>[i("div",{class:"image-wrapper",ref_key:"main",ref:I},[(l(!0),d(E,null,D(t.value.images,(a,g)=>(l(),d("div",{key:a.id,class:"slide"},[i("img",{src:V(N.value),class:"main-image",onError:Z},null,40,Ye)]))),128))],512),i("div",Ze,[H.value>1?(l(),d("button",{key:0,class:"btn nav-button left",onClick:le},[v(o,{icon:"arrow-left"})])):h("",!0),i("div",{class:S(["slider-container",{"centered-slides":R.value<3}])},[i("div",{class:"slider",ref_key:"slider",ref:$},[(l(!0),d(E,null,D(t.value.images,(a,g)=>(l(),d("div",{key:a.id,class:"slide",onClick:M=>L(a.path)},[i("img",{src:V(a.path),class:S({active:N.value===a.path}),onError:Z},null,42,tt)],8,et))),128))],512)],2),H.value>1?(l(),d("button",{key:1,class:"btn nav-button right",onClick:de},[v(o,{icon:"arrow-right"})])):h("",!0)])]),_:1})]),_:1}),t.value.children&&t.value.children.length>0?(l(),d("div",st,[i("div",at,[v(o,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),i("h2",ot,r(P(c)("products.relatedProducts")),1)]),i("div",it,[(l(!0),d(E,null,D(t.value.children,a=>(l(),d("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[i("div",nt,[i("div",rt,[v(F,{to:`/read/products/${a.id}`},{default:w(()=>{var g;return[i("img",{src:(g=a.images)!=null&&g.length?V(a.images[0].path):X,alt:P(C)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,ct)]}),_:2},1032,["to"]),a.is_available?h("",!0):(l(),d("div",lt,r(e.$t("products.outOfStock")),1)),i("div",dt,[v(F,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:w(()=>[v(o,{icon:"eye"})]),_:2},1032,["to"]),i("button",{onClick:g=>ee(a),class:S(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},r(e.$t("home.add-to-cart")),11,ut),i("button",{onClick:g=>ee(a),class:S(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[v(o,{icon:"cart-plus"})],10,vt),i("button",{onClick:g=>ue(a),class:S(["btn rounded-circle shadow-sm btn-light",B(a)?"text-danger":""]),title:B(a)?"Remove from favorites":"Add to favorites"},[v(o,{icon:B(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,_t)])]),i("div",pt,[i("h5",mt,r(P(C)==="ar"?a.name_ar:a.name_en),1),i("div",gt,[a.discount&&a.discount.is_active?(l(),d("span",ft," -"+r(a.discount.discount_value)+"% ",1)):h("",!0),a.discount&&a.discount.is_active?(l(),d("span",ht,r(a.converted_price||a.price)+" "+r(a.currency_code||"UAE"),1)):h("",!0),i("span",kt,r(pe(a))+" "+r(a.currency_code||"UAE"),1)])])])]))),128))])])):h("",!0)])],8,Te),v(xe)],64)}}},Ft=ge(yt,[["__scopeId","data-v-f96ae6af"]]);export{Ft as default};

import{_ as L,o as p,c as g,a as s,t as d,n as b,A as f,b as _,r as D,F as q,d as B,e as O,f as w,w as z,g as A,v as U,h as x,i as P,H,j as R}from"./index-e527976a.js";const K={name:"CheckoutStepper",props:{step:{type:Number,required:!0}}},X={class:"stepper"},Y={class:"step-label"},ee={class:"step-label"},te={class:"step-label"};function se(t,e,r,o,a,n){return p(),g("div",X,[s("div",{class:b(["step",{active:r.step>=1,completed:r.step>1}])},[e[0]||(e[0]=s("div",{class:"step-number"},"1",-1)),s("div",Y,d(t.$t("checkout.cart")),1)],2),s("div",{class:b(["step-line",{active:r.step>1}])},null,2),s("div",{class:b(["step",{active:r.step>=2,completed:r.step>2}])},[e[1]||(e[1]=s("div",{class:"step-number"},"2",-1)),s("div",ee,d(t.$t("checkout.shipping")),1)],2),s("div",{class:b(["step-line",{active:r.step>2}])},null,2),s("div",{class:b(["step",{active:r.step>=3}])},[e[2]||(e[2]=s("div",{class:"step-number"},"3",-1)),s("div",te,d(t.$t("checkout.payment")),1)],2)])}const re=L(K,[["render",se],["__scopeId","data-v-4a5013a8"]]);const ae={name:"CartReview",props:{cartItems:{type:Array,required:!0},shippingCost:{type:Number,required:!0}},computed:{currentLang(){return localStorage.getItem("lang")||"en"},currency(){if(this.cartItems.length===0)return"";const t=this.cartItems[0].currency;return t?this.currentLang==="ar"?t.name_ar:t.name_en:""},subtotal(){return this.cartItems.reduce((t,e)=>t+parseFloat(e.price)*e.quantity,0).toFixed(2)},total(){return(parseFloat(this.subtotal)+this.shippingCost).toFixed(2)}},methods:{getProductImage(t){return t.images&&Array.isArray(t.images)?`${f}/public/storage/${t.images[0]}`:`${f}/images/default.jpg`},async updateQuantity(t,e){var o,a,n;const r=t.quantity+e;if(r<1){this.$toast.warning(this.$t("checkout.minimumQuantity"));return}try{const i=await _.post(`${f}/api/cart-items/${t.id}`,{quantity:r},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(i.data&&i.data.success){const l=i.data.data;t.quantity=l.quantity??r,t.price=l.price??t.price,this.$toast.success(this.$t("checkout.quantityUpdated")),this.$emit("update-cart",[...this.cartItems])}else{const l=((o=i.data)==null?void 0:o.message)||this.$t("checkout.errorUpdatingQuantity");this.$toast.error(l)}}catch(i){console.error("Error updating quantity:",i);const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||this.$t("checkout.errorUpdatingQuantity");this.$toast.error(l)}},async removeItem(t){try{await _.delete(`${f}/api/cart-items/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),this.$emit("update-cart",this.cartItems.filter(e=>e.id!==t)),this.$toast.success(this.$t("checkout.itemRemoved"))}catch(e){console.error("Error removing item:",e),this.$toast.error(this.$t("checkout.errorRemovingItem"))}}}},ie={class:"checkout-step"},ne={class:"cart-items"},oe=["src","alt"],de={class:"item-details"},ce={class:"item-price"},le={class:"quantity-controls"},ue=["onClick","disabled"],pe=["onClick"],he=["onClick"],me={class:"cart-summary"},ge={class:"summary-row"},ye={class:"summary-row"},_e={class:"summary-row total"},ve=["disabled"];function fe(t,e,r,o,a,n){const i=D("fa");return p(),g("div",ie,[s("h2",null,d(t.$t("checkout.reviewCart")),1),s("div",ne,[(p(!0),g(q,null,B(r.cartItems,l=>{var y,S,I,k,C;return p(),g("div",{key:l.id,class:"cart-item"},[s("img",{src:n.getProductImage(l),alt:((y=l.product)==null?void 0:y.name_en)||"",class:"item-image"},null,8,oe),s("div",de,[s("h3",null,d(n.currentLang==="ar"?(S=l.product)==null?void 0:S.name_ar:(I=l.product)==null?void 0:I.name_en),1),s("p",ce,d(l.price)+" "+d(n.currentLang==="ar"?(k=l.currency)==null?void 0:k.name_ar:(C=l.currency)==null?void 0:C.name_en),1),s("div",le,[s("button",{onClick:u=>n.updateQuantity(l,-1),disabled:l.quantity<=1},"-",8,ue),s("span",null,d(l.quantity),1),s("button",{onClick:u=>n.updateQuantity(l,1)},"+",8,pe)])]),s("button",{class:"remove-item",onClick:u=>n.removeItem(l.id)},[O(i,{icon:"trash"})],8,he)])}),128))]),s("div",me,[s("div",ge,[s("span",null,d(t.$t("checkout.subtotal")),1),s("span",null,d(n.subtotal)+" "+d(n.currency),1)]),s("div",ye,[s("span",null,d(t.$t("checkout.shipping")),1),s("span",null,d(r.shippingCost)+" "+d(n.currency),1)]),s("div",_e,[s("span",null,d(t.$t("checkout.total")),1),s("span",null,d(n.total)+" "+d(n.currency),1)])]),s("button",{class:"btn-primary",onClick:e[0]||(e[0]=l=>t.$emit("next-step")),disabled:!r.cartItems.length},d(t.$t("checkout.continueToShipping")),9,ve)])}const be=L(ae,[["render",fe],["__scopeId","data-v-1274088d"]]);const Se={name:"ShippingDetails",props:{modelValue:{type:Object,required:!0}},data(){return{savedAddresses:[],selectedAddressId:null,loading:!1,error:null,selectedAddress:null,isNewAddress:!1,countries:[],countryLoading:!1}},computed:{shippingDetails:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},isValid(){return this.isNewAddress?this.shippingDetails.buildingName&&this.shippingDetails.floorNumber&&this.shippingDetails.apartmentNumber&&this.shippingDetails.landmark&&this.shippingDetails.postalCode&&this.shippingDetails.cityId&&this.shippingDetails.countryId:this.selectedAddressId!==null}},methods:{async fetchSavedAddresses(){var t,e;this.loading=!0;try{const r=await _.get("https://backend.webenia.org/api/address",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(r.data.status&&r.data.data){this.savedAddresses=r.data.data;const o=this.savedAddresses.find(a=>a.is_primary);o&&this.selectAddress(o)}}catch(r){console.error("Error fetching addresses:",r),this.error=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||r.message}finally{this.loading=!1}},selectAddress(t){this.selectedAddressId=t.id,this.selectedAddress=t,this.isNewAddress=!1,this.shippingDetails={...this.shippingDetails,addressId:t.id}},async saveNewAddress(){var t,e;try{const r=localStorage.getItem("auth_token");let o=1;if(r)try{o=JSON.parse(atob(r.split(".")[1])).sub||1}catch(i){console.error("Error decoding token:",i)}const a={user_id:o,city_id:this.shippingDetails.cityId||1,country_id:this.shippingDetails.countryId||1,building_name:this.shippingDetails.buildingName,floor_number:this.shippingDetails.floorNumber,apartment_number:this.shippingDetails.apartmentNumber,landmark:this.shippingDetails.landmark,postal_code:this.shippingDetails.postalCode,is_primary:this.savedAddresses.length===0},n=await _.post("https://backend.webenia.org/api/address",a,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(n.data.status){const i=n.data.data;return this.savedAddresses.push(i),this.selectAddress(i),i.id}throw new Error(n.data.message||"Failed to save address")}catch(r){throw console.error("Error saving address:",r),this.error=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.message)||r.message,r}},async handleSubmit(){if(this.isValid)try{let t=this.selectedAddressId;this.isNewAddress&&(t=await this.saveNewAddress());const e={...this.shippingDetails,addressId:t};this.$emit("next-step",e)}catch(t){const e=t.message||this.$t("checkout.errorSavingAddress");this.$toast.error(e)}},toggle(){this.isOpen=!this.isOpen},selectOption(t){this.selectedValue=t.value,this.$emit("update:modelValue",t.value),this.isOpen=!1},async fetchCountries(){var t;this.countryLoading=!0;try{const e=await _.get("https://backend.webenia.org/api/countries");this.countries=((t=e.data)==null?void 0:t.data)||[]}catch(e){console.error("Error fetching countries:",e)}finally{this.countryLoading=!1}}},mounted(){this.fetchSavedAddresses(),this.fetchCountries()}},Ie={class:"checkout-step"},ke={class:"address-type-selector"},we={key:0,class:"saved-addresses"},Ce={class:"address-list"},Ae=["onClick"],De={class:"address-info"},$e={key:0,class:"primary-badge"},Ee={class:"address-actions"},Pe={class:"form-group"},Ne={for:"country"},Me={key:0,disabled:""},qe=["value"],Le={class:"form-group"},Te={for:"city"},Ge={class:"form-group"},Be={for:"buildingName"},Oe={class:"form-group"},Re={for:"floorNumber"},Ve={class:"form-group"},Ue={for:"apartmentNumber"},Fe={class:"form-group"},je={for:"landmark"},We={class:"form-group"},Ze={for:"postalCode"},Je={class:"button-group"},Qe=["disabled"];function ze(t,e,r,o,a,n){return p(),g("div",Ie,[s("h2",null,d(t.$t("checkout.shippingDetails")),1),s("div",ke,[s("button",{class:b(["type-btn",{active:!a.isNewAddress}]),onClick:e[0]||(e[0]=i=>a.isNewAddress=!1)},d(t.$t("checkout.selectExistingAddress")),3),s("button",{class:b(["type-btn",{active:a.isNewAddress}]),onClick:e[1]||(e[1]=i=>a.isNewAddress=!0)},d(t.$t("checkout.createNewAddress")),3)]),!a.isNewAddress&&a.savedAddresses.length?(p(),g("div",we,[s("h3",null,d(t.$t("checkout.savedAddresses")),1),s("div",Ce,[(p(!0),g(q,null,B(a.savedAddresses,i=>(p(),g("div",{key:i.id,class:b(["address-card",{selected:a.selectedAddressId===i.id}]),onClick:l=>n.selectAddress(i)},[s("div",De,[s("p",null,[s("strong",null,d(i.building_name),1)]),s("p",null,d(i.landmark),1),s("p",null,"Floor "+d(i.floor_number)+", Apartment "+d(i.apartment_number),1),s("p",null,"Postal Code: "+d(i.postal_code),1),i.is_primary?(p(),g("p",$e,d(t.$t("checkout.primaryAddress")),1)):w("",!0)]),s("div",Ee,[s("button",{class:b(["btn-select",{selected:a.selectedAddressId===i.id}])},d(a.selectedAddressId===i.id?t.$t("checkout.selected"):t.$t("checkout.select")),3)])],10,Ae))),128))])])):w("",!0),a.isNewAddress?(p(),g("form",{key:1,onSubmit:e[9]||(e[9]=z((...i)=>n.handleSubmit&&n.handleSubmit(...i),["prevent"])),class:"shipping-form"},[s("div",Pe,[s("label",Ne,d(t.$t("checkout.country")),1),A(s("select",{id:"country","onUpdate:modelValue":e[2]||(e[2]=i=>n.shippingDetails.countryId=i),required:""},[a.countryLoading?(p(),g("option",Me,"Loading...")):w("",!0),(p(!0),g(q,null,B(a.countries,i=>(p(),g("option",{key:i.id,value:i.id},d(i.name_en||i.name_ar),9,qe))),128))],512),[[U,n.shippingDetails.countryId]])]),s("div",Le,[s("label",Te,d(t.$t("checkout.city")),1),A(s("select",{id:"city",class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[3]||(e[3]=i=>n.shippingDetails.cityId=i),required:""},e[12]||(e[12]=[x('<option value="1" class="option" data-v-eb677163>Dubai</option><option value="2" class="option" data-v-eb677163>Abu Dhabi</option><option value="3" class="option" data-v-eb677163>Sharjah</option><option value="4" class="option" data-v-eb677163>Ajman</option><option value="5" class="option" data-v-eb677163>Ras Al Khaimah</option><option value="6" class="option" data-v-eb677163>Umm Al Quwain</option><option value="7" class="option" data-v-eb677163>Fujairah</option>',7)]),512),[[U,n.shippingDetails.cityId]])]),s("div",Ge,[s("label",Be,d(t.$t("checkout.buildingName")),1),A(s("input",{type:"text",id:"buildingName","onUpdate:modelValue":e[4]||(e[4]=i=>n.shippingDetails.buildingName=i),required:""},null,512),[[P,n.shippingDetails.buildingName]])]),s("div",Oe,[s("label",Re,d(t.$t("checkout.floorNumber")),1),A(s("input",{type:"text",id:"floorNumber","onUpdate:modelValue":e[5]||(e[5]=i=>n.shippingDetails.floorNumber=i),required:""},null,512),[[P,n.shippingDetails.floorNumber]])]),s("div",Ve,[s("label",Ue,d(t.$t("checkout.apartmentNumber")),1),A(s("input",{type:"text",id:"apartmentNumber","onUpdate:modelValue":e[6]||(e[6]=i=>n.shippingDetails.apartmentNumber=i),required:""},null,512),[[P,n.shippingDetails.apartmentNumber]])]),s("div",Fe,[s("label",je,d(t.$t("checkout.landmark")),1),A(s("input",{type:"text",id:"landmark","onUpdate:modelValue":e[7]||(e[7]=i=>n.shippingDetails.landmark=i),required:""},null,512),[[P,n.shippingDetails.landmark]])]),s("div",We,[s("label",Ze,d(t.$t("checkout.postalCode")),1),A(s("input",{type:"text",id:"postalCode","onUpdate:modelValue":e[8]||(e[8]=i=>n.shippingDetails.postalCode=i),required:""},null,512),[[P,n.shippingDetails.postalCode]])])],32)):w("",!0),s("div",Je,[s("button",{type:"button",class:"btn-secondary",onClick:e[10]||(e[10]=i=>t.$emit("previous-step"))},d(t.$t("checkout.back")),1),s("button",{type:"button",class:"btn-primary",onClick:e[11]||(e[11]=(...i)=>n.handleSubmit&&n.handleSubmit(...i)),disabled:!n.isValid},d(t.$t("checkout.continueToPayment")),9,Qe)])])}const xe=L(Se,[["render",ze],["__scopeId","data-v-eb677163"]]);var W="basil",He=function(e){return e===3?"v3":e},Z="https://js.stripe.com",Ke="".concat(Z,"/").concat(W,"/stripe.js"),Xe=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Ye=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,F="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",et=function(e){return Xe.test(e)||Ye.test(e)},tt=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Z,'"]')),r=0;r<e.length;r++){var o=e[r];if(et(o.src))return o}return null},j=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",o=document.createElement("script");o.src="".concat(Ke).concat(r);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(o),o},st=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.3.1",startTime:r})},N=null,T=null,G=null,rt=function(e){return function(r){e(new Error("Failed to load Stripe.js",{cause:r}))}},at=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},it=function(e){return N!==null?N:(N=new Promise(function(r,o){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe&&e&&console.warn(F),window.Stripe){r(window.Stripe);return}try{var a=tt();if(a&&e)console.warn(F);else if(!a)a=j(e);else if(a&&G!==null&&T!==null){var n;a.removeEventListener("load",G),a.removeEventListener("error",T),(n=a.parentNode)===null||n===void 0||n.removeChild(a),a=j(e)}G=at(r,o),T=rt(o),a.addEventListener("load",G),a.addEventListener("error",T)}catch(i){o(i);return}}),N.catch(function(r){return N=null,Promise.reject(r)}))},nt=function(e,r,o){if(e===null)return null;var a=r[0],n=a.match(/^pk_test/),i=He(e.version),l=W;n&&i!==l&&console.warn("Stripe.js@".concat(i," was loaded on the page, but @stripe/stripe-js@").concat("7.3.1"," expected Stripe.js@").concat(l,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var y=e.apply(void 0,r);return st(y,o),y},M,J=!1,Q=function(){return M||(M=it(null).catch(function(e){return M=null,Promise.reject(e)}),M)};Promise.resolve().then(function(){return Q()}).catch(function(t){J||console.warn(t)});var ot=function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];J=!0;var a=Date.now();return Q().then(function(n){return nt(n,r,a)})};const dt={name:"PaymentStep",props:{cartItems:{type:Array,required:!0},shippingDetails:{type:Object,required:!0},total:{type:Number,required:!0},currency:{type:String,required:!0}},data(){return{selectedPaymentMethod:null,paymentMethods:[{id:1,name:"Stripe",icon:"credit-card"},{id:2,name:"Tabby",icon:"credit-card-alt"},{id:3,name:"Cash on Delivery",icon:"money-bill"}],loading:!1,stripePromise:null,stripeClientSecret:null,stripeElements:null,cardElement:null}},created(){this.stripePromise=ot("pk_test_51MWOtgGtTsebDkQwsne9XO59N9J9PJvoAMa1dr01kQyDSMptnsh5FiWXOPF6HLexmIoasGQYtAsueIP2Xl6oaL3a00p8Yuhir3")},watch:{selectedPaymentMethod(t){t===1&&this.$nextTick(()=>{this.initStripeElements()})}},methods:{selectPaymentMethod(t){this.selectedPaymentMethod=t},async initStripeElements(){if(!document.getElementById("card-element"))return;const t=await this.stripePromise;this.stripeElements=t.elements();const e=this.stripeElements.create("card",{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}});e.mount("#card-element"),e.on("change",r=>{const o=document.getElementById("card-errors");r.error?o.textContent=r.error.message:o.textContent=""}),this.cardElement=e},async initiateTabbyPayment(){var t,e,r;this.loading=!0;try{if(!this.shippingDetails.addressId){this.$toast.error("The address id field is required.");return}const o=localStorage.getItem("auth_user");if(!o){this.$toast.error("User authentication required");return}const a=JSON.parse(o),n=a==null?void 0:a.id;if(!n){this.$toast.error("User authentication required");return}if(!Array.isArray(this.cartItems)||this.cartItems.length===0){this.$toast.error("No items in cart");return}const i=this.cartItems.reduce((m,v)=>m+v.price*v.quantity,0),l=this.cartItems.map(m=>{var v,$;return{product_id:(v=m.product)==null?void 0:v.id,product_name:(($=m.product)==null?void 0:$.name)||"",quantity:parseInt(m.quantity)||0,price:parseFloat(m.price)||0,subtotal:(parseFloat(m.price)||0)*(parseInt(m.quantity)||0)}}).filter(m=>m.product_id&&m.quantity>0),y=((t=this.user)==null?void 0:t.name)||(a==null?void 0:a.name)||"Guest",S=((e=this.user)==null?void 0:e.email)||(a==null?void 0:a.email)||"",I=((r=this.user)==null?void 0:r.phone)||(a==null?void 0:a.phone)||"",k={user_id:n,total_price:i,shipping_address:this.shippingDetails.address||"",address_id:this.shippingDetails.addressId,items:l,user:{name:y,email:S,phone:I}},C={Authorization:`Bearer ${localStorage.getItem("auth_token")}`},u=await _.post(`${f}/api/payment/tabby/send`,k,{headers:C});u.data.status==="success"&&(console.log("Redirecting to:",u.data.data.payment_url),window.location.href=u.data.data.payment_url)}catch(o){console.error("Tabby Payment Error:",o),this.$toast.error((o==null?void 0:o.message)||"Unexpected Tabby payment error")}finally{this.loading=!1}},async placeOrder(){var t,e,r,o,a,n,i,l,y,S,I,k,C;try{if(this.loading=!0,!this.shippingDetails.addressId){this.$toast.error("The address id field is required.");return}let u;try{const c=localStorage.getItem("auth_user");if(c){const h=JSON.parse(c);u=h==null?void 0:h.id}}catch(c){console.error("Error parsing auth_user:",c),this.$toast.error("Error getting user information");return}if(!u){this.$toast.error("User authentication required");return}if(!Array.isArray(this.cartItems)||this.cartItems.length===0){this.$toast.error("No items in cart");return}const m=this.cartItems.reduce((c,h)=>c+h.price*h.quantity,0),v={user_id:u,order:{status:"pending",payment_method:this.selectedPaymentMethod===1?"stripe":this.selectedPaymentMethod===2?"tabby":"cod",shipping_address:this.shippingDetails.address||"",address_id:this.shippingDetails.addressId,items:this.cartItems.map(c=>{var h,E;return{product_id:(h=c.product)==null?void 0:h.id,product_name:((E=c.product)==null?void 0:E.name)||"",quantity:parseInt(c.quantity)||0,price:parseFloat(c.price)||0,subtotal:(parseFloat(c.price)||0)*(parseInt(c.quantity)||0),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}).filter(c=>c.product_id&&c.quantity>0),total_price:m,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}};if(!v.order.items.length){this.$toast.error("Invalid order items");return}const $={Authorization:`Bearer ${localStorage.getItem("auth_token")}`};if(this.selectedPaymentMethod===1){const c=await _.post(`${f}/api/payment/process`,{...v,amount:m,currency:this.currency,payment_method:"stripe"},{headers:$});if((t=c==null?void 0:c.data)!=null&&t.success&&((e=c==null?void 0:c.data)!=null&&e.url)){window.location.href=c.data.url;return}else throw new Error(((r=c==null?void 0:c.data)==null?void 0:r.error)||((o=c==null?void 0:c.data)==null?void 0:o.message)||this.$t("checkout.errorCreatingPaymentSession"))}if(this.selectedPaymentMethod===2){const c=await _.post(`${f}/api/payment/process`,{user_id:u,payment_method:"tabby",order:{status:"pending",payment_method:"tabby",shipping_address:this.shippingDetails.address||"",address_id:this.shippingDetails.addressId,items:this.cartItems.map(h=>{var E,V;return{product_id:(E=h.product)==null?void 0:E.id,product_name:((V=h.product)==null?void 0:V.name)||"",quantity:parseInt(h.quantity)||0,price:parseFloat(h.price)||0,subtotal:(parseFloat(h.price)||0)*(parseInt(h.quantity)||0)}}).filter(h=>h.product_id&&h.quantity>0),total_price:m},user:{name:this.user.name,email:this.user.email,phone:this.user.phone}},{headers:$});if(((a=c==null?void 0:c.data)==null?void 0:a.status)==="success"&&((n=c.data.data)!=null&&n.payment_url)){this.$toast.success("Redirecting to Tabby..."),window.location.href=c.data.data.payment_url;return}else throw new Error(((i=c==null?void 0:c.data)==null?void 0:i.message)||((l=c==null?void 0:c.data)==null?void 0:l.error)||"Error creating Tabby session.")}if(this.selectedPaymentMethod===3){const c=await _.post(`${f}/api/orders`,v,{headers:$});if(((y=c==null?void 0:c.data)==null?void 0:y.status)==="success"){this.$toast.success(this.$t("checkout.orderPlacedSuccessfully")),window.location.href="/orders/user";return}else{const h=((S=c==null?void 0:c.data)==null?void 0:S.message)||((I=c==null?void 0:c.data)==null?void 0:I.error)||"Error placing order";throw new Error(h)}}}catch(u){console.error("Error placing order:",u);let m="Unexpected error while placing your order.";try{(k=u==null?void 0:u.response)!=null&&k.data?m=u.response.data.message||u.response.data.error||u.message||m:u!=null&&u.message&&(m=u.message)}catch(v){console.warn("Error extracting message:",v)}(C=this==null?void 0:this.$toast)!=null&&C.error?this.$toast.error(m):window.location.href="/orders/user"}finally{this.loading=!1}},async createOrder(){if(!this.shippingDetails.addressId){this.$toast.error("The address id field is required.");return}const t=this.cartItems.reduce((o,a)=>o+a.price*a.quantity,0),e=this.selectedPaymentMethod===3?"cod":String(this.selectedPaymentMethod),r={shipping_details:this.shippingDetails,address_id:this.shippingDetails.addressId,payment_method:e,items:this.cartItems.map(o=>({product_id:o.product.id,quantity:o.quantity,price:o.price,subtotal:o.price*o.quantity})),total_price:t};try{const o=await _.post(`${f}/api/orders`,r,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(o.data.success)console.log(o),window.location.href="/orders/user";else throw new Error(o.data.error||this.$t("checkout.errorPlacingOrder"))}catch(o){console.error(o),this.$t("checkout.errorPlacingOrder")}},getCountryCode(t){const e={"United States":"US","United Kingdom":"GB",Egypt:"EG","Saudi Arabia":"SA","United Arab Emirates":"AE",Kuwait:"KW",Qatar:"QA",Bahrain:"BH",Oman:"OM",Jordan:"JO",Lebanon:"LB",Iraq:"IQ",Syria:"SY",Yemen:"YE",Libya:"LY",Sudan:"SD",Morocco:"MA",Algeria:"DZ",Tunisia:"TN",Palestine:"PS",Israel:"IL",Turkey:"TR",Iran:"IR",Pakistan:"PK",India:"IN",China:"CN",Japan:"JP","South Korea":"KR",Singapore:"SG",Malaysia:"MY",Indonesia:"ID",Australia:"AU","New Zealand":"NZ",Canada:"CA",Mexico:"MX",Brazil:"BR",Argentina:"AR","South Africa":"ZA",Nigeria:"NG",Kenya:"KE",Ghana:"GH",Ethiopia:"ET",Tanzania:"TZ",Uganda:"UG",Rwanda:"RW",Senegal:"SN","Côte d'Ivoire":"CI",Cameroon:"CM",Angola:"AO",Mozambique:"MZ",Madagascar:"MG",Mauritius:"MU",Seychelles:"SC",Comoros:"KM",Djibouti:"DJ",Eritrea:"ER",Somalia:"SO","South Sudan":"SS",Chad:"TD",Niger:"NE",Mali:"ML","Burkina Faso":"BF",Benin:"BJ",Togo:"TG",Guinea:"GN","Guinea-Bissau":"GW","Sierra Leone":"SL",Liberia:"LR","Cape Verde":"CV","São Tomé and Príncipe":"ST","Equatorial Guinea":"GQ",Gabon:"GA","Republic of the Congo":"CG","Democratic Republic of the Congo":"CD","Central African Republic":"CF",Burundi:"BI",Zambia:"ZM",Zimbabwe:"ZW",Malawi:"MW",Namibia:"NA",Botswana:"BW",Lesotho:"LS",Eswatini:"SZ",Mauritania:"MR","Western Sahara":"EH","The Gambia":"GM","Guinea-Bissau":"GW","Sierra Leone":"SL",Liberia:"LR","Cape Verde":"CV","São Tomé and Príncipe":"ST","Equatorial Guinea":"GQ",Gabon:"GA","Republic of the Congo":"CG","Democratic Republic of the Congo":"CD","Central African Republic":"CF",Burundi:"BI",Zambia:"ZM",Zimbabwe:"ZW",Malawi:"MW",Namibia:"NA",Botswana:"BW",Lesotho:"LS",Eswatini:"SZ",Mauritania:"MR","Western Sahara":"EH","The Gambia":"GM"};if(/^[A-Z]{2}$/.test(t))return t;const r=e[t];return r||null}}},ct={class:"checkout-step"},lt={class:"payment-methods"},ut=["onClick"],pt={key:0,class:"stripe-container"},ht={class:"order-summary"},mt={class:"summary-details"},gt={class:"total-amount"},yt={class:"button-group"},_t=["disabled"],vt={key:0},ft={key:1};function bt(t,e,r,o,a,n){const i=D("fa");return p(),g("div",ct,[s("h2",null,d(t.$t("checkout.payment")),1),s("div",lt,[(p(!0),g(q,null,B(a.paymentMethods,l=>(p(),g("div",{key:l.id,class:b(["payment-method",{active:a.selectedPaymentMethod===l.id}]),onClick:y=>n.selectPaymentMethod(l.id)},[O(i,{icon:l.icon},null,8,["icon"]),s("span",null,d(l.name),1)],10,ut))),128))]),a.selectedPaymentMethod===1?(p(),g("div",pt,e[2]||(e[2]=[s("div",{class:"card-element-container"},[s("div",{id:"card-element",class:"card-element"}),s("div",{id:"card-errors",class:"card-errors",role:"alert"})],-1)]))):w("",!0),s("div",ht,[s("h3",null,d(t.$t("checkout.orderSummary")),1),s("div",mt,[s("p",null,d(r.cartItems.length)+" "+d(t.$t("checkout.items")),1),s("p",null,d(t.$t("checkout.deliveryTo"))+": "+d(r.shippingDetails.city),1),s("p",null,d(t.$t("checkout.tax"))+": "+d(r.shippingDetails.tax)+" "+d(r.currency),1),s("p",null,d(t.$t("checkout.total"))+": "+d(r.shippingDetails.total)+" "+d(r.currency),1),s("div",gt,d(t.$t("checkout.totalAmount"))+": "+d(r.total)+" "+d(r.currency),1)])]),s("div",yt,[s("button",{class:"btn-secondary",onClick:e[0]||(e[0]=l=>t.$emit("previous-step"))},d(t.$t("checkout.back")),1),s("button",{class:"btn-primary",disabled:!a.selectedPaymentMethod||a.loading,onClick:e[1]||(e[1]=l=>a.selectedPaymentMethod===2?n.initiateTabbyPayment():n.placeOrder())},[a.loading?(p(),g("span",vt,d(t.$t("checkout.processing"))+"...",1)):(p(),g("span",ft,d(t.$t("checkout.placeOrder")),1))],8,_t)])])}const St=L(dt,[["render",bt],["__scopeId","data-v-f3cb1379"]]);const It={name:"Checkout",components:{Header:H,CheckoutStepper:re,CartReview:be,ShippingDetails:xe,PaymentStep:St},data(){return{step:1,cartItems:[],shippingDetails:{fullName:"",address:"",city:"",postalCode:"",phone:"",buildingName:"",floorNumber:"",apartmentNumber:"",landmark:"",street:"",country:""},shippingCost:10}},computed:{currentLang(){return localStorage.getItem("lang")||"en"},currency(){if(this.cartItems.length>0){if(this.cartItems[0].currency.code)return this.cartItems[0].currency.code.toLowerCase();const t=(this.currentLang==="ar"?this.cartItems[0].currency.name_ar:this.cartItems[0].currency.name_en).toLowerCase();return{"us dollar":"usd",usd:"usd","british pound":"gbp",gbp:"gbp",euro:"eur",eur:"eur","درهم إماراتي":"aed",aed:"aed","جنيه مصري":"egp",egp:"egp"}[t]||"usd"}return"usd"},total(){return(this.cartItems.reduce((e,r)=>e+parseFloat(r.price)*r.quantity,0)+this.shippingCost).toFixed(2)}},created(){this.fetchCartItems()},methods:{async fetchCartItems(){try{const t=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},e=await _.get(`${f}/api/cart-items`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:t.code}});this.cartItems=e.data.data.original.data}catch(t){console.error("Error fetching cart items:",t),this.$toast.error(this.$t("checkout.errorFetchingCart"))}},updateCart(t){this.cartItems=t},nextStep(){this.step<3&&this.step++},previousStep(){this.step>1&&this.step--},async handleOrderPlaced(){const t={payment_method:this.cartItems[0].payment_method||"paypal",user_id:localStorage.getItem("user_id"),order:{status:"pending",payment_method:this.selectedPaymentMethod===1?"stripe":"cash",shipping_address:`${this.shippingDetails.street}, ${this.shippingDetails.city}, ${this.shippingDetails.country}`},items:this.cartItems.map(e=>({product_id:e.product_id,product_name:e.product_name,quantity:e.quantity,price:e.price}))};try{const e=await _.post(`${f}/api/orders`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.$router.push("/order-confirmation")}catch(e){console.error("Error placing order:",e),this.$toast.error(this.$t("checkout.errorPlacingOrder"))}}},mounted(){window.addEventListener("currency-changed",()=>{this.fetchCartItems()})}},kt={class:"checkout-container"};function wt(t,e,r,o,a,n){const i=D("Header"),l=D("CheckoutStepper"),y=D("CartReview"),S=D("ShippingDetails"),I=D("PaymentStep");return p(),g(q,null,[O(i),s("div",kt,[O(l,{step:a.step},null,8,["step"]),a.step===1?(p(),R(y,{key:0,"cart-items":a.cartItems,"shipping-cost":a.shippingCost,onNextStep:n.nextStep,onUpdateCart:n.updateCart},null,8,["cart-items","shipping-cost","onNextStep","onUpdateCart"])):w("",!0),a.step===2?(p(),R(S,{key:1,modelValue:a.shippingDetails,"onUpdate:modelValue":e[0]||(e[0]=k=>a.shippingDetails=k),onNextStep:n.nextStep,onPreviousStep:n.previousStep},null,8,["modelValue","onNextStep","onPreviousStep"])):w("",!0),a.step===3?(p(),R(I,{key:2,"cart-items":a.cartItems,"shipping-details":a.shippingDetails,total:n.total,currency:n.currency,onPreviousStep:n.previousStep,onOrderPlaced:n.handleOrderPlaced},null,8,["cart-items","shipping-details","total","currency","onPreviousStep","onOrderPlaced"])):w("",!0)])],64)}const At=L(It,[["render",wt],["__scopeId","data-v-ca26d89d"]]);export{At as default};

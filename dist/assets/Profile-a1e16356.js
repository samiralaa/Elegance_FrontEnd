import{_ as S,B as E,H as x,ae as L,b as m,G as b,r as D,o as n,c as l,e as f,a as s,t as i,l as g,g as k,w as c,v as h,f as u,F as _,d as y,h as P}from"./index-2ca0f0e5.js";const N={setup(){const{t}=E();return{t}},components:{Header:x,fa:L},data(){return{cities:[],countries:[],countryLoading:!1,loading:!0,error:null,user:{},showAddressDialog:!1,editingAddressId:null,addressForm:{building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""},addressSuccess:!1,showResetPasswordModal:!1,password:"",password_confirmation:"",resetPasswordLoading:!1,resetPasswordError:null,resetPasswordSuccess:null,showDeleteDialog:!1,addressToDelete:null,showDeleteSuccess:!1}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"},goToResetPassword(){this.$router.push({name:"ResetPassword",query:{email:this.user.email}})},formatAddress(t){let e="";t.country?e=this.$i18n&&this.$i18n.locale==="ar"?t.country.name_ar:t.country.name_en:t.country_id&&(e=t.country_id);let a="";return t.city?a=this.$i18n&&this.$i18n.locale==="ar"?t.city.name_ar:t.city.name_en:t.city_id&&(a=t.city_id),[t.building_name,t.floor_number,t.apartment_number,t.postal_code,t.landmark,a,e].filter(Boolean).join(", ")},openEditDialog(t=null){t?(this.editingAddressId=t==null?void 0:t.id,this.addressForm={...t},this.showAddressDialog=!0):(this.showAddressDialog=!0,this.addressForm={...t})},closeEditDialog(){this.showAddressDialog=!1,this.editingAddressId=null,this.addressForm={building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""}},async saveAddress(t){if(t==null||t==null){this.addAddress();return}try{const e=await m.post(`api/address/${t}`,this.addressForm,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});b({title:this.$t("success"),message:this.$t("profile.editAddressSuccess"),type:"success"}),await this.fetchUserProfile(),this.closeEditDialog(),this.addressSuccess=!0}catch{b({title:this.$t("error"),message:this.$t("profile.errorEditing"),type:"error"}),this.closeEditDialog()}},async addAddress(){try{const t={user_id:this.user.id,building_name:this.addressForm.building_name,floor_number:this.addressForm.floor_number,apartment_number:this.addressForm.apartment_number,postal_code:this.addressForm.postal_code,landmark:this.addressForm.landmark,city_id:this.addressForm.city_id,country_id:this.addressForm.country_id},e=await m.post("https://backend.webenia.org/api/address",t,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});this.closeEditDialog(),b({title:this.$t("success"),message:this.$t("profile.addSuccess"),type:"success"}),this.fetchUserProfile()}catch(t){throw b({title:this.$t("error"),message:this.$t("profile.errorAdding"),type:"error"}),t}},async resetPassword(){var t,e;if(this.resetPasswordError=null,this.resetPasswordSuccess=null,this.password!==this.password_confirmation){this.resetPasswordError=this.$t("profile.passwordsDoNotMatch");return}if(this.password.length<8){this.resetPasswordError=this.$t("profile.passwordTooShort");return}this.resetPasswordLoading=!0;try{const a=await m.post("api/reset-password",{email:this.user.email,password:this.password,password_confirmation:this.password_confirmation});a.data.status&&a.data.data?(this.resetPasswordSuccess=a.data.message||this.$t("profile.passwordResetSuccess"),setTimeout(()=>{this.showResetPasswordModal=!1,this.password="",this.password_confirmation=""},1500)):this.resetPasswordError=a.data.message||this.$t("profile.passwordResetFailed")}catch(a){this.resetPasswordError=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||this.$t("profile.passwordResetFailed")}finally{this.resetPasswordLoading=!1}},async fetchCountries(){var t;this.countryLoading=!0;try{const e=await m.get("https://backend.webenia.org/api/countries");this.countries=((t=e.data)==null?void 0:t.data)||[]}catch(e){console.error("Error fetching countries:",e)}finally{this.countryLoading=!1}},async fetchCities(t){this.countryLoading=!0;try{const e=await m.get(`https://backend.webenia.org/api/countries/${t}`);this.cities=e.data.data.original.data.cities,console.log("Cities:",this.cities)}catch(e){console.error("Failed to fetch cities:",e),this.cities=[],this.countryLoading=!1}finally{this.countryLoading=!1}},async fetchUserProfile(){var t,e;try{const a=await m.get("api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.user=a.data.data.user}catch(a){this.error=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"Failed to fetch profile"}finally{this.loading=!1}},openDeleteDialog(t){this.addressToDelete=t,this.showDeleteDialog=!0},async confirmDeleteAddress(){var t,e,a;if(this.addressToDelete)try{await m.delete(`api/address/${this.addressToDelete.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),this.user.address=this.user.address.filter(p=>p.id!==this.addressToDelete.id),this.showDeleteDialog=!1,this.showDeleteSuccess=!0,this.addressToDelete=null}catch(p){const o=((e=(t=p==null?void 0:p.response)==null?void 0:t.data)==null?void 0:e.message)||this.$t("profile.errorDeletingAddress")||"Failed to delete address";(a=this.$toast)==null||a.error(o),this.showDeleteDialog=!1,this.addressToDelete=null}}},async created(){var t;if(await this.fetchUserProfile(),await this.fetchCountries(),this.user.address&&this.user.address.length>0){const e=this.user.address[0].country_id||((t=this.user.address[0].country)==null?void 0:t.id);e&&await this.fetchCities(e)}else this.cities=[]},async mounted(){await this.fetchCountries()}},j={class:"profile-outer container my-5"},U={key:0,class:"d-flex flex-column align-items-center justify-content-center py-5"},T={key:1,class:"text-center text-danger"},V={key:2,class:"card p-4 shadow w-75"},B={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},M={class:"d-flex align-items-center gap-3"},R={class:"avatar bg-primary text-white rounded-circle d-flex justify-content-center align-items-center",style:{width:"60px",height:"60px","font-size":"24px"}},I={class:"mb-0"},z={class:"text-muted"},q={key:0,class:"modal-overlay"},H={class:"modal-dialog-centered"},G={class:"modal-content bg-white p-4 rounded shadow w-100"},K={class:"mb-4"},O={class:"form-group"},$={class:"form-group"},J={key:0,class:"alert alert-danger"},Q={key:1,class:"alert alert-success"},W={class:"d-flex justify-content-end gap-2 mt-2"},X=["disabled"],Y={key:0,class:"spinner-border spinner-border-sm"},Z={class:"d-flex flex-column gap-3"},ee={class:"d-flex justify-content-between border-bottom pb-2"},se={class:"d-flex justify-content-between border-bottom pb-2"},te={class:"d-flex justify-content-between border-bottom pb-2"},oe={class:"d-flex justify-content-between align-items-center my-3"},re={class:"mb-0 text-dark"},ie={key:1,class:"mt-4"},ne={class:"d-flex align-items-center"},le={class:"text-muted"},ae={class:"d-flex align-items-center gap-2"},de=["onClick"],ce=["onClick"],ue={key:3,class:"modal-overlay"},me={class:"modal-dialog-centered"},he={class:"modal-content bg-white p-4 rounded shadow w-100"},pe={class:"form-group"},fe={class:"form-group"},ge={class:"form-group"},we={class:"form-group"},be={class:"form-group"},_e={class:"form-group"},ye={key:0,disabled:""},ve=["value"],De={class:"form-group"},ke={for:"city"},Pe=["value"],Ae={class:"d-flex justify-content-end gap-2 mt-2"},Fe={type:"submit",class:"btn btn-primary"},Ce={key:0,class:"modal-overlay"},Se={class:"modal-dialog-centered"},Ee={class:"modal-content bg-white p-4 rounded shadow w-100"},xe={class:"mb-3"},Le={class:"d-flex justify-content-end gap-2 mt-2"},Ne={key:1,class:"modal-overlay"},je={class:"modal-dialog-centered"},Ue={class:"modal-content bg-white p-4 rounded shadow w-100 text-center"},Te={class:"mb-3 text-success"};function Ve(t,e,a,p,o,d){var v;const A=D("Header"),w=D("fa");return n(),l(_,null,[f(A),s("div",j,[o.loading?(n(),l("div",U,[e[19]||(e[19]=s("span",{class:"loader mb-2"},null,-1)),s("span",null,i(t.$t("profile.loading")),1)])):o.error?(n(),l("div",T,[s("span",null,i(o.error),1)])):(n(),l("div",V,[s("div",B,[s("div",M,[s("div",R,i(o.user.name?o.user.name.charAt(0).toUpperCase():"?"),1),s("div",null,[s("h5",I,i(o.user.name),1),s("small",z,i(o.user.role),1)])]),s("button",{class:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:e[0]||(e[0]=r=>o.showResetPasswordModal=!0),"aria-label":"Reset Password"},[e[20]||(e[20]=s("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24"},[s("path",{d:"M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a8 8 0 11-16 0 8 8 0 0116 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),g(" "+i(t.$t("profile.resetPassword")),1)])]),o.showResetPasswordModal?(n(),l("div",q,[s("div",H,[s("div",G,[s("h5",K,i(t.$t("profile.resetPassword")),1),s("form",{onSubmit:e[4]||(e[4]=k((...r)=>d.resetPassword&&d.resetPassword(...r),["prevent"])),class:"d-flex flex-column gap-3"},[s("div",O,[s("label",null,i(t.$t("profile.newPassword")),1),c(s("input",{type:"password","onUpdate:modelValue":e[1]||(e[1]=r=>o.password=r),class:"form-control",required:""},null,512),[[h,o.password]])]),s("div",$,[s("label",null,i(t.$t("profile.confirmPassword")),1),c(s("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=r=>o.password_confirmation=r),class:"form-control",required:""},null,512),[[h,o.password_confirmation]])]),o.resetPasswordError?(n(),l("div",J,i(o.resetPasswordError),1)):u("",!0),o.resetPasswordSuccess?(n(),l("div",Q,i(o.resetPasswordSuccess),1)):u("",!0),s("div",W,[s("button",{type:"submit",class:"btn btn-primary",disabled:o.resetPasswordLoading},[o.resetPasswordLoading?(n(),l("span",Y)):u("",!0),g(" "+i(t.$t("profile.submit")),1)],8,X),s("button",{type:"button",class:"btn btn-secondary",onClick:e[3]||(e[3]=r=>o.showResetPasswordModal=!1)},i(t.$t("profile.cancel")),1)])],32)])])])):u("",!0),s("div",Z,[s("div",ee,[s("strong",null,i(t.$t("profile.name")),1),s("span",null,i(o.user.name),1)]),s("div",se,[s("strong",null,i(t.$t("profile.email")),1),s("span",null,i(o.user.email),1)]),s("div",te,[s("strong",null,i(t.$t("profile.phone")),1),s("span",null,i(o.user.phone),1)])]),s("div",oe,[s("h5",re,[f(w,{icon:["fas","map-marker-alt"],class:"me-2 text-primary"}),g(" "+i(t.$t("profile.address")),1)]),s("button",{class:"btn btn-outline-info btn-sm",onClick:e[5]||(e[5]=r=>d.openEditDialog())},[f(w,{icon:["fas","plus"],class:"me-1"}),g(" "+i(t.$t("profile.addAddress")),1)])]),(v=o.user.address)!=null&&v.length?(n(),l("div",ie,[(n(!0),l(_,null,y(o.user.address,(r,F)=>(n(),l("div",{key:r.id||F,class:"d-flex justify-content-between align-items-center border rounded p-3 mb-2 bg-light"},[s("div",ne,[f(w,{icon:["fas","location-dot"],class:"text-secondary me-3"}),s("span",le,i(d.formatAddress(r)),1)]),s("div",ae,[s("button",{class:"btn btn-sm btn-outline-primary",onClick:C=>d.openEditDialog(r)},[f(w,{icon:["fas","pen"],class:"me-1"}),g(" "+i(t.$t("profile.editAddress")),1)],8,de),s("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:C=>d.openDeleteDialog(r)},[f(w,{icon:["fas","trash"],class:"me-1"}),g(" "+i(t.$t("profile.deleteAddress")),1)],8,ce)])]))),128))])):u("",!0)])),o.showAddressDialog?(n(),l("div",ue,[s("div",me,[s("div",he,[e[27]||(e[27]=s("h5",{class:"mb-4"},"Edit Address",-1)),s("form",{onSubmit:e[15]||(e[15]=k(r=>d.saveAddress(o.editingAddressId),["prevent"])),class:"d-flex flex-column gap-3"},[s("div",pe,[e[21]||(e[21]=s("label",null,"Building Name",-1)),c(s("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>o.addressForm.building_name=r),class:"form-control",placeholder:"Building Name"},null,512),[[h,o.addressForm.building_name]])]),s("div",fe,[e[22]||(e[22]=s("label",null,"Floor Number",-1)),c(s("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>o.addressForm.floor_number=r),class:"form-control",placeholder:"Floor Number"},null,512),[[h,o.addressForm.floor_number]])]),s("div",ge,[e[23]||(e[23]=s("label",null,"Apartment Number",-1)),c(s("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>o.addressForm.apartment_number=r),class:"form-control",placeholder:"Apartment Number"},null,512),[[h,o.addressForm.apartment_number]])]),s("div",we,[e[24]||(e[24]=s("label",null,"Postal Code",-1)),c(s("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>o.addressForm.postal_code=r),class:"form-control",placeholder:"Postal Code"},null,512),[[h,o.addressForm.postal_code]])]),s("div",be,[e[25]||(e[25]=s("label",null,"Landmark",-1)),c(s("input",{"onUpdate:modelValue":e[10]||(e[10]=r=>o.addressForm.landmark=r),class:"form-control",placeholder:"Landmark"},null,512),[[h,o.addressForm.landmark]])]),s("div",_e,[e[26]||(e[26]=s("label",{for:"country"},"country",-1)),c(s("select",{id:"country",class:"form-control","onUpdate:modelValue":e[11]||(e[11]=r=>o.addressForm.country_id=r),required:"",onChange:e[12]||(e[12]=r=>d.fetchCities(o.addressForm.country_id))},[o.countryLoading?(n(),l("option",ye,"Loading...")):u("",!0),(n(!0),l(_,null,y(o.countries,r=>(n(),l("option",{key:r.id,value:r.id},i(r.name_en||r.name_ar),9,ve))),128))],544),[[P,o.addressForm.country_id]])]),s("div",De,[s("label",ke,i(t.$t("checkout.city")),1),c(s("select",{id:"city",class:"form-select","onUpdate:modelValue":e[13]||(e[13]=r=>o.addressForm.city_id=r),required:""},[(n(!0),l(_,null,y(o.cities,r=>(n(),l("option",{key:r.id,value:r.id},i(t.$i18n.locale==="ar"?r.name_ar:r.name_en),9,Pe))),128))],512),[[P,o.addressForm.city_id]])]),s("div",Ae,[s("button",Fe,i(t.$t("profile.save")),1),s("button",{type:"button",class:"btn btn-secondary",onClick:e[14]||(e[14]=(...r)=>d.closeEditDialog&&d.closeEditDialog(...r))},i(t.$t("profile.cancel")),1)])],32)])])])):u("",!0)]),o.showDeleteDialog?(n(),l("div",Ce,[s("div",Se,[s("div",Ee,[s("h5",xe,i(t.$t("profile.confirmDeleteAddress")||"Are you sure you want to delete this address?"),1),s("div",Le,[s("button",{class:"btn btn-danger",onClick:e[16]||(e[16]=(...r)=>d.confirmDeleteAddress&&d.confirmDeleteAddress(...r))},i(t.$t("profile.deleteAddress")),1),s("button",{class:"btn btn-secondary",onClick:e[17]||(e[17]=r=>o.showDeleteDialog=!1)},i(t.$t("profile.cancel")),1)])])])])):u("",!0),o.showDeleteSuccess?(n(),l("div",Ne,[s("div",je,[s("div",Ue,[s("h5",Te,i(t.$t("profile.addressDeleted")||"Address deleted successfully"),1),s("button",{class:"btn btn-primary",onClick:e[18]||(e[18]=r=>o.showDeleteSuccess=!1)},"OK")])])])):u("",!0)],64)}const Me=S(N,[["render",Ve],["__scopeId","data-v-72fe4a6d"]]);export{Me as default};

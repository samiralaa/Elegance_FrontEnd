import{_ as H,y as d,L as F,E as K,r as o,V as X,o as i,c as z,a as C,t as c,e as r,p as l,w as Y,k as O,f as L,b as f,W as g,G as m,a9 as Z,F as x,d as ee,m as p,aa as te,ab as ae,a0 as re}from"./index-2c18e476.js";const le={class:"orders-page"},oe={class:"orders-header"},se={class:"orders-filters"},b=5,ne={__name:"Orders",setup(de){const v=d([]),u=d(""),_=d(""),h=d(1),w=d(!1),y=d(null),k=d(!1),B=["pending","processing","cancelled"],V=async()=>{k.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${e.token}`;const a=await f.get("https://backend.webenia.org/api/orders");if(a.data.status===!0)v.value=a.data.data,console.log("Orders loaded:",v.value);else throw new Error(a.data.message||"Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e),g.error(e.message||"Failed to fetch orders")}finally{k.value=!1}},$=F(()=>v.value.filter(e=>{const a=u.value===""||e.id.toString().includes(u.value.toLowerCase())||e.total_price.includes(u.value.toLowerCase()),s=!_.value||e.status===_.value;return a&&s})),N=F(()=>{const e=(h.value-1)*b,a=e+b;return $.value.slice(e,a)}),I=e=>{h.value=e},A=e=>{y.value=e,w.value=!0},T=e=>{const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString()},U=e=>({pending:"info",processing:"warning",cancelled:"danger"})[e.toLowerCase()]||"info",q=async e=>{try{const a=JSON.parse(localStorage.getItem("tokenData"));if(!a||!a.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${a.token}`;const s=await f.post(`https://backend.webenia.org/api/orders/${e.id}/cancel`);if(s.data.status===!0)g.success("Order cancelled successfully"),await V();else throw new Error(s.data.message||"Failed to cancel order")}catch(a){console.error("Error cancelling order:",a),g.error(a.message||"Failed to cancel order")}},J=e=>{g.info("Reordered items from order #"+e.id)};return K(()=>{V()}),(e,a)=>{const s=o("el-icon"),M=o("el-input"),P=o("el-option"),G=o("el-select"),n=o("el-table-column"),Q=o("el-tag"),S=o("el-button"),D=o("el-table"),R=o("el-pagination"),W=o("el-dialog"),j=X("loading");return i(),z("div",le,[C("div",oe,[C("h2",null,c(e.$t("orders.myOrders")),1),r(M,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=t=>u.value=t),placeholder:e.$t("orders.Search-orders"),class:"search-input",clearable:""},{prefix:l(()=>[r(s,null,{default:l(()=>[r(m(Z))]),_:1})]),_:1},8,["modelValue","placeholder"])]),C("div",se,[r(G,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),placeholder:e.$t("orders.Filter-by-Status"),clearable:""},{default:l(()=>[(i(),z(x,null,ee(B,t=>r(P,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),Y((i(),O(D,{data:N.value,style:{width:"100%"},class:"orders-table",stripe:"",border:""},{default:l(()=>[r(n,{prop:"id",label:e.$t("orders.orderId"),width:"120"},null,8,["label"]),r(n,{prop:"ordered_at",label:e.$t("orders.orderDate"),width:"180"},{default:l(t=>[p(c(T(t.row.ordered_at)),1)]),_:1},8,["label"]),r(n,{label:e.$t("orders.total"),width:"150"},{default:l(t=>[p(c(t.row.currency)+" "+c(t.row.total_price),1)]),_:1},8,["label"]),r(n,{prop:"status",label:e.$t("orders.status"),width:"150"},{default:l(t=>[r(Q,{type:U(t.row.status)},{default:l(()=>[p(c(t.row.status),1)]),_:2},1032,["type"])]),_:1},8,["label"]),r(n,{label:e.$t("orders.actions"),width:"220"},{default:l(t=>[r(S,{size:"small",type:"primary",onClick:E=>A(t.row),circle:""},{default:l(()=>[r(s,null,{default:l(()=>[r(m(te))]),_:1})]),_:2},1032,["onClick"]),r(S,{size:"small",type:"danger",disabled:t.row.status!=="pending"&&t.row.status!=="processing",onClick:E=>q(t.row),circle:""},{default:l(()=>[r(s,null,{default:l(()=>[r(m(ae))]),_:1})]),_:2},1032,["disabled","onClick"]),r(S,{size:"small",type:"success",onClick:E=>J(t.row),circle:""},{default:l(()=>[r(s,null,{default:l(()=>[r(m(re))]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[j,k.value]]),$.value.length>b?(i(),O(R,{key:0,class:"pagination",layout:"prev, pager, next","current-page":h.value,"page-size":b,total:$.value.length,onCurrentChange:I},null,8,["current-page","total"])):L("",!0),r(W,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=t=>w.value=t),title:e.$t("orders.orderDetails"),width:"600px"},{default:l(()=>[y.value?(i(),O(D,{key:0,data:y.value.items,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[r(n,{prop:"product_id",label:e.$t("orders.orderId")},null,8,["label"]),r(n,{prop:"quantity",label:e.$t("orders.quantity")},null,8,["label"]),r(n,{prop:"price",label:e.$t("orders.price")},{default:l(t=>[p(" $"+c(t.row.price),1)]),_:1},8,["label"]),r(n,{prop:"subtotal",label:e.$t("orders.Subtotal")},{default:l(t=>[p(c(t.row.subtotal),1)]),_:1},8,["label"])]),_:1},8,["data"])):L("",!0)]),_:1},8,["modelValue","title"])])}}},ue=H(ne,[["__scopeId","data-v-17b2b18d"]]);export{ue as default};

import{_ as y,b as f,r as M,o as m,c as g,a as i,k,t as d,w as _,F as w,d as I,l as O,f as S,e as $,m as T,g as b,i as V}from"./index-d93b5fdf.js";const v="https://backend.webenia.org/api",N={data(){return{otp:Array(4).fill(""),user:null,token:null,timer:"03:00",countdown:null,otpMessage:""}},computed:{otpMessageColor(){return this.otpMessage==="Invalid OTP"||this.otpMessage==="Resend Invalid"?"red":this.otpMessage==="OTP resent successfully"?"green":"#333"}},created(){const t=localStorage.getItem("user"),e=localStorage.getItem("auth_token");if(!t||!e){this.$router.push("/register");return}this.user=JSON.parse(t),this.token=e,this.startTimer()},methods:{focusNext(t){t<4&&this.otp[t-1]&&this.$el.querySelectorAll(".otp-input")[t].focus()},handleInput(t,e){const r=t.target.value;/^\d$/.test(r)?(this.otp[e-1]=r,e<4&&this.focusNext(e)):this.otp[e-1]=""},handleKeyDown(t,e){t.key==="Backspace"&&!this.otp[e-1]&&e>1&&this.$el.querySelectorAll(".otp-input")[e-2].focus()},async handleOtpVerification(){var r,u,n,a,p,o,s,l;const t=this.otp.join(""),e=this.otp.every(c=>/^\d$/.test(c));if(t.length!==4||!e){(n=(r=this.$toast)==null?void 0:r.error)==null||n.call(r,((u=this.$t)==null?void 0:u.call(this,"otp.invalidLength"))||"Please enter a valid 4-digit code");return}try{const c=await f.post(`${v}/client/verify-otp`,{otp:t,email:this.user.email},{headers:{Authorization:`Bearer ${this.token}`}});if(c.data.status===!0){const h={...this.user,...c.data.data.user};localStorage.setItem("user",JSON.stringify(h)),localStorage.setItem("auth_token",c.data.data.token),this.otpMessage="",this.$router.push("/")}}catch(c){console.error("OTP verification error:",c);const h=((p=(a=c.response)==null?void 0:a.data)==null?void 0:p.message)||((o=this.$t)==null?void 0:o.call(this,"otp.error"))||"OTP verification failed";this.otpMessage=h,(l=(s=this.$toast)==null?void 0:s.error)==null||l.call(s,h)}},startTimer(){let t=3,e=0;this.countdown=setInterval(()=>{if(e===0){if(t===0){clearInterval(this.countdown);return}t--,e=59}else e--;this.timer=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)},async resendOtp(){var t,e,r,u,n,a,p,o;try{const s=await f.post(`${v}/resend-otp`,{email:this.user.email});if(s.data.status===!0){const l=s.data.message||"OTP resent successfully.";this.otpMessage=l,(e=(t=this.$toast)==null?void 0:t.info)==null||e.call(t,l)}else{const l=s.data.message||"Resend Invalid";this.otpMessage=l,(u=(r=this.$toast)==null?void 0:r.error)==null||u.call(r,l)}this.startTimer()}catch(s){const l=((a=(n=s.response)==null?void 0:n.data)==null?void 0:a.message)||"Resend Invalid";this.otpMessage=l,(o=(p=this.$toast)==null?void 0:p.error)==null||o.call(p,l)}}}},P={class:"otp-wrapper"},D={class:"otp-container"},A={class:"otp-message"},B={class:"otp-input-group"},C=["onUpdate:modelValue","onInput","onKeydown"],K={type:"submit",class:"verify-btn"},L={class:"resend d-flex w-100 justify-content-between align-items-center mt-3"},R={class:"time-left"};function U(t,e,r,u,n,a){const p=M("fa");return m(),g("div",P,[i("div",D,[e[2]||(e[2]=i("img",{src:k,alt:"Logo",height:"100"},null,-1)),i("p",A,d(t.$t("otp.message")),1),i("span",null,d(n.user.email),1),i("form",{onSubmit:e[0]||(e[0]=_((...o)=>a.handleOtpVerification&&a.handleOtpVerification(...o),["prevent"]))},[i("div",B,[(m(),g(w,null,I(4,o=>b(i("input",{key:o,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*","onUpdate:modelValue":s=>n.otp[o-1]=s,onInput:s=>a.handleInput(s,o),onKeydown:s=>a.handleKeyDown(s,o),class:"otp-input",placeholder:"_"},null,40,C),[[V,n.otp[o-1]]])),64))]),i("button",K,d(t.$t("otp.verify")),1),n.otpMessage?(m(),g("div",{key:0,class:"info-message",style:O({marginTop:"1rem",color:a.otpMessageColor})},d(n.otpMessage),5)):S("",!0)],32),i("div",L,[i("div",R,[i("span",null,d(n.timer),1)]),i("a",{href:"#",onClick:e[1]||(e[1]=_((...o)=>a.resendOtp&&a.resendOtp(...o),["prevent"]))},[$(p,{icon:"rotate-right"}),T(" "+d(t.$t("otp.resend")),1)])])])])}const q=y(N,[["render",U],["__scopeId","data-v-819cfb55"]]);export{q as default};

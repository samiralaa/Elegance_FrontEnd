import{_ as v,H as b,b as f,r as O,o,c as n,e as C,a as e,n as g,g as m,t as l,F as _,d as p,f as u}from"./index-9d1791a5.js";const w={components:{Header:b},name:"UserOrder",data(){return{orders:[],currentFilter:null,selectedOrder:null,isDialogVisible:!1,loading:!0,selectedCurrency:localStorage.getItem("selectedCurrency")?JSON.parse(localStorage.getItem("selectedCurrency")).code:"EGP"}},computed:{allOrdersCount(){return this.orders.length},pendingOrdersCount(){return this.orders.filter(r=>r.status==="pending").length},completedOrdersCount(){return this.orders.filter(r=>r.status==="completed"||r.status==="completed").length},cancelledOrdersCount(){return this.orders.filter(r=>r.status==="cancelled").length},filteredOrders(){return this.currentFilter?this.orders.filter(r=>this.currentFilter==="completed"?r.status==="completed":r.status===this.currentFilter):this.orders}},methods:{async fetchOrders(){var r,t,h;try{const a=localStorage.getItem("auth_token");if(!a){this.$toast.error("Please login to view your orders"),this.$router.push("/login");return}const s=await f.get("https://backend.webenia.org/api/orders/user",{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});s.data.status&&s.data.data.original.success?this.orders=s.data.data.original.orders:this.$toast.error(s.data.message||"Failed to fetch orders")}catch(a){console.error("Failed to fetch orders:",a),((r=a.response)==null?void 0:r.status)===401?(this.$toast.error("Please login to view your orders"),this.$router.push("/login")):this.$toast.error(((h=(t=a.response)==null?void 0:t.data)==null?void 0:h.message)||"Failed to fetch orders")}finally{this.loading=!1}},filterOrders(r){this.currentFilter=this.currentFilter===r?null:r},imageUrl(r){return`https://backend.webenia.org/public/storage/${r}`},formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})},formatStatus(r){return{pending:"In Progress",completed:"Completed",cancelled:"Cancelled"}[r.toLowerCase()]||r},async showOrderDetails(r){try{this.loading=!0;const t=localStorage.getItem("auth_token"),h=await f.get(`https://backend.webenia.org/api/orders/${r}`,{headers:{Authorization:`Bearer ${t}`}});this.selectedOrder=h.data.data.order,this.isDialogVisible=!0}catch{this.$toast.error("حدث خطأ أثناء تحميل تفاصيل الطلب")}finally{this.loading=!1}},getStatusBadgeClass(r){return{pending:"bg-warning",completed:"bg-success",cancelled:"bg-danger"}[r.toLowerCase()]||"bg-secondary"},updateCurrency(){const r=localStorage.getItem("selectedCurrency");this.selectedCurrency=r?JSON.parse(r).code:"EGP"}},mounted(){this.fetchOrders(),window.addEventListener("currency-changed",this.updateCurrency)},beforeUnmount(){window.removeEventListener("currency-changed",this.updateCurrency)}},k={class:"container py-4"},x={class:"orders-header"},S={class:"num"},F={class:"num"},D={class:"num"},I={class:"num"},z={key:0,class:"text-center"},B={key:1,class:"row g-4"},j={class:"order-card p-4 rounded-4 shadow-sm bg-white"},P={class:"d-flex justify-content-between align-items-start flex-wrap mb-3"},V={class:"fw-bold"},L={class:"text-end"},N={class:"text-muted"},U={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},E=["src"],H={class:"small"},M={class:"text-muted"},A={class:"text-muted"},q={class:"d-flex justify-content-between align-items-center"},G=["onClick"],J={key:2,class:"alert alert-info text-center"},T={key:0,class:"modal-overlay d-flex justify-content-center align-items-center"},K={class:"cart-modal bg-white rounded-4 shadow p-4 position-relative"},Q={class:"mb-3"},R={key:0,class:"text-center"},W={key:1,class:"cart-content overflow-auto",style:{"max-height":"60vh"}},X={class:"mb-3"},Y={key:0,class:"mb-3"},Z={key:0},$={key:0},ee={key:1},te={key:2},se={key:3},re={key:4},le={key:1},de={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},oe=["src"],ne={class:"small"},ie={class:"text-muted"},ae={class:"text-muted"};function ce(r,t,h,a,s,i){const y=O("Header");return o(),n(_,null,[C(y),e("div",k,[t[12]||(t[12]=e("h2",{class:"mb-4 fw-bold"},"My Orders",-1)),e("div",x,[e("a",{class:g(["order-stage",{active:!s.currentFilter}]),href:"#",onClick:t[0]||(t[0]=m(d=>i.filterOrders(null),["prevent"]))},[t[5]||(t[5]=e("h3",null,"In Progress",-1)),e("h3",S,l(i.allOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="pending"}]),href:"#",onClick:t[1]||(t[1]=m(d=>i.filterOrders("pending"),["prevent"]))},[t[6]||(t[6]=e("h3",null,"In Progress",-1)),e("h3",F,l(i.pendingOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="completed"}]),href:"#",onClick:t[2]||(t[2]=m(d=>i.filterOrders("completed"),["prevent"]))},[t[7]||(t[7]=e("h3",null,"Completed",-1)),e("h3",D,l(i.completedOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="cancelled"}]),href:"#",onClick:t[3]||(t[3]=m(d=>i.filterOrders("cancelled"),["prevent"]))},[t[8]||(t[8]=e("h3",null,"Cancelled",-1)),e("h3",I,l(i.cancelledOrdersCount),1)],2)]),s.loading?(o(),n("div",z,t[9]||(t[9]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):i.filteredOrders.length>0?(o(),n("div",B,[(o(!0),n(_,null,p(i.filteredOrders,d=>(o(),n("div",{key:d.id,class:"col-12 col-md-6"},[e("div",j,[e("div",P,[e("div",null,[t[10]||(t[10]=e("small",{class:"text-muted"},"Order ID",-1)),e("h5",V,"#"+l(d.id),1)]),e("div",L,[e("small",N,l(i.formatDate(d.ordered_at)),1),t[11]||(t[11]=e("br",null,null,-1)),e("span",{class:g(["badge",i.getStatusBadgeClass(d.status)])},l(i.formatStatus(d.status)),3)])]),e("div",U,[(o(!0),n(_,null,p(d.items,c=>(o(),n("div",{key:c.id,class:"d-flex flex-column align-items-start col-4"},[e("img",{src:i.imageUrl(c.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,E),e("strong",H,l(c.product.name_en),1),e("small",M,l(c.price)+" "+l(s.selectedCurrency)+" x"+l(c.quantity),1),e("small",A,"Size: "+l(c.size||"-"),1)]))),128))]),e("div",q,[e("strong",null,"Total: "+l(d.total_price)+" "+l(s.selectedCurrency)+" ("+l(d.items.length)+" Items)",1),e("button",{class:"btn btn-outline-dark btn-sm",onClick:c=>i.showOrderDetails(d.id)},"Details",8,G)])])]))),128))])):(o(),n("div",J," No orders found. "))]),s.isDialogVisible?(o(),n("div",T,[e("div",K,[e("button",{type:"button",class:"btn-close position-absolute top-0 end-0 m-3",onClick:t[4]||(t[4]=d=>s.isDialogVisible=!1),"aria-label":"Close"}),e("h4",Q,l(r.$t("order.orderDetails")),1),s.loading?(o(),n("div",R,t[13]||(t[13]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):(o(),n("div",W,[e("div",X,[t[14]||(t[14]=e("strong",null,"Status:",-1)),e("span",{class:g(["badge",i.getStatusBadgeClass(s.selectedOrder.status)])},l(i.formatStatus(s.selectedOrder.status)),3)]),s.selectedOrder.address?(o(),n("div",Y,[t[15]||(t[15]=e("strong",null,"Address:",-1)),typeof s.selectedOrder.address=="object"?(o(),n("div",Z,[s.selectedOrder.address.street?(o(),n("div",$,l(s.selectedOrder.address.street),1)):u("",!0),s.selectedOrder.address.city?(o(),n("div",ee,l(s.selectedOrder.address.city),1)):u("",!0),s.selectedOrder.address.state?(o(),n("div",te,l(s.selectedOrder.address.state),1)):u("",!0),s.selectedOrder.address.country?(o(),n("div",se,l(s.selectedOrder.address.country),1)):u("",!0),s.selectedOrder.address.zip?(o(),n("div",re,l(s.selectedOrder.address.zip),1)):u("",!0)])):(o(),n("div",le,l(s.selectedOrder.address),1))])):u("",!0),e("div",de,[(o(!0),n(_,null,p(s.selectedOrder.items,d=>(o(),n("div",{key:d.id,class:"d-flex flex-column align-items-start col-4"},[e("img",{src:i.imageUrl(d.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,oe),e("strong",ne,l(d.product.name_en),1),e("small",ie,l(d.price)+" "+l(s.selectedCurrency)+" x"+l(d.quantity),1),e("small",ae,"Size: "+l(d.size||"-"),1)]))),128))])]))])])):u("",!0)],64)}const ge=v(w,[["render",ce],["__scopeId","data-v-dc099a3b"]]);export{ge as default};

import{_ as b,b as m,V as y,r as _,o as l,c,a as t,t as n,f as p,g as v,i as w,w as u,v as f,e as C,p as k,F as M,d as B,k as V}from"./index-2602f062.js";const E={name:"EditCategory",data(){return{form:{name:"",name_ar:"",description:"",description_ar:"",brand_id:"",image:null},imagePreview:null,brands:[],successMessage:"",errorMessage:"",loading:!1}},created(){this.fetchBrands(),this.fetchCategory()},methods:{async fetchBrands(){try{const a=JSON.parse(localStorage.getItem("tokenData"));a!=null&&a.token&&(m.defaults.headers.common.Authorization=`Bearer ${a.token}`);const e=await m.get("https://backend.webenia.org/api/brands");if(e.data.status){const i=e.data.data;this.brands=Array.isArray(i)?i:[i]}else throw new Error(e.data.message||"Failed to fetch brands")}catch(a){console.error("Error fetching brands:",a),y.error("Failed to load brands")}},async fetchCategory(){var a,e;this.loading=!0;try{const i=JSON.parse(localStorage.getItem("tokenData"));i!=null&&i.token&&(m.defaults.headers.common.Authorization=`Bearer ${i.token}`);const g=this.$route.params.id,s=await m.get(`https://backend.webenia.org/api/categories/${g}`);if(s.data.status&&s.data.data){const r=s.data.data;this.form={name:r.name_en||"",name_ar:r.name_ar||"",description:r.description_en||"",description_ar:r.description_ar||"",brand_id:r.brand_id||"",image:null},r.image&&(this.imagePreview=r.image)}else throw new Error(s.data.message||"Failed to fetch category")}catch(i){this.errorMessage=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message||"An error occurred while fetching the category."}finally{this.loading=!1}},onFileChange(a){const e=a.target.files[0];e?(this.form.image=e,this.imagePreview=URL.createObjectURL(e)):(this.form.image=null,this.imagePreview=null)},async submitCategory(){var a,e,i,g,s;this.successMessage="",this.errorMessage="",this.loading=!0;try{const r=new FormData;r.append("name_en",this.form.name),r.append("name_ar",this.form.name_ar),r.append("description_en",this.form.description),r.append("description_ar",this.form.description_ar),r.append("brand_id",this.form.brand_id),this.form.image&&r.append("image",this.form.image);const d=JSON.parse(localStorage.getItem("tokenData"));d!=null&&d.token&&(m.defaults.headers.common.Authorization=`Bearer ${d.token}`);const h=this.$route.params.id,o=await m.post(`https://backend.webenia.org/api/categories/${h}`,r,{headers:{"Content-Type":"multipart/form-data"}});if((a=o.data)!=null&&a.status&&((e=o.data)!=null&&e.data))this.loading=!1,this.successMessage="Category updated successfully!",setTimeout(()=>{this.$router.push("/categories")},1500);else throw new Error(((i=o.data)==null?void 0:i.message)||"Failed to update category")}catch(r){this.loading=!1,this.errorMessage=((s=(g=r.response)==null?void 0:g.data)==null?void 0:s.message)||r.message||"An error occurred while updating the category."}}}},F={class:"category-edit"},S={class:"form-card"},A={class:"form-title"},N={key:0,class:"loading-overlay"},P={key:1,class:"success-message"},U={key:2,class:"error-message"},I={class:"form-group"},D={class:"form-group"},q={class:"form-group"},z={class:"form-group"},O={class:"form-group"},J={class:"form-group"},L={class:"file-input-wrapper"},T={key:0,class:"image-preview-container"},R={class:"preview-title"},j={class:"image-preview"},x=["src"],G={type:"submit",class:"submit-button"};function H(a,e,i,g,s,r){const d=_("el-option"),h=_("el-select");return l(),c("div",F,[t("div",S,[t("h2",A,n(a.$t("Categories.EditCategory")),1),s.loading?(l(),c("div",N,e[7]||(e[7]=[t("span",{class:"spinner"},null,-1)]))):p("",!0),s.successMessage?(l(),c("div",P,n(s.successMessage),1)):p("",!0),s.errorMessage?(l(),c("div",U,n(s.errorMessage),1)):p("",!0),t("form",{onSubmit:e[6]||(e[6]=v((...o)=>r.submitCategory&&r.submitCategory(...o),["prevent"])),style:w(s.loading?"pointer-events:none;opacity:0.5;":"")},[t("div",I,[t("label",null,n(a.$t("Categories.NameEn")),1),u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.form.name=o),required:"",class:"form-input"},null,512),[[f,s.form.name]])]),t("div",D,[t("label",null,n(a.$t("Categories.NameAr")),1),u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.form.name_ar=o),required:"",class:"form-input"},null,512),[[f,s.form.name_ar]])]),t("div",q,[t("label",null,n(a.$t("Categories.DescriptionEn")),1),u(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>s.form.description=o),required:"",class:"form-input form-textarea"},null,512),[[f,s.form.description]])]),t("div",z,[t("label",null,n(a.$t("Categories.DescriptionAr")),1),u(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.form.description_ar=o),required:"",class:"form-input form-textarea"},null,512),[[f,s.form.description_ar]])]),t("div",O,[t("label",null,n(a.$t("Categories.Brand")),1),C(h,{modelValue:s.form.brand_id,"onUpdate:modelValue":e[4]||(e[4]=o=>s.form.brand_id=o),placeholder:a.$t("Categories.SelectBrand"),filterable:"",clearable:"",class:"form-input"},{default:k(()=>[(l(!0),c(M,null,B(s.brands,o=>(l(),V(d,{key:o.id,label:o.name_en,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),t("div",J,[t("label",null,n(a.$t("Categories.Image")),1),t("div",L,[t("input",{type:"file",onChange:e[5]||(e[5]=(...o)=>r.onFileChange&&r.onFileChange(...o)),accept:"image/*",class:"form-input file-input"},null,32)])]),s.imagePreview?(l(),c("div",T,[t("p",R,n(a.$t("Categories.ImagePreview")),1),t("div",j,[t("img",{src:s.imagePreview,alt:"Image Preview"},null,8,x)])])):p("",!0),t("button",G,n(a.$t("Categories.UpdateButton")),1)],36)])])}const Q=b(E,[["render",H],["__scopeId","data-v-babafd23"]]);export{Q as default};

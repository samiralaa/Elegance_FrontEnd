import{_ as J,C as j,y as u,z as G,K as L,D as K,N as $,r as D,o as l,c as d,e as _,a as s,t as r,g as Q,E,F as k,d as I,w as C,v as V,f as g,b as w,H as W,m as X,ae as Y,q as N,n as Z,G as m}from"./index-9d1791a5.js";const ee={class:"axil-breadcrumb-area mt-5"},te={class:"container"},se={class:"row align-items-center"},ae={class:"col-lg-6 col-md-8"},oe={class:"inner"},ie={class:"title"},re=["dir"],ne={class:"container"},ce={class:"filter col-12"},le={class:"sidebar"},de={class:"sidebar-container"},ue={class:"sidebar-title"},ve={class:"checkbox-container"},me=["value"],_e={class:"sidebar-title"},ge={class:"price-range"},he=["min","max"],pe=["min","max"],fe={class:"price-values"},be={class:"products-grid"},ye={class:"image-container mb-3 bg-light rounded"},xe=["src","alt"],ke={key:0,class:"sale-badge"},Ce={class:"product-actions d-flex justify-content-center gap-5 w-100"},we=["onClick","title"],Fe={class:"card-body"},Pe={class:"card-title"},Se={class:"price-container"},Le={key:0,class:"price-old"},$e={key:1,class:"discount-badge"},De={class:"card-text card-price"},Ee={class:"addToCart-btn"},Ie=["disabled","onClick"],Ve={__name:"ProductListing",setup(Ne){const{t:c}=j(),T=u(document.documentElement.dir||"ltr"),F=u([]),P=u([]);u(!1),u("");const h=u([]),o=u({min:0,max:2e3}),v={min:0,max:2e3},p=u(!1),f=G(),A=L(()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"}),y=()=>{p.value=!p.value;const e=document.querySelector(".sidebar"),a=document.body;e&&(e.classList.toggle("active",p.value),e.classList.contains("active")?a.classList.add("no-scroll"):a.classList.remove("no-scroll"))},q=e=>`https://backend.webenia.org/public/storage/${e}`,b=e=>f.favorites.some(a=>a.product_id===e),M=e=>{const a=f.favorites.find(n=>n.product_id===e);return a?a.favorite_id||a.id:null},U=async e=>{var a,n;try{if(b(e.id)){const i=M(e.id);i&&(await f.removeFromFavorites(i),m({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const i=await f.addToFavorites(e.id);m({title:c("success"),message:i.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(i){console.error("Favorite error:",i),m({title:c("error"),message:((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},B=async()=>{try{const e=await w.get("https://backend.webenia.org/api/website");F.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},S=async()=>{try{const e=await w.get("https://backend.webenia.org/api/all/products");P.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},O=async e=>{var a,n;try{const i=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},t=await w.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:parseFloat(e.price)},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:i.code}});t.data.status?m({title:c("success"),message:t.data.message,type:"success"}):m({title:c("error"),message:t.data.message,type:"error"})}catch(i){console.error("Error adding to cart:",i),m({title:c("error"),message:(n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message,type:"error"})}};K(()=>{B(),S(),window.addEventListener("currency-changed",()=>{S()})});const z=L(()=>P.value.filter(e=>{const a=h.value.length===0||h.value.includes(e.category_id),i=o.value.min===v.min&&o.value.max===v.max?!0:e.price>=o.value.min&&e.price<=o.value.max;return a&&i})),R=e=>{if(e.discount&&e.discount.is_active){const a=parseFloat(e.discount.discount_value),n=parseFloat(e.converted_price||e.price);return(n-n*(a/100)).toFixed(2)}return e.converted_price||e.price},H=e=>e.discount&&e.discount.is_active?Math.round(parseFloat(e.discount.discount_value)):0;return $(()=>o.value.min,e=>{e>o.value.max&&(o.value.min=o.value.max)}),$(()=>o.value.max,e=>{e<o.value.min&&(o.value.max=o.value.min)}),(e,a)=>{const n=D("router-link"),i=D("fa");return l(),d(k,null,[_(W),s("div",ee,[s("div",te,[s("div",se,[s("div",ae,[s("div",oe,[s("h1",ie,r(e.$t("products.title")),1)])])])])]),s("div",{class:"shop-container",dir:T.value},[s("div",ne,[s("div",ce,[s("a",{href:"#",onClick:Q(y,["prevent"])},r(e.$t("products.filter")),1)]),s("aside",le,[s("div",de,[s("button",{class:"close-btn",onClick:y},"Ã—"),s("h3",ue,r(E(c)("products.categories")),1),a[4]||(a[4]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(l(!0),d(k,null,I(F.value,t=>(l(),d("div",{key:t.id,class:"filter-item"},[s("label",ve,[X(r(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),C(s("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=x=>h.value=x),value:t.id},null,8,me),[[Y,h.value]]),a[3]||(a[3]=s("span",{class:"checkmark"},null,-1))])]))),128)),s("h3",_e,r(E(c)("products.price")),1),a[5]||(a[5]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),s("div",ge,[C(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=t=>o.value.min=t),min:v.min,max:v.max},null,8,he),[[V,o.value.min,void 0,{number:!0}]]),C(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=t=>o.value.max=t),min:v.min,max:v.max},null,8,pe),[[V,o.value.max,void 0,{number:!0}]]),s("div",fe,[s("span",null,r(o.value.min)+" - "+r(o.value.max)+" "+r(A.value),1)])])])]),p.value?(l(),d("div",{key:0,class:"overlay",onClick:y})):g("",!0),s("section",be,[(l(!0),d(k,null,I(z.value,t=>(l(),d("div",{key:t.id,class:"product-card"},[s("div",ye,[_(n,{to:`/read/products/${t.id}`},{default:N(()=>[t.images&&t.images.length?(l(),d("img",{key:0,src:q(t.images[0].path),alt:t.name},null,8,xe)):g("",!0)]),_:2},1032,["to"]),t.is_available?g("",!0):(l(),d("div",ke,r(e.$t("products.outOfStock")),1)),s("div",Ce,[_(n,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:N(()=>[_(i,{icon:"eye"})]),_:2},1032,["to"]),s("button",{onClick:x=>U(t),class:Z(["btn rounded-circle shadow-sm btn-light",b(t.id)?"text-danger":""]),title:b(t.id)?"Remove from favorites":"Add to favorites"},[_(i,{icon:b(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,we)])]),s("div",Fe,[s("h5",Pe,r(t.name_en),1),s("div",Se,[t.discount&&t.discount.is_active?(l(),d("span",Le,r(t.converted_price)+" "+r(t.currency_code),1)):g("",!0),t.discount&&t.discount.is_active?(l(),d("span",$e,r(H(t))+"% OFF ",1)):g("",!0),s("span",De,r(R(t))+" "+r(t.currency_code),1)])]),s("div",Ee,[s("button",{disabled:!t.is_available,onClick:x=>O(t),class:"btn"},r(e.$t("products.addToCart")),9,Ie)])]))),128))])])],8,re)],64)}}},Ae=J(Ve,[["__scopeId","data-v-dbd81351"]]);export{Ae as default};

import{_ as U,Z as F,$ as q,b,r as P,o as d,c as m,a as t,t as a,g as f,w as c,v as N,n as w,f as p,m as _,e as D,p as v,F as L,d as V,i as j,l as k}from"./index-07d675ee.js";const R="https://backend.webenia.org/api",E={name:"Register",components:{ElSelect:F,ElOption:q},data(){return{formData:{fullName:"",email:"",password:"",confirmPassword:"",country_id:"",phoneNumber:""},countryCode:"",phoneNumber:"",errors:{fullName:"",email:"",password:"",confirmPassword:"",phoneNumber:"",country_id:""},countries:[],filteredCountries:[],loading:!1,showPassword:!1,showConfirmPassword:!1,countryCodes:{1:"93",2:"355",3:"213",4:"376",5:"244",6:"973",7:"880",8:"32",9:"55",10:"1",11:"86",12:"20",13:"33",14:"49",15:"30",16:"91",17:"62",18:"98",19:"964",20:"353",21:"39",22:"81",23:"962",24:"7",25:"254",26:"965",27:"961",28:"218",29:"60",30:"52",31:"212",32:"977",33:"31",34:"64",35:"234",36:"968",37:"92",38:"970",39:"974",40:"7",41:"966",42:"65",43:"27",44:"82",45:"34",46:"249",47:"46",48:"41",49:"963",50:"886",51:"255",52:"66",53:"216",54:"90",55:"256",56:"380",57:"971",58:"44",59:"1",60:"998",61:"84",62:"967",63:"263"}}},computed:{selectedCountryDialCode(){if(!Array.isArray(this.countries))return"";const e=this.countries.find(r=>r.id===this.formData.country_id);return e?this.getCountryCode(e.id):""},currentLocale(){var e;return((e=this.$i18n)==null?void 0:e.locale)||"en"}},created(){this.fetchCountries()},watch:{"formData.fullName"(e){this.validateFullName(e)},"formData.email"(e){this.validateEmail(e)},"formData.password"(e){this.validatePassword(e),this.formData.confirmPassword&&this.validateConfirmPassword(this.formData.confirmPassword)},"formData.confirmPassword"(e){this.validateConfirmPassword(e)},"formData.phoneNumber"(e){this.validatePhoneNumber(e)},"formData.country_id":{immediate:!0,handler(e){this.validateCountry(e),e?(this.countryCode=this.getCountryCode(e),this.phoneNumber&&this.updateFullPhoneNumber()):this.countryCode=""}},phoneNumber:{handler(e){this.updateFullPhoneNumber()}}},methods:{getCountryName(e){return this.currentLocale==="ar"?e.name_ar:e.name_en},getCountryCode(e){return this.countryCodes[e]||""},filterCountries(e){if(e){const r=e.toLowerCase();this.filteredCountries=this.countries.filter(n=>{var u,l;const h=((u=n.name_en)==null?void 0:u.toLowerCase())||"",s=((l=n.name_ar)==null?void 0:l.toLowerCase())||"",i=this.getCountryCode(n.id)||"";return h.includes(r)||s.includes(r)||i.includes(r)})}else this.filteredCountries=this.countries},async fetchCountries(){var e,r,n,h;try{this.loading=!0;const s=await b.get(`${R}/countries`);console.log("Countries API response:",s.data.data);const i=((e=s.data)==null?void 0:e.data)||[];this.countries=Array.isArray(i)?i:[],this.filteredCountries=this.countries,this.formData.country_id&&(this.countryCode=this.getCountryCode(this.formData.country_id),this.updateFullPhoneNumber())}catch(s){console.error("Error fetching countries:",s),(h=(r=this.$toast)==null?void 0:r.error)==null||h.call(r,((n=this.$t)==null?void 0:n.call(this,"register.errorFetchingCountries"))||"Failed to fetch countries")}finally{this.loading=!1}},validateFullName(e){e?e.length<3?this.errors.fullName=this.$t("register.validation.fullNameMinLength"):e.length>255?this.errors.fullName=this.$t("register.validation.fullNameMaxLength"):/^[\p{L}\s'-]+$/u.test(e)?this.errors.fullName="":this.errors.fullName=this.$t("register.validation.fullNameInvalid"):this.errors.fullName=this.$t("register.validation.fullNameRequired")},validateEmail(e){e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?this.errors.email="":this.errors.email=this.$t("register.validation.emailInvalid"):this.errors.email=this.$t("register.validation.emailRequired")},validatePassword(e){e?e.length<8?this.errors.password=this.$t("register.validation.passwordMinLength"):this.errors.password="":this.errors.password=this.$t("register.validation.passwordRequired")},validateConfirmPassword(e){e?e!==this.formData.password?this.errors.confirmPassword=this.$t("register.validation.confirmPasswordMatch"):this.errors.confirmPassword="":this.errors.confirmPassword=this.$t("register.validation.confirmPasswordRequired")},validatePhoneNumber(e){e?this.countryCode?e.length<10||e.length>18?this.errors.phoneNumber=this.$t("register.validation.phoneLength"):/^\d+$/.test(e)?this.errors.phoneNumber="":this.errors.phoneNumber=this.$t("register.validation.phoneInvalid"):this.errors.phoneNumber=this.$t("register.validation.countryRequired"):this.errors.phoneNumber=this.$t("register.validation.phoneRequired")},validateCountry(e){e?this.countries.some(r=>r.id===e)?this.errors.country_id="":this.errors.country_id=this.$t("register.validation.countryInvalid"):this.errors.country_id=this.$t("register.validation.countryRequired")},async handleRegister(){var e,r,n,h,s,i,u,l,g;if(this.validateFullName(this.formData.fullName),this.validateEmail(this.formData.email),this.validatePassword(this.formData.password),this.validateConfirmPassword(this.formData.confirmPassword),this.validatePhoneNumber(this.formData.phoneNumber),this.validateCountry(this.formData.country_id),!Object.values(this.errors).some(o=>o))try{const o=await b.post(`${R}/clients/register`,{name:this.formData.fullName,email:this.formData.email,password:this.formData.password,password_confirmation:this.formData.confirmPassword,country_id:this.formData.country_id,phone:this.formData.phoneNumber,role:"user"});if(o.data&&o.data.data)localStorage.setItem("user",JSON.stringify(o.data.data.user)),localStorage.setItem("auth_token",o.data.data.token),(r=(e=this.$toast)==null?void 0:e.success)==null||r.call(e,o.data.message||"Registration successful"),this.$router.push("/otp");else throw new Error("Invalid response format")}catch(o){if(console.error("Registration error:",o),(h=(n=o.response)==null?void 0:n.data)!=null&&h.errors){const y=o.response.data.errors;Object.keys(y).forEach(C=>{this.errors.hasOwnProperty(C)&&(this.errors[C]=y[C][0])})}else{const y=((i=(s=o.response)==null?void 0:s.data)==null?void 0:i.message)||((u=this.$t)==null?void 0:u.call(this,"register.error"))||"Registration failed";(g=(l=this.$toast)==null?void 0:l.error)==null||g.call(l,y)}}},updateFullPhoneNumber(){this.countryCode?this.formData.phoneNumber=this.countryCode+this.phoneNumber:this.formData.phoneNumber=this.phoneNumber},formatPhoneNumber(e){let r=e.target.value;r=r.replace(/\D/g,""),this.phoneNumber=r},togglePassword(){this.showPassword=!this.showPassword},toggleConfirmPassword(){this.showConfirmPassword=!this.showConfirmPassword},copyPassword(e){e&&navigator.clipboard.writeText(e).then(()=>{var r,n;(n=(r=this.$toast)==null?void 0:r.success)==null||n.call(r,this.$t("joinUs.passwordCopied")||"Password copied!")}).catch(()=>{var r,n;(n=(r=this.$toast)==null?void 0:r.error)==null||n.call(r,this.$t("joinUs.copyFailed")||"Failed to copy password.")})}}},I={class:"join-us-container"},A={class:"join-us-content"},M={class:"form-header"},S={class:"elegant-title"},O={class:"elegant-description"},B={class:"form-group"},T={for:"fullName"},H=["placeholder"],z={key:0,class:"error-message"},J={class:"form-group"},Q={for:"email"},Z=["placeholder"],G={key:0,class:"error-message"},K={class:"form-group"},W={for:"password"},X={class:"password-input-container"},Y=["type","placeholder"],$={key:0,class:"error-message"},x={class:"form-group"},ee={for:"confirmPassword"},re={class:"password-input-container"},se=["type","placeholder"],oe={key:0,class:"error-message"},te={class:"form-group"},ie={for:"country"},ae={class:"country-option"},ne={class:"country-name"},le={class:"country-code"},de={key:0,class:"error-message"},he={class:"form-group"},me={for:"phoneNumber"},ue={class:"phone-input-container"},fe={class:"country-code-input"},ce=["placeholder"],pe=["placeholder"],we={key:0,class:"error-message"},ge={type:"submit",class:"submit-btn"},ye={class:"register-section"};function Ne(e,r,n,h,s,i){const u=P("el-option"),l=P("el-select"),g=P("router-link");return d(),m("div",I,[r[19]||(r[19]=t("div",{class:"banner-section"},null,-1)),t("div",A,[t("div",M,[t("h1",S,a(e.$t("header.register")),1),t("p",O,a(e.$t("header.register")),1)]),t("form",{onSubmit:r[17]||(r[17]=f((...o)=>i.handleRegister&&i.handleRegister(...o),["prevent"])),class:"join-form"},[t("div",B,[t("label",T,a(e.$t("header.fullName")),1),c(t("input",{type:"text",id:"fullName","onUpdate:modelValue":r[0]||(r[0]=o=>s.formData.fullName=o),placeholder:e.$t("header.fullNamePlaceholder"),class:w({error:s.errors.fullName,valid:s.formData.fullName&&!s.errors.fullName}),required:""},null,10,H),[[N,s.formData.fullName]]),s.errors.fullName?(d(),m("span",z,a(s.errors.fullName),1)):p("",!0)]),t("div",J,[t("label",Q,a(e.$t("header.email")),1),c(t("input",{type:"email",id:"email","onUpdate:modelValue":r[1]||(r[1]=o=>s.formData.email=o),placeholder:e.$t("header.emailPlaceholder"),class:w({error:s.errors.email,valid:s.formData.email&&!s.errors.email}),required:""},null,10,Z),[[N,s.formData.email]]),s.errors.email?(d(),m("span",G,a(s.errors.email),1)):p("",!0)]),t("div",K,[t("label",W,a(e.$t("header.password")),1),t("div",X,[c(t("input",{type:s.showPassword?"text":"password",id:"password","onUpdate:modelValue":r[2]||(r[2]=o=>s.formData.password=o),placeholder:e.$t("header.passwordPlaceholder"),class:w({error:s.errors.password,valid:s.formData.password&&!s.errors.password}),required:"",onCopy:r[3]||(r[3]=f(()=>{},["prevent"])),onCut:r[4]||(r[4]=f(()=>{},["prevent"])),onPaste:r[5]||(r[5]=f(()=>{},["prevent"]))},null,42,Y),[[_,s.formData.password]]),t("button",{type:"button",class:"show-password-btn",onClick:r[6]||(r[6]=(...o)=>i.togglePassword&&i.togglePassword(...o))},a(s.showPassword?e.$t("joinUs.hidePassword"):e.$t("joinUs.showPassword")),1),t("button",{type:"button",class:"copy-password-btn",onClick:r[7]||(r[7]=o=>i.copyPassword(s.formData.password))})]),s.errors.password?(d(),m("span",$,a(s.errors.password),1)):p("",!0)]),t("div",x,[t("label",ee,a(e.$t("header.confirmPassword")),1),t("div",re,[c(t("input",{type:s.showConfirmPassword?"text":"password",id:"confirmPassword","onUpdate:modelValue":r[8]||(r[8]=o=>s.formData.confirmPassword=o),placeholder:e.$t("register.confirmPasswordPlaceholder"),class:w({error:s.errors.confirmPassword,valid:s.formData.confirmPassword&&!s.errors.confirmPassword}),required:"",onCopy:r[9]||(r[9]=f(()=>{},["prevent"])),onCut:r[10]||(r[10]=f(()=>{},["prevent"])),onPaste:r[11]||(r[11]=f(()=>{},["prevent"]))},null,42,se),[[_,s.formData.confirmPassword]]),t("button",{type:"button",class:"show-password-btn",onClick:r[12]||(r[12]=(...o)=>i.toggleConfirmPassword&&i.toggleConfirmPassword(...o))},a(s.showConfirmPassword?e.$t("joinUs.hidePassword"):e.$t("joinUs.showPassword")),1)]),s.errors.confirmPassword?(d(),m("span",oe,a(s.errors.confirmPassword),1)):p("",!0)]),t("div",te,[t("label",ie,a(e.$t("register.country")),1),D(l,{modelValue:s.formData.country_id,"onUpdate:modelValue":r[13]||(r[13]=o=>s.formData.country_id=o),class:"country-select",placeholder:e.$t("register.countryPlaceholder"),loading:s.loading,filterable:"","filter-method":i.filterCountries,"remote-method":i.filterCountries,remote:!1,required:""},{default:v(()=>[(d(!0),m(L,null,V(s.filteredCountries,o=>(d(),j(u,{key:o.id,label:i.getCountryName(o),value:o.id},{default:v(()=>[t("div",ae,[t("span",ne,a(i.getCountryName(o)),1),t("span",le,"+"+a(i.getCountryCode(o.id)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading","filter-method","remote-method"]),s.errors.country_id?(d(),m("span",de,a(s.errors.country_id),1)):p("",!0)]),t("div",he,[t("label",me,a(e.$t("register.phoneNumber")),1),t("div",ue,[t("div",fe,[r[18]||(r[18]=t("span",{class:"plus"},"+",-1)),c(t("input",{type:"text","onUpdate:modelValue":r[14]||(r[14]=o=>s.countryCode=o),class:"country-code-field",readonly:"",placeholder:i.selectedCountryDialCode||"Code"},null,8,ce),[[N,s.countryCode]])]),c(t("input",{type:"tel",id:"phoneNumber","onUpdate:modelValue":r[15]||(r[15]=o=>s.phoneNumber=o),placeholder:e.$t("register.phoneNumberPlaceholder"),class:w({error:s.errors.phoneNumber,valid:s.phoneNumber&&!s.errors.phoneNumber}),required:"",minlength:"10",maxlength:"18",onInput:r[16]||(r[16]=(...o)=>i.formatPhoneNumber&&i.formatPhoneNumber(...o))},null,42,pe),[[N,s.phoneNumber]])]),s.errors.phoneNumber?(d(),m("span",we,a(s.errors.phoneNumber),1)):p("",!0)]),t("button",ge,a(e.$t("register.submit")),1),t("div",ye,[t("p",null,[k(a(e.$t("register.alreadyHaveAccount"))+" ",1),D(g,{to:"/account/login",class:"link"},{default:v(()=>[k(a(e.$t("register.loginHere")),1)]),_:1})])])],32)])])}const Pe=U(E,[["render",Ne],["__scopeId","data-v-f2c7ac91"]]);export{Pe as default};

import{_ as ee,B as te,L as N,x as _,y as se,z as ae,D as oe,N as q,r as z,o as u,c as m,e as f,a,t as d,g as ie,E as F,F as P,d as B,w as h,v as k,l as M,f as y,b as S,H as ne,af as re,m as K,n as ce,k as le,G as v}from"./index-bdf199cb.js";const de={class:"axil-breadcrumb-area mt-5"},ue={class:"container"},me={class:"row align-items-center"},ve={class:"col-lg-6 col-md-8"},_e={class:"inner"},ge={class:"title"},pe=["dir"],fe={class:"container"},he={class:"filter col-12"},ye={class:"sidebar"},be={class:"sidebar-container"},xe={class:"sidebar-title"},ke={class:"checkbox-container"},we=["value"],Ce={class:"sidebar-title"},Fe={class:"price-range"},Pe=["min","max"],Se=["min","max"],Le={class:"price-values mt-2"},Ve={class:"d-flex gap-2 align-items-center"},De=["min","max"],$e=["min","max"],Ee={class:"products-grid"},Ie={class:"image-container mb-3 bg-light rounded"},Ue=["src","alt"],Te={key:0,class:"sale-badge"},Ae={class:"product-actions d-flex justify-content-center gap-5 w-100"},Ne=["onClick","title"],qe={class:"card-body"},ze={class:"card-title"},Be={class:"price-container"},Me={key:0,class:"discount-badge"},Ke={key:1,class:"price-old"},Oe={class:"card-text card-price"},Re=["disabled","onClick"],He={__name:"ProductListing",setup(je){const{locale:L,t:c}=te(),O=N(()=>L.value==="ar"?"rtl":"ltr"),V=_([]),D=_([]);_(!1),_("");const g=_([]),o=_({min:0,max:2e3}),r={min:0,max:2e3},p=_(!1),b=se(),$=ae(),E=()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"},R=(e,s,i)=>{const l={AED:1,USD:.2724795640326976};return s===i?parseFloat(e):l[i]?parseFloat((e*l[i]).toFixed(2)):parseFloat(e)},w=()=>{p.value=!p.value;const e=document.querySelector(".sidebar"),s=document.body;e&&(e.classList.toggle("active",p.value),e.classList.contains("active")?s.classList.add("no-scroll"):s.classList.remove("no-scroll"))},H=e=>`https://backend.webenia.org/public/storage/${e}`,x=e=>b.favorites.some(s=>s.product_id===e),j=e=>{const s=b.favorites.find(i=>i.product_id===e);return s?s.favorite_id||s.id:null},G=async e=>{var s,i,l,t;try{if(x(e.id)){const n=j(e.id);n&&(await b.removeFromFavorites(n),v({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await b.addToFavorites(e.id);v({title:c("success"),message:n.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){if(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)==="Unauthenticated."){v({title:c("error"),message:c("unauthenticated"),type:"warning",duration:4e3});return}v({title:c("error"),message:((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},J=async()=>{try{const e=await S.get("https://backend.webenia.org/api/website");V.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},I=async()=>{try{const e=await S.get("https://backend.webenia.org/api/all/products");D.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},Q=async e=>{var s,i,l,t;try{let n=0;if(e.discount&&e.discount.is_active){const Z=parseFloat(e.discount.discount_value),A=parseFloat(e.price);n=A-A*(Z/100)}else n=parseFloat(e.price);const C=await S.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:n},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});C.data.status?(v({title:c("success"),message:C.data.message,type:"success"}),$.incrementCount(),await $.fetchCartCount()):v({title:c("error"),message:C.data.message,type:"error"})}catch(n){if(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)==="Unauthenticated."){v({title:c("error"),message:c("unauthenticated"),type:"warning",duration:4e3});return}v({title:c("error"),message:(t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message,type:"error"})}};oe(()=>{J(),I(),window.addEventListener("currency-changed",()=>{I(),X()})});const W=N(()=>D.value.filter(e=>{const s=g.value.length===0||g.value.includes(e.category_id),i=o.value.min===r.min&&o.value.max===r.max,l=R(U(e),e.currency_code||"AED",E.value),t=i?!0:l>=o.value.min&&l<=o.value.max;return s&&t})),X=()=>{g.value=[],o.value.min=r.min,o.value.max=r.max,p.value=!1,document.body.classList.remove("no-scroll")},U=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(s/100)).toFixed(2)}return e.converted_price||e.price},Y=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value);return Math.round(s)}return 0},T=e=>{["e","E","+","-","."].includes(e.key)&&e.preventDefault()};return q(()=>o.value.min,e=>{e>o.value.max&&(o.value.min=o.value.max),e<r.min&&(o.value.min=r.min)}),q(()=>o.value.max,e=>{e<o.value.min&&(o.value.max=o.value.min),e>r.max&&(o.value.max=r.max)}),(e,s)=>{const i=z("router-link"),l=z("fa");return u(),m(P,null,[f(ne),a("div",de,[a("div",ue,[a("div",me,[a("div",ve,[a("div",_e,[a("h1",ge,d(e.$t("products.title")),1)])])])])]),a("div",{class:"shop-container",dir:O.value},[a("div",fe,[a("div",he,[a("a",{href:"#",onClick:ie(w,["prevent"])},d(e.$t("products.filter")),1)]),a("aside",ye,[a("div",be,[a("button",{class:"close-btn",onClick:w},"Ã—"),a("h3",xe,d(F(c)("products.categories")),1),s[7]||(s[7]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(u(!0),m(P,null,B(V.value,t=>(u(),m("div",{key:t.id,class:"filter-item"},[a("label",ke,[M(d(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),h(a("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=n=>g.value=n),value:t.id},null,8,we),[[re,g.value]]),s[5]||(s[5]=a("span",{class:"checkmark"},null,-1))])]))),128)),a("h3",Ce,d(F(c)("products.price")),1),s[8]||(s[8]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),a("div",Fe,[h(a("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.min=t),step:10,min:r.min,max:r.max},null,8,Pe),[[k,o.value.min,void 0,{number:!0}]]),h(a("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=t=>o.value.max=t),step:10,min:r.min,max:r.max},null,8,Se),[[k,o.value.max,void 0,{number:!0}]]),a("div",Le,[a("div",Ve,[h(a("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.min=t),step:10,min:r.min,max:r.max,onKeydown:T,class:"form-control qty-number"},null,40,De),[[k,o.value.min,void 0,{number:!0,lazy:!0}]]),s[6]||(s[6]=a("span",null,"-",-1)),h(a("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=t=>o.value.max=t),step:10,min:r.min,max:r.max,onKeydown:T,class:"form-control qty-number"},null,40,$e),[[k,o.value.max,void 0,{number:!0,lazy:!0}]]),M(" "+d(E()),1)])])])])]),p.value?(u(),m("div",{key:0,class:"overlay",onClick:w})):y("",!0),a("section",Ee,[(u(!0),m(P,null,B(W.value,t=>(u(),m("div",{key:t.id,class:"product-card"},[a("div",Ie,[f(i,{to:`/read/products/${t.id}`},{default:K(()=>[t.images&&t.images.length?(u(),m("img",{key:0,src:H(t.images[0].path),alt:t.name},null,8,Ue)):y("",!0)]),_:2},1032,["to"]),t.is_available?y("",!0):(u(),m("div",Te,d(e.$t("products.outOfStock")),1)),a("div",Ae,[f(i,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:K(()=>[f(l,{icon:"eye"})]),_:2},1032,["to"]),a("button",{onClick:n=>G(t),class:ce(["btn rounded-circle shadow-sm btn-light",x(t.id)?"text-danger":""]),title:x(t.id)?"Remove from favorites":"Add to favorites"},[f(l,{icon:x(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,Ne)])]),a("div",qe,[a("h5",ze,d(F(L)==="ar"?t.name_ar:t.name_en),1),a("div",Be,[t.discount&&t.discount.is_active?(u(),m("span",Me,d(Y(t))+"% OFF ",1)):y("",!0),t.discount&&t.discount.is_active?(u(),m("span",Ke,d(t.converted_price)+" "+d(t.currency_code),1)):y("",!0),a("span",Oe,d(U(t))+" "+d(t.currency_code),1)])]),a("div",{class:"addToCart-btn",style:le(t.is_available?"":"cursor: not-allowed;")},[a("button",{disabled:!t.is_available,onClick:n=>Q(t),class:"btn"},d(e.$t("products.addToCart")),9,Re)],4)]))),128))])])],8,pe)],64)}}},Je=ee(He,[["__scopeId","data-v-3907e825"]]);export{Je as default};

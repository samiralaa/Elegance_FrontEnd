import{_ as de,D as se,C as ue,y as _,L as re,E as ie,r as s,R as ce,o as y,c as S,a as f,t as r,e as o,p as l,G as v,b as i,W as c,m as p,a3 as O,w as B,k as F,a6 as L,a9 as pe,a1 as me,a2 as _e,aa as ve,F as fe,d as ge,v as R,a5 as ye}from"./index-ecb0d7d7.js";const he={class:"products-container"},be={class:"header"},$e={class:"image-error"},we={key:1,class:"image-error"},ke={dir:"rtl"},Ve={class:"dialog-footer"},h="https://backend.webenia.org",Pe={__name:"index",setup(De){const A=se(),{t:b}=ue(),P=_([]),$=_(!1),N=`${h}/api/dashboard/products`,T=async()=>{$.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");i.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await i.get(N);if(t.data.status)P.value=t.data.data;else throw new Error(t.data.message||"Failed to fetch products")}catch(e){console.error("Fetch products error:",e),c.error(e.message||"Failed to fetch products")}finally{$.value=!1}},W=()=>{A.push("/products/create")},G=e=>{A.push(`/products/${e}`)},Y=e=>{A.push(`/products/${e.id}/edit`)},j=async e=>{try{if(await ye.confirm(b("Products.DeleteConfirmation"),b("Products.Warning"),{confirmButtonText:b("Products.Yes"),cancelButtonText:b("Products.No"),type:"warning"})==="confirm"){$.value=!0;const d=JSON.parse(localStorage.getItem("tokenData"));if(!d||!d.token)throw new Error("Authentication token not found");i.defaults.headers.common.Authorization=`Bearer ${d.token}`;const V=await i.delete(`${N}/${e.id}`);if(V.data.status)c.success(b("Products.DeletedSuccessfully")),P.value=P.value.filter(E=>E.id!==e.id);else throw new Error(V.data.message||"Failed to delete product")}}catch(t){t!=="cancel"&&(console.error("Delete product error:",t),c.error(t.message||"Failed to delete product"))}finally{$.value=!1}},w=_(!1),U=_(null),I=_([]),u=_({unit_id:"",weight:"",price:""}),q=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));i.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await i.get(`${h}/api/units`);I.value=t.data.data}catch(e){console.error("Failed to fetch units:",e),c.error("Failed to load units")}},H=e=>{U.value=e,u.value={unit_id:"",weight:"",price:""},q(),w.value=!0},K=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));i.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={product_id:U.value.id,unit_id:u.value.unit_id,weight:u.value.weight,price:u.value.price},d=await i.post(`${h}/api/amounts`,t);d.data.status?(c.success("Amount added successfully"),w.value=!1):c.error(d.data.message||"Failed to add amount")}catch(e){console.error(e),c.error("Error occurred while saving amount")}},k=_(!1),n=_({start_date:"",duration:"",discount_value:"",is_active:!1,product_id:"",category_id:"",end_date:""}),Q=e=>{U.value=e,n.value={start_date:"",duration:"",discount_value:"",is_active:!1,product_id:e.id,category_id:e.category_id||"",end_date:""},k.value=!0},X=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));i.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t={start_date:n.value.start_date,duration:n.value.duration,discount_value:n.value.discount_value,is_active:n.value.is_active,product_id:n.value.product_id,category_id:n.value.category_id,end_date:n.value.end_date},d=await i.post(`${h}/api/discounts`,t);d.data?(c.success("Discount added successfully"),k.value=!1):c.error(d.data.message||"Failed to add discount")}catch(e){console.error(e),c.error("Error occurred while saving discount")}},Z=re(()=>window.innerWidth<=768);return ie(()=>{T()}),(e,t)=>{const d=s("el-button"),V=s("el-icon"),E=s("el-image"),g=s("el-table-column"),x=s("el-button-group"),ee=s("el-table"),te=s("el-card"),ae=s("el-option"),oe=s("el-select"),m=s("el-form-item"),D=s("el-input"),z=s("el-form"),J=s("el-dialog"),M=s("el-date-picker"),le=s("el-switch"),ne=ce("loading");return y(),S("div",he,[f("div",be,[f("h2",null,r(e.$t("Products.Products")),1),o(d,{type:"primary",icon:v(O),onClick:W},{default:l(()=>[p(r(e.$t("Products.AddProduct")),1)]),_:1},8,["icon"])]),o(te,{class:"products-table"},{default:l(()=>[B((y(),F(ee,{data:P.value,style:{width:"100%"}},{default:l(()=>[o(g,{label:e.$t("Products.Image"),width:"120"},{default:l(({row:a})=>[a.images&&a.images.length>0?(y(),F(E,{key:0,src:`${h}/${a.images[0].path}`,fit:"cover",class:"product-image","preview-src-list":[`${h}public/storage/${a.images[0].path}`],"initial-index":0,"preview-teleported":""},{error:l(()=>[f("div",$e,[o(V,null,{default:l(()=>[o(v(L))]),_:1})])]),_:2},1032,["src","preview-src-list"])):(y(),S("div",we,[o(V,null,{default:l(()=>[o(v(L))]),_:1})]))]),_:1},8,["label"]),o(g,{prop:"name_en",label:e.$t("Products.NameEn")},null,8,["label"]),o(g,{prop:"name_ar",label:e.$t("Products.NameAr")},{default:l(({row:a})=>[f("div",ke,r(a.name_ar||e.$t("Products.NA")),1)]),_:1},8,["label"]),o(g,{prop:"price",label:e.$t("Products.Price")},null,8,["label"]),o(g,{prop:"currency.name_en",label:e.$t("Products.Currency")},null,8,["label"]),o(g,{label:e.$t("Products.Actions"),width:"250"},{default:l(({row:a})=>[o(x,null,{default:l(()=>[o(d,{type:"primary",icon:v(pe),onClick:C=>G(a.id)},{default:l(()=>[p(r(e.$t("Products.View")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"warning",icon:v(me),onClick:C=>Y(a)},{default:l(()=>[p(r(e.$t("Products.Edit")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"danger",icon:v(_e),onClick:C=>j(a)},{default:l(()=>[p(r(e.$t("Products.Delete")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"success",icon:v(O),onClick:C=>H(a)},{default:l(()=>[p(r(e.$t("add.amount")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"info",icon:v(ve),onClick:C=>Q(a)},{default:l(()=>[p(r(e.$t("Products.AddDiscount")),1)]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[ne,$.value]])]),_:1}),o(J,{modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=a=>w.value=a),title:"Add Product Amount",width:"500px"},{footer:l(()=>[o(d,{onClick:t[3]||(t[3]=a=>w.value=!1)},{default:l(()=>t[14]||(t[14]=[p("Cancel")])),_:1,__:[14]}),o(d,{type:"primary",onClick:K},{default:l(()=>t[15]||(t[15]=[p("Submit")])),_:1,__:[15]})]),default:l(()=>[o(z,{model:u.value,"label-width":"100px"},{default:l(()=>[o(m,{label:"Unit"},{default:l(()=>[o(oe,{modelValue:u.value.unit_id,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value.unit_id=a),placeholder:"Select Unit"},{default:l(()=>[(y(!0),S(fe,null,ge(I.value,a=>(y(),F(ae,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"Weight"},{default:l(()=>[o(D,{modelValue:u.value.weight,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.weight=a),type:"number",placeholder:"Enter weight"},null,8,["modelValue"])]),_:1}),o(m,{label:"Price"},{default:l(()=>[o(D,{modelValue:u.value.price,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.price=a),type:"number",placeholder:"Enter price"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(J,{modelValue:k.value,"onUpdate:modelValue":t[13]||(t[13]=a=>k.value=a),title:e.$t("discount.add_discount"),width:Z.value?"90%":"500px",class:"discount-dialog"},{footer:l(()=>[f("div",Ve,[o(d,{onClick:t[12]||(t[12]=a=>k.value=!1)},{default:l(()=>[p(r(e.$t("common.cancel")),1)]),_:1}),o(d,{type:"primary",onClick:X},{default:l(()=>[p(r(e.$t("common.submit")),1)]),_:1})])]),default:l(()=>[o(z,{model:n.value,"label-width":"100px",class:"discount-form"},{default:l(()=>[o(m,{label:e.$t("discount.start_date")},{default:l(()=>[o(M,{modelValue:n.value.start_date,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.start_date=a),type:"date",placeholder:e.$t("discount.start_date_placeholder"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("discount.duration_days")},{default:l(()=>[o(D,{modelValue:n.value.duration,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.duration=a),type:"number",placeholder:e.$t("discount.duration_days_placeholder"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("discount.discount_value")},{default:l(()=>[o(D,{modelValue:n.value.discount_value,"onUpdate:modelValue":t[7]||(t[7]=a=>n.value.discount_value=a),type:"number",placeholder:e.$t("discount.discount_value_placeholder"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("discount.is_active")},{default:l(()=>[o(le,{modelValue:n.value.is_active,"onUpdate:modelValue":t[8]||(t[8]=a=>n.value.is_active=a)},null,8,["modelValue"])]),_:1},8,["label"]),B(f("input",{type:"hidden","onUpdate:modelValue":t[9]||(t[9]=a=>n.value.product_id=a)},null,512),[[R,n.value.product_id]]),B(f("input",{type:"hidden","onUpdate:modelValue":t[10]||(t[10]=a=>n.value.category_id=a)},null,512),[[R,n.value.category_id]]),o(m,{label:e.$t("discount.end_date")},{default:l(()=>[o(M,{modelValue:n.value.end_date,"onUpdate:modelValue":t[11]||(t[11]=a=>n.value.end_date=a),type:"date",placeholder:e.$t("discount.end_date_placeholder"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])])}}},Ae=de(Pe,[["__scopeId","data-v-4ef30235"]]);export{Ae as default};

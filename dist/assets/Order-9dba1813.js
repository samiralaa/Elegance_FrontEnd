import{_ as b,H as v,b as p,r as y,o as a,c as i,e as w,a as e,n as g,w as h,t as l,F as m,d as f,f as C}from"./index-d93b5fdf.js";const O={components:{Header:v},name:"UserOrder",data(){return{orders:[],currentFilter:null,selectedOrder:null,isDialogVisible:!1,loading:!0}},computed:{allOrdersCount(){return this.orders.length},pendingOrdersCount(){return this.orders.filter(s=>s.status==="pending").length},completedOrdersCount(){return this.orders.filter(s=>s.status==="completed"||s.status==="completed").length},cancelledOrdersCount(){return this.orders.filter(s=>s.status==="cancelled").length},filteredOrders(){return this.currentFilter?this.orders.filter(s=>this.currentFilter==="completed"?s.status==="completed":s.status===this.currentFilter):this.orders}},methods:{async fetchOrders(){var s,t,u;try{const d=localStorage.getItem("auth_token");if(!d){this.$toast.error("Please login to view your orders"),this.$router.push("/login");return}const n=await p.get("https://backend.webenia.org/api/orders/user",{headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"}});n.data.status&&n.data.data.original.success?this.orders=n.data.data.original.orders:this.$toast.error(n.data.message||"Failed to fetch orders")}catch(d){console.error("Failed to fetch orders:",d),((s=d.response)==null?void 0:s.status)===401?(this.$toast.error("Please login to view your orders"),this.$router.push("/login")):this.$toast.error(((u=(t=d.response)==null?void 0:t.data)==null?void 0:u.message)||"Failed to fetch orders")}finally{this.loading=!1}},filterOrders(s){this.currentFilter=this.currentFilter===s?null:s},imageUrl(s){return`https://backend.webenia.org/public/storage/${s}`},formatDate(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})},formatStatus(s){return{pending:"In Progress",completed:"Completed",cancelled:"Cancelled"}[s.toLowerCase()]||s},async showOrderDetails(s){try{this.loading=!0;const t=localStorage.getItem("auth_token"),u=await p.get(`https://backend.webenia.org/api/orders/${s}`,{headers:{Authorization:`Bearer ${t}`}});this.selectedOrder=u.data.data.order,this.isDialogVisible=!0}catch{this.$toast.error("حدث خطأ أثناء تحميل تفاصيل الطلب")}finally{this.loading=!1}},getStatusBadgeClass(s){return{pending:"bg-warning",completed:"bg-success",cancelled:"bg-danger"}[s.toLowerCase()]||"bg-secondary"}},mounted(){this.fetchOrders()}},k={class:"container py-4"},x={class:"orders-header"},F={class:"num"},D={class:"num"},S={class:"num"},I={class:"num"},P={key:0,class:"text-center"},z={key:1,class:"row g-4"},B={class:"order-card p-4 rounded-4 shadow-sm bg-white"},V={class:"d-flex justify-content-between align-items-start flex-wrap mb-3"},j={class:"fw-bold"},U={class:"text-end"},E={class:"text-muted"},H={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},L=["src"],M={class:"small"},N={class:"text-muted"},G={class:"text-muted"},q={class:"d-flex justify-content-between align-items-center"},A=["onClick"],T={key:2,class:"alert alert-info text-center"},J={key:0,class:"modal-overlay d-flex justify-content-center align-items-center"},K={class:"cart-modal bg-white rounded-4 shadow p-4 position-relative"},Q={class:"mb-3"},R={key:0,class:"text-center"},W={key:1,class:"cart-content overflow-auto",style:{"max-height":"60vh"}},X={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},Y=["src"],Z={class:"small"},$={class:"text-muted"},ee={class:"text-muted"};function te(s,t,u,d,n,o){const _=y("Header");return a(),i(m,null,[w(_),e("div",k,[t[12]||(t[12]=e("h2",{class:"mb-4 fw-bold"},"My Orders",-1)),e("div",x,[e("a",{class:g(["order-stage",{active:!n.currentFilter}]),href:"#",onClick:t[0]||(t[0]=h(r=>o.filterOrders(null),["prevent"]))},[t[5]||(t[5]=e("h3",null,"In Progress",-1)),e("h3",F,l(o.allOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:n.currentFilter==="pending"}]),href:"#",onClick:t[1]||(t[1]=h(r=>o.filterOrders("pending"),["prevent"]))},[t[6]||(t[6]=e("h3",null,"In Progress",-1)),e("h3",D,l(o.pendingOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:n.currentFilter==="completed"}]),href:"#",onClick:t[2]||(t[2]=h(r=>o.filterOrders("completed"),["prevent"]))},[t[7]||(t[7]=e("h3",null,"Completed",-1)),e("h3",S,l(o.completedOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:n.currentFilter==="cancelled"}]),href:"#",onClick:t[3]||(t[3]=h(r=>o.filterOrders("cancelled"),["prevent"]))},[t[8]||(t[8]=e("h3",null,"Cancelled",-1)),e("h3",I,l(o.cancelledOrdersCount),1)],2)]),n.loading?(a(),i("div",P,t[9]||(t[9]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):o.filteredOrders.length>0?(a(),i("div",z,[(a(!0),i(m,null,f(o.filteredOrders,r=>(a(),i("div",{key:r.id,class:"col-12 col-md-6"},[e("div",B,[e("div",V,[e("div",null,[t[10]||(t[10]=e("small",{class:"text-muted"},"Order ID",-1)),e("h5",j,"#"+l(r.id),1)]),e("div",U,[e("small",E,l(o.formatDate(r.ordered_at)),1),t[11]||(t[11]=e("br",null,null,-1)),e("span",{class:g(["badge",o.getStatusBadgeClass(r.status)])},l(o.formatStatus(r.status)),3)])]),e("div",H,[(a(!0),i(m,null,f(r.items,c=>(a(),i("div",{key:c.id,class:"d-flex flex-column align-items-start col-4"},[e("img",{src:o.imageUrl(c.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,L),e("strong",M,l(c.product.name_en),1),e("small",N,l(c.price)+" EGP x"+l(c.quantity),1),e("small",G,"Size: "+l(c.size||"-"),1)]))),128))]),e("div",q,[e("strong",null,"Total: "+l(r.total_price)+" EGP ("+l(r.items.length)+" Items)",1),e("button",{class:"btn btn-outline-dark btn-sm",onClick:c=>o.showOrderDetails(r.id)},"Details",8,A)])])]))),128))])):(a(),i("div",T," No orders found. "))]),n.isDialogVisible?(a(),i("div",J,[e("div",K,[e("button",{type:"button",class:"btn-close position-absolute top-0 end-0 m-3",onClick:t[4]||(t[4]=r=>n.isDialogVisible=!1),"aria-label":"Close"}),e("h4",Q,l(s.$t("order.orderDetails")),1),n.loading?(a(),i("div",R,t[13]||(t[13]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):(a(),i("div",W,[e("div",X,[(a(!0),i(m,null,f(n.selectedOrder.items,r=>(a(),i("div",{key:r.id,class:"d-flex flex-column align-items-start col-4"},[e("img",{src:o.imageUrl(r.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,Y),e("strong",Z,l(r.product.name_en),1),e("small",$,l(r.price)+" EGP x"+l(r.quantity),1),e("small",ee,"Size: "+l(r.size||"-"),1)]))),128))])]))])])):C("",!0)],64)}const re=b(O,[["render",te],["__scopeId","data-v-2ff41566"]]);export{re as default};

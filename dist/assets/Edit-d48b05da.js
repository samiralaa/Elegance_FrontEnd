import{_ as Q,C as X,M as Y,x as _,L as Z,D as x,r as c,o as u,c as f,e as l,m as r,b as p,W as V,a as m,t as g,F as y,d as P,i as k,f as ee,l as ae}from"./index-c31d5995.js";const te={class:"product-edit-container"},le={class:"currency-option"},oe={class:"currency-name"},re={class:"currency-rate"},ne={key:0,class:"existing-images"},se={class:"image-list"},ue=["src"],de={class:"el-upload__text"},v="https://backend.webenia.org",ie={__name:"Edit",setup(ce){const A=X(),E=Y(),C=_(null),o=_({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_id:null,currency_id:null,country_id:null,parent_id:null}),D={name_en:[{required:!0,message:"Please input product name (EN)",trigger:"blur"}],price:[{required:!0,message:"Please input product price",trigger:"blur"}],category_id:[{required:!0,message:"Please select a category",trigger:"change"}],currency_id:[{required:!0,message:"Please select a currency",trigger:"change"}],country_id:[{required:!0,message:"Please select a country",trigger:"change"}]},b=_([]),S=_([]),I=_([]),R=_([]),U=_([]),h=_([]),w=`${v}/api/products`,F=`${v}/api/categories`,N=`${v}/api/currencies`,B=`${v}/api/countries`,O=Z(()=>I.value.filter(e=>!e.is_deleted)),T=e=>(localStorage.getItem("lang")||"en")==="ar"?e.name_ar:e.name_en,L=()=>{b.value=h.value.map(e=>({name:e.path.split("/").pop(),url:`${v}/storage/${e.path}`,status:"success",isExisting:!0,id:e.id}))},q=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(F);t.data.status&&t.data.data&&(S.value=t.data.data);const s=await p.get(N);s.data.status&&s.data.currencies&&(I.value=s.data.currencies);const n=await p.get(B);n.data.status&&n.data.data&&(R.value=n.data.data);const i=await p.get(w);i.data.status&&i.data.data&&(U.value=i.data.data)}catch(e){V.error(e.message||"Failed to fetch select options")}},z=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const{id:t}=E.params,s=await p.get(`${w}/${t}`);if(s.data.status)Object.assign(o.value,s.data.data),h.value=s.data.data.images||[],L();else throw new Error(s.data.message||"Failed to fetch product")}catch(e){V.error(e.message||"Failed to fetch product")}},J=(e,t)=>{b.value=t},M=(e,t)=>{b.value=t},j=async()=>{C.value.validate(async e=>{if(e)try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${t.token}`;const{id:s}=E.params,n=new FormData;for(const d in o.value)n.append(d,o.value[d]);b.value.forEach(d=>{n.append("images[]",d.raw)});const i=await p.post(`${w}/${s}?_method=PUT`,n,{headers:{"Content-Type":"multipart/form-data"}});if(i.data.status)V.success(i.data.message||"Product updated successfully"),A.push("/products");else throw new Error(i.data.message||"Failed to update product")}catch(t){V.error(t.message||"Failed to update product")}})};return x(()=>{q(),z()}),(e,t)=>{const s=c("el-input"),n=c("el-form-item"),i=c("el-switch"),d=c("el-option"),$=c("el-select"),G=c("el-upload"),W=c("el-button"),H=c("el-form"),K=c("el-card");return u(),f("div",te,[l(K,{class:"product-card"},{default:r(()=>[m("h2",null,g(e.$t("Products.EditProduct")),1),l(H,{model:o.value,ref_key:"formRef",ref:C,rules:D,"label-width":"120px",enctype:"multipart/form-data"},{default:r(()=>[l(n,{label:e.$t("Products.NameEn"),prop:"name_en"},{default:r(()=>[l(s,{modelValue:o.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.name_en=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.NameAr"),prop:"name_ar"},{default:r(()=>[l(s,{modelValue:o.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.name_ar=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Price"),prop:"price"},{default:r(()=>[l(s,{modelValue:o.value.price,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.price=a),type:"number"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Availability"),prop:"is_available"},{default:r(()=>[l(i,{modelValue:o.value.is_available,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.is_available=a),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.DescriptionEn"),prop:"description_en"},{default:r(()=>[l(s,{type:"textarea",modelValue:o.value.description_en,"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.description_en=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.DescriptionAr"),prop:"description_ar"},{default:r(()=>[l(s,{type:"textarea",modelValue:o.value.description_ar,"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.description_ar=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Category"),prop:"category_id"},{default:r(()=>[l($,{modelValue:o.value.category_id,"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.category_id=a),placeholder:e.$t("Products.SelectCategory"),filterable:"",clearable:""},{default:r(()=>[(u(!0),f(y,null,P(S.value,a=>(u(),k(d,{key:a.id,label:a.name_en||a.name_ar,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Currency"),prop:"currency_id"},{default:r(()=>[l($,{modelValue:o.value.currency_id,"onUpdate:modelValue":t[7]||(t[7]=a=>o.value.currency_id=a),placeholder:e.$t("Products.SelectCurrency"),filterable:"",clearable:""},{default:r(()=>[(u(!0),f(y,null,P(O.value,a=>(u(),k(d,{key:a.id,label:T(a),value:a.id},{default:r(()=>[m("div",le,[m("span",oe,g(a.name_en),1),m("span",re,"("+g(parseFloat(a.exchange_rate).toFixed(2))+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Country"),prop:"country_id"},{default:r(()=>[l($,{modelValue:o.value.country_id,"onUpdate:modelValue":t[8]||(t[8]=a=>o.value.country_id=a),placeholder:e.$t("Products.SelectCountry"),filterable:"",clearable:""},{default:r(()=>[(u(!0),f(y,null,P(R.value,a=>(u(),k(d,{key:a.id,label:a.name_en||a.name_ar,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.ParentProduct"),prop:"parent_id"},{default:r(()=>[l($,{modelValue:o.value.parent_id,"onUpdate:modelValue":t[9]||(t[9]=a=>o.value.parent_id=a),placeholder:e.$t("Products.SelectParentProduct"),clearable:""},{default:r(()=>[l(d,{label:e.$t("Products.None"),value:null},null,8,["label"]),(u(!0),f(y,null,P(U.value,a=>(u(),k(d,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),h.value.length?(u(),f("div",ne,[m("h4",null,g(e.$t("Products.ExistingImages")),1),m("div",se,[(u(!0),f(y,null,P(h.value,(a,pe)=>(u(),f("div",{key:a.id,class:"image-item"},[m("img",{src:`${v}/public/storage/${a.path}`,alt:"Product Image"},null,8,ue)]))),128))])])):ee("",!0),l(n,{label:e.$t("Products.Images"),prop:"images"},{default:r(()=>[l(G,{class:"upload-demo",drag:"",action:"","list-type":"picture","auto-upload":!1,"file-list":b.value,"on-change":J,"on-remove":M,"before-remove":e.beforeRemove},{default:r(()=>[t[10]||(t[10]=m("i",{class:"el-icon-upload"},null,-1)),m("div",de,g(e.$t("Products.DropFiles")),1)]),_:1,__:[10]},8,["file-list","before-remove"])]),_:1},8,["label"]),l(n,null,{default:r(()=>[l(W,{type:"primary",onClick:j},{default:r(()=>[ae(g(e.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},_e=Q(ie,[["__scopeId","data-v-3c79beb5"]]);export{_e as default};

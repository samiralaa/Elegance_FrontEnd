import{_ as j,B as K,K as k,x as u,y as G,C as Q,N as I,r as V,o as l,c as d,e as m,a as s,t as r,g as W,D as C,F as w,d as E,w as F,v as N,f as g,b as P,H as X,k as Y,ae as Z,p as T,n as ee,E as _}from"./index-8fc7e8a4.js";const te={class:"axil-breadcrumb-area mt-5"},se={class:"container"},ae={class:"row align-items-center"},oe={class:"col-lg-6 col-md-8"},ie={class:"inner"},re={class:"title"},ne=["dir"],ce={class:"container"},le={class:"filter col-12"},de={class:"sidebar"},ue={class:"sidebar-container"},ve={class:"sidebar-title"},_e={class:"checkbox-container"},me=["value"],ge={class:"sidebar-title"},he={class:"price-range"},pe=["min","max"],fe=["min","max"],be={class:"price-values"},ye={class:"products-grid"},xe={class:"image-container mb-3 bg-light rounded"},ke=["src","alt"],Ce={key:0,class:"sale-badge"},we={class:"product-actions d-flex justify-content-center gap-5 w-100"},Fe=["onClick","title"],Pe={class:"card-body"},Se={class:"card-title"},Le={class:"price-container"},$e={key:0,class:"price-old"},De={key:1,class:"discount-badge"},Ie={class:"card-text card-price"},Ve={class:"addToCart-btn"},Ee=["disabled","onClick"],Ne={__name:"ProductListing",setup(Te){const{locale:S,t:c}=K(),A=k(()=>S.value==="ar"?"rtl":"ltr"),L=u([]),$=u([]);u(!1),u("");const h=u([]),o=u({min:0,max:2e3}),v={min:0,max:2e3},p=u(!1),f=G(),B=k(()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"}),y=()=>{p.value=!p.value;const e=document.querySelector(".sidebar"),a=document.body;e&&(e.classList.toggle("active",p.value),e.classList.contains("active")?a.classList.add("no-scroll"):a.classList.remove("no-scroll"))},M=e=>`http://elegance_backend.test/public/storage/${e}`,b=e=>f.favorites.some(a=>a.product_id===e),U=e=>{const a=f.favorites.find(n=>n.product_id===e);return a?a.favorite_id||a.id:null},q=async e=>{var a,n;try{if(b(e.id)){const i=U(e.id);i&&(await f.removeFromFavorites(i),_({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const i=await f.addToFavorites(e.id);_({title:c("success"),message:i.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(i){console.error("Favorite error:",i),_({title:c("error"),message:((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},O=async()=>{try{const e=await P.get("http://elegance_backend.test/api/website");L.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},D=async()=>{try{const e=await P.get("http://elegance_backend.test/api/all/products");$.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},R=async e=>{var a,n;try{const i=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},t=await P.post("http://elegance_backend.test/api/cart-items",{product_id:e.id,quantity:1,price:parseFloat(e.price)},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:i.code}});t.data.status?_({title:c("success"),message:t.data.message,type:"success"}):_({title:c("error"),message:t.data.message,type:"error"})}catch(i){console.error("Error adding to cart:",i),_({title:c("error"),message:(n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message,type:"error"})}};Q(()=>{O(),D(),window.addEventListener("currency-changed",()=>{D()})});const z=k(()=>$.value.filter(e=>{const a=h.value.length===0||h.value.includes(e.category_id),i=o.value.min===v.min&&o.value.max===v.max?!0:e.price>=o.value.min&&e.price<=o.value.max;return a&&i})),H=e=>{if(e.discount&&e.discount.is_active){const a=parseFloat(e.discount.discount_value),n=parseFloat(e.converted_price||e.price);return(n-n*(a/100)).toFixed(2)}return e.converted_price||e.price},J=e=>e.discount&&e.discount.is_active?Math.round(parseFloat(e.discount.discount_value)):0;return I(()=>o.value.min,e=>{e>o.value.max&&(o.value.min=o.value.max)}),I(()=>o.value.max,e=>{e<o.value.min&&(o.value.max=o.value.min)}),(e,a)=>{const n=V("router-link"),i=V("fa");return l(),d(w,null,[m(X),s("div",te,[s("div",se,[s("div",ae,[s("div",oe,[s("div",ie,[s("h1",re,r(e.$t("products.title")),1)])])])])]),s("div",{class:"shop-container",dir:A.value},[s("div",ce,[s("div",le,[s("a",{href:"#",onClick:W(y,["prevent"])},r(e.$t("products.filter")),1)]),s("aside",de,[s("div",ue,[s("button",{class:"close-btn",onClick:y},"Ã—"),s("h3",ve,r(C(c)("products.categories")),1),a[4]||(a[4]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(l(!0),d(w,null,E(L.value,t=>(l(),d("div",{key:t.id,class:"filter-item"},[s("label",_e,[Y(r(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),F(s("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=x=>h.value=x),value:t.id},null,8,me),[[Z,h.value]]),a[3]||(a[3]=s("span",{class:"checkmark"},null,-1))])]))),128)),s("h3",ge,r(C(c)("products.price")),1),a[5]||(a[5]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),s("div",he,[F(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=t=>o.value.min=t),min:v.min,max:v.max},null,8,pe),[[N,o.value.min,void 0,{number:!0}]]),F(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=t=>o.value.max=t),min:v.min,max:v.max},null,8,fe),[[N,o.value.max,void 0,{number:!0}]]),s("div",be,[s("span",null,r(o.value.min)+" - "+r(o.value.max)+" "+r(B.value),1)])])])]),p.value?(l(),d("div",{key:0,class:"overlay",onClick:y})):g("",!0),s("section",ye,[(l(!0),d(w,null,E(z.value,t=>(l(),d("div",{key:t.id,class:"product-card"},[s("div",xe,[m(n,{to:`/read/products/${t.id}`},{default:T(()=>[t.images&&t.images.length?(l(),d("img",{key:0,src:M(t.images[0].path),alt:t.name},null,8,ke)):g("",!0)]),_:2},1032,["to"]),t.is_available?g("",!0):(l(),d("div",Ce,r(e.$t("products.outOfStock")),1)),s("div",we,[m(n,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:T(()=>[m(i,{icon:"eye"})]),_:2},1032,["to"]),s("button",{onClick:x=>q(t),class:ee(["btn rounded-circle shadow-sm btn-light",b(t.id)?"text-danger":""]),title:b(t.id)?"Remove from favorites":"Add to favorites"},[m(i,{icon:b(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,Fe)])]),s("div",Pe,[s("h5",Se,r(C(S)==="ar"?t.name_ar:t.name_en),1),s("div",Le,[t.discount&&t.discount.is_active?(l(),d("span",$e,r(t.converted_price)+" "+r(t.currency_code),1)):g("",!0),t.discount&&t.discount.is_active?(l(),d("span",De,r(J(t))+"% OFF ",1)):g("",!0),s("span",Ie,r(H(t))+" "+r(t.currency_code),1)])]),s("div",Ve,[s("button",{disabled:!t.is_available,onClick:x=>R(t),class:"btn"},r(e.$t("products.addToCart")),9,Ee)])]))),128))])])],8,ne)],64)}}},Be=j(Ne,[["__scopeId","data-v-88d67106"]]);export{Be as default};

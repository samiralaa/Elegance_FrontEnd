import{_ as te,B as se,L as N,x as _,y as ae,z as oe,D as ie,N as q,r as z,o as u,c as m,e as f,a,t as d,g as ne,n as B,E as F,F as P,d as M,w as h,v as k,l as K,f as y,b as S,H as re,af as ce,m as O,k as le,G as v}from"./index-01aaf835.js";const de={class:"axil-breadcrumb-area mt-5"},ue={class:"container"},me={class:"row align-items-center"},ve={class:"col-lg-6 col-md-8"},_e={class:"inner"},ge={class:"title"},pe=["dir"],fe={class:"container"},he={class:"filter col-12"},ye={class:"sidebar-container"},be={class:"sidebar-title"},xe={class:"checkbox-container"},ke=["value"],Ce={class:"sidebar-title"},we={class:"price-range"},Fe=["min","max"],Pe=["min","max"],Se={class:"price-values mt-2"},Le={class:"d-flex gap-2 align-items-center"},Ve=["min","max"],De=["min","max"],$e={class:"products-grid"},Ee={class:"image-container mb-3 bg-light rounded"},Ie=["src","alt"],Ue={key:0,class:"sale-badge"},Te={class:"product-actions d-flex justify-content-center gap-5 w-100"},Ae=["onClick","title"],Ne={class:"card-body"},qe={class:"card-title"},ze={class:"price-container"},Be={key:0,class:"discount-badge"},Me={key:1,class:"price-old"},Ke={class:"card-text card-price"},Oe=["disabled","onClick"],Re={__name:"ProductListing",setup(He){const{locale:L,t:c}=se(),R=N(()=>L.value==="ar"?"rtl":"ltr"),V=_([]),D=_([]);_(!1),_("");const p=_([]),o=_({min:0,max:2e3}),r={min:0,max:2e3},g=_(!1),b=ae(),$=oe(),E=()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"},H=(e,s,i)=>{const l={AED:1,USD:.2724795640326976};return s===i?parseFloat(e):l[i]?parseFloat((e*l[i]).toFixed(2)):parseFloat(e)},C=()=>{g.value=!g.value;const e=document.querySelector(".sidebar"),s=document.body;e&&(g.value?(e.classList.add("active"),s.classList.add("no-scroll")):(e.classList.remove("active"),s.classList.remove("no-scroll")))},j=e=>`https://backend.webenia.org/public/storage/${e}`,x=e=>b.favorites.some(s=>s.product_id===e),G=e=>{const s=b.favorites.find(i=>i.product_id===e);return s?s.favorite_id||s.id:null},J=async e=>{var s,i,l,t;try{if(x(e.id)){const n=G(e.id);n&&(await b.removeFromFavorites(n),v({title:c("success"),message:c("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await b.addToFavorites(e.id);v({title:c("success"),message:n.message||c("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){if(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)==="Unauthenticated."){v({title:c("error"),message:c("unauthenticated"),type:"warning",duration:4e3});return}v({title:c("error"),message:((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||c("login_required_favorite")||"Login required to favorite product",type:"error"})}},Q=async()=>{try{const e=await S.get("https://backend.webenia.org/api/categories/website/homepage");V.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},I=async()=>{try{const e=await S.get("https://backend.webenia.org/api/all/products");D.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},W=async e=>{var s,i,l,t;try{let n=0;if(e.discount&&e.discount.is_active){const ee=parseFloat(e.discount.discount_value),A=parseFloat(e.price);n=A-A*(ee/100)}else n=parseFloat(e.price);const w=await S.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:n},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});w.data.status?(v({title:c("success"),message:w.data.message,type:"success"}),$.incrementCount(),await $.fetchCartCount()):v({title:c("error"),message:w.data.message,type:"error"})}catch(n){if(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)==="Unauthenticated."){v({title:c("error"),message:c("unauthenticated"),type:"warning",duration:4e3});return}v({title:c("error"),message:(t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message,type:"error"})}};ie(()=>{Q(),I(),window.addEventListener("currency-changed",()=>{I(),Y()})});const X=N(()=>D.value.filter(e=>{const s=p.value.length===0||p.value.includes(e.category_id),i=o.value.min===r.min&&o.value.max===r.max,l=H(U(e),e.currency_code||"AED",E.value),t=i?!0:l>=o.value.min&&l<=o.value.max;return s&&t})),Y=()=>{p.value=[],o.value.min=r.min,o.value.max=r.max,g.value=!1,document.body.classList.remove("no-scroll")},U=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(s/100)).toFixed(2)}return e.converted_price||e.price},Z=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value);return Math.round(s)}return 0},T=e=>{["e","E","+","-","."].includes(e.key)&&e.preventDefault()};return q(()=>o.value.min,e=>{e>o.value.max&&(o.value.min=o.value.max),e<r.min&&(o.value.min=r.min)}),q(()=>o.value.max,e=>{e<o.value.min&&(o.value.max=o.value.min),e>r.max&&(o.value.max=r.max)}),(e,s)=>{const i=z("router-link"),l=z("fa");return u(),m(P,null,[f(re),a("div",de,[a("div",ue,[a("div",me,[a("div",ve,[a("div",_e,[a("h1",ge,d(e.$t("products.title")),1)])])])])]),a("div",{class:"shop-container",dir:R.value},[a("div",fe,[a("div",he,[a("a",{href:"#",onClick:ne(C,["prevent"])},d(e.$t("products.filter")),1)]),a("aside",{class:B(["sidebar",{active:g.value}])},[a("div",ye,[a("button",{class:"close-btn",onClick:C},"Ã—"),a("h3",be,d(F(c)("products.categories")),1),s[7]||(s[7]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(u(!0),m(P,null,M(V.value,t=>(u(),m("div",{key:t.id,class:"filter-item"},[a("label",xe,[K(d(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),h(a("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=n=>p.value=n),value:t.id},null,8,ke),[[ce,p.value]]),s[5]||(s[5]=a("span",{class:"checkmark"},null,-1))])]))),128)),a("h3",Ce,d(F(c)("products.price")),1),s[8]||(s[8]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),a("div",we,[h(a("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=t=>o.value.min=t),step:10,min:r.min,max:r.max},null,8,Fe),[[k,o.value.min,void 0,{number:!0}]]),h(a("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=t=>o.value.max=t),step:10,min:r.min,max:r.max},null,8,Pe),[[k,o.value.max,void 0,{number:!0}]]),a("div",Se,[a("div",Le,[h(a("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>o.value.min=t),step:10,min:r.min,max:r.max,onKeydown:T,class:"form-control qty-number"},null,40,Ve),[[k,o.value.min,void 0,{number:!0,lazy:!0}]]),s[6]||(s[6]=a("span",null,"-",-1)),h(a("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=t=>o.value.max=t),step:10,min:r.min,max:r.max,onKeydown:T,class:"form-control qty-number"},null,40,De),[[k,o.value.max,void 0,{number:!0,lazy:!0}]]),K(" "+d(E()),1)])])])])],2),g.value?(u(),m("div",{key:0,class:"overlay",onClick:C})):y("",!0),a("section",$e,[(u(!0),m(P,null,M(X.value,t=>(u(),m("div",{key:t.id,class:"product-card"},[a("div",Ee,[f(i,{to:`/read/products/${t.id}`},{default:O(()=>[t.images&&t.images.length?(u(),m("img",{key:0,src:j(t.images[0].path),alt:t.name},null,8,Ie)):y("",!0)]),_:2},1032,["to"]),t.is_available?y("",!0):(u(),m("div",Ue,d(e.$t("products.outOfStock")),1)),a("div",Te,[f(i,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:O(()=>[f(l,{icon:"eye"})]),_:2},1032,["to"]),a("button",{onClick:n=>J(t),class:B(["btn rounded-circle shadow-sm btn-light",x(t.id)?"text-danger":""]),title:x(t.id)?"Remove from favorites":"Add to favorites"},[f(l,{icon:x(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,Ae)])]),a("div",Ne,[a("h5",qe,d(F(L)==="ar"?t.name_ar:t.name_en),1),a("div",ze,[t.discount&&t.discount.is_active?(u(),m("span",Be,d(Z(t))+"% OFF ",1)):y("",!0),t.discount&&t.discount.is_active?(u(),m("span",Me,d(t.converted_price)+" "+d(t.currency_code),1)):y("",!0),a("span",Ke,d(U(t))+" "+d(t.currency_code),1)])]),a("div",{class:"addToCart-btn",style:le(t.is_available?"":"cursor: not-allowed;")},[a("button",{disabled:!t.is_available,onClick:n=>W(t),class:"btn"},d(e.$t("products.addToCart")),9,Oe)],4)]))),128))])])],8,pe)],64)}}},Ge=te(Re,[["__scopeId","data-v-2f9dd4de"]]);export{Ge as default};

import{_ as Y,y as p,L as z,E as Z,r as d,a5 as x,o as c,c as f,a as o,t as r,e as a,p as n,w as ee,k as g,f as V,b as w,V as b,G as y,a9 as te,F as B,d as N,m as _,aa as le,ab as re,$ as ae}from"./index-e6d81d92.js";const oe={class:"orders-page"},ne={class:"orders-header"},se={class:"orders-filters"},de={id:"invoice-print",style:{display:"none"}},ue={style:{width:"100%","border-collapse":"collapse"},border:"1"},$=5,ie={__name:"Orders",setup(ce){const k=p([]),v=p(""),m=p(""),S=p(1),C=p(!1),s=p(null),D=p(!1),q=["pending","processing","cancelled"],I=async()=>{D.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");w.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await w.get("https://backend.webenia.org/api/orders");if(t.data.status===!0)k.value=t.data.data,console.log("Orders loaded:",k.value);else throw new Error(t.data.message||"Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e),b.error(e.message||"Failed to fetch orders")}finally{D.value=!1}},O=z(()=>k.value.filter(e=>{const t=v.value===""||e.id.toString().includes(v.value.toLowerCase())||e.total_price.includes(v.value.toLowerCase()),u=!m.value||e.status===m.value;return t&&u})),A=z(()=>{const e=(S.value-1)*$,t=e+$;return O.value.slice(e,t)}),T=e=>{S.value=e},M=e=>{s.value=e,C.value=!0},P=()=>{const e=document.getElementById("invoice-print").cloneNode(!0);e.style.display="block";const t=window.open("","","width=800,height=600");t.document.write("<html><head><title>Invoice</title>"),t.document.write("<style>body{font-family:sans-serif;} table{margin-top:16px;} th,td{padding:8px;}</style>"),t.document.write("</head><body>"),t.document.write(e.innerHTML),t.document.write("</body></html>"),t.document.close(),t.focus(),t.print(),t.close()},E=e=>{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},U=e=>({pending:"info",processing:"warning",cancelled:"danger"})[e.toLowerCase()]||"info",J=async e=>{try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");w.defaults.headers.common.Authorization=`Bearer ${t.token}`;const u=await w.post(`https://backend.webenia.org/api/orders/${e.id}/cancel`);if(u.data.status===!0)b.success("Order cancelled successfully"),await I();else throw new Error(u.data.message||"Failed to cancel order")}catch(t){console.error("Error cancelling order:",t),b.error(t.message||"Failed to cancel order")}},G=e=>{b.info("Reordered items from order #"+e.id)};return Z(()=>{I()}),(e,t)=>{const u=d("el-icon"),H=d("el-input"),Q=d("el-option"),R=d("el-select"),i=d("el-table-column"),W=d("el-tag"),h=d("el-button"),F=d("el-table"),j=d("el-pagination"),K=d("el-dialog"),X=x("loading");return c(),f("div",oe,[o("div",ne,[o("h2",null,r(e.$t("orders.myOrders")),1),a(H,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=l=>v.value=l),placeholder:e.$t("orders.Search-orders"),class:"search-input",clearable:""},{prefix:n(()=>[a(u,null,{default:n(()=>[a(y(te))]),_:1})]),_:1},8,["modelValue","placeholder"])]),o("div",se,[a(R,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l),placeholder:e.$t("orders.Filter-by-Status"),clearable:""},{default:n(()=>[(c(),f(B,null,N(q,l=>a(Q,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),ee((c(),g(F,{data:A.value,style:{width:"100%"},class:"orders-table",stripe:"",border:""},{default:n(()=>[a(i,{prop:"id",label:e.$t("orders.orderId"),width:"120"},null,8,["label"]),a(i,{prop:"ordered_at",label:e.$t("orders.orderDate"),width:"180"},{default:n(l=>[_(r(E(l.row.ordered_at)),1)]),_:1},8,["label"]),a(i,{label:e.$t("orders.total"),width:"150"},{default:n(l=>[_(r(l.row.currency)+" "+r(l.row.total_price),1)]),_:1},8,["label"]),a(i,{prop:"status",label:e.$t("orders.status"),width:"150"},{default:n(l=>[a(W,{type:U(l.row.status)},{default:n(()=>[_(r(l.row.status),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(i,{label:e.$t("orders.actions"),width:"220"},{default:n(l=>[a(h,{size:"small",type:"primary",onClick:L=>M(l.row),circle:""},{default:n(()=>[a(u,null,{default:n(()=>[a(y(le))]),_:1})]),_:2},1032,["onClick"]),a(h,{size:"small",type:"danger",disabled:l.row.status!=="pending"&&l.row.status!=="processing",onClick:L=>J(l.row),circle:""},{default:n(()=>[a(u,null,{default:n(()=>[a(y(re))]),_:1})]),_:2},1032,["disabled","onClick"]),a(h,{size:"small",type:"success",onClick:L=>G(l.row),circle:""},{default:n(()=>[a(u,null,{default:n(()=>[a(y(ae))]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[X,D.value]]),O.value.length>$?(c(),g(j,{key:0,class:"pagination",layout:"prev, pager, next","current-page":S.value,"page-size":$,total:O.value.length,onCurrentChange:T},null,8,["current-page","total"])):V("",!0),a(K,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=l=>C.value=l),title:e.$t("orders.orderDetails"),width:"600px"},{footer:n(()=>[s.value?(c(),g(h,{key:0,type:"primary",onClick:P},{default:n(()=>[_(r(e.$t("orders.printInvoice")||"Print Invoice"),1)]),_:1})):V("",!0)]),default:n(()=>[s.value?(c(),g(F,{key:0,data:s.value.items,border:"",stripe:"",style:{width:"100%"}},{default:n(()=>[a(i,{prop:"product_id",label:e.$t("orders.orderId")},null,8,["label"]),a(i,{prop:"quantity",label:e.$t("orders.quantity")},null,8,["label"]),a(i,{prop:"price",label:e.$t("orders.price")},{default:n(l=>[_(r(l.row.price)+" "+r(s.value.currency)+" Ã— "+r(l.row.quantity),1)]),_:1},8,["label"]),a(i,{prop:"subtotal",label:e.$t("orders.Subtotal")},{default:n(l=>[_(r(l.row.subtotal),1)]),_:1},8,["label"])]),_:1},8,["data"])):V("",!0),o("div",de,[o("h2",null,r(e.$t("orders.invoice")||"Invoice"),1),o("p",null,r(e.$t("orders.orderId"))+": "+r(s.value.id),1),o("p",null,r(e.$t("orders.orderDate"))+": "+r(E(s.value.ordered_at)),1),o("p",null,r(e.$t("orders.status"))+": "+r(s.value.status),1),o("p",null,r(e.$t("orders.total"))+": "+r(s.value.currency)+" "+r(s.value.total_price),1),o("table",ue,[o("thead",null,[o("tr",null,[o("th",null,r(e.$t("orders.orderId")),1),o("th",null,r(e.$t("orders.quantity")),1),o("th",null,r(e.$t("orders.price")),1),o("th",null,r(e.$t("orders.Subtotal")),1)])]),o("tbody",null,[(c(!0),f(B,null,N(s.value.items,l=>(c(),f("tr",{key:l.id},[o("td",null,r(l.product_id),1),o("td",null,r(l.quantity),1),o("td",null,r(l.price)+" "+r(s.value.currency),1),o("td",null,r(l.subtotal),1)]))),128))])])])]),_:1},8,["modelValue","title"])])}}},_e=Y(ie,[["__scopeId","data-v-ca609584"]]);export{_e as default};

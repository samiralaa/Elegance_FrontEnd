import{_ as de,M as se,C as ue,y as m,K as re,D as ie,r as s,a5 as ce,o as y,c as U,a as f,t as _,e as o,q as l,E as v,b as r,X as i,m as c,a2 as J,w as B,j as F,a6 as O,a8 as pe,a0 as me,a1 as _e,aa as ve,F as fe,d as ge,v as T,a4 as ye}from"./index-ae750e8a.js";const be={class:"products-container"},we={class:"header"},ke={class:"image-error"},he={key:1,class:"image-error"},$e={dir:"rtl"},Ve={class:"dialog-footer"},b="https://backend.webenia.org",De={__name:"index",setup(Pe){const A=se(),{t:w}=ue(),D=m([]),k=m(!1),N=`${b}/api/products`,L=async()=>{k.value=!0;try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");r.defaults.headers.common.Authorization=`Bearer ${t.token}`;const e=await r.get(N);if(e.data.status)D.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch products")}catch(t){console.error("Fetch products error:",t),i.error(t.message||"Failed to fetch products")}finally{k.value=!1}},R=()=>{A.push("/products/create")},W=t=>{A.push(`/products/${t}`)},j=t=>{A.push(`/products/${t.id}/edit`)},q=async t=>{try{if(await ye.confirm(w("Products.DeleteConfirmation"),w("Products.Warning"),{confirmButtonText:w("Products.Yes"),cancelButtonText:w("Products.No"),type:"warning"})==="confirm"){k.value=!0;const d=JSON.parse(localStorage.getItem("tokenData"));if(!d||!d.token)throw new Error("Authentication token not found");r.defaults.headers.common.Authorization=`Bearer ${d.token}`;const V=await r.delete(`${N}/${t.id}`);if(V.data.status)i.success(w("Products.DeletedSuccessfully")),D.value=D.value.filter(E=>E.id!==t.id);else throw new Error(V.data.message||"Failed to delete product")}}catch(e){e!=="cancel"&&(console.error("Delete product error:",e),i.error(e.message||"Failed to delete product"))}finally{k.value=!1}},h=m(!1),S=m(null),I=m([]),u=m({unit_id:"",weight:"",price:""}),K=async()=>{try{const t=JSON.parse(localStorage.getItem("tokenData"));r.defaults.headers.common.Authorization=`Bearer ${t.token}`;const e=await r.get(`${b}/api/units`);I.value=e.data.data}catch(t){console.error("Failed to fetch units:",t),i.error("Failed to load units")}},X=t=>{S.value=t,u.value={unit_id:"",weight:"",price:""},K(),h.value=!0},Y=async()=>{try{const t=JSON.parse(localStorage.getItem("tokenData"));r.defaults.headers.common.Authorization=`Bearer ${t.token}`;const e={product_id:S.value.id,unit_id:u.value.unit_id,weight:u.value.weight,price:u.value.price},d=await r.post(`${b}/api/amounts`,e);d.data.status?(i.success("Amount added successfully"),h.value=!1):i.error(d.data.message||"Failed to add amount")}catch(t){console.error(t),i.error("Error occurred while saving amount")}},$=m(!1),n=m({start_date:"",duration:"",discount_value:"",is_active:!1,product_id:"",category_id:"",end_date:""}),G=t=>{S.value=t,n.value={start_date:"",duration:"",discount_value:"",is_active:!1,product_id:t.id,category_id:t.category_id||"",end_date:""},$.value=!0},H=async()=>{try{const t=JSON.parse(localStorage.getItem("tokenData"));r.defaults.headers.common.Authorization=`Bearer ${t.token}`;const e={start_date:n.value.start_date,duration:n.value.duration,discount_value:n.value.discount_value,is_active:n.value.is_active,product_id:n.value.product_id,category_id:n.value.category_id,end_date:n.value.end_date},d=await r.post(`${b}/api/discounts`,e);d.data.status?(i.success("Discount added successfully"),$.value=!1):i.error(d.data.message||"Failed to add discount")}catch(t){console.error(t),i.error("Error occurred while saving discount")}},Q=re(()=>window.innerWidth<=768);return ie(()=>{L()}),(t,e)=>{const d=s("el-button"),V=s("el-icon"),E=s("el-image"),g=s("el-table-column"),Z=s("el-button-group"),ee=s("el-table"),te=s("el-card"),ae=s("el-option"),oe=s("el-select"),p=s("el-form-item"),P=s("el-input"),M=s("el-form"),x=s("el-dialog"),z=s("el-date-picker"),le=s("el-switch"),ne=ce("loading");return y(),U("div",be,[f("div",we,[f("h2",null,_(t.$t("Products.Products")),1),o(d,{type:"primary",icon:v(J),onClick:R},{default:l(()=>[c(_(t.$t("Products.AddProduct")),1)]),_:1},8,["icon"])]),o(te,{class:"products-table"},{default:l(()=>[B((y(),F(ee,{data:D.value,style:{width:"100%"}},{default:l(()=>[o(g,{label:t.$t("Products.Image"),width:"120"},{default:l(({row:a})=>[a.images&&a.images.length>0?(y(),F(E,{key:0,src:`${b}/${a.images[0].path}`,fit:"cover",class:"product-image","preview-src-list":[`${b}public/storage/${a.images[0].path}`],"initial-index":0,"preview-teleported":""},{error:l(()=>[f("div",ke,[o(V,null,{default:l(()=>[o(v(O))]),_:1})])]),_:2},1032,["src","preview-src-list"])):(y(),U("div",he,[o(V,null,{default:l(()=>[o(v(O))]),_:1})]))]),_:1},8,["label"]),o(g,{prop:"name_en",label:t.$t("Products.NameEn")},null,8,["label"]),o(g,{prop:"name_ar",label:t.$t("Products.NameAr")},{default:l(({row:a})=>[f("div",$e,_(a.name_ar||t.$t("Products.NA")),1)]),_:1},8,["label"]),o(g,{prop:"price",label:t.$t("Products.Price")},null,8,["label"]),o(g,{prop:"currency.name_en",label:t.$t("Products.Currency")},null,8,["label"]),o(g,{label:t.$t("Products.Actions"),width:"250"},{default:l(({row:a})=>[o(Z,null,{default:l(()=>[o(d,{type:"primary",icon:v(pe),onClick:C=>W(a.id)},{default:l(()=>[c(_(t.$t("Products.View")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"warning",icon:v(me),onClick:C=>j(a)},{default:l(()=>[c(_(t.$t("Products.Edit")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"danger",icon:v(_e),onClick:C=>q(a)},{default:l(()=>[c(_(t.$t("Products.Delete")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"success",icon:v(J),onClick:C=>X(a)},{default:l(()=>[c(_(t.$t("add.amount")),1)]),_:2},1032,["icon","onClick"]),o(d,{type:"info",icon:v(ve),onClick:C=>G(a)},{default:l(()=>[c(_(t.$t("Products.AddDiscount")),1)]),_:2},1032,["icon","onClick"])]),_:2},1024)]),_:1},8,["label"])]),_:1},8,["data"])),[[ne,k.value]])]),_:1}),o(x,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),title:"Add Product Amount",width:"500px"},{footer:l(()=>[o(d,{onClick:e[3]||(e[3]=a=>h.value=!1)},{default:l(()=>e[14]||(e[14]=[c("Cancel")])),_:1,__:[14]}),o(d,{type:"primary",onClick:Y},{default:l(()=>e[15]||(e[15]=[c("Submit")])),_:1,__:[15]})]),default:l(()=>[o(M,{model:u.value,"label-width":"100px"},{default:l(()=>[o(p,{label:"Unit"},{default:l(()=>[o(oe,{modelValue:u.value.unit_id,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.unit_id=a),placeholder:"Select Unit"},{default:l(()=>[(y(!0),U(fe,null,ge(I.value,a=>(y(),F(ae,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"Weight"},{default:l(()=>[o(P,{modelValue:u.value.weight,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.weight=a),type:"number",placeholder:"Enter weight"},null,8,["modelValue"])]),_:1}),o(p,{label:"Price"},{default:l(()=>[o(P,{modelValue:u.value.price,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.price=a),type:"number",placeholder:"Enter price"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(x,{modelValue:$.value,"onUpdate:modelValue":e[13]||(e[13]=a=>$.value=a),title:"Add Product Discount",width:Q.value?"90%":"500px",class:"discount-dialog"},{footer:l(()=>[f("div",Ve,[o(d,{onClick:e[12]||(e[12]=a=>$.value=!1)},{default:l(()=>e[16]||(e[16]=[c("Cancel")])),_:1,__:[16]}),o(d,{type:"primary",onClick:H},{default:l(()=>e[17]||(e[17]=[c("Submit")])),_:1,__:[17]})])]),default:l(()=>[o(M,{model:n.value,"label-width":"100px",class:"discount-form"},{default:l(()=>[o(p,{label:"Start Date"},{default:l(()=>[o(z,{modelValue:n.value.start_date,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.start_date=a),type:"date",placeholder:"Select start date",class:"w-100"},null,8,["modelValue"])]),_:1}),o(p,{label:"Duration (days)"},{default:l(()=>[o(P,{modelValue:n.value.duration,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.duration=a),type:"number",placeholder:"Enter duration in days",class:"w-100"},null,8,["modelValue"])]),_:1}),o(p,{label:"Discount Value (%)"},{default:l(()=>[o(P,{modelValue:n.value.discount_value,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.discount_value=a),type:"number",placeholder:"Enter discount percentage",class:"w-100"},null,8,["modelValue"])]),_:1}),o(p,{label:"Is Active"},{default:l(()=>[o(le,{modelValue:n.value.is_active,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.is_active=a)},null,8,["modelValue"])]),_:1}),B(f("input",{type:"hidden","onUpdate:modelValue":e[9]||(e[9]=a=>n.value.product_id=a)},null,512),[[T,n.value.product_id]]),B(f("input",{type:"hidden","onUpdate:modelValue":e[10]||(e[10]=a=>n.value.category_id=a)},null,512),[[T,n.value.category_id]]),o(p,{label:"End Date"},{default:l(()=>[o(z,{modelValue:n.value.end_date,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.end_date=a),type:"date",placeholder:"Select end date",class:"w-100"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","width"])])}}},Ae=de(De,[["__scopeId","data-v-60c4c52c"]]);export{Ae as default};

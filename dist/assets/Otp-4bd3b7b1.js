import{_ as y,b as f,r as b,o as m,c as g,a as i,k,t as u,w as _,F as M,d as O,l as w,f as I,e as S,m as T,g as $,i as V}from"./index-710d3685.js";const v="https://backend.webenia.org/api",N={data(){return{otp:Array(4).fill(""),user:null,token:null,timer:"03:00",countdown:null,otpMessage:""}},computed:{otpMessageColor(){return this.otpMessage==="Invalid OTP"||this.otpMessage==="Resend Invalid"?"red":this.otpMessage==="OTP resent successfully"?"green":"#333"},isOtpComplete(){return this.otp.every(e=>/^\d$/.test(e))}},created(){const e=localStorage.getItem("user"),t=localStorage.getItem("auth_token");if(!e||!t){this.$router.push("/register");return}this.user=JSON.parse(e),this.token=t,this.startTimer()},methods:{focusNext(e){e<4&&this.otp[e-1]&&this.$el.querySelectorAll(".otp-input")[e].focus()},handleInput(e,t){const a=e.target.value;/^\d$/.test(a)?(this.otp[t-1]=a,t<4&&this.focusNext(t)):this.otp[t-1]=""},handleKeyDown(e,t){e.key==="Backspace"&&!this.otp[t-1]&&t>1&&this.$el.querySelectorAll(".otp-input")[t-2].focus()},async handleOtpVerification(){var a,d,n,r,p,o,s,l;const e=this.otp.join(""),t=this.otp.every(c=>/^\d$/.test(c));if(e.length!==4||!t){(n=(a=this.$toast)==null?void 0:a.error)==null||n.call(a,((d=this.$t)==null?void 0:d.call(this,"otp.invalidLength"))||"Please enter a valid 4-digit code");return}try{const c=await f.post(`${v}/client/verify-otp`,{otp:e,email:this.user.email},{headers:{Authorization:`Bearer ${this.token}`}});if(c.data.status===!0){const h={...this.user,...c.data.data.user};localStorage.setItem("user",JSON.stringify(h)),localStorage.setItem("auth_token",c.data.data.token),this.otpMessage="",this.$router.push("/")}}catch(c){console.error("OTP verification error:",c);const h=((p=(r=c.response)==null?void 0:r.data)==null?void 0:p.message)||((o=this.$t)==null?void 0:o.call(this,"otp.error"))||"OTP verification failed";this.otpMessage=h,(l=(s=this.$toast)==null?void 0:s.error)==null||l.call(s,h)}},startTimer(){let e=3,t=0;this.countdown=setInterval(()=>{if(t===0){if(e===0){clearInterval(this.countdown);return}e--,t=59}else t--;this.timer=`${String(e).padStart(3,"0")}:${String(t).padStart(3,"0")}`},1e3)},async resendOtp(){var e,t,a,d,n,r,p,o;try{const s=await f.post(`${v}/resend-otp`,{email:this.user.email});if(s.data.status===!0){const l=s.data.message||"OTP resent successfully.";this.otpMessage=l,(t=(e=this.$toast)==null?void 0:e.info)==null||t.call(e,l)}else{const l=s.data.message||"Resend Invalid";this.otpMessage=l,(d=(a=this.$toast)==null?void 0:a.error)==null||d.call(a,l)}this.startTimer()}catch(s){const l=((r=(n=s.response)==null?void 0:n.data)==null?void 0:r.message)||"Resend Invalid";this.otpMessage=l,(o=(p=this.$toast)==null?void 0:p.error)==null||o.call(p,l)}}}},C={class:"otp-wrapper"},P={class:"otp-container"},D={class:"otp-message"},A={class:"otp-input-group"},B=["onUpdate:modelValue","onInput","onKeydown"],K=["disabled"],L={class:"resend d-flex w-100 justify-content-between align-items-center mt-3"},R={class:"time-left"},U=["disabled"];function j(e,t,a,d,n,r){const p=b("fa");return m(),g("div",C,[i("div",P,[t[2]||(t[2]=i("img",{src:k,alt:"Logo",height:"100"},null,-1)),i("p",D,u(e.$t("otp.message")),1),i("span",null,u(n.user.email),1),i("form",{onSubmit:t[0]||(t[0]=_((...o)=>r.handleOtpVerification&&r.handleOtpVerification(...o),["prevent"]))},[i("div",A,[(m(),g(M,null,O(4,o=>$(i("input",{key:o,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*","onUpdate:modelValue":s=>n.otp[o-1]=s,onInput:s=>r.handleInput(s,o),onKeydown:s=>r.handleKeyDown(s,o),class:"otp-input",placeholder:"_"},null,40,B),[[V,n.otp[o-1]]])),64))]),i("button",{type:"submit",disabled:!r.isOtpComplete,class:"verify-btn"},u(e.$t("otp.verify")),9,K),n.otpMessage?(m(),g("div",{key:0,class:"info-message",style:w({marginTop:"1rem",color:r.otpMessageColor})},u(n.otpMessage),5)):I("",!0)],32),i("div",L,[i("div",R,[i("span",null,u(n.timer),1)]),i("button",{class:"btn btn-link",disabled:n.timer!=="00:00",onClick:t[1]||(t[1]=_((...o)=>r.resendOtp&&r.resendOtp(...o),["prevent"]))},[S(p,{icon:"rotate-right"}),T(" "+u(e.$t("otp.resend")),1)],8,U)])])])}const x=y(N,[["render",j],["__scopeId","data-v-224f5e7b"]]);export{x as default};

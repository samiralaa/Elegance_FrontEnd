import{_ as H,K as Q,J as W,u as m,I as X,B as Y,r as i,o as c,c as f,e as l,l as r,b as p,V as y,a as _,t as v,F as P,d as V,j as h,m as Z}from"./index-0cd49077.js";const x={class:"product-edit-container"},ee={class:"currency-option"},ae={class:"currency-name"},te={class:"currency-rate"},le={class:"el-upload__text"},$="https://backend.webenia.org",oe={__name:"Edit",setup(re){const R=Q(),w=W(),E=m(null),o=m({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_id:null,currency_id:null,country_id:null,parent_id:null}),I={name_en:[{required:!0,message:"Please input product name (EN)",trigger:"blur"}],price:[{required:!0,message:"Please input product price",trigger:"blur"}],category_id:[{required:!0,message:"Please select a category",trigger:"change"}],currency_id:[{required:!0,message:"Please select a currency",trigger:"change"}],country_id:[{required:!0,message:"Please select a country",trigger:"change"}]},g=m([]),C=m([]),S=m([]),U=m([]),A=m([]),k=`${$}/api/products`,D=`${$}/api/categories`,F=`${$}/api/currencies`,N=`${$}/api/countries`,B=X(()=>S.value.filter(e=>!e.is_deleted)),O=e=>(localStorage.getItem("lang")||"en")==="ar"?e.name_ar:e.name_en,T=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const a=await p.get(D);a.data.status&&a.data.data&&(C.value=a.data.data);const u=await p.get(F);u.data.status&&u.data.currencies&&(S.value=u.data.currencies);const n=await p.get(N);n.data.status&&n.data.data&&(U.value=n.data.data);const d=await p.get(k);d.data.status&&d.data.data&&(A.value=d.data.data)}catch(e){y.error(e.message||"Failed to fetch select options")}},q=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const{id:a}=w.params,u=await p.get(`${k}/${a}`);if(u.data.status)Object.assign(o.value,u.data.data);else throw new Error(u.data.message||"Failed to fetch product")}catch(e){y.error(e.message||"Failed to fetch product")}},J=(e,a)=>{g.value=a},L=(e,a)=>{g.value=a},z=async()=>{E.value.validate(async e=>{if(e)try{const a=JSON.parse(localStorage.getItem("tokenData"));if(!a||!a.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${a.token}`;const{id:u}=w.params,n=new FormData;for(const s in o.value)n.append(s,o.value[s]);g.value.forEach(s=>{n.append("images[]",s.raw)});const d=await p.post(`${k}/${u}?_method=PUT`,n,{headers:{"Content-Type":"multipart/form-data"}});if(d.data.status)y.success(d.data.message||"Product updated successfully"),R.push("/products");else throw new Error(d.data.message||"Failed to update product")}catch(a){y.error(a.message||"Failed to update product")}})};return Y(()=>{T(),q()}),(e,a)=>{const u=i("el-input"),n=i("el-form-item"),d=i("el-switch"),s=i("el-option"),b=i("el-select"),j=i("el-upload"),M=i("el-button"),G=i("el-form"),K=i("el-card");return c(),f("div",x,[l(K,{class:"product-card"},{default:r(()=>[_("h2",null,v(e.$t("Products.EditProduct")),1),l(G,{model:o.value,ref_key:"formRef",ref:E,rules:I,"label-width":"120px",enctype:"multipart/form-data"},{default:r(()=>[l(n,{label:e.$t("Products.NameEn"),prop:"name_en"},{default:r(()=>[l(u,{modelValue:o.value.name_en,"onUpdate:modelValue":a[0]||(a[0]=t=>o.value.name_en=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.NameAr"),prop:"name_ar"},{default:r(()=>[l(u,{modelValue:o.value.name_ar,"onUpdate:modelValue":a[1]||(a[1]=t=>o.value.name_ar=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Price"),prop:"price"},{default:r(()=>[l(u,{modelValue:o.value.price,"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.price=t),type:"number"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Availability"),prop:"is_available"},{default:r(()=>[l(d,{modelValue:o.value.is_available,"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.is_available=t),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.DescriptionEn"),prop:"description_en"},{default:r(()=>[l(u,{type:"textarea",modelValue:o.value.description_en,"onUpdate:modelValue":a[4]||(a[4]=t=>o.value.description_en=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.DescriptionAr"),prop:"description_ar"},{default:r(()=>[l(u,{type:"textarea",modelValue:o.value.description_ar,"onUpdate:modelValue":a[5]||(a[5]=t=>o.value.description_ar=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Category"),prop:"category_id"},{default:r(()=>[l(b,{modelValue:o.value.category_id,"onUpdate:modelValue":a[6]||(a[6]=t=>o.value.category_id=t),placeholder:e.$t("Products.SelectCategory"),filterable:"",clearable:""},{default:r(()=>[(c(!0),f(P,null,V(C.value,t=>(c(),h(s,{key:t.id,label:t.name_en||t.name_ar,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Currency"),prop:"currency_id"},{default:r(()=>[l(b,{modelValue:o.value.currency_id,"onUpdate:modelValue":a[7]||(a[7]=t=>o.value.currency_id=t),placeholder:e.$t("Products.SelectCurrency"),filterable:"",clearable:""},{default:r(()=>[(c(!0),f(P,null,V(B.value,t=>(c(),h(s,{key:t.id,label:O(t),value:t.id},{default:r(()=>[_("div",ee,[_("span",ae,v(t.name_en),1),_("span",te,"("+v(parseFloat(t.exchange_rate).toFixed(2))+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Country"),prop:"country_id"},{default:r(()=>[l(b,{modelValue:o.value.country_id,"onUpdate:modelValue":a[8]||(a[8]=t=>o.value.country_id=t),placeholder:e.$t("Products.SelectCountry"),filterable:"",clearable:""},{default:r(()=>[(c(!0),f(P,null,V(U.value,t=>(c(),h(s,{key:t.id,label:t.name_en||t.name_ar,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.ParentProduct"),prop:"parent_id"},{default:r(()=>[l(b,{modelValue:o.value.parent_id,"onUpdate:modelValue":a[9]||(a[9]=t=>o.value.parent_id=t),placeholder:e.$t("Products.SelectParentProduct"),clearable:""},{default:r(()=>[l(s,{label:e.$t("Products.None"),value:null},null,8,["label"]),(c(!0),f(P,null,V(A.value,t=>(c(),h(s,{key:t.id,label:t.name_en,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(n,{label:e.$t("Products.Images"),prop:"images"},{default:r(()=>[l(j,{class:"upload-demo",drag:"",action:"","auto-upload":!1,limit:5,"file-list":g.value,"list-type":"picture","on-change":J,"on-remove":L},{default:r(()=>[a[10]||(a[10]=_("i",{class:"el-icon-upload"},null,-1)),_("div",le,v(e.$t("Products.DropFiles")),1)]),_:1,__:[10]},8,["file-list"])]),_:1},8,["label"]),l(n,null,{default:r(()=>[l(M,{type:"primary",onClick:z},{default:r(()=>[Z(v(e.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ue=H(oe,[["__scopeId","data-v-97c0bfeb"]]);export{ue as default};

import{_ as C,H as x,ae as S,b as p,r as k,o as l,c as a,e as g,a as e,t as n,l as w,g as D,w as c,v as f,f as m,F as _,d as y,h as F}from"./index-96ee7cbc.js";const E={components:{Header:x,fa:S},data(){return{cities:[],countries:[],countryLoading:!1,loading:!0,error:null,user:{},showAddressDialog:!1,editingAddressId:null,addressForm:{building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""},addressSuccess:!1,showResetPasswordModal:!1,password:"",password_confirmation:"",resetPasswordLoading:!1,resetPasswordError:null,resetPasswordSuccess:null,showDeleteDialog:!1,addressToDelete:null,showDeleteSuccess:!1}},methods:{formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"},goToResetPassword(){this.$router.push({name:"ResetPassword",query:{email:this.user.email}})},formatAddress(t){let s="";return t.country?s=this.$i18n&&this.$i18n.locale==="ar"?t.country.name_ar:t.country.name_en:t.country_id&&(s=t.country_id),[t.building_name,t.floor_number,t.apartment_number,t.postal_code,t.landmark,t.city_id,s].filter(Boolean).join(", ")},openEditDialog(t=null){t?(this.editingAddressId=t==null?void 0:t.id,this.addressForm={...t},this.showAddressDialog=!0):(this.showAddressDialog=!0,this.addressForm={...t})},closeEditDialog(){this.showAddressDialog=!1,this.editingAddressId=null,this.addressForm={building_name:"",floor_number:"",apartment_number:"",postal_code:"",landmark:"",city_id:"",country_id:""}},async saveAddress(t){var s,i,u;console.log(t,"ssssssss"),(t==null||t==null)&&this.addAddress();try{const o=await p.post("api/address/",this.addressForm,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),d=o.data.data,b=this.user.address.findIndex(h=>h.id===t);b!==-1?this.$set(this.user.address,b,d):this.user.address.push(d),this.addressSuccess=!0,(s=this.$toast)==null||s.success(o.data.message||"Address updated successfully"),await this.fetchUserProfile(),setTimeout(()=>{this.closeEditDialog()},300)}catch(o){const d=((u=(i=o==null?void 0:o.response)==null?void 0:i.data)==null?void 0:u.message)||"Failed to update address";this.$toast.error(d),this.closeEditDialog()}},async addAddress(){console.log("userId",this.user.id),console.log("addressForm",this.addressForm);const t=JSON.parse(localStorage.getItem("auth_token"));console.log(t,"token");try{if(!t||!t.token)throw new Error("Authentication token not found");const s={user_id:this.userId,building_name:this.addressForm.building_name,floor_number:this.addressForm.floor_number,apartment_number:this.addressForm.apartment_number,postal_code:this.addressForm.postal_code,landmark:this.addressForm.landmark,city_id:this.addressForm.city_id,country_id:this.addressForm.country_id};console.log(s,"addressDataaaaaaaaaaa");const i=await p.post("https://backend.webenia.org/api/address",s,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});console.log("response.data",i)}catch(s){console.log("Error adding address:",s)}},async resetPassword(){var t,s;if(this.resetPasswordError=null,this.resetPasswordSuccess=null,this.password!==this.password_confirmation){this.resetPasswordError=this.$t("profile.passwordsDoNotMatch");return}if(this.password.length<8){this.resetPasswordError=this.$t("profile.passwordTooShort");return}this.resetPasswordLoading=!0;try{const i=await p.post("api/reset-password",{email:this.user.email,password:this.password,password_confirmation:this.password_confirmation});i.data.status&&i.data.data?(this.resetPasswordSuccess=i.data.message||this.$t("profile.passwordResetSuccess"),setTimeout(()=>{this.showResetPasswordModal=!1,this.password="",this.password_confirmation=""},1500)):this.resetPasswordError=i.data.message||this.$t("profile.passwordResetFailed")}catch(i){this.resetPasswordError=((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||this.$t("profile.passwordResetFailed")}finally{this.resetPasswordLoading=!1}},async fetchCountries(){var t;this.countryLoading=!0;try{const s=await p.get("https://backend.webenia.org/api/countries");this.countries=((t=s.data)==null?void 0:t.data)||[]}catch(s){console.error("Error fetching countries:",s)}finally{this.countryLoading=!1}},async fetchCities(t){console.log(t),this.countryLoading=!0;try{const s=await p.get(`https://backend.webenia.org/api/countries/${t}`);this.cities=s.data.data.original.data.cities,console.log("Cities:",this.cities)}catch(s){console.error("Failed to fetch cities:",s),this.cities=[],this.countryLoading=!1}finally{this.countryLoading=!1}},async fetchUserProfile(){var t,s;try{const i=await p.get("api/me",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.user=i.data.data.user}catch(i){this.error=((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.message)||"Failed to fetch profile"}finally{this.loading=!1}},openDeleteDialog(t){this.addressToDelete=t,this.showDeleteDialog=!0},async confirmDeleteAddress(){var t,s,i;if(this.addressToDelete)try{await p.delete(`api/address/${this.addressToDelete.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),this.user.address=this.user.address.filter(u=>u.id!==this.addressToDelete.id),this.showDeleteDialog=!1,this.showDeleteSuccess=!0,this.addressToDelete=null}catch(u){const o=((s=(t=u==null?void 0:u.response)==null?void 0:t.data)==null?void 0:s.message)||this.$t("profile.errorDeletingAddress")||"Failed to delete address";(i=this.$toast)==null||i.error(o),this.showDeleteDialog=!1,this.addressToDelete=null}}},async created(){var t;if(await this.fetchUserProfile(),await this.fetchCountries(),this.user.address&&this.user.address.length>0){const s=this.user.address[0].country_id||((t=this.user.address[0].country)==null?void 0:t.id);s&&await this.fetchCities(s)}else this.cities=[]},async mounted(){await this.fetchCountries()}},L={class:"profile-outer container my-5"},j={key:0,class:"d-flex flex-column align-items-center justify-content-center py-5"},N={key:1,class:"text-center text-danger"},T={key:2,class:"card p-4 shadow"},U={class:"d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"},V={class:"d-flex align-items-center gap-3"},I={class:"avatar bg-primary text-white rounded-circle d-flex justify-content-center align-items-center",style:{width:"60px",height:"60px","font-size":"24px"}},M={class:"mb-0"},B={class:"text-muted"},R={key:0,class:"modal-overlay"},z={class:"modal-dialog-centered"},q={class:"modal-content bg-white p-4 rounded shadow w-100"},H={class:"mb-4"},O={class:"form-group"},J={class:"form-group"},K={key:0,class:"alert alert-danger"},G={key:1,class:"alert alert-success"},Q={class:"d-flex justify-content-end gap-2 mt-2"},W=["disabled"],X={key:0,class:"spinner-border spinner-border-sm"},Y={class:"d-flex flex-column gap-3"},Z={class:"d-flex justify-content-between border-bottom pb-2"},$={class:"d-flex justify-content-between border-bottom pb-2"},ss={class:"d-flex justify-content-between border-bottom pb-2"},es={key:1,class:"mt-4"},ts={class:"d-flex justify-content-between align-items-center mb-3"},os={class:"mb-0 text-dark"},rs={class:"d-flex align-items-center"},ns={class:"text-muted"},is=["onClick"],ls=["onClick"],as={key:3,class:"modal-overlay"},ds={class:"modal-dialog-centered"},us={class:"modal-content bg-white p-4 rounded shadow w-100"},cs={class:"form-group"},ms={class:"form-group"},hs={class:"form-group"},ps={class:"form-group"},fs={class:"form-group"},gs={class:"form-group"},ws={key:0,disabled:""},bs=["value"],_s={class:"form-group"},ys={for:"city"},vs=["value"],ks={class:"d-flex justify-content-end gap-2 mt-2"},Ds={key:0,class:"modal-overlay"},Fs={class:"modal-dialog-centered"},As={class:"modal-content bg-white p-4 rounded shadow w-100"},Ps={class:"mb-3"},Cs={class:"d-flex justify-content-end gap-2 mt-2"},xs={key:1,class:"modal-overlay"},Ss={class:"modal-dialog-centered"},Es={class:"modal-content bg-white p-4 rounded shadow w-100 text-center"},Ls={class:"mb-3 text-success"};function js(t,s,i,u,o,d){var v;const b=k("Header"),h=k("fa");return l(),a(_,null,[g(b),e("div",L,[o.loading?(l(),a("div",j,[s[19]||(s[19]=e("span",{class:"loader mb-2"},null,-1)),e("span",null,n(t.$t("profile.loading")),1)])):o.error?(l(),a("div",N,[e("span",null,n(o.error),1)])):(l(),a("div",T,[e("div",U,[e("div",V,[e("div",I,n(o.user.name?o.user.name.charAt(0).toUpperCase():"?"),1),e("div",null,[e("h5",M,n(o.user.name),1),e("small",B,n(o.user.role),1)])]),e("button",{class:"btn btn-outline-secondary d-flex align-items-center gap-1",onClick:s[0]||(s[0]=r=>o.showResetPasswordModal=!0),"aria-label":"Reset Password"},[s[20]||(s[20]=e("svg",{width:"18",height:"18",fill:"none",viewBox:"0 0 24 24"},[e("path",{d:"M12 15v2m0 0v2m0-2h2m-2 0H10m8-6a8 8 0 11-16 0 8 8 0 0116 0z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),w(" "+n(t.$t("profile.resetPassword")),1)])]),o.showResetPasswordModal?(l(),a("div",R,[e("div",z,[e("div",q,[e("h5",H,n(t.$t("profile.resetPassword")),1),e("form",{onSubmit:s[4]||(s[4]=D((...r)=>d.resetPassword&&d.resetPassword(...r),["prevent"])),class:"d-flex flex-column gap-3"},[e("div",O,[e("label",null,n(t.$t("profile.newPassword")),1),c(e("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=r=>o.password=r),class:"form-control",required:""},null,512),[[f,o.password]])]),e("div",J,[e("label",null,n(t.$t("profile.confirmPassword")),1),c(e("input",{type:"password","onUpdate:modelValue":s[2]||(s[2]=r=>o.password_confirmation=r),class:"form-control",required:""},null,512),[[f,o.password_confirmation]])]),o.resetPasswordError?(l(),a("div",K,n(o.resetPasswordError),1)):m("",!0),o.resetPasswordSuccess?(l(),a("div",G,n(o.resetPasswordSuccess),1)):m("",!0),e("div",Q,[e("button",{type:"submit",class:"btn btn-primary",disabled:o.resetPasswordLoading},[o.resetPasswordLoading?(l(),a("span",X)):m("",!0),w(" "+n(t.$t("profile.submit")),1)],8,W),e("button",{type:"button",class:"btn btn-secondary",onClick:s[3]||(s[3]=r=>o.showResetPasswordModal=!1)},n(t.$t("profile.cancel")),1)])],32)])])])):m("",!0),e("div",Y,[e("div",Z,[e("strong",null,n(t.$t("profile.name")),1),e("span",null,n(o.user.name),1)]),e("div",$,[e("strong",null,n(t.$t("profile.email")),1),e("span",null,n(o.user.email),1)]),e("div",ss,[e("strong",null,n(t.$t("profile.phone")),1),e("span",null,n(o.user.phone),1)])]),(v=o.user.address)!=null&&v.length?(l(),a("div",es,[e("div",ts,[e("h5",os,[g(h,{icon:["fas","map-marker-alt"],class:"me-2 text-primary"}),w(" "+n(t.$t("profile.address")),1)]),e("button",{class:"btn btn-outline-info btn-sm",onClick:s[5]||(s[5]=r=>d.openEditDialog())},[g(h,{icon:["fas","plus"],class:"me-1"}),w(" "+n(t.$t("profile.addAddress")),1)])]),(l(!0),a(_,null,y(o.user.address,(r,A)=>(l(),a("div",{key:r.id||A,class:"d-flex justify-content-between align-items-center border rounded p-3 mb-2 bg-light"},[e("div",rs,[g(h,{icon:["fas","location-dot"],class:"text-secondary me-3"}),e("span",ns,n(d.formatAddress(r)),1)]),e("button",{class:"btn btn-sm btn-outline-primary",onClick:P=>d.openEditDialog(r)},[g(h,{icon:["fas","pen"],class:"me-1"}),w(" "+n(t.$t("profile.editAddress")),1)],8,is),e("button",{class:"btn btn-sm btn-outline-danger ms-2",onClick:P=>d.openDeleteDialog(r)},[g(h,{icon:["fas","trash"],class:"me-1"}),w(" "+n(t.$t("profile.deleteAddress")),1)],8,ls)]))),128))])):m("",!0)])),o.showAddressDialog?(l(),a("div",as,[e("div",ds,[e("div",us,[s[28]||(s[28]=e("h5",{class:"mb-4"},"Edit Address",-1)),e("form",{onSubmit:s[15]||(s[15]=D(r=>d.saveAddress(o.editingAddressId),["prevent"])),class:"d-flex flex-column gap-3"},[e("div",cs,[s[21]||(s[21]=e("label",null,"Building Name",-1)),c(e("input",{"onUpdate:modelValue":s[6]||(s[6]=r=>o.addressForm.building_name=r),class:"form-control",placeholder:"Building Name"},null,512),[[f,o.addressForm.building_name]])]),e("div",ms,[s[22]||(s[22]=e("label",null,"Floor Number",-1)),c(e("input",{"onUpdate:modelValue":s[7]||(s[7]=r=>o.addressForm.floor_number=r),class:"form-control",placeholder:"Floor Number"},null,512),[[f,o.addressForm.floor_number]])]),e("div",hs,[s[23]||(s[23]=e("label",null,"Apartment Number",-1)),c(e("input",{"onUpdate:modelValue":s[8]||(s[8]=r=>o.addressForm.apartment_number=r),class:"form-control",placeholder:"Apartment Number"},null,512),[[f,o.addressForm.apartment_number]])]),e("div",ps,[s[24]||(s[24]=e("label",null,"Postal Code",-1)),c(e("input",{"onUpdate:modelValue":s[9]||(s[9]=r=>o.addressForm.postal_code=r),class:"form-control",placeholder:"Postal Code"},null,512),[[f,o.addressForm.postal_code]])]),e("div",fs,[s[25]||(s[25]=e("label",null,"Landmark",-1)),c(e("input",{"onUpdate:modelValue":s[10]||(s[10]=r=>o.addressForm.landmark=r),class:"form-control",placeholder:"Landmark"},null,512),[[f,o.addressForm.landmark]])]),e("div",gs,[s[26]||(s[26]=e("label",{for:"country"},"country",-1)),c(e("select",{id:"country",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=r=>o.addressForm.country_id=r),required:"",onChange:s[12]||(s[12]=r=>d.fetchCities(o.addressForm.country_id))},[o.countryLoading?(l(),a("option",ws,"Loading...")):m("",!0),(l(!0),a(_,null,y(o.countries,r=>(l(),a("option",{key:r.id,value:r.id},n(r.name_en||r.name_ar),9,bs))),128))],544),[[F,o.addressForm.country_id]])]),e("div",_s,[e("label",ys,n(t.$t("checkout.city")),1),c(e("select",{id:"city",class:"form-select","onUpdate:modelValue":s[13]||(s[13]=r=>o.addressForm.city_id=r),required:""},[(l(!0),a(_,null,y(o.cities,r=>(l(),a("option",{key:r.id,value:r.id},n(t.$i18n.locale==="ar"?r.name_ar:r.name_en),9,vs))),128))],512),[[F,o.addressForm.city_id]])]),e("div",ks,[s[27]||(s[27]=e("button",{type:"submit",class:"btn btn-primary"},"Save",-1)),e("button",{type:"button",class:"btn btn-secondary",onClick:s[14]||(s[14]=(...r)=>d.closeEditDialog&&d.closeEditDialog(...r))},"Cancel")])],32)])])])):m("",!0)]),o.showDeleteDialog?(l(),a("div",Ds,[e("div",Fs,[e("div",As,[e("h5",Ps,n(t.$t("profile.confirmDeleteAddress")||"Are you sure you want to delete this address?"),1),e("div",Cs,[e("button",{class:"btn btn-danger",onClick:s[16]||(s[16]=(...r)=>d.confirmDeleteAddress&&d.confirmDeleteAddress(...r))},n(t.$t("profile.deleteAddress")),1),e("button",{class:"btn btn-secondary",onClick:s[17]||(s[17]=r=>o.showDeleteDialog=!1)},n(t.$t("profile.cancel")),1)])])])])):m("",!0),o.showDeleteSuccess?(l(),a("div",xs,[e("div",Ss,[e("div",Es,[e("h5",Ls,n(t.$t("profile.addressDeleted")||"Address deleted successfully"),1),e("button",{class:"btn btn-primary",onClick:s[18]||(s[18]=r=>o.showDeleteSuccess=!1)},"OK")])])])):m("",!0)],64)}const Ts=C(E,[["render",js],["__scopeId","data-v-a0dae6bd"]]);export{Ts as default};

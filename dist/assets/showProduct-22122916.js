import{_ as de,C as ue,J as ve,K as _e,L as pe,z as me,B as ge,y as h,D as fe,x as V,M as he,N as ke,r as I,o as l,c,a as o,e as d,q as w,t as r,O as T,F as z,d as B,g as f,b as H,H as ye,n as S,f as be,h as we,j as Ce,E as m}from"./index-44f336bc.js";import{$ as k}from"./slick-theme-c40c0489.js";const Fe=["dir"],Se={class:"container"},$e={class:"product-details"},xe={class:"product-title"},Ie=["innerHTML"],Te={class:"price-block"},ze={class:"d-flex"},qe={key:0,class:"price-old"},Ae={key:1,class:"discount-badge"},Ee={class:"price-new"},Ne={class:"product-actions"},Pe=["title"],Re={key:0,class:"sale-badge"},Ve={key:0,class:"weight"},Be={class:"weight-container"},Le={class:"row g-4"},Me=["onClick"],Oe={class:"buttons-section"},Ue={key:0,class:"quantity-section"},De={class:"quantity-control"},je=["src"],He={class:"slider-wrapper"},Qe=["onClick"],Je=["src"],Ke={key:0,class:"children-products-section"},We={class:"title section-header d-flex align-items-center mb-4"},Ge={class:"mb-0"},Xe={class:"row g-3"},Ye={class:"product-card card border-0 h-100"},Ze={class:"position-relative overflow-hidden bg-light"},et=["src","alt"],tt={key:0,class:"sale-badge"},st={class:"product-actions d-flex justify-content-center gap-2 w-100"},at=["onClick","disabled"],ot=["onClick","disabled"],it=["onClick","title"],nt={class:"card-body"},rt={class:"card-title"},lt={class:"price-container"},ct={key:0,class:"discount-badge"},dt={key:1,class:"price-old"},ut={class:"card-text card-price"},Z=1,ee=99,Q="/default-image.jpg",vt={__name:"showProduct",setup(_t){const{locale:C,t:n}=ue(),te=ve(()=>C.value==="ar"?"rtl":"ltr"),J=_e();pe();const y=me(),K=ge(),s=h({}),g=h(1),q=h(null),F=h(!1);h(0);const $=h(null),x=h(null),L=h(3),M=h(3),A=e=>e?`https://backend.webenia.org/public/storage/${e}`:Q,W=e=>{e.target.src=Q},E=e=>{q.value=e,V(()=>{const t=document.querySelector(".main-image");t&&(t.src=A(e))})},O=async()=>{var e;try{const t=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},i=await H.get(`https://backend.webenia.org/api/website/show/products/${J.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:t.code}});i.data.status&&(s.value=i.data.data,s.value._original_price=s.value.price,(e=s.value.images)!=null&&e.length&&(q.value=s.value.images[0].path,V(()=>{D(),j()})))}catch(t){console.error("Error fetching product:",t)}},se=async()=>{var e,t;try{let i=0;if(s.value.discount&&s.value.discount.is_active){const _=parseFloat(s.value.discount.discount_value),b=parseFloat(s.value.converted_price||s.value.price);i=b-b*(_/100)}else i=parseFloat(s.value.converted_price)||parseFloat(s.value.price);const v={product_id:s.value.id,quantity:g.value,price:i};s.value.amounts&&(v.amount_id=s.value.amount_id);const u=await H.post("https://backend.webenia.org/api/cart-items",v,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});u.data.message&&(m({title:n("success"),message:u.data.message,type:"success"}),K.incrementCount(),await K.fetchCartCount())}catch(i){m({title:"❌",message:((t=(e=i.response)==null?void 0:e.data)==null?void 0:t.message)||n("add_to_cart_error")||"Login required to add to cart",type:"error"})}},G=async e=>{var t,i,v;try{let u=0;if(e.discount&&e.discount.is_active){const p=parseFloat(e.discount.discount_value),R=parseFloat(e.converted_price||e.price);u=R-R*(p/100)}else u=parseFloat(e.converted_price)||parseFloat(e.price);const _={product_id:e.id,quantity:1,price:u},b=(t=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:t.id;b&&(_.user_id=b),e.amounts&&(_.amount_id=e.amount_id);const a=await H.post("https://backend.webenia.org/api/cart-items",_,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&m({title:n("success"),message:a.data.message,type:"success"})}catch(u){console.error("Error adding child product to cart:",u),m({title:"❌",message:((v=(i=u.response)==null?void 0:i.data)==null?void 0:v.message)||n("add_to_cart_error")||"Login required to add to cart",type:"error"})}},U=h(0),N=(e,t)=>{U.value=e,s.value.amount_id=t.id,s.value.price=t.price,t.converted_price!==void 0?s.value.converted_price=t.converted_price:s.value.converted_price=t.price},ae=()=>{var e,t;(t=(e=s.value)==null?void 0:e.amounts)!=null&&t.length?N(0,s.value.amounts[0]):(U.value=null,s.value.amount_id=null,s.value._original_price!==void 0&&(s.value.price=s.value._original_price))},D=()=>{var v;const e=k($.value),t=k(x.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick");const i=((v=s.value.images)==null?void 0:v.length)||0;M.value=i,L.value=i>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:L.value,slidesToScroll:1,infinite:i>1,focusOnSelect:!0,rtl:C.value==="ar",asNavFor:t,afterChange:function(u){const _=s.value.images[u];_&&E(_.path)}}),t.slick({slidesToShow:1,slidesToScroll:1,infinite:i>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:C.value==="ar",asNavFor:e,afterChange:function(u){const _=s.value.images[u];_&&E(_.path)}})},oe=()=>{const e=k($.value),t=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),t.slick("slickPrev"),X())},ie=()=>{const e=k($.value),t=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),t.slick("slickNext"),X())},X=()=>{const e=k($.value);if(e.length&&e.hasClass("slick-initialized")){const i=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");E(i)}};fe(async()=>{var e,t;await O(),(t=(e=s.value)==null?void 0:e.amounts)!=null&&t.length&&N(0,s.value.amounts[0]),V(()=>{D(),j()}),window.addEventListener("currency-changed",O)}),he(()=>J.params.id,async e=>{var t,i;await O(),(i=(t=s.value)==null?void 0:t.amounts)!=null&&i.length&&N(0,s.value.amounts[0]),V(()=>{D(),j()})}),ke(()=>{const e=k(x.value),t=k($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick")});const P=e=>y.isInFavorites(e.id),ne=async e=>{try{if(P(e)){const t=y.favorites.find(i=>i.product_id===e.id);t&&(await y.removeFromFavorites(t.id),m({title:n("Removed From Favorites"),message:n("Product Removed From Favorites"),type:"success"}))}else await y.addToFavorites(e.id)&&m({title:n("Added To Favorites"),message:n("Product Added To Favorites"),type:"success"})}catch(t){console.error("Error toggling child favorites:",t),m({title:n("error"),message:t.message||n("failed_to_toggle_favorite"),type:"error"})}},re=()=>{g.value<ee?g.value++:m({title:n("warning"),message:n("max_quantity_reached"),type:"warning"})},le=()=>{g.value>Z?g.value--:m({title:n("warning"),message:n("min_quantity_reached"),type:"warning"})},ce=async()=>{try{if(F.value){const e=y.favorites.find(t=>t.product_id===s.value.id);e&&(await y.removeFromFavorites(e.id),F.value=!1,m({title:n("Removed From Favorites"),message:n("Product Removed From Favorites"),type:"success"}))}else await y.addToFavorites(s.value.id)&&(F.value=!0,m({title:n("Added To Favorites"),message:n("Product Added To Favorites"),type:"success"}))}catch(e){console.error("Error toggling favorites:",e),m({title:n("error"),message:e.message||n("failed_to_toggle_favorite"),type:"error"})}},j=()=>{F.value=y.isInFavorites(s.value.id)},Y=e=>{if(e.discount&&e.discount.is_active){const t=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(t/100)).toFixed(2)}return e.converted_price||e.price};return(e,t)=>{const i=I("fa"),v=I("el-button"),u=I("el-col"),_=I("el-row"),b=I("router-link");return l(),c(z,null,[t[5]||(t[5]=o("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap",rel:"stylesheet"},null,-1)),d(ye),o("div",{class:"product-show",dir:te.value},[o("div",Se,[d(_,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:w(()=>[d(u,{xs:24,sm:24,md:12,lg:14},{default:w(()=>[o("div",$e,[o("h1",xe,r(T(C)==="ar"?s.value.name_ar:s.value.name_en),1),o("div",{innerHTML:T(C)==="ar"?s.value.description_ar:s.value.description_en,class:"description"},null,8,Ie),o("div",Te,[o("div",ze,[s.value.discount&&s.value.discount.is_active?(l(),c("span",qe,r(s.value.converted_price||s.value.price)+" "+r(s.value.currency_code),1)):f("",!0),s.value.discount&&s.value.discount.is_active?(l(),c("span",Ae,"-"+r(s.value.discount.discount_value)+"%",1)):f("",!0)]),o("span",Ee,r(Y(s.value))+" "+r(s.value.currency_code),1)]),o("div",Ne,[o("button",{onClick:t[0]||(t[0]=a=>ce(s.value)),class:S(["btn rounded-circle shadow-sm btn-light",F.value?"text-danger":""]),title:F.value?"Remove from favorites":"Add to favorites"},[d(i,{icon:F.value?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Pe),s.value.is_available?f("",!0):(l(),c("div",Re,r(e.$t("products.outOfStock")),1))]),s.value.amounts&&s.value.amounts.length>0?(l(),c("div",Ve,[t[4]||(t[4]=o("h1",{class:"weight-title"},"Select Weight",-1)),o("div",{class:"reset",onClick:ae},[d(i,{icon:"rotate-right"}),t[3]||(t[3]=o("a",null,"reset",-1))]),o("div",Be,[o("div",Le,[(l(!0),c(z,null,B(s.value.amounts,(a,p)=>(l(),c("div",{key:a.id,class:S(["weight-item",{active:U.value===p}]),onClick:R=>N(p,a)},[o("p",null,r(a.weight)+" "+r(a.unit.name_en)+" For "+r(a.price)+" "+r(s.value.currency_code),1)],10,Me))),128))])])])):f("",!0),o("div",Oe,[d(v,{class:"add-to-cart btn",disabled:!s.value.is_available,type:"primary",size:"large",round:"",onClick:se},{default:w(()=>[be(r(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),s.value.is_available?(l(),c("div",Ue,[o("div",De,[d(v,{size:"small",onClick:le,disabled:g.value<=Z,class:"qty-btn"},{default:w(()=>[d(i,{icon:"minus"})]),_:1},8,["disabled"]),we(o("input",{class:"qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":t[1]||(t[1]=a=>g.value=a),onInput:t[2]||(t[2]=a=>g.value=Math.min(g.value))},null,544),[[Ce,g.value,void 0,{number:!0}]]),d(v,{size:"small",onClick:re,disabled:g.value>=ee,class:"qty-btn"},{default:w(()=>[d(i,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),d(u,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:w(()=>[o("div",{class:"image-wrapper",ref_key:"main",ref:x},[(l(!0),c(z,null,B(s.value.images,(a,p)=>(l(),c("div",{key:a.id,class:"slide"},[o("img",{src:A(q.value),class:"main-image",onError:W},null,40,je)]))),128))],512),o("div",He,[M.value>1?(l(),c("button",{key:0,class:"btn nav-button left",onClick:oe},[d(i,{icon:"arrow-left"})])):f("",!0),o("div",{class:S(["slider-container",{"centered-slides":L.value<3}])},[o("div",{class:"slider",ref_key:"slider",ref:$},[(l(!0),c(z,null,B(s.value.images,(a,p)=>(l(),c("div",{key:a.id,class:"slide",onClick:R=>E(a.path)},[o("img",{src:A(a.path),class:S({active:q.value===a.path}),onError:W},null,42,Je)],8,Qe))),128))],512)],2),M.value>1?(l(),c("button",{key:1,class:"btn nav-button right",onClick:ie},[d(i,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),s.value.children&&s.value.children.length>0?(l(),c("div",Ke,[o("div",We,[d(i,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),o("h2",Ge,r(T(n)("products.relatedProducts")),1)]),o("div",Xe,[(l(!0),c(z,null,B(s.value.children,a=>(l(),c("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[o("div",Ye,[o("div",Ze,[d(b,{to:`/read/products/${s.value.id}`},{default:w(()=>{var p;return[o("img",{src:(p=a.images)!=null&&p.length?A(a.images[0].path):Q,alt:T(C)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,et)]}),_:2},1032,["to"]),a.is_available?f("",!0):(l(),c("div",tt,r(e.$t("products.outOfStock")),1)),o("div",st,[d(b,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:w(()=>[d(i,{icon:"eye"})]),_:2},1032,["to"]),o("button",{onClick:p=>G(a),class:S(["btn btn-light shadow-sm",{disabled:!a.is_available}]),disabled:!a.is_available},r(e.$t("home.add-to-cart")),11,at),o("button",{onClick:p=>G(a),class:S(["d-none btn rounded-circle btn-light shadow-sm",{disabled:!a.is_available}]),disabled:!a.is_available},[d(i,{icon:"cart-plus"})],10,ot),o("button",{onClick:p=>ne(a),class:S(["btn rounded-circle shadow-sm btn-light",P(a)?"text-danger":""]),title:P(a)?"Remove from favorites":"Add to favorites"},[d(i,{icon:P(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,it)])]),o("div",nt,[o("h5",rt,r(T(C)==="ar"?a.name_ar:a.name_en),1),o("div",lt,[a.discount&&a.discount.is_active?(l(),c("span",ct," -"+r(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(l(),c("span",dt,r(a.converted_price||a.price)+" "+r(a.currency_code||"UAE"),1)):f("",!0),o("span",ut,r(Y(a))+" "+r(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,Fe)],64)}}},gt=de(vt,[["__scopeId","data-v-17a82ae0"]]);export{gt as default};

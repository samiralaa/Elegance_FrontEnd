import{_ as he,C as ke,L as S,M as ye,D as be,z as we,B as Ce,y as k,E as Fe,x as M,N as Se,O as $e,r as E,o as r,c,e as v,a as n,p as w,t as l,G as U,F as $,d as T,f,b as X,H as xe,n as x,j as oe,w as Ie,v as ze,k as Te,I as g}from"./index-59f74053.js";import{$ as b}from"./slick-theme-c2fd2e83.js";const qe=["dir"],Pe={class:"container"},Ee={class:"product-details"},Ne={class:"product-title"},Ae={key:0,class:"description"},Ve={class:"price-block"},Be={class:"d-flex"},Le={key:0,class:"price-old",dir:"ltr"},De={key:1,class:"discount-badge",dir:"ltr"},Me={class:"price-new",dir:"ltr"},Ue=["title"],Oe={class:"product-actions"},Re={key:0,class:"sale-badge"},Qe={key:1,class:"weight"},He={class:"weight-title"},Je={class:"weight-container"},je={class:"row g-4"},Ge=["onClick"],Ke={key:0,class:"amount-details",style:{"margin-top":"1rem"}},We={key:1},Xe={class:"buttons-section"},Ye={key:0,class:"quantity-section"},Ze={class:"quantity-control"},et=["src"],tt={class:"slider-wrapper"},st=["onClick"],at=["src"],ot={key:0,class:"children-products-section"},it={class:"title section-header d-flex align-items-center mb-4"},nt={class:"mb-0"},rt={class:"row g-3"},ct={class:"product-card card border-0 h-100"},lt={class:"position-relative overflow-hidden bg-light"},dt=["src","alt"],ut={key:0,class:"sale-badge"},vt={class:"product-actions d-flex justify-content-center gap-2 w-100"},_t=["onClick","disabled"],pt=["onClick","disabled"],mt=["onClick","title"],gt={class:"card-body"},ft={class:"card-title"},ht={class:"price-container"},kt={key:0,class:"discount-badge"},yt={key:1,class:"price-old",dir:"ltr"},bt={class:"card-text card-price",dir:"ltr"},ie=1,ne=99,Y="/default-image.jpg",wt={__name:"showProduct",setup(Ct){const{locale:C,t:d}=ke(),O=S(()=>C.value==="ar"?"rtl":"ltr"),Z=ye();be();const y=we(),N=Ce(),s=k({}),h=k(1),A=k(null);k(0),k("");const I=k(null),q=k(null),R=k(3),Q=k(3),P=e=>y.favorites.some(t=>t.product_id===e),re=e=>{var t,o;return((t=y.favorites.find(i=>i.product_id===e))==null?void 0:t.favorite_id)||((o=y.favorites.find(i=>i.product_id===e))==null?void 0:o.id)},ce=async e=>{var t,o;try{if(P(e.id)){const i=re(e.id);i&&(await y.removeFromFavorites(i),g({title:d("success"),message:d("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const i=await y.addToFavorites(e.id);g({title:d("success"),message:i.message||d("favorite_added")||"Product added to favorites",type:"success"})}}catch(i){console.error("Favorite error:",i),g({title:d("error"),message:((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.message)||d("login_required_favorite")||"Login required to favorite product",type:"error"})}},le=async()=>{var e,t,o;try{let i=0;if(_.value?i=parseFloat((e=_.value)==null?void 0:e.price):i=parseFloat(s.value.price),s.value.discount&&s.value.discount.is_active){const F=parseFloat(s.value.discount.discount_value);i=i-i*(F/100)}const u={product_id:s.value.id,quantity:h.value,price:i};_.value&&(u.amount_id=_.value.id);const p=await X.post("https://backend.webenia.org/api/cart-items",u,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});p.data.status?(g({title:d("success"),message:d("Products.addedSussess"),type:"success"}),N.incrementCount(),await N.fetchCartCount()):g.error(p.data.message)}catch(i){g.error(((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.message)||d("Error adding product to cart"))}},V=e=>e?`https://backend.webenia.org/public/storage/${e}`:Y,ee=e=>{e.target.src=Y},B=e=>{A.value=e,M(()=>{const t=document.querySelector(".main-image");t&&(t.src=V(e))})},H=async()=>{var e;try{const t=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},o=await X.get(`https://backend.webenia.org/api/website/show/products/${Z.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:t.code}});o.data.status&&(s.value=o.data.data,s.value._original_price=s.value.converted_price,(e=s.value.images)!=null&&e.length&&(A.value=s.value.images[0].path,M(()=>{j(),G()})))}catch(t){console.error("Error fetching product:",t)}},te=async e=>{var t,o,i;try{let u=0;if(e.discount&&e.discount.is_active){const m=parseFloat(e.discount.discount_value),z=parseFloat(e.price);u=z-z*(m/100)}else u=parseFloat(e.price);const p={product_id:e.id,quantity:1,price:u},F=(t=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:t.id;F&&(p.user_id=F),e.amounts&&(p.amount_id=e.amount_id);const a=await X.post("https://backend.webenia.org/api/cart-items",p,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&(g({title:d("success"),message:a.data.message,type:"success"}),N.incrementCount(),await N.fetchCartCount())}catch(u){console.error("Error adding child product to cart:",u),g({title:"❌",message:((i=(o=u.response)==null?void 0:o.data)==null?void 0:i.message)||d("add_to_cart_error")||"Login required to add to cart",type:"error"})}},L=k(null),J=(e,t)=>{L.value=e,s.value.amount_id=t.id,s.value.price=t.price,t.converted_price!==void 0?s.value.converted_price=t.converted_price:s.value.converted_price=t.price},j=()=>{var i;const e=b(I.value),t=b(q.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick");const o=((i=s.value.images)==null?void 0:i.length)||0;Q.value=o,R.value=o>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:R.value,slidesToScroll:1,infinite:o>1,focusOnSelect:!0,rtl:C.value==="ar",asNavFor:t,afterChange:function(u){const p=s.value.images[u];p&&B(p.path)}}),t.slick({slidesToShow:1,slidesToScroll:1,infinite:o>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:C.value==="ar",asNavFor:e,afterChange:function(u){const p=s.value.images[u];p&&B(p.path)}})},de=()=>{const e=b(I.value),t=b(q.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),t.slick("slickPrev"),se())},ue=()=>{const e=b(I.value),t=b(q.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),t.slick("slickNext"),se())},se=()=>{const e=b(I.value);if(e.length&&e.hasClass("slick-initialized")){const o=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");B(o)}};Fe(async()=>{var e,t;await H(),(t=(e=s.value)==null?void 0:e.amounts)!=null&&t.length&&J(0,s.value.amounts[0]),M(()=>{j(),G()}),window.addEventListener("currency-changed",H)}),Se(()=>Z.params.id,async e=>{var t,o;await H(),(o=(t=s.value)==null?void 0:t.amounts)!=null&&o.length&&J(0,s.value.amounts[0]),W(),M(()=>{j(),G()})}),$e(()=>{const e=b(q.value),t=b(I.value);e.hasClass("slick-initialized")&&e.slick("unslick"),t.hasClass("slick-initialized")&&t.slick("unslick")});const D=e=>y.isInFavorites(e.id),ve=async e=>{var t,o;try{if(D(e)){const i=y.favorites.find(u=>u.product_id===e.id);if(i){const u=i.favorite_id||i.id;await y.removeFromFavorites(u),g({title:d("success"),message:d("favorite_removed")||"Product removed from favorites",type:"success"})}}else{const i=await y.addToFavorites(e.id);i&&g({title:d("success"),message:i.message||d("favorite_added")||"Product added to favorites",type:"success"})}}catch(i){console.error("Error toggling child favorites:",i),g({title:d("error"),message:((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.message)||d("login_required_favorite")||"Login required to favorite product",type:"error"})}},_e=()=>{h.value<ne?h.value++:g({title:d("warning"),message:d("max_quantity_reached"),type:"warning"})},pe=()=>{h.value>ie?h.value--:g({title:d("warning"),message:d("min_quantity_reached"),type:"warning"})},G=()=>{P(s.value.id)},me=e=>{if(e.discount&&e.discount.is_active){const t=parseFloat(e.discount.discount_value),o=parseFloat(e.converted_price);return(o-o*(t/100)).toFixed(2)}return e.converted_price},K=S(()=>_.value?_.value.converted_price!==void 0?_.value.converted_price:_.value.price:s.value.converted_price!==void 0?s.value.converted_price:s.value.price);S(()=>{if(s.value.discount&&s.value.discount.is_active){const e=parseFloat(s.value.discount.discount_value),t=parseFloat(K.value);return(t-t*(e/100)).toFixed(2)}return K.value});const _=S(()=>s.value.amounts&&s.value.amounts.length>0&&L.value!==null?s.value.amounts[L.value]:null),ge=S(()=>{var t;let e;if(e=_.value?parseFloat((t=_.value)==null?void 0:t.converted_price):parseFloat(s.value.converted_price),s.value.discount&&s.value.discount.is_active){const o=parseFloat(s.value.discount.discount_value);return e=e-e*(o/100),e.toFixed(2)}return e}),W=S(()=>C.value==="ar"?s.value.description_ar:s.value.description_en),ae=S(()=>{if(!W.value)return[];const e=W.value.split(`
`).filter(o=>o.trim()!=="");console.log("lines",e);const t=[];for(let o=0;o<e.length;o+=3)t.push(e.slice(o,o+3));return t});return(e,t)=>{const o=E("fa"),i=E("el-button"),u=E("el-col"),p=E("el-row"),F=E("router-link");return r(),c($,null,[v(xe),n("div",{class:"product-show",dir:O.value},[n("div",Pe,[v(p,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:w(()=>[v(u,{xs:24,sm:24,md:12,lg:14},{default:w(()=>[n("div",Ee,[n("h1",Ne,l(U(C)==="ar"?s.value.name_ar:s.value.name_en),1),ae.value.length?(r(),c("ul",Ae,[(r(!0),c($,null,T(ae.value,(a,m)=>(r(),c("li",{key:m},[(r(!0),c($,null,T(a,(z,fe)=>(r(),c("p",{key:fe},l(z),1))),128))]))),128))])):f("",!0),n("div",Ve,[n("div",Be,[s.value.discount&&s.value.discount.is_active?(r(),c("span",Le,l(K.value)+" "+l(s.value.currency_code),1)):f("",!0),s.value.discount&&s.value.discount.is_active?(r(),c("span",De," -"+l(s.value.discount.discount_value)+"% ",1)):f("",!0)]),n("span",Me,l(ge.value||0)+" "+l(s.value.currency_code),1),n("button",{onClick:t[0]||(t[0]=a=>ce(s.value)),class:x(["love-btn btn rounded-circle shadow-sm btn-light",P(s.value.id)?"text-danger":""]),title:P(s.value.id)?"Remove from favorites":"Add to favorites"},[v(o,{icon:P(s.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Ue)]),n("div",Oe,[s.value.is_available?f("",!0):(r(),c("div",Re,l(e.$t("products.outOfStock")),1))]),s.value.amounts&&s.value.amounts.length>0?(r(),c("div",Qe,[n("h1",He,l(e.$t("amount.weight")),1),n("div",Je,[n("div",je,[(r(!0),c($,null,T(s.value.amounts,(a,m)=>(r(),c("div",{key:a.id,class:x(["weight-item p-0",{active:L.value===m}]),onClick:z=>J(m,a)},[n("p",null,l(O.value==="rtl"?a.weight+""+a.unit.name_en:a.weight+" "+a.unit.name_en)+" For "+l(a.converted_price)+" "+l(s.value.currency_code),1)],10,Ge))),128))])]),_.value?(r(),c("div",Ke,[n("p",null,[n("strong",null,l(e.$t("amount.selected"))+":",1),oe(" "+l(O.value==="rtl"?_.value.weight+""+_.value.unit.name_en:_.value.weight+" "+_.value.unit.name_en)+" - "+l(_.value.converted_price)+" "+l(s.value.currency_code),1)])])):(r(),c("div",We,[n("p",null,l(e.$t("amount.noAmount")),1)]))])):f("",!0),n("div",Xe,[v(i,{class:"add-to-cart btn",disabled:!s.value.is_available,type:"primary",size:"large",round:"",onClick:le},{default:w(()=>[oe(l(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),s.value.is_available?(r(),c("div",Ye,[n("div",Ze,[v(i,{size:"small",onClick:pe,disabled:h.value<=ie,class:"qty-btn"},{default:w(()=>[v(o,{icon:"minus"})]),_:1},8,["disabled"]),Ie(n("input",{dir:"ltr",class:"form-control qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),onInput:t[2]||(t[2]=a=>h.value=Math.min(h.value))},null,544),[[ze,h.value,void 0,{number:!0}]]),v(i,{size:"small",onClick:_e,disabled:h.value>=ne,class:"qty-btn"},{default:w(()=>[v(o,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),v(u,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:w(()=>[n("div",{class:"image-wrapper",ref_key:"main",ref:q},[(r(!0),c($,null,T(s.value.images,(a,m)=>(r(),c("div",{key:a.id,class:"slide"},[n("img",{src:V(A.value),class:"main-image",onError:ee},null,40,et)]))),128))],512),n("div",tt,[Q.value>1?(r(),c("button",{key:0,class:"btn nav-button left",onClick:de},[v(o,{icon:"arrow-left"})])):f("",!0),n("div",{class:x(["slider-container",{"centered-slides":R.value<3}])},[n("div",{class:"slider",ref_key:"slider",ref:I},[(r(!0),c($,null,T(s.value.images,(a,m)=>(r(),c("div",{key:a.id,class:"slide",onClick:z=>B(a.path)},[n("img",{src:V(a.path),class:x({active:A.value===a.path}),onError:ee},null,42,at)],8,st))),128))],512)],2),Q.value>1?(r(),c("button",{key:1,class:"btn nav-button right",onClick:ue},[v(o,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),s.value.children&&s.value.children.length>0?(r(),c("div",ot,[n("div",it,[v(o,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),n("h2",nt,l(U(d)("products.relatedProducts")),1)]),n("div",rt,[(r(!0),c($,null,T(s.value.children,a=>(r(),c("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[n("div",ct,[n("div",lt,[v(F,{to:`/read/products/${a.id}`},{default:w(()=>{var m;return[n("img",{src:(m=a.images)!=null&&m.length?V(a.images[0].path):Y,alt:U(C)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,dt)]}),_:2},1032,["to"]),a.is_available?f("",!0):(r(),c("div",ut,l(e.$t("products.outOfStock")),1)),n("div",vt,[v(F,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:w(()=>[v(o,{icon:"eye"})]),_:2},1032,["to"]),n("button",{onClick:m=>te(a),class:x(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},l(e.$t("home.add-to-cart")),11,_t),n("button",{onClick:m=>te(a),class:x(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[v(o,{icon:"cart-plus"})],10,pt),n("button",{onClick:m=>ve(a),class:x(["btn rounded-circle shadow-sm btn-light",D(a)?"text-danger":""]),title:D(a)?"Remove from favorites":"Add to favorites"},[v(o,{icon:D(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,mt)])]),n("div",gt,[n("h5",ft,l(U(C)==="ar"?a.name_ar:a.name_en),1),n("div",ht,[a.discount&&a.discount.is_active?(r(),c("span",kt," -"+l(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(r(),c("span",yt,l(a.converted_price||a.price)+" "+l(a.currency_code||"UAE"),1)):f("",!0),n("span",bt,l(me(a))+" "+l(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,qe),v(Te)],64)}}},$t=he(wt,[["__scopeId","data-v-c426fa94"]]);export{$t as default};

import{_ as G,x as c,L as F,D as H,r as l,V as K,o as i,c as $,a as D,t as d,e as o,m as r,w as X,i as C,f as z,b as f,W as g,E as m,ab as Y,F as Z,d as ee,l as p,a9 as te,ac as ae,a0 as oe}from"./index-fb9faeb8.js";const re={class:"orders-page"},le={class:"orders-header"},se={class:"orders-filters"},v=5,ne={__name:"Orders",setup(ce){const h=c([]),u=c(""),_=c(""),w=c(1),b=c(!1),y=c(null),k=c(!1),L=["pending","processing","cancelled"],V=async()=>{k.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${e.token}`;const a=await f.get("https://backend.webenia.org/api/orders");if(a.data.status===!0)h.value=a.data.data,console.log("Orders loaded:",h.value);else throw new Error(a.data.message||"Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e),g.error(e.message||"Failed to fetch orders")}finally{k.value=!1}},O=F(()=>h.value.filter(e=>{const a=u.value===""||e.id.toString().includes(u.value.toLowerCase())||e.total_price.includes(u.value.toLowerCase()),s=!_.value||e.status===_.value;return a&&s})),B=F(()=>{const e=(w.value-1)*v,a=e+v;return O.value.slice(e,a)}),N=e=>{w.value=e},A=e=>{y.value=e,b.value=!0},I=e=>{const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString()},P=e=>({pending:"info",processing:"warning",cancelled:"danger"})[e.toLowerCase()]||"info",T=async e=>{try{const a=JSON.parse(localStorage.getItem("tokenData"));if(!a||!a.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${a.token}`;const s=await f.post(`https://backend.webenia.org/api/orders/${e.id}/cancel`);if(s.data.status===!0)g.success("Order cancelled successfully"),await V();else throw new Error(s.data.message||"Failed to cancel order")}catch(a){console.error("Error cancelling order:",a),g.error(a.message||"Failed to cancel order")}},U=e=>{g.info("Reordered items from order #"+e.id)};return H(()=>{V()}),(e,a)=>{const s=l("el-icon"),J=l("el-input"),M=l("el-option"),Q=l("el-select"),n=l("el-table-column"),q=l("el-tag"),S=l("el-button"),x=l("el-table"),R=l("el-pagination"),W=l("el-dialog"),j=K("loading");return i(),$("div",re,[D("div",le,[D("h2",null,d(e.$t("orders.myOrders")),1),o(J,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=t=>u.value=t),placeholder:"Search orders...",class:"search-input",clearable:""},{prefix:r(()=>[o(s,null,{default:r(()=>[o(m(Y))]),_:1})]),_:1},8,["modelValue"])]),D("div",se,[o(Q,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),placeholder:"Filter by Status",clearable:""},{default:r(()=>[(i(),$(Z,null,ee(L,t=>o(M,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),X((i(),C(x,{data:B.value,style:{width:"100%"},class:"orders-table",stripe:"",border:""},{default:r(()=>[o(n,{prop:"id",label:"Order ID",width:"120"}),o(n,{prop:"ordered_at",label:"Order Date",width:"180"},{default:r(t=>[p(d(I(t.row.ordered_at)),1)]),_:1}),o(n,{label:"Total",width:"150"},{default:r(t=>[p(d(t.row.currency)+" "+d(t.row.total_price),1)]),_:1}),o(n,{prop:"status",label:"Status",width:"150"},{default:r(t=>[o(q,{type:P(t.row.status)},{default:r(()=>[p(d(t.row.status),1)]),_:2},1032,["type"])]),_:1}),o(n,{label:"Actions",width:"220"},{default:r(t=>[o(S,{size:"small",type:"primary",onClick:E=>A(t.row),circle:""},{default:r(()=>[o(s,null,{default:r(()=>[o(m(te))]),_:1})]),_:2},1032,["onClick"]),o(S,{size:"small",type:"danger",disabled:t.row.status!=="pending"&&t.row.status!=="processing",onClick:E=>T(t.row),circle:""},{default:r(()=>[o(s,null,{default:r(()=>[o(m(ae))]),_:1})]),_:2},1032,["disabled","onClick"]),o(S,{size:"small",type:"success",onClick:E=>U(t.row),circle:""},{default:r(()=>[o(s,null,{default:r(()=>[o(m(oe))]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,k.value]]),O.value.length>v?(i(),C(R,{key:0,class:"pagination",layout:"prev, pager, next","current-page":w.value,"page-size":v,total:O.value.length,onCurrentChange:N},null,8,["current-page","total"])):z("",!0),o(W,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=t=>b.value=t),title:"Order Details",width:"600px"},{default:r(()=>[y.value?(i(),C(x,{key:0,data:y.value.items,border:"",stripe:"",style:{width:"100%"}},{default:r(()=>[o(n,{prop:"product_id",label:"Product ID"}),o(n,{prop:"quantity",label:"Quantity"}),o(n,{prop:"price",label:"Price"},{default:r(t=>[p(" $"+d(t.row.price),1)]),_:1}),o(n,{prop:"subtotal",label:"Subtotal"},{default:r(t=>[p(d(t.row.subtotal),1)]),_:1})]),_:1},8,["data"])):z("",!0)]),_:1},8,["modelValue"])])}}},ue=G(ne,[["__scopeId","data-v-5e94e65c"]]);export{ue as default};

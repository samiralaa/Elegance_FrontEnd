import{_ as v,H as b,b as f,r as O,o as d,c as n,e as C,a as e,n as g,g as m,t as o,F as p,d as _,f as u}from"./index-dc530aff.js";const k={components:{Header:b},name:"UserOrder",data(){return{orders:[],currentFilter:null,selectedOrder:null,isDialogVisible:!1,loading:!0,selectedCurrency:localStorage.getItem("selectedCurrency")?JSON.parse(localStorage.getItem("selectedCurrency")).code:"EGP"}},computed:{allOrdersCount(){return this.orders.length},pendingOrdersCount(){return this.orders.filter(r=>r.status==="pending").length},completedOrdersCount(){return this.orders.filter(r=>r.status==="completed"||r.status==="completed").length},cancelledOrdersCount(){return this.orders.filter(r=>r.status==="cancelled").length},filteredOrders(){return this.currentFilter?this.orders.filter(r=>this.currentFilter==="completed"?r.status==="completed":r.status===this.currentFilter):this.orders}},methods:{async fetchOrders(){var r,t,h;try{const c=localStorage.getItem("auth_token");if(!c){this.$toast.error("Please login to view your orders"),this.$router.push("/login");return}const s=await f.get("https://backend.webenia.org/api/orders/user",{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});s.data.status&&s.data.data.original.success?this.orders=s.data.data.original.orders:this.$toast.error(s.data.message||"Failed to fetch orders")}catch(c){console.error("Failed to fetch orders:",c),((r=c.response)==null?void 0:r.status)===401?(this.$toast.error("Please login to view your orders"),this.$router.push("/login")):this.$toast.error(((h=(t=c.response)==null?void 0:t.data)==null?void 0:h.message)||"Failed to fetch orders")}finally{this.loading=!1}},filterOrders(r){this.currentFilter=this.currentFilter===r?null:r},imageUrl(r){return`https://backend.webenia.org/public/storage/${r}`},formatDate(r){return new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})},formatStatus(r){return{pending:"In Progress",completed:"Completed",cancelled:"Cancelled"}[r.toLowerCase()]||r},async showOrderDetails(r){try{this.loading=!0;const t=localStorage.getItem("auth_token"),h=await f.get(`https://backend.webenia.org/api/orders/${r}`,{headers:{Authorization:`Bearer ${t}`}});this.selectedOrder=h.data.data.order,this.isDialogVisible=!0}catch{this.$toast.error("حدث خطأ أثناء تحميل تفاصيل الطلب")}finally{this.loading=!1}},getStatusBadgeClass(r){return{pending:"bg-warning",completed:"bg-success",cancelled:"bg-danger"}[r.toLowerCase()]||"bg-secondary"},updateCurrency(){const r=localStorage.getItem("selectedCurrency");this.selectedCurrency=r?JSON.parse(r).code:"EGP"}},mounted(){this.fetchOrders(),window.addEventListener("currency-changed",this.updateCurrency)},beforeUnmount(){window.removeEventListener("currency-changed",this.updateCurrency)}},w={class:"container py-4"},x={class:"orders-header"},S={class:"num"},F={class:"num"},D={class:"num"},I={class:"num"},N={key:0,class:"text-center"},j={key:1,class:"row g-4"},z={class:"order-card p-4 rounded-4 shadow-sm bg-white"},B={class:"d-flex justify-content-between align-items-start flex-wrap mb-3"},P={class:"fw-bold"},V={class:"text-end"},L={class:"text-muted"},U={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},A=["src"],E={key:1,src:"https://via.placeholder.com/150",class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"},alt:"No Image Available"},H={class:"small"},M={class:"text-muted"},q={class:"text-muted"},G={class:"d-flex justify-content-between align-items-center"},J=["onClick"],T={key:2,class:"alert alert-info text-center"},K={key:0,class:"modal-overlay d-flex justify-content-center align-items-center"},Q={class:"cart-modal bg-white rounded-4 shadow p-4 position-relative"},R={class:"mb-3"},W={key:0,class:"text-center"},X={key:1,class:"cart-content overflow-auto",style:{"max-height":"60vh"}},Y={class:"mb-3"},Z={key:0,class:"mb-3"},$={key:0},ee={key:0},te={key:1},se={key:2},re={key:3},oe={key:4},le={key:1},de={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},ne=["src"],ae={key:1,src:"https://via.placeholder.com/150",class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"},alt:"No Image Available"},ie={class:"small"},ce={class:"text-muted"},ue={class:"text-muted"};function ge(r,t,h,c,s,a){const y=O("Header");return d(),n(p,null,[C(y),e("div",w,[t[12]||(t[12]=e("h2",{class:"mb-4 fw-bold"},"My Orders",-1)),e("div",x,[e("a",{class:g(["order-stage",{active:!s.currentFilter}]),href:"#",onClick:t[0]||(t[0]=m(l=>a.filterOrders(null),["prevent"]))},[t[5]||(t[5]=e("h3",null,"In Progress",-1)),e("h3",S,o(a.allOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="pending"}]),href:"#",onClick:t[1]||(t[1]=m(l=>a.filterOrders("pending"),["prevent"]))},[t[6]||(t[6]=e("h3",null,"In Progress",-1)),e("h3",F,o(a.pendingOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="completed"}]),href:"#",onClick:t[2]||(t[2]=m(l=>a.filterOrders("completed"),["prevent"]))},[t[7]||(t[7]=e("h3",null,"Completed",-1)),e("h3",D,o(a.completedOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:s.currentFilter==="cancelled"}]),href:"#",onClick:t[3]||(t[3]=m(l=>a.filterOrders("cancelled"),["prevent"]))},[t[8]||(t[8]=e("h3",null,"Cancelled",-1)),e("h3",I,o(a.cancelledOrdersCount),1)],2)]),s.loading?(d(),n("div",N,t[9]||(t[9]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):a.filteredOrders.length>0?(d(),n("div",j,[(d(!0),n(p,null,_(a.filteredOrders,l=>(d(),n("div",{key:l.id,class:"col-12 col-md-6"},[e("div",z,[e("div",B,[e("div",null,[t[10]||(t[10]=e("small",{class:"text-muted"},"Order ID",-1)),e("h5",P,"#"+o(l.id),1)]),e("div",V,[e("small",L,o(a.formatDate(l.ordered_at)),1),t[11]||(t[11]=e("br",null,null,-1)),e("span",{class:g(["badge",a.getStatusBadgeClass(l.status)])},o(a.formatStatus(l.status)),3)])]),e("div",U,[(d(!0),n(p,null,_(l.items,i=>(d(),n("div",{key:i.id,class:"d-flex flex-column align-items-start col-4"},[i.product&&i.product.images&&i.product.images.length?(d(),n("img",{key:0,src:a.imageUrl(i.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,A)):(d(),n("img",E)),e("strong",H,o(i.product&&i.product.name_en?i.product.name_en:"No Name"),1),e("small",M,o(i.price)+" "+o(s.selectedCurrency)+" x"+o(i.quantity),1),e("small",q,"Size: "+o(i.size||"-"),1)]))),128))]),e("div",G,[e("strong",null,"Total: "+o(l.total_price)+" "+o(s.selectedCurrency)+" ("+o(l.items.length)+" Items)",1),e("button",{class:"btn btn-outline-dark btn-sm",onClick:i=>a.showOrderDetails(l.id)},"Details",8,J)])])]))),128))])):(d(),n("div",T," No orders found. "))]),s.isDialogVisible?(d(),n("div",K,[e("div",Q,[e("button",{type:"button",class:"btn-close position-absolute top-0 end-0 m-3",onClick:t[4]||(t[4]=l=>s.isDialogVisible=!1),"aria-label":"Close"}),e("h4",R,o(r.$t("order.orderDetails")),1),s.loading?(d(),n("div",W,t[13]||(t[13]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):(d(),n("div",X,[e("div",Y,[t[14]||(t[14]=e("strong",null,"Status:",-1)),e("span",{class:g(["badge",a.getStatusBadgeClass(s.selectedOrder.status)])},o(a.formatStatus(s.selectedOrder.status)),3)]),s.selectedOrder.address?(d(),n("div",Z,[t[15]||(t[15]=e("strong",null,"Address:",-1)),typeof s.selectedOrder.address=="object"?(d(),n("div",$,[s.selectedOrder.address.street?(d(),n("div",ee,o(s.selectedOrder.address.street),1)):u("",!0),s.selectedOrder.address.city?(d(),n("div",te,o(s.selectedOrder.address.city),1)):u("",!0),s.selectedOrder.address.state?(d(),n("div",se,o(s.selectedOrder.address.state),1)):u("",!0),s.selectedOrder.address.country?(d(),n("div",re,o(s.selectedOrder.address.country),1)):u("",!0),s.selectedOrder.address.zip?(d(),n("div",oe,o(s.selectedOrder.address.zip),1)):u("",!0)])):(d(),n("div",le,o(s.selectedOrder.address),1))])):u("",!0),e("div",de,[(d(!0),n(p,null,_(s.selectedOrder.items,l=>(d(),n("div",{key:l.id,class:"d-flex flex-column align-items-start col-4"},[l.product&&l.product.images&&l.product.images.length?(d(),n("img",{key:0,src:a.imageUrl(l.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,ne)):(d(),n("img",ae)),e("strong",ie,o(l.product&&l.product.name_en?l.product.name_en:"No Name"),1),e("small",ce,o(l.price)+" "+o(s.selectedCurrency)+" x"+o(l.quantity),1),e("small",ue,"Size: "+o(l.size||"-"),1)]))),128))])]))])])):u("",!0)],64)}const me=v(k,[["render",ge],["__scopeId","data-v-a8d550af"]]);export{me as default};

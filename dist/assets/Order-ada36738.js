import{_ as w,H as C,b,r as O,o as d,c as a,e as k,a as e,t as o,n as g,g as h,l as m,F as p,d as f,f as D}from"./index-4b94f5ff.js";const x={components:{Header:C},name:"UserOrder",data(){return{orders:[],currentFilter:null,selectedOrder:null,isDialogVisible:!1,loading:!0,selectedCurrency:localStorage.getItem("selectedCurrency")?JSON.parse(localStorage.getItem("selectedCurrency")).code:"EGP"}},computed:{allOrdersCount(){return this.orders.length},pendingOrdersCount(){return this.orders.filter(t=>t.status==="pending").length},completedOrdersCount(){return this.orders.filter(t=>t.status==="completed").length},cancelledOrdersCount(){return this.orders.filter(t=>t.status==="cancelled").length},filteredOrders(){return this.currentFilter?this.orders.filter(t=>t.status===this.currentFilter):this.orders}},methods:{async fetchOrders(){var t,s,u;try{const i=localStorage.getItem("auth_token");if(!i){this.$toast.error("Please login to view your orders"),this.$router.push("/login");return}const l=await b.get("https://backend.webenia.org/api/orders/user",{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});l.data.status&&l.data.data.original.success?this.orders=l.data.data.original.orders:this.$toast.error(l.data.message||"Failed to fetch orders")}catch(i){console.error("Failed to fetch orders:",i),((t=i.response)==null?void 0:t.status)===401?(this.$toast.error("Please login to view your orders"),this.$router.push("/login")):this.$toast.error(((u=(s=i.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to fetch orders")}finally{this.loading=!1}},filterOrders(t){this.currentFilter=this.currentFilter===t?null:t},imageUrl(t){return`https://backend.webenia.org/public/storage/${t}`},formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})},formatStatus(t){return{pending:"In Progress",completed:"Completed",cancelled:"Cancelled"}[t.toLowerCase()]||t},getStatusBadgeClass(t){return{pending:"bg-warning",completed:"bg-success",cancelled:"bg-danger"}[t.toLowerCase()]||"bg-secondary"},updateCurrency(){const t=localStorage.getItem("selectedCurrency");this.selectedCurrency=t?JSON.parse(t).code:"EGP"},toggleDropdown(t){t.classList.toggle("show")},setupDropdown(){const t=document.getElementById("selectDropdownButton"),s=document.getElementById("selectDropdownContent"),u=document.getElementById("selectedValue"),i=document.getElementById("hiddenSelectValue"),l=s.querySelectorAll(".select-option");t==null||t.addEventListener("click",()=>this.toggleDropdown(s)),l.forEach(r=>{r.addEventListener("click",v=>{v.preventDefault(),u.textContent=r.textContent,i.value=r.getAttribute("data-value"),s.classList.remove("show")})}),window.addEventListener("click",r=>{!t.contains(r.target)&&s.classList.contains("show")&&s.classList.remove("show")}),window.addEventListener("keydown",r=>{r.key==="Escape"&&s.classList.contains("show")&&s.classList.remove("show")})},async showOrderDetailsPopup(t){var s,u;this.isDialogVisible=!0,this.loading=!0;try{const i=localStorage.getItem("auth_token"),l=await b.get(`https://backend.webenia.org/api/orders/${t}`,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}});l.data.status&&l.data.data.original.success?this.selectedOrder=l.data.data.original.orders.find(r=>r.id===t):this.$toast.error(l.data.message||"Failed to fetch order details")}catch(i){console.error("Failed to fetch order details:",i),this.$toast.error(((u=(s=i.response)==null?void 0:s.data)==null?void 0:u.message)||"Failed to fetch order details")}finally{this.loading=!1}}},mounted(){this.fetchOrders(),this.setupDropdown(),window.addEventListener("currency-changed",this.updateCurrency)},beforeUnmount(){window.removeEventListener("currency-changed",this.updateCurrency)}},S={class:"container py-4"},F={class:"mb-4 fw-bold"},I={class:"orders-header"},L={class:"num"},B={class:"num"},E={class:"num"},N={class:"num"},V={class:"dropdown-container"},j={id:"selectDropdownButton",type:"button",class:"select-dropdown-button"},P={id:"selectedValue",class:"selected-value"},A={id:"selectDropdownContent",class:"select-dropdown-content"},U={style:{"padding-top":"0.25rem","padding-bottom":"0.25rem"},role:"menu","aria-orientation":"vertical","aria-labelledby":"selectDropdownButton"},z={class:"num"},H={class:"num"},M={class:"num"},T={class:"num"},q={key:0,class:"text-center"},G={key:1,class:"row g-4"},J={class:"order-card p-4 rounded-4 shadow-sm bg-white"},K={class:"d-flex justify-content-between align-items-start flex-wrap mb-3"},Q={class:"text-muted"},R={class:"fw-bold"},W={class:"text-end"},X={class:"text-muted"},Y={class:"items row gy-3 overflow-auto mb-3 pb-2 border-bottom"},Z=["src"],$={key:1,src:"https://via.placeholder.com/150",class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"},alt:"No Image Available"},ee={class:"small"},te={class:"text-muted"},se={class:"d-flex justify-content-between align-items-center"},re=["onClick"],oe={key:2,class:"alert alert-info text-center"},le={key:0,class:"modal-overlay d-flex justify-content-center align-items-center"},ne={class:"cart-modal bg-white rounded-4 shadow p-4 position-relative"},de={class:"mb-3"},ae={key:0,class:"text-center"},ie={key:1,class:"cart-content"},ce={class:"mb-3"},ue={class:"row flex-wrap gap-2 align-items-start border-bottom flex justify-content-center py-3 px-2",style:{"max-height":"70vh","overflow-y":"auto"}},he={class:"card h-100 border-0 shadow-sm rounded-3"},ge=["src"],me={key:1,src:"https://via.placeholder.com/300x300?text=No+Image",class:"card-img-top rounded-top",style:{"aspect-ratio":"1 / 1","object-fit":"cover"},alt:"No Image Available"},pe={class:"card-body d-flex flex-column"},ve={class:"card-title small mb-1"},fe={class:"text-muted"};function _e(t,s,u,i,l,r){const v=O("Header");return d(),a(p,null,[k(v),e("div",S,[e("h2",F,o(t.$t("orders.myOrders")),1),e("div",I,[e("a",{class:g(["order-stage",{active:!l.currentFilter}]),href:"#",onClick:s[0]||(s[0]=h(n=>r.filterOrders(null),["prevent"]))},[e("h3",null,o(t.$t("orders.allOrders")),1),e("h3",L,o(r.allOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:l.currentFilter==="pending"}]),href:"#",onClick:s[1]||(s[1]=h(n=>r.filterOrders("pending"),["prevent"]))},[e("h3",null,o(t.$t("orders.inProgress")),1),e("h3",B,o(r.pendingOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:l.currentFilter==="completed"}]),href:"#",onClick:s[2]||(s[2]=h(n=>r.filterOrders("completed"),["prevent"]))},[e("h3",null,o(t.$t("orders.completed")),1),e("h3",E,o(r.completedOrdersCount),1)],2),e("a",{class:g(["order-stage",{active:l.currentFilter==="cancelled"}]),href:"#",onClick:s[3]||(s[3]=h(n=>r.filterOrders("cancelled"),["prevent"]))},[e("h3",null,o(t.$t("orders.cancelled")),1),e("h3",N,o(r.cancelledOrdersCount),1)],2)]),e("div",V,[e("button",j,[e("span",P,o(t.$t("orders.allOrders")),1),s[9]||(s[9]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1))]),e("div",A,[e("div",U,[e("a",{class:"select-option",href:"#",onClick:s[4]||(s[4]=h(n=>r.filterOrders(null),["prevent"]))},[m(o(t.$t("orders.allOrders"))+" ",1),e("h3",z,o(r.allOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[5]||(s[5]=h(n=>r.filterOrders("pending"),["prevent"]))},[m(o(t.$t("orders.inProgress"))+" ",1),e("h3",H,o(r.pendingOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[6]||(s[6]=h(n=>r.filterOrders("completed"),["prevent"]))},[m(o(t.$t("orders.completed"))+" ",1),e("h3",M,o(r.completedOrdersCount),1)]),e("a",{class:"select-option",href:"#",onClick:s[7]||(s[7]=h(n=>r.filterOrders("cancelled"),["prevent"]))},[m(o(t.$t("orders.cancelled"))+" ",1),e("h3",T,o(r.cancelledOrdersCount),1)])])]),s[10]||(s[10]=e("input",{type:"hidden",id:"hiddenSelectValue",name:"selectOption",value:""},null,-1))]),l.loading?(d(),a("div",q,s[11]||(s[11]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):r.filteredOrders.length>0?(d(),a("div",G,[(d(!0),a(p,null,f(r.filteredOrders,n=>(d(),a("div",{key:n.id,class:"col-12 col-md-6"},[e("div",J,[e("div",K,[e("div",null,[e("small",Q,o(t.$t("orders.orderId")),1),e("h5",R,"#"+o(n.id),1)]),e("div",W,[e("small",X,o(r.formatDate(n.ordered_at)),1),s[12]||(s[12]=e("br",null,null,-1)),e("span",{class:g(["badge",r.getStatusBadgeClass(n.status)])},o(r.formatStatus(n.status)),3)])]),e("div",Y,[(d(!0),a(p,null,f(n.items,c=>(d(),a("div",{key:c.id,class:"d-flex flex-column align-items-start col-4"},[c.product&&c.product.images&&c.product.images.length?(d(),a("img",{key:0,src:r.imageUrl(c.product.images[0].path),class:"rounded mb-2",style:{width:"100%","aspect-ratio":"1","object-fit":"cover"}},null,8,Z)):(d(),a("img",$)),e("strong",ee,o(c.product&&c.product.name_en?c.product.name_en:"No Name"),1),e("small",te,o(c.price)+" "+o(l.selectedCurrency)+" x"+o(c.quantity),1)]))),128))]),e("div",se,[e("strong",null,"Total: "+o(n.total_price)+" "+o(l.selectedCurrency)+" ("+o(n.items.length)+" Items)",1),e("button",{class:"btn btn-outline-dark btn-sm",onClick:c=>r.showOrderDetailsPopup(n.id)},o(t.$t("orders.details")),9,re)])])]))),128))])):(d(),a("div",oe," No orders found. "))]),l.isDialogVisible?(d(),a("div",le,[e("div",ne,[e("button",{type:"button",class:"btn-close position-absolute top-0 end-0 m-3",onClick:s[8]||(s[8]=n=>l.isDialogVisible=!1),"aria-label":"Close"}),e("h4",de,o(t.$t("orders.orderDetails")),1),l.loading?(d(),a("div",ae,s[13]||(s[13]=[e("div",{class:"spinner-border",role:"status"},null,-1)]))):(d(),a("div",ie,[e("div",ce,[s[14]||(s[14]=e("strong",null,"Status:",-1)),e("span",{class:g(["badge",r.getStatusBadgeClass(l.selectedOrder.status)])},o(r.formatStatus(l.selectedOrder.status)),3)]),e("div",ue,[(d(!0),a(p,null,f(l.selectedOrder.items,n=>{var c,_,y;return d(),a("div",{key:n.id,class:"col-12 col-md-4 col-lg-3"},[e("div",he,[(_=(c=n.product)==null?void 0:c.images)!=null&&_.length?(d(),a("img",{key:0,src:r.imageUrl(n.product.images[0].path),class:"card-img-top rounded-top",style:{"aspect-ratio":"1 / 1","object-fit":"cover"},alt:"Product Image"},null,8,ge)):(d(),a("img",me)),e("div",pe,[e("strong",ve,o(((y=n.product)==null?void 0:y.name_en)||"No Name"),1),e("small",fe,o(n.price)+" "+o(l.selectedCurrency)+" × "+o(n.quantity),1)])])])}),128))])]))])])):D("",!0)],64)}const be=w(x,[["render",_e],["__scopeId","data-v-240699a6"]]);export{be as default};

import{_ as le,D as ae,M as te,y as D,L as ue,N as oe,E as ne,r as f,o as r,c,e as u,p as n,b as p,a as A,t as P,F as b,d as k,m as U,k as v,f as y,V as B}from"./index-7d302927.js";const de={class:"product-edit-container"},re={key:1,class:"amount-entry mb-3"},ie={key:5,class:"image-preview-list",style:{"margin-bottom":"1em"}},se=["src"],ce={class:"el-upload__text"},V="https://backend.webenia.org",pe={__name:"Edit",setup(me){const F=ae(),T=te(),R=D(null),E=T.params.id,e=D({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_ar:"",category_en:"",category_id:null,currency_id:null,country_id:null,parent_id:null,brand_id:null,images:[],amount_required:!1,amounts:[],unit_id:null,weight:null,amount_price:null,discount:{id:null,value:null,startDate:null,endDate:null,is_active:!1}}),L=()=>{e.value.amounts.push({unit_id:null,weight:null,price:null})},O=a=>{if(e.value.amounts.length<=1){B.warning(localStorage.getItem("lang")==="ar"?"يجب عليك حفظ كمية واحدة على الاقل":"At least one amount entry is required.");return}if(confirm(localStorage.getItem("lang")==="ar"?"سيتم حذف الكمية":"The amount will be deleted"))e.value.amounts.splice(a,1);else return},W={name_en:[{required:!0,message:"Required",trigger:"blur"}],price:[{required:!0,message:"Required",trigger:"blur"}]},h=D([]),C=D([]),I=D([]),N=D([]),Y=D([]),S=D([]),z=a=>(localStorage.getItem("lang")||"en")==="ar"?a.name_ar:a.name_en,J=ue(()=>C.value.filter(a=>!a.is_deleted)),q=a=>a?typeof a=="object"&&a.url?a.url:a.startsWith("http")?a:`${V}/public/storage/${a}`:"",j=async()=>{var $;const a=($=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:$.token;p.defaults.headers.common.Authorization=`Bearer ${a}`;const[t,i,d,o,s,_]=await Promise.all([p.get(`${V}/api/brands/${e.value.brand_id}/categories`),p.get(`${V}/api/currencies`),p.get(`${V}/api/countries`),p.get(`${V}/api/products`),p.get(`${V}/api/brands`),p.get(`${V}/api/units`)]);h.value=t.data.data,console.log("Categories:",h.value),C.value=i.data,I.value=d.data.data,N.value=o.data.data,Y.value=s.data.data,S.value=_.data.data},G=async()=>{var a,t,i;try{const o=(await p.get(`/api/products/${E}`)).data.data;console.log(o),e.value.name_ar=o.name_ar,e.value.name_en=o.name_en,e.value.description_ar=o.description_ar,e.value.description_en=o.description_en,e.value.price=o.price,e.value.category_ar=o.category.name_ar,e.value.category_en=o.category.name_en,e.value.currency_id=o.currency_id,e.value.country_id=o.country_id,e.value.brand_id=o.brand_id,e.value.parent_id=o.parent_id,e.value.quantity=o.quantity??1,e.value.amounts=((a=o.amounts)==null?void 0:a.map(m=>({unit_id:m.unit_id,weight:m.weight,price:m.price,id:m.id})))||[],e.value.type=o.type??"product",e.value.offer=o.discount?"1":"0",e.value.offer_price=o.discount?o.discounted_price:"",e.value.category_id=o.category_id,e.value.images=o.images.map(m=>({id:m.id,path:m.path,url:q(m.path)})),e.value.discount=o.discount?{id:o.discount.id,value:parseFloat(o.discount.discount_value),startDate:(t=o.discount.start_date)==null?void 0:t.split("T")[0],endDate:(i=o.discount.end_date)==null?void 0:i.split("T")[0],is_active:o.discount.is_active}:{id:null,value:null,startDate:null,endDate:null,is_active:!1};const[s,_,$]=await Promise.all([p.get("/api/categories"),p.get("/api/currencies"),p.get("/api/brands")]);h.value=s.data.data,C.value=_.data,Y.value=$.data.data}catch(d){console.error("Error loading product data",d)}},H=(a,t)=>e.value.images=t,K=(a,t)=>e.value.images=t,Q=()=>{R.value.validate(async a=>{var d;if(!a)return;const t=new FormData;for(const o in e.value)o!=="images"&&e.value[o]!==null&&t.append(o,e.value[o]);e.value.amounts.forEach((o,s)=>{t.append(`amounts[${s}][unit_id]`,o.unit_id),t.append(`amounts[${s}][weight]`,o.weight),t.append(`amounts[${s}][price]`,o.price),o.id&&t.append(`amounts[${s}][id]`,o.id)}),e.value.images.forEach(o=>{o.raw?t.append("images[]",o.raw):o.id&&t.append("existing_images[]",o.id)}),e.value.discount.value&&(t.append("discount[value]",e.value.discount.value),t.append("discount[startDate]",e.value.discount.startDate),t.append("discount[endDate]",e.value.discount.endDate),e.value.discount.id&&t.append("discount[id]",e.value.discount.id));const i=(d=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:d.token;p.defaults.headers.common.Authorization=`Bearer ${i}`,await p.post(`${V}/api/products/${E}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}),B.success("Product updated successfully"),F.push("/products")})},X=()=>{confirm(localStorage.getItem("lang")==="ar"?"سيتم حذف الخصم":"The discount will be deleted")&&(e.value.discount={id:null,value:null,startDate:null,endDate:null,is_active:!1})};return oe(()=>e.value.brand_id,async a=>{if(a)try{const t=await p.get(`${V}/api/brands/${a}/categories`);h.value=t.data.data,console.log("Categories for brand:",h.value)}catch(t){console.error("Failed to fetch categories for brand",t)}else{const t=await p.get(`${V}/api/categories`);h.value=t.data.data,e.value.category_id=null}}),ne(async()=>{await G(),j()}),(a,t)=>{const i=f("el-input"),d=f("el-form-item"),o=f("el-divider"),s=f("el-option"),_=f("el-select"),$=f("el-button"),m=f("el-switch"),M=f("el-date-picker"),Z=f("el-upload"),x=f("el-form"),ee=f("el-card");return r(),c("div",de,[u(ee,{class:"product-card"},{default:n(()=>[A("h2",null,P(a.$t("Products.EditProduct")),1),u(x,{model:e.value,ref_key:"formRef",ref:R,rules:W,"label-width":"120px",enctype:"multipart/form-data"},{default:n(()=>[u(d,{label:a.$t("Products.NameEn"),prop:"name_en"},{default:n(()=>[u(i,{modelValue:e.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.name_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.NameAr"),prop:"name_ar"},{default:n(()=>[u(i,{modelValue:e.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.name_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.amounts?(r(!0),c(b,{key:0},k(e.value.amounts,(l,w)=>(r(),c("div",{key:w,class:"amount-entry mb-3"},[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.Amount-Info")),1)]),_:1}),u(d,{label:a.$t("Products.Unit"),prop:`amounts.${w}.unit_id`},{default:n(()=>[u(_,{modelValue:l.unit_id,"onUpdate:modelValue":g=>l.unit_id=g,placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:n(()=>[(r(!0),c(b,null,k(S.value,g=>(r(),v(s,{key:g.id,label:g.name_en,value:g.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]),u(d,{label:a.$t("Products.Weight"),prop:`amounts.${w}.weight`},{default:n(()=>[u(i,{modelValue:l.weight,"onUpdate:modelValue":g=>l.weight=g,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),u(d,{label:a.$t("Products.amount-Price"),prop:`amounts.${w}.price`},{default:n(()=>[u(i,{modelValue:l.price,"onUpdate:modelValue":g=>l.price=g,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),e.value.amounts.length>0?(r(),v($,{key:0,type:"danger",onClick:g=>O(w),icon:"el-icon-delete"},{default:n(()=>[U(P(a.$t("Products.RemoveAmount")),1)]),_:2},1032,["onClick"])):y("",!0),e.value.amounts.length>0?(r(),v($,{key:1,type:"success",plain:"",onClick:L,icon:"el-icon-plus"},{default:n(()=>[U(P(a.$t("Products.AddAmount")),1)]),_:1})):y("",!0)]))),128)):y("",!0),u(d,{label:a.$t("Products.discount"),prop:"discount.value"},{default:n(()=>[u(m,{modelValue:e.value.discount.is_active,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.discount.is_active=l),"active-text":"Yes","inactive-text":"No"},null,8,["modelValue"])]),_:1},8,["label"]),e.value.discount&&e.value.discount.is_active?(r(),c("div",re,[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.discountInfo")),1)]),_:1}),e.value.discount.is_active?(r(),c(b,{key:0},[u(d,{label:a.$t("Products.Discount-Value"),prop:"discount.value"},{default:n(()=>[u(i,{modelValue:e.value.discount.value,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.discount.value=l),type:"number"},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.Start-Date"),prop:"discount.startDate"},{default:n(()=>[u(M,{modelValue:e.value.discount.startDate,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.discount.startDate=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"Pick start date",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.End-Date"),prop:"discount.endDate"},{default:n(()=>[u(M,{modelValue:e.value.discount.endDate,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.discount.endDate=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"Pick end date",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),e.value.discount.value?(r(),v($,{key:0,type:"danger",icon:"el-icon-delete",onClick:X},{default:n(()=>[U(P(a.$t("Products.removeDiscount")),1)]),_:1})):y("",!0),u(o)],64)):y("",!0)])):y("",!0),!e.value.amounts.length>0?(r(),v(d,{key:2,label:a.$t("Products.Needs-Amount")},{default:n(()=>[u(m,{modelValue:e.value.amount_required,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.amount_required=l),"active-text":"Yes","inactive-text":"No",dir:"ltr",class:"mx-3"},null,8,["modelValue"])]),_:1},8,["label"])):y("",!0),e.value.amount_required?(r(),c(b,{key:3},[u(o,{"content-position":"left"},{default:n(()=>[U(P(a.$t("Products.Amount-Info")),1)]),_:1}),u(d,{label:a.$t("Products.Unit"),prop:"unit_id"},{default:n(()=>[u(_,{modelValue:e.value.unit_id,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.unit_id=l),placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:n(()=>[(r(!0),c(b,null,k(S.value,l=>(r(),v(s,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.Weight"),prop:"weight"},{default:n(()=>[u(i,{modelValue:e.value.weight,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.weight=l),type:"number",placeholder:a.$t("Products.select-weight")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.amount-Price"),prop:"amount_price"},{default:n(()=>[u(i,{modelValue:e.value.amount_price,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.amount_price=l),type:"number",placeholder:a.$t("Products.select-price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):y("",!0),e.value.amounts?y("",!0):(r(),v(d,{key:4,label:a.$t("Products.Price"),prop:"price"},{default:n(()=>[u(i,{modelValue:e.value.price,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.price=l),type:"number"},null,8,["modelValue"])]),_:1},8,["label"])),u(d,{label:a.$t("Products.Availability"),prop:"is_available"},{default:n(()=>[u(m,{modelValue:e.value.is_available,"onUpdate:modelValue":t[11]||(t[11]=l=>e.value.is_available=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.DescriptionEn"),prop:"description_en"},{default:n(()=>[u(i,{type:"textarea",modelValue:e.value.description_en,"onUpdate:modelValue":t[12]||(t[12]=l=>e.value.description_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.DescriptionAr"),prop:"description_ar"},{default:n(()=>[u(i,{type:"textarea",modelValue:e.value.description_ar,"onUpdate:modelValue":t[13]||(t[13]=l=>e.value.description_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.brand"),prop:"brand_id"},{default:n(()=>[u(_,{modelValue:e.value.brand_id,"onUpdate:modelValue":t[14]||(t[14]=l=>e.value.brand_id=l),filterable:"",clearable:"",placeholder:"Select Brand"},{default:n(()=>[(r(!0),c(b,null,k(Y.value,l=>(r(),v(s,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.Category"),prop:"category_id"},{default:n(()=>[u(_,{modelValue:e.value.category_id,"onUpdate:modelValue":t[15]||(t[15]=l=>e.value.category_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCategory")},{default:n(()=>[(r(!0),c(b,null,k(h.value,l=>(r(),v(s,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.Currency"),prop:"currency_id"},{default:n(()=>[u(_,{modelValue:e.value.currency_id,"onUpdate:modelValue":t[16]||(t[16]=l=>e.value.currency_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCurrency")},{default:n(()=>[(r(!0),c(b,null,k(J.value,l=>(r(),v(s,{key:l.id,label:z(l),value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.Country"),prop:"country_id"},{default:n(()=>[u(_,{modelValue:e.value.country_id,"onUpdate:modelValue":t[17]||(t[17]=l=>e.value.country_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCountry")},{default:n(()=>[(r(!0),c(b,null,k(I.value,l=>(r(),v(s,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(d,{label:a.$t("Products.ParentProduct"),prop:"parent_id"},{default:n(()=>[u(_,{modelValue:e.value.parent_id,"onUpdate:modelValue":t[18]||(t[18]=l=>e.value.parent_id=l),clearable:"",placeholder:a.$t("Products.SelectParentProduct")},{default:n(()=>[u(s,{label:a.$t("Products.None"),value:null},null,8,["label"]),(r(!0),c(b,null,k(N.value,l=>(r(),v(s,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e.value.images&&e.value.images.length?(r(),c("div",ie,[(r(!0),c(b,null,k(e.value.images,(l,w)=>(r(),c("img",{key:w,src:l.url?l.url:q(l.path),alt:"Product Image",style:{"max-width":"120px","max-height":"120px","margin-right":"10px","border-radius":"8px"}},null,8,se))),128))])):y("",!0),u(d,{label:a.$t("Products.Images"),prop:"images"},{default:n(()=>[u(Z,{class:"upload-demo",drag:"",action:"","auto-upload":!1,limit:5,"file-list":e.value.images,"list-type":"picture","on-change":H,"on-remove":K},{default:n(()=>[t[19]||(t[19]=A("i",{class:"el-icon-upload"},null,-1)),A("div",ce,P(a.$t("Products.DropFiles")),1)]),_:1,__:[19]},8,["file-list"])]),_:1},8,["label"]),u(d,null,{default:n(()=>[u($,{type:"primary",onClick:Q},{default:n(()=>[U(P(a.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},_e=le(pe,[["__scopeId","data-v-201bfbdd"]]);export{_e as default};

import{_ as k,o as c,c as p,a as s,t as l,n as h,A as m,b as g,r as v,F as $,d as P,e as A,f as _,w as U,g as y,v as E,h as N,i as f,H as V,j as D}from"./index-23e6863a.js";const j={name:"CheckoutStepper",props:{step:{type:Number,required:!0}}},F={class:"stepper"},W={class:"step-label"},Q={class:"step-label"},Z={class:"step-label"};function z(t,e,a,d,r,i){return c(),p("div",F,[s("div",{class:h(["step",{active:a.step>=1,completed:a.step>1}])},[e[0]||(e[0]=s("div",{class:"step-number"},"1",-1)),s("div",W,l(t.$t("checkout.cart")),1)],2),s("div",{class:h(["step-line",{active:a.step>1}])},null,2),s("div",{class:h(["step",{active:a.step>=2,completed:a.step>2}])},[e[1]||(e[1]=s("div",{class:"step-number"},"2",-1)),s("div",Q,l(t.$t("checkout.shipping")),1)],2),s("div",{class:h(["step-line",{active:a.step>2}])},null,2),s("div",{class:h(["step",{active:a.step>=3}])},[e[2]||(e[2]=s("div",{class:"step-number"},"3",-1)),s("div",Z,l(t.$t("checkout.payment")),1)],2)])}const J=k(j,[["render",z],["__scopeId","data-v-74769554"]]);const K={name:"CartReview",props:{cartItems:{type:Array,required:!0},shippingCost:{type:Number,required:!0}},computed:{currentLang(){return localStorage.getItem("lang")||"en"},currency(){return this.cartItems.length>0?this.currentLang==="ar"?this.cartItems[0].currency.name_ar:this.cartItems[0].currency.name_en:""},subtotal(){return this.cartItems.reduce((t,e)=>t+parseFloat(e.price)*e.quantity,0).toFixed(2)},total(){return(parseFloat(this.subtotal)+this.shippingCost).toFixed(2)}},methods:{getProductImage(t){return t.images&&Array.isArray(t.images)?`${m}/${t.images[0]}`:`${m}/images/default.jpg`},async updateQuantity(t,e){var d,r,i;const a=t.quantity+e;if(a<1){this.$toast.warning(this.$t("checkout.minimumQuantity"));return}try{const o=await g.post(`${m}/api/cart-items/${t.id}`,{quantity:a},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(o.data&&o.data.success){const n=o.data.data;t.quantity=n.quantity??a,t.price=n.price??t.price,this.$toast.success(this.$t("checkout.quantityUpdated")),this.$emit("update-cart",[...this.cartItems])}else{const n=((d=o.data)==null?void 0:d.message)||this.$t("checkout.errorUpdatingQuantity");this.$toast.error(n)}}catch(o){console.error("Error updating quantity:",o);const n=((i=(r=o.response)==null?void 0:r.data)==null?void 0:i.message)||this.$t("checkout.errorUpdatingQuantity");this.$toast.error(n)}},async removeItem(t){try{await g.delete(`${m}/api/cart-items/${t}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}}),this.$emit("update-cart",this.cartItems.filter(e=>e.id!==t)),this.$toast.success(this.$t("checkout.itemRemoved"))}catch(e){console.error("Error removing item:",e),this.$toast.error(this.$t("checkout.errorRemovingItem"))}}}},x={class:"checkout-step"},H={class:"cart-items"},X=["src","alt"],Y={class:"item-details"},ee={class:"item-price"},te={class:"quantity-controls"},se=["onClick","disabled"],re=["onClick"],ae=["onClick"],ie={class:"cart-summary"},ne={class:"summary-row"},oe={class:"summary-row"},de={class:"summary-row total"},le=["disabled"];function ce(t,e,a,d,r,i){const o=v("fa");return c(),p("div",x,[s("h2",null,l(t.$t("checkout.reviewCart")),1),s("div",H,[(c(!0),p($,null,P(a.cartItems,n=>(c(),p("div",{key:n.id,class:"cart-item"},[s("img",{src:i.getProductImage(n),alt:n.product.name_en,class:"item-image"},null,8,X),s("div",Y,[s("h3",null,l(i.currentLang==="ar"?n.product.name_ar:n.product.name_en),1),s("p",ee,l(n.price)+" "+l(i.currentLang==="ar"?n.currency.name_ar:n.currency.name_en),1),s("div",te,[s("button",{onClick:u=>i.updateQuantity(n,-1),disabled:n.quantity<=1},"-",8,se),s("span",null,l(n.quantity),1),s("button",{onClick:u=>i.updateQuantity(n,1)},"+",8,re)])]),s("button",{class:"remove-item",onClick:u=>i.removeItem(n.id)},[A(o,{icon:"trash"})],8,ae)]))),128))]),s("div",ie,[s("div",ne,[s("span",null,l(t.$t("checkout.subtotal")),1),s("span",null,l(i.subtotal)+" "+l(i.currency),1)]),s("div",oe,[s("span",null,l(t.$t("checkout.shipping")),1),s("span",null,l(a.shippingCost)+" "+l(i.currency),1)]),s("div",de,[s("span",null,l(t.$t("checkout.total")),1),s("span",null,l(i.total)+" "+l(i.currency),1)])]),s("button",{class:"btn-primary",onClick:e[0]||(e[0]=n=>t.$emit("next-step")),disabled:!a.cartItems.length},l(t.$t("checkout.continueToShipping")),9,le)])}const ue=k(K,[["render",ce],["__scopeId","data-v-c82a522c"]]);const pe={name:"ShippingDetails",props:{modelValue:{type:Object,required:!0}},data(){return{savedAddresses:[],selectedAddressId:null,loading:!1,error:null,selectedAddress:null,isNewAddress:!1}},computed:{shippingDetails:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},isValid(){return this.isNewAddress?this.shippingDetails.buildingName&&this.shippingDetails.floorNumber&&this.shippingDetails.apartmentNumber&&this.shippingDetails.landmark&&this.shippingDetails.postalCode&&this.shippingDetails.cityId&&this.shippingDetails.countryId:this.selectedAddressId!==null}},methods:{async fetchSavedAddresses(){var t,e;this.loading=!0;try{const a=await g.get("http://elegance_backend.test/api/address",{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(a.data.status&&a.data.data){this.savedAddresses=a.data.data;const d=this.savedAddresses.find(r=>r.is_primary);d&&this.selectAddress(d)}}catch(a){console.error("Error fetching addresses:",a),this.error=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message}finally{this.loading=!1}},selectAddress(t){this.selectedAddressId=t.id,this.selectedAddress=t,this.isNewAddress=!1,this.shippingDetails={...this.shippingDetails,addressId:t.id}},async saveNewAddress(){var t,e;try{const a=localStorage.getItem("auth_token");let d=1;if(a)try{d=JSON.parse(atob(a.split(".")[1])).sub||1}catch(o){console.error("Error decoding token:",o)}const r={user_id:d,city_id:this.shippingDetails.cityId||1,country_id:this.shippingDetails.countryId||1,building_name:this.shippingDetails.buildingName,floor_number:this.shippingDetails.floorNumber,apartment_number:this.shippingDetails.apartmentNumber,landmark:this.shippingDetails.landmark,postal_code:this.shippingDetails.postalCode,is_primary:this.savedAddresses.length===0},i=await g.post("http://elegance_backend.test/api/address",r,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,"Content-Type":"application/json"}});if(i.data.status){const o=i.data.data;return this.savedAddresses.push(o),this.selectAddress(o),o.id}throw new Error(i.data.message||"Failed to save address")}catch(a){throw console.error("Error saving address:",a),this.error=((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message,a}},async handleSubmit(){if(this.isValid)try{let t=this.selectedAddressId;this.isNewAddress&&(t=await this.saveNewAddress());const e={...this.shippingDetails,addressId:t};this.$emit("next-step",e)}catch(t){const e=t.message||this.$t("checkout.errorSavingAddress");this.$toast.error(e)}},toggle(){this.isOpen=!this.isOpen},selectOption(t){this.selectedValue=t.value,this.$emit("update:modelValue",t.value),this.isOpen=!1}},mounted(){this.fetchSavedAddresses()}},he={class:"checkout-step"},me={class:"address-type-selector"},ge={key:0,class:"saved-addresses"},ye={class:"address-list"},ve=["onClick"],_e={class:"address-info"},fe={key:0,class:"primary-badge"},be={class:"address-actions"},Se={class:"form-group"},ke={for:"country"},Ie={class:"form-group"},we={for:"city"},Ce={class:"form-group"},Ae={for:"buildingName"},$e={class:"form-group"},De={for:"floorNumber"},Pe={class:"form-group"},Ee={for:"apartmentNumber"},Ne={class:"form-group"},Me={for:"landmark"},qe={class:"form-group"},Le={for:"postalCode"},Re={class:"button-group"},Te=["disabled"];function Be(t,e,a,d,r,i){return c(),p("div",he,[s("h2",null,l(t.$t("checkout.shippingDetails")),1),s("div",me,[s("button",{class:h(["type-btn",{active:!r.isNewAddress}]),onClick:e[0]||(e[0]=o=>r.isNewAddress=!1)},l(t.$t("checkout.selectExistingAddress")),3),s("button",{class:h(["type-btn",{active:r.isNewAddress}]),onClick:e[1]||(e[1]=o=>r.isNewAddress=!0)},l(t.$t("checkout.createNewAddress")),3)]),!r.isNewAddress&&r.savedAddresses.length?(c(),p("div",ge,[s("h3",null,l(t.$t("checkout.savedAddresses")),1),s("div",ye,[(c(!0),p($,null,P(r.savedAddresses,o=>(c(),p("div",{key:o.id,class:h(["address-card",{selected:r.selectedAddressId===o.id}]),onClick:n=>i.selectAddress(o)},[s("div",_e,[s("p",null,[s("strong",null,l(o.building_name),1)]),s("p",null,l(o.landmark),1),s("p",null,"Floor "+l(o.floor_number)+", Apartment "+l(o.apartment_number),1),s("p",null,"Postal Code: "+l(o.postal_code),1),o.is_primary?(c(),p("p",fe,l(t.$t("checkout.primaryAddress")),1)):_("",!0)]),s("div",be,[s("button",{class:h(["btn-select",{selected:r.selectedAddressId===o.id}])},l(r.selectedAddressId===o.id?t.$t("checkout.selected"):t.$t("checkout.select")),3)])],10,ve))),128))])])):_("",!0),r.isNewAddress?(c(),p("form",{key:1,onSubmit:e[9]||(e[9]=U((...o)=>i.handleSubmit&&i.handleSubmit(...o),["prevent"])),class:"shipping-form"},[s("div",Se,[s("label",ke,l(t.$t("checkout.country")),1),y(s("select",{id:"country","onUpdate:modelValue":e[2]||(e[2]=o=>i.shippingDetails.countryId=o),required:""},e[12]||(e[12]=[N('<option value="1" data-v-8824172d>United Arab Emirates</option><option value="2" data-v-8824172d>Saudi Arabia</option><option value="3" data-v-8824172d>Kuwait</option><option value="4" data-v-8824172d>Qatar</option><option value="5" data-v-8824172d>Bahrain</option><option value="6" data-v-8824172d>Oman</option>',6)]),512),[[E,i.shippingDetails.countryId]])]),s("div",Ie,[s("label",we,l(t.$t("checkout.city")),1),y(s("select",{id:"city",class:"form-select","aria-label":"Default select example","onUpdate:modelValue":e[3]||(e[3]=o=>i.shippingDetails.cityId=o),required:""},e[13]||(e[13]=[N('<option value="1" class="option" data-v-8824172d>Dubai</option><option value="2" class="option" data-v-8824172d>Abu Dhabi</option><option value="3" class="option" data-v-8824172d>Sharjah</option><option value="4" class="option" data-v-8824172d>Ajman</option><option value="5" class="option" data-v-8824172d>Ras Al Khaimah</option><option value="6" class="option" data-v-8824172d>Umm Al Quwain</option><option value="7" class="option" data-v-8824172d>Fujairah</option>',7)]),512),[[E,i.shippingDetails.cityId]])]),s("div",Ce,[s("label",Ae,l(t.$t("checkout.buildingName")),1),y(s("input",{type:"text",id:"buildingName","onUpdate:modelValue":e[4]||(e[4]=o=>i.shippingDetails.buildingName=o),required:""},null,512),[[f,i.shippingDetails.buildingName]])]),s("div",$e,[s("label",De,l(t.$t("checkout.floorNumber")),1),y(s("input",{type:"text",id:"floorNumber","onUpdate:modelValue":e[5]||(e[5]=o=>i.shippingDetails.floorNumber=o),required:""},null,512),[[f,i.shippingDetails.floorNumber]])]),s("div",Pe,[s("label",Ee,l(t.$t("checkout.apartmentNumber")),1),y(s("input",{type:"text",id:"apartmentNumber","onUpdate:modelValue":e[6]||(e[6]=o=>i.shippingDetails.apartmentNumber=o),required:""},null,512),[[f,i.shippingDetails.apartmentNumber]])]),s("div",Ne,[s("label",Me,l(t.$t("checkout.landmark")),1),y(s("input",{type:"text",id:"landmark","onUpdate:modelValue":e[7]||(e[7]=o=>i.shippingDetails.landmark=o),required:""},null,512),[[f,i.shippingDetails.landmark]])]),s("div",qe,[s("label",Le,l(t.$t("checkout.postalCode")),1),y(s("input",{type:"text",id:"postalCode","onUpdate:modelValue":e[8]||(e[8]=o=>i.shippingDetails.postalCode=o),required:""},null,512),[[f,i.shippingDetails.postalCode]])])],32)):_("",!0),s("div",Re,[s("button",{type:"button",class:"btn-secondary",onClick:e[10]||(e[10]=o=>t.$emit("previous-step"))},l(t.$t("checkout.back")),1),s("button",{type:"button",class:"btn-primary",onClick:e[11]||(e[11]=(...o)=>i.handleSubmit&&i.handleSubmit(...o)),disabled:!i.isValid},l(t.$t("checkout.continueToPayment")),9,Te)])])}const Oe=k(pe,[["render",Be],["__scopeId","data-v-8824172d"]]);var L="basil",Ge=function(e){return e===3?"v3":e},R="https://js.stripe.com",Ue="".concat(R,"/").concat(L,"/stripe.js"),Ve=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,je=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,M="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",Fe=function(e){return Ve.test(e)||je.test(e)},We=function(){for(var e=document.querySelectorAll('script[src^="'.concat(R,'"]')),a=0;a<e.length;a++){var d=e[a];if(Fe(d.src))return d}return null},q=function(e){var a=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",d=document.createElement("script");d.src="".concat(Ue).concat(a);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(d),d},Qe=function(e,a){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.3.1",startTime:a})},b=null,w=null,C=null,Ze=function(e){return function(a){e(new Error("Failed to load Stripe.js",{cause:a}))}},ze=function(e,a){return function(){window.Stripe?e(window.Stripe):a(new Error("Stripe.js not available"))}},Je=function(e){return b!==null?b:(b=new Promise(function(a,d){if(typeof window>"u"||typeof document>"u"){a(null);return}if(window.Stripe&&e&&console.warn(M),window.Stripe){a(window.Stripe);return}try{var r=We();if(r&&e)console.warn(M);else if(!r)r=q(e);else if(r&&C!==null&&w!==null){var i;r.removeEventListener("load",C),r.removeEventListener("error",w),(i=r.parentNode)===null||i===void 0||i.removeChild(r),r=q(e)}C=ze(a,d),w=Ze(d),r.addEventListener("load",C),r.addEventListener("error",w)}catch(o){d(o);return}}),b.catch(function(a){return b=null,Promise.reject(a)}))},Ke=function(e,a,d){if(e===null)return null;var r=a[0],i=r.match(/^pk_test/),o=Ge(e.version),n=L;i&&o!==n&&console.warn("Stripe.js@".concat(o," was loaded on the page, but @stripe/stripe-js@").concat("7.3.1"," expected Stripe.js@").concat(n,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var u=e.apply(void 0,a);return Qe(u,d),u},S,T=!1,B=function(){return S||(S=Je(null).catch(function(e){return S=null,Promise.reject(e)}),S)};Promise.resolve().then(function(){return B()}).catch(function(t){T||console.warn(t)});var xe=function(){for(var e=arguments.length,a=new Array(e),d=0;d<e;d++)a[d]=arguments[d];T=!0;var r=Date.now();return B().then(function(i){return Ke(i,a,r)})};const He={name:"PaymentStep",props:{cartItems:{type:Array,required:!0},shippingDetails:{type:Object,required:!0},total:{type:Number,required:!0},currency:{type:String,required:!0}},data(){return{selectedPaymentMethod:null,paymentMethods:[{id:1,name:"Stripe",icon:"credit-card"},{id:2,name:"Tabby",icon:"credit-card-alt"},{id:3,name:"Cash on Delivery",icon:"money-bill"}],loading:!1,stripePromise:null,stripeClientSecret:null,stripeElements:null,cardElement:null}},created(){this.stripePromise=xe("pk_test_51MWOtgGtTsebDkQwsne9XO59N9J9PJvoAMa1dr01kQyDSMptnsh5FiWXOPF6HLexmIoasGQYtAsueIP2Xl6oaL3a00p8Yuhir3")},watch:{selectedPaymentMethod(t){t===1&&this.$nextTick(()=>{this.initStripeElements()})}},methods:{selectPaymentMethod(t){this.selectedPaymentMethod=t},async initStripeElements(){if(!document.getElementById("card-element"))return;const t=await this.stripePromise;this.stripeElements=t.elements();const e=this.stripeElements.create("card",{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}});e.mount("#card-element"),e.on("change",a=>{const d=document.getElementById("card-errors");a.error?d.textContent=a.error.message:d.textContent=""}),this.cardElement=e},async placeOrder(){var t,e,a,d;try{if(this.loading=!0,!this.shippingDetails.addressId){this.$toast.error("The address id field is required."),this.loading=!1;return}let r;try{const n=localStorage.getItem("auth_user");if(n){const u=JSON.parse(n);r=u==null?void 0:u.id}}catch(n){console.error("Error parsing auth_user:",n),this.$toast.error("Error getting user information"),this.loading=!1;return}if(!r){this.$toast.error("User authentication required"),this.loading=!1;return}const i=this.cartItems.reduce((n,u)=>n+u.price*u.quantity,0);if(!Array.isArray(this.cartItems)||this.cartItems.length===0){this.$toast.error("No items in cart"),this.loading=!1;return}const o={user_id:r,order:{status:"pending",payment_method:this.selectedPaymentMethod===1?"stripe":this.selectedPaymentMethod===2?"tabby":"cash",shipping_address:this.shippingDetails.address||"",address_id:this.shippingDetails.addressId,items:this.cartItems.map(n=>{var u,I;return{product_id:(u=n.product)==null?void 0:u.id,product_name:((I=n.product)==null?void 0:I.name)||"",quantity:parseInt(n.quantity)||0,price:parseFloat(n.price)||0,subtotal:(parseFloat(n.price)||0)*(parseInt(n.quantity)||0),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}}).filter(n=>n.product_id&&n.quantity>0),total_price:i,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}};if(!o.order.items.length){this.$toast.error("Invalid order items"),this.loading=!1;return}if(this.selectedPaymentMethod===1){const n=await g.post(`${m}/api/payment/process`,{...o,amount:i,currency:this.currency,payment_method:"stripe"},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(n.data.success&&n.data.url){console.log("Stripe redirect URL:",n.data.url),window.location.href=n.data.url;return}else throw new Error(n.data.error||this.$t("checkout.errorCreatingPaymentSession"))}else if(this.selectedPaymentMethod===2){const n=await g.post(`${m}/api/payment/tabby/create-session`,{...o,amount:i},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(n.data.success)this.$toast.success(this.$t("checkout.redirectingToTabby")),window.location.href=n.data.redirectUrl;else throw new Error(this.$t("checkout.errorCreatingPaymentSession"))}else if(this.selectedPaymentMethod===3){const n=await g.post(`${m}/api/orders`,o,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(n.data.success)this.$toast.success(this.$t("checkout.orderPlacedSuccessfully")),window.location.href="/orders/user";else throw new Error(n.data.error||this.$t("checkout.errorPlacingOrder"))}}catch(r){console.error("Error placing order:",r);let i=this.$t("checkout.errorPlacingOrder");r&&((e=(t=r.response)==null?void 0:t.data)!=null&&e.error?i=r.response.data.error:(d=(a=r.response)==null?void 0:a.data)!=null&&d.message?i=r.response.data.message:r.message&&(i=r.message)),this.$toast.error(i)}finally{this.loading=!1}},async createOrder(){if(!this.shippingDetails.addressId){this.$toast.error("The address id field is required.");return}const t=this.cartItems.reduce((d,r)=>d+r.price*r.quantity,0),e=this.selectedPaymentMethod===3?"cod":String(this.selectedPaymentMethod),a={shipping_details:this.shippingDetails,address_id:this.shippingDetails.addressId,payment_method:e,items:this.cartItems.map(d=>({product_id:d.product.id,quantity:d.quantity,price:d.price,subtotal:d.price*d.quantity})),total_price:t};try{const d=await g.post(`${m}/api/orders`,a,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(d.data.success)this.$toast.success(this.$t("checkout.orderPlacedSuccessfully")),window.location.href="/orders/user";else throw new Error(d.data.error||this.$t("checkout.errorPlacingOrder"))}catch(d){console.error(d);let r=this.$t("checkout.errorPlacingOrder");d.response&&d.response.data&&d.response.data.error?r=d.response.data.error:d.message&&(r=d.message),this.$toast.error(r)}},getCountryCode(t){const e={"United States":"US","United Kingdom":"GB",Egypt:"EG","Saudi Arabia":"SA","United Arab Emirates":"AE",Kuwait:"KW",Qatar:"QA",Bahrain:"BH",Oman:"OM",Jordan:"JO",Lebanon:"LB",Iraq:"IQ",Syria:"SY",Yemen:"YE",Libya:"LY",Sudan:"SD",Morocco:"MA",Algeria:"DZ",Tunisia:"TN",Palestine:"PS",Israel:"IL",Turkey:"TR",Iran:"IR",Pakistan:"PK",India:"IN",China:"CN",Japan:"JP","South Korea":"KR",Singapore:"SG",Malaysia:"MY",Indonesia:"ID",Australia:"AU","New Zealand":"NZ",Canada:"CA",Mexico:"MX",Brazil:"BR",Argentina:"AR","South Africa":"ZA",Nigeria:"NG",Kenya:"KE",Ghana:"GH",Ethiopia:"ET",Tanzania:"TZ",Uganda:"UG",Rwanda:"RW",Senegal:"SN","Côte d'Ivoire":"CI",Cameroon:"CM",Angola:"AO",Mozambique:"MZ",Madagascar:"MG",Mauritius:"MU",Seychelles:"SC",Comoros:"KM",Djibouti:"DJ",Eritrea:"ER",Somalia:"SO","South Sudan":"SS",Chad:"TD",Niger:"NE",Mali:"ML","Burkina Faso":"BF",Benin:"BJ",Togo:"TG",Guinea:"GN","Guinea-Bissau":"GW","Sierra Leone":"SL",Liberia:"LR","Cape Verde":"CV","São Tomé and Príncipe":"ST","Equatorial Guinea":"GQ",Gabon:"GA","Republic of the Congo":"CG","Democratic Republic of the Congo":"CD","Central African Republic":"CF",Burundi:"BI",Zambia:"ZM",Zimbabwe:"ZW",Malawi:"MW",Namibia:"NA",Botswana:"BW",Lesotho:"LS",Eswatini:"SZ",Mauritania:"MR","Western Sahara":"EH","The Gambia":"GM","Guinea-Bissau":"GW","Sierra Leone":"SL",Liberia:"LR","Cape Verde":"CV","São Tomé and Príncipe":"ST","Equatorial Guinea":"GQ",Gabon:"GA","Republic of the Congo":"CG","Democratic Republic of the Congo":"CD","Central African Republic":"CF",Burundi:"BI",Zambia:"ZM",Zimbabwe:"ZW",Malawi:"MW",Namibia:"NA",Botswana:"BW",Lesotho:"LS",Eswatini:"SZ",Mauritania:"MR","Western Sahara":"EH","The Gambia":"GM"};if(/^[A-Z]{2}$/.test(t))return t;const a=e[t];return a||null}}},Xe={class:"checkout-step"},Ye={class:"payment-methods"},et=["onClick"],tt={key:0,class:"stripe-container"},st={class:"order-summary"},rt={class:"summary-details"},at={class:"total-amount"},it={class:"button-group"},nt=["disabled"],ot={key:0},dt={key:1};function lt(t,e,a,d,r,i){const o=v("fa");return c(),p("div",Xe,[s("h2",null,l(t.$t("checkout.payment")),1),s("div",Ye,[(c(!0),p($,null,P(r.paymentMethods,n=>(c(),p("div",{key:n.id,class:h(["payment-method",{active:r.selectedPaymentMethod===n.id}]),onClick:u=>i.selectPaymentMethod(n.id)},[A(o,{icon:n.icon},null,8,["icon"]),s("span",null,l(n.name),1)],10,et))),128))]),r.selectedPaymentMethod===1?(c(),p("div",tt,e[2]||(e[2]=[s("div",{class:"card-element-container"},[s("div",{id:"card-element",class:"card-element"}),s("div",{id:"card-errors",class:"card-errors",role:"alert"})],-1)]))):_("",!0),s("div",st,[s("h3",null,l(t.$t("checkout.orderSummary")),1),s("div",rt,[s("p",null,l(a.cartItems.length)+" "+l(t.$t("checkout.items")),1),s("p",null,l(t.$t("checkout.deliveryTo"))+": "+l(a.shippingDetails.city),1),s("div",at,l(t.$t("checkout.totalAmount"))+": "+l(a.total)+" "+l(a.currency),1)])]),s("div",it,[s("button",{class:"btn-secondary",onClick:e[0]||(e[0]=n=>t.$emit("previous-step"))},l(t.$t("checkout.back")),1),s("button",{class:"btn-primary",onClick:e[1]||(e[1]=(...n)=>i.placeOrder&&i.placeOrder(...n)),disabled:!r.selectedPaymentMethod||r.loading},[r.loading?(c(),p("span",ot,l(t.$t("checkout.processing"))+"...",1)):(c(),p("span",dt,l(t.$t("checkout.placeOrder")),1))],8,nt)])])}const ct=k(He,[["render",lt],["__scopeId","data-v-a04757ab"]]);const ut={name:"Checkout",components:{Header:V,CheckoutStepper:J,CartReview:ue,ShippingDetails:Oe,PaymentStep:ct},data(){return{step:1,cartItems:[],shippingDetails:{fullName:"",address:"",city:"",postalCode:"",phone:"",buildingName:"",floorNumber:"",apartmentNumber:"",landmark:"",street:"",country:""},shippingCost:10}},computed:{currentLang(){return localStorage.getItem("lang")||"en"},currency(){if(this.cartItems.length>0){if(this.cartItems[0].currency.code)return this.cartItems[0].currency.code.toLowerCase();const t=(this.currentLang==="ar"?this.cartItems[0].currency.name_ar:this.cartItems[0].currency.name_en).toLowerCase();return{"us dollar":"usd",usd:"usd","british pound":"gbp",gbp:"gbp",euro:"eur",eur:"eur","درهم إماراتي":"aed",aed:"aed","جنيه مصري":"egp",egp:"egp"}[t]||"usd"}return"usd"},total(){return(this.cartItems.reduce((e,a)=>e+parseFloat(a.price)*a.quantity,0)+this.shippingCost).toFixed(2)}},created(){this.fetchCartItems()},methods:{async fetchCartItems(){try{const t=await g.get(`${m}/api/cart-items`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.cartItems=t.data.data.original.data}catch(t){console.error("Error fetching cart items:",t),this.$toast.error(this.$t("checkout.errorFetchingCart"))}},updateCart(t){this.cartItems=t},nextStep(){this.step<3&&this.step++},previousStep(){this.step>1&&this.step--},async handleOrderPlaced(){const t={payment_method:this.cartItems[0].payment_method||"paypal",user_id:localStorage.getItem("user_id"),order:{status:"pending",payment_method:this.selectedPaymentMethod===1?"stripe":"cash",shipping_address:`${this.shippingDetails.street}, ${this.shippingDetails.city}, ${this.shippingDetails.country}`},items:this.cartItems.map(e=>({product_id:e.product_id,product_name:e.product_name,quantity:e.quantity,price:e.price}))};try{const e=await g.post(`${m}/api/orders`,t,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});this.$router.push("/order-confirmation")}catch(e){console.error("Error placing order:",e),this.$toast.error(this.$t("checkout.errorPlacingOrder"))}}}},pt={class:"checkout-container"};function ht(t,e,a,d,r,i){const o=v("Header"),n=v("CheckoutStepper"),u=v("CartReview"),I=v("ShippingDetails"),O=v("PaymentStep");return c(),p($,null,[A(o),s("div",pt,[A(n,{step:r.step},null,8,["step"]),r.step===1?(c(),D(u,{key:0,"cart-items":r.cartItems,"shipping-cost":r.shippingCost,onNextStep:i.nextStep,onUpdateCart:i.updateCart},null,8,["cart-items","shipping-cost","onNextStep","onUpdateCart"])):_("",!0),r.step===2?(c(),D(I,{key:1,modelValue:r.shippingDetails,"onUpdate:modelValue":e[0]||(e[0]=G=>r.shippingDetails=G),onNextStep:i.nextStep,onPreviousStep:i.previousStep},null,8,["modelValue","onNextStep","onPreviousStep"])):_("",!0),r.step===3?(c(),D(O,{key:2,"cart-items":r.cartItems,"shipping-details":r.shippingDetails,total:i.total,currency:i.currency,onPreviousStep:i.previousStep,onOrderPlaced:i.handleOrderPlaced},null,8,["cart-items","shipping-details","total","currency","onPreviousStep","onOrderPlaced"])):_("",!0)])],64)}const gt=k(ut,[["render",ht],["__scopeId","data-v-5b017879"]]);export{gt as default};

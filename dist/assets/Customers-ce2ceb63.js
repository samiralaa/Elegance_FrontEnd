import{_ as M,b as z,u as C,O as J,r as n,o as _,c as P,a as w,e as t,l as r,j as q,f as B,X as O,Y as W,Z as X,$ as Y,P as Z,J as G,a0 as H,z as K,m as U,w as Q,F as x,d as ee,t as A,U as b,a1 as te}from"./index-23e6863a.js";const v=z.create({baseURL:"http://elegance_backend.test/api",headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!1}),T=C([]);v.interceptors.request.use(e=>{const o=JSON.parse(localStorage.getItem("tokenData"));return o!=null&&o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e},e=>Promise.reject(e));v.interceptors.response.use(e=>e,e=>{var o;return((o=e.response)==null?void 0:o.status)===401&&(localStorage.removeItem("tokenData"),window.location.href="/login"),Promise.reject(e)});const oe=J({name:"CustomersView",components:{Refresh:O,Edit:W,Delete:X,Plus:Y},setup(){const e=Z(),o=G(),V=C(null),k=C(!1),F=C([]),y=C(!1),h=C(null),d=H({name:"",email:"",phone:"",role:"user",country_id:"",password:"",password_confirmation:""}),g=async()=>{try{const a=await v.get("/countries");T.value=a.data.data}catch(a){console.error("Failed to load countries:",a)}},R={name:[{required:!0,message:"Please enter name",trigger:"blur"},{min:3,message:"Name must be at least 3 characters",trigger:"blur"}],email:[{required:!0,message:"Please enter email",trigger:"blur"},{type:"email",message:"Please enter valid email",trigger:"blur"}],phone:[{required:!0,message:"Please enter phone number",trigger:"blur"},{pattern:/^[0-9+\-\s()]*$/,message:"Please enter a valid phone number",trigger:"blur"}],role:[{required:!0,message:"Please select role",trigger:"change"}],country_id:[{required:!0,message:"Please select country",trigger:"change"}],password:[{required:!0,message:"Please enter password",trigger:"blur"},{min:6,message:"Password must be at least 6 characters",trigger:"blur"}],password_confirmation:[{required:!0,message:"Please confirm password",trigger:"blur"},{validator:(a,u,l)=>{u!==d.password?l(new Error("Passwords do not match")):l()},trigger:"blur"}]},S=a=>({admin:"danger",manager:"warning",user:"success"})[a]||"info",f=()=>{k.value=!0,d.name="",d.email="",d.phone="",d.role="user",d.country_id="",d.password="",d.password_confirmation=""},c=async()=>{var a,u;if(V.value)try{await V.value.validate(),y.value=!0;const l=await v.post("/users",d);if(l.data.status)b({message:"User created successfully",type:"success",duration:2e3}),k.value=!1,p();else throw new Error(l.data.message||"Failed to create user")}catch(l){console.error("Error creating user:",l),b({message:((u=(a=l.response)==null?void 0:a.data)==null?void 0:u.message)||"Failed to create user",type:"error",duration:5e3})}finally{y.value=!1}},p=async()=>{var a,u,l,i,D;try{y.value=!0,h.value=null;const m=JSON.parse(localStorage.getItem("tokenData"));if(console.log("Token data:",m),!(m!=null&&m.token)){console.error("No token found"),o.push("/login");return}console.log("Fetching customers with token:",m.token),await e.dispatch("fetchCustomers"),F.value=e.getters.getCustomers,console.log("Customers loaded from store:",F.value)}catch(m){console.error("Error loading customers:",m),console.error("Error details:",{message:m.message,response:(a=m.response)==null?void 0:a.data,status:(u=m.response)==null?void 0:u.status}),h.value=((i=(l=m.response)==null?void 0:l.data)==null?void 0:i.message)||m.message||"Failed to load customers",((D=m.response)==null?void 0:D.status)===401&&(localStorage.removeItem("tokenData"),o.push("/login"))}finally{y.value=!1}},E=async a=>{var u,l;try{const i=await v.put(`/users/${a.id}`,a);if(i.data.status)b({message:"User updated successfully",type:"success",duration:2e3}),p();else throw new Error(i.data.message||"Failed to update user")}catch(i){console.error("Error updating user:",i),b({message:((l=(u=i.response)==null?void 0:u.data)==null?void 0:l.message)||"Failed to update user",type:"error",duration:5e3})}},N=async a=>{var u,l;try{await te.confirm(`Are you sure you want to delete user ${a.name}?`,"Warning",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"});const i=await v.delete(`/users/${a.id}`);if(i.data.status)b({message:"User deleted successfully",type:"success",duration:2e3}),p();else throw new Error(i.data.message||"Failed to delete user")}catch(i){i!=="cancel"&&(console.error("Error deleting user:",i),b({message:((l=(u=i.response)==null?void 0:u.data)==null?void 0:l.message)||"Failed to delete user",type:"error",duration:5e3}))}},$=a=>a?new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",L=()=>{h.value=null};return K(()=>{p(),g()}),{usersList:F,isLoading:y,error:h,loadCustomers:p,handleEdit:E,handleDelete:N,formatDate:$,clearError:L,createDialogVisible:k,createForm:d,createRules:R,createFormRef:V,showCreateDialog:f,handleCreate:c,getRoleType:S,countries:T}}}),ae={class:"page-container"},re={class:"page-header"},se={class:"button-group"},le={class:"form-footer"},ne={key:1,class:"card"},ie={key:2,class:"table-container"},ue={class:"button-group"};function de(e,o,V,k,F,y){const h=n("Plus"),d=n("el-icon"),g=n("el-button"),R=n("Refresh"),S=n("el-alert"),f=n("el-input"),c=n("el-form-item"),p=n("el-option"),E=n("el-select"),N=n("el-form"),$=n("el-dialog"),L=n("el-skeleton"),a=n("el-table-column"),u=n("el-tag"),l=n("Edit"),i=n("el-tooltip"),D=n("Delete"),m=n("el-table"),j=n("el-empty");return _(),P("div",ae,[w("div",re,[o[11]||(o[11]=w("h2",{class:"page-title"},"customers",-1)),w("div",se,[t(g,{type:"success",class:"action-button",onClick:e.showCreateDialog},{default:r(()=>[t(d,null,{default:r(()=>[t(h)]),_:1}),o[9]||(o[9]=w("span",null,"Create User",-1))]),_:1,__:[9]},8,["onClick"]),t(g,{type:"primary",class:"action-button",onClick:e.loadCustomers},{default:r(()=>[t(d,null,{default:r(()=>[t(R)]),_:1}),o[10]||(o[10]=w("span",null,"Refresh",-1))]),_:1,__:[10]},8,["onClick"])])]),e.error?(_(),q(S,{key:0,title:e.error,type:"error","show-icon":"",onClose:e.clearError,class:"mb-md"},null,8,["title","onClose"])):B("",!0),t($,{modelValue:e.createDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=s=>e.createDialogVisible=s),title:"Create New User",width:"500px"},{footer:r(()=>[w("div",le,[t(g,{onClick:o[7]||(o[7]=s=>e.createDialogVisible=!1)},{default:r(()=>o[12]||(o[12]=[U("Cancel")])),_:1,__:[12]}),t(g,{type:"primary",loading:e.isLoading,onClick:e.handleCreate},{default:r(()=>o[13]||(o[13]=[U(" Create ")])),_:1,__:[13]},8,["loading","onClick"])])]),default:r(()=>[t(N,{ref:"createFormRef",model:e.createForm,rules:e.createRules,"label-width":"120px",class:"form-container",onSubmit:Q(e.handleCreate,["prevent"])},{default:r(()=>[t(c,{label:"Name",prop:"name"},{default:r(()=>[t(f,{modelValue:e.createForm.name,"onUpdate:modelValue":o[0]||(o[0]=s=>e.createForm.name=s),placeholder:"Enter name"},null,8,["modelValue"])]),_:1}),t(c,{label:"Email",prop:"email"},{default:r(()=>[t(f,{modelValue:e.createForm.email,"onUpdate:modelValue":o[1]||(o[1]=s=>e.createForm.email=s),placeholder:"Enter email"},null,8,["modelValue"])]),_:1}),t(c,{label:"Phone",prop:"phone"},{default:r(()=>[t(f,{modelValue:e.createForm.phone,"onUpdate:modelValue":o[2]||(o[2]=s=>e.createForm.phone=s),placeholder:"Enter phone number"},null,8,["modelValue"])]),_:1}),t(c,{label:"Role",prop:"role"},{default:r(()=>[t(E,{modelValue:e.createForm.role,"onUpdate:modelValue":o[3]||(o[3]=s=>e.createForm.role=s),placeholder:"Select role"},{default:r(()=>[t(p,{label:"Admin",value:"admin"}),t(p,{label:"User",value:"user"}),t(p,{label:"Manager",value:"manager"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"Country",prop:"country_id"},{default:r(()=>[t(E,{modelValue:e.createForm.country_id,"onUpdate:modelValue":o[4]||(o[4]=s=>e.createForm.country_id=s),placeholder:"Select country"},{default:r(()=>[(_(!0),P(x,null,ee(e.countries,s=>(_(),q(p,{key:s.id,label:s.name_en,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"Password",prop:"password"},{default:r(()=>[t(f,{modelValue:e.createForm.password,"onUpdate:modelValue":o[5]||(o[5]=s=>e.createForm.password=s),type:"password",placeholder:"Enter password","show-password":""},null,8,["modelValue"])]),_:1}),t(c,{label:"Confirm",prop:"password_confirmation"},{default:r(()=>[t(f,{modelValue:e.createForm.password_confirmation,"onUpdate:modelValue":o[6]||(o[6]=s=>e.createForm.password_confirmation=s),type:"password",placeholder:"Confirm password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","onSubmit"])]),_:1},8,["modelValue"]),e.isLoading?(_(),P("div",ne,[t(L,{rows:5,animated:""})])):(_(),P("div",ie,[t(m,{data:e.usersList,style:{width:"100%"},border:!0},{default:r(()=>[t(a,{prop:"id",label:"ID",width:"80"}),t(a,{prop:"name",label:"Name","min-width":"120"}),t(a,{prop:"email",label:"Email","min-width":"180"}),t(a,{prop:"phone",label:"Phone","min-width":"120"}),t(a,{prop:"role",label:"Role",width:"120"},{default:r(s=>[t(u,{type:e.getRoleType(s.row.role),class:"status-tag"},{default:r(()=>[U(A(s.row.role),1)]),_:2},1032,["type"])]),_:1}),t(a,{prop:"created_at",label:"Created At",width:"150"},{default:r(s=>[U(A(e.formatDate(s.row.created_at)),1)]),_:1}),t(a,{label:"Actions",width:"150",fixed:"right"},{default:r(s=>[w("div",ue,[t(i,{content:"Edit User",placement:"top"},{default:r(()=>[t(g,{type:"primary",size:"small",class:"action-button",onClick:I=>e.handleEdit(s.row)},{default:r(()=>[t(d,null,{default:r(()=>[t(l)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(i,{content:"Delete User",placement:"top"},{default:r(()=>[t(g,{type:"danger",size:"small",class:"action-button",onClick:I=>e.handleDelete(s.row)},{default:r(()=>[t(d,null,{default:r(()=>[t(D)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"]),!e.isLoading&&e.usersList.length===0?(_(),q(j,{key:0,description:"No users found"})):B("",!0)]))])}const pe=M(oe,[["render",de]]);export{pe as default};

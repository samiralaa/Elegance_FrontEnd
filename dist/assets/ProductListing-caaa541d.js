import{_ as Z,B as ee,L as C,x as m,y as te,z as se,D as ae,N as A,r as U,o as d,c as u,e as f,a,t as r,g as oe,E as F,F as P,d as q,w as h,v as k,l as M,f as y,b as S,H as ie,af as ne,p as B,n as re,k as ce,G as v}from"./index-96ee7cbc.js";const le={class:"axil-breadcrumb-area mt-5"},de={class:"container"},ue={class:"row align-items-center"},me={class:"col-lg-6 col-md-8"},ve={class:"inner"},_e={class:"title"},ge=["dir"],pe={class:"container"},fe={class:"filter col-12"},he={class:"sidebar"},ye={class:"sidebar-container"},be={class:"sidebar-title"},xe={class:"checkbox-container"},ke=["value"],we={class:"sidebar-title"},Ce={class:"price-range"},Fe=["min","max"],Pe=["min","max"],Se={class:"price-values"},Le={class:"d-flex gap-2 align-items-center"},Ve=["min","max"],De=["min"],Ee={class:"products-grid"},Ie={class:"image-container mb-3 bg-light rounded"},$e=["src","alt"],Ne={key:0,class:"sale-badge"},Te={class:"product-actions d-flex justify-content-center gap-5 w-100"},ze=["onClick","title"],Ae={class:"card-body"},Ue={class:"card-title"},qe={class:"price-container"},Me={key:0,class:"discount-badge"},Be={key:1,class:"price-old"},Ke={class:"card-text card-price"},Oe=["disabled","onClick"],Re={__name:"ProductListing",setup(He){const{locale:L,t:l}=ee(),K=C(()=>L.value==="ar"?"rtl":"ltr"),V=m([]),D=m([]);m(!1),m("");const _=m([]),n=m({min:0,max:2e3}),c={min:0,max:2e3},g=m(!1),b=te(),E=se(),I=C(()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"}),O=(e,s,i)=>{const o={AED:1,USD:.2724795640326976};return s===i?parseFloat(e):o[i]?parseFloat((e*o[i]).toFixed(2)):parseFloat(e)},w=()=>{g.value=!g.value;const e=document.querySelector(".sidebar"),s=document.body;e&&(e.classList.toggle("active",g.value),e.classList.contains("active")?s.classList.add("no-scroll"):s.classList.remove("no-scroll"))},R=e=>`https://backend.webenia.org/public/storage/${e}`,x=e=>b.favorites.some(s=>s.product_id===e),H=e=>{const s=b.favorites.find(i=>i.product_id===e);return s?s.favorite_id||s.id:null},j=async e=>{var s,i;try{if(x(e.id)){const o=H(e.id);o&&(await b.removeFromFavorites(o),v({title:l("success"),message:l("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const o=await b.addToFavorites(e.id);v({title:l("success"),message:o.message||l("favorite_added")||"Product added to favorites",type:"success"})}}catch(o){console.error("Favorite error:",o),v({title:l("error"),message:((i=(s=o.response)==null?void 0:s.data)==null?void 0:i.message)||l("login_required_favorite")||"Login required to favorite product",type:"error"})}},G=async()=>{try{const e=await S.get("https://backend.webenia.org/api/website");V.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},$=async()=>{try{const e=await S.get("https://backend.webenia.org/api/all/products");D.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},J=async e=>{var s,i;try{let o=0;if(e.discount&&e.discount.is_active){const p=parseFloat(e.discount.discount_value),z=parseFloat(e.converted_price||e.price);o=z-z*(p/100)}else o=parseFloat(e.converted_price||e.price);const t=await S.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:o},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});t.data.status?(v({title:l("success"),message:t.data.message,type:"success"}),E.incrementCount(),await E.fetchCartCount()):v({title:l("error"),message:t.data.message,type:"error"})}catch(o){console.error("Error adding to cart:",o),v({title:l("error"),message:(i=(s=o.response)==null?void 0:s.data)==null?void 0:i.message,type:"error"})}};ae(()=>{G(),$(),window.addEventListener("currency-changed",()=>{$(),W()})});const Q=C(()=>D.value.filter(e=>{const s=_.value.length===0||_.value.includes(e.category_id),i=n.value.min===c.min&&n.value.max===c.max,o=O(e.converted_price,e.currency_code||"AED",I.value),t=i?!0:o>=n.value.min&&o<=n.value.max;return s&&t})),W=()=>{_.value=[],n.value.min=c.min,n.value.max=c.max,g.value=!1,document.body.classList.remove("no-scroll")},X=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(s/100)).toFixed(2)}return e.converted_price||e.price},Y=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value);return Math.round(s)}return 0},N=e=>{const s=parseInt(e);return isNaN(s)?c.min:Math.min(s,c.max)},T=e=>{["e","E",".","+","-"].includes(e.key)&&e.preventDefault()};return A(()=>n.value.min,e=>{n.value.min=N(e)}),A(()=>n.value.max,e=>{n.value.max=N(e)}),(e,s)=>{const i=U("router-link"),o=U("fa");return d(),u(P,null,[f(ie),a("div",le,[a("div",de,[a("div",ue,[a("div",me,[a("div",ve,[a("h1",_e,r(e.$t("products.title")),1)])])])])]),a("div",{class:"shop-container",dir:K.value},[a("div",pe,[a("div",fe,[a("a",{href:"#",onClick:oe(w,["prevent"])},r(e.$t("products.filter")),1)]),a("aside",he,[a("div",ye,[a("button",{class:"close-btn",onClick:w},"Ã—"),a("h3",be,r(F(l)("products.categories")),1),s[7]||(s[7]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(d(!0),u(P,null,q(V.value,t=>(d(),u("div",{key:t.id,class:"filter-item"},[a("label",xe,[M(r(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),h(a("input",{type:"checkbox","onUpdate:modelValue":s[0]||(s[0]=p=>_.value=p),value:t.id},null,8,ke),[[ne,_.value]]),s[5]||(s[5]=a("span",{class:"checkmark"},null,-1))])]))),128)),a("h3",we,r(F(l)("products.price")),1),s[8]||(s[8]=a("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),a("div",Ce,[h(a("input",{type:"range","onUpdate:modelValue":s[1]||(s[1]=t=>n.value.min=t),step:"10",min:c.min,max:c.max},null,8,Fe),[[k,n.value.min,void 0,{number:!0}]]),h(a("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=t=>n.value.max=t),step:"10",min:c.min,max:c.max},null,8,Pe),[[k,n.value.max,void 0,{number:!0}]]),a("div",Se,[a("div",Le,[h(a("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>n.value.min=t),step:10,min:c.min,max:c.max,onKeydown:T,class:"form-control qty-number"},null,40,Ve),[[k,n.value.min,void 0,{lazy:!0}]]),s[6]||(s[6]=a("span",null,"-",-1)),h(a("input",{type:"number","onUpdate:modelValue":s[4]||(s[4]=t=>n.value.max=t),step:10,min:c.min,max:2e3,onKeydown:T,class:"form-control qty-number"},null,40,De),[[k,n.value.max,void 0,{lazy:!0}]])]),M(" "+r(I.value.value),1)])])])]),g.value?(d(),u("div",{key:0,class:"overlay",onClick:w})):y("",!0),a("section",Ee,[(d(!0),u(P,null,q(Q.value,t=>(d(),u("div",{key:t.id,class:"product-card"},[a("div",Ie,[f(i,{to:`/read/products/${t.id}`},{default:B(()=>[t.images&&t.images.length?(d(),u("img",{key:0,src:R(t.images[0].path),alt:t.name},null,8,$e)):y("",!0)]),_:2},1032,["to"]),t.is_available?y("",!0):(d(),u("div",Ne,r(e.$t("products.outOfStock")),1)),a("div",Te,[f(i,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:B(()=>[f(o,{icon:"eye"})]),_:2},1032,["to"]),a("button",{onClick:p=>j(t),class:re(["btn rounded-circle shadow-sm btn-light",x(t.id)?"text-danger":""]),title:x(t.id)?"Remove from favorites":"Add to favorites"},[f(o,{icon:x(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,ze)])]),a("div",Ae,[a("h5",Ue,r(F(L)==="ar"?t.name_ar:t.name_en),1),a("div",qe,[t.discount&&t.discount.is_active?(d(),u("span",Me,r(Y(t))+"% OFF ",1)):y("",!0),t.discount&&t.discount.is_active?(d(),u("span",Be,r(t.converted_price)+" "+r(t.currency_code),1)):y("",!0),a("span",Ke,r(X(t))+" "+r(t.currency_code),1)])]),a("div",{class:"addToCart-btn",style:ce(t.is_available?"":"cursor: not-allowed;")},[a("button",{disabled:!t.is_available,onClick:p=>J(t),class:"btn"},r(e.$t("products.addToCart")),9,Oe)],4)]))),128))])])],8,ge)],64)}}},Ge=Z(Re,[["__scopeId","data-v-5f5de3ef"]]);export{Ge as default};

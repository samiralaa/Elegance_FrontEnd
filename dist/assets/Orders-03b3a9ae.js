import{_ as X,u as c,G as $,z as H,r,a2 as K,o as u,c as z,a as O,e as o,l,g as W,j as C,f as E,b as f,U as m,L as g,a8 as Y,F as Z,d as ee,m as i,t as p,a5 as te,a9 as ae,X as oe}from"./index-23e6863a.js";const le={class:"orders-page"},re={class:"orders-header"},se={class:"orders-filters"},v=5,ne={__name:"Orders",setup(ce){const D=c([]),d=c(""),_=c(""),h=c(1),w=c(!1),b=c(null),y=c(!1),F=["completed","pending","processing","cancelled"],L=async()=>{y.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await f.get("http://elegance_backend.test/api/orders");if(t.data.status===!0)D.value=t.data.data;else throw new Error(t.data.message||"Failed to fetch orders")}catch(e){console.error("Error fetching orders:",e),m.error(e.message||"Failed to fetch orders")}finally{y.value=!1}},k=$(()=>D.value.filter(e=>{const t=d.value===""||e.id.toString().includes(d.value.toLowerCase())||e.total_price.includes(d.value.toLowerCase()),s=!_.value||e.status===_.value;return t&&s})),B=$(()=>{const e=(h.value-1)*v,t=e+v;return k.value.slice(e,t)}),N=e=>{h.value=e},A=e=>{b.value=e,w.value=!0},I=e=>{const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},P=e=>({completed:"success",pending:"info",processing:"warning",cancelled:"danger"})[e.toLowerCase()]||"info",T=async e=>{try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");f.defaults.headers.common.Authorization=`Bearer ${t.token}`;const s=await f.put(`http://elegance_backend.test/api/orders/${e.id}/cancel`);if(s.data.status===!0)e.status="cancelled",m.success("Order cancelled successfully");else throw new Error(s.data.message||"Failed to cancel order")}catch(t){console.error("Error cancelling order:",t),m.error(t.message||"Failed to cancel order")}},U=e=>{m.info("Reordered items from order #"+e.id)};return H(()=>{L()}),(e,t)=>{const s=r("el-icon"),M=r("el-input"),J=r("el-option"),Q=r("el-select"),n=r("el-table-column"),j=r("el-tag"),S=r("el-button"),V=r("el-table"),q=r("el-pagination"),G=r("el-dialog"),R=K("loading");return u(),z("div",le,[O("div",re,[t[3]||(t[3]=O("h2",null,"My Orders",-1)),o(M,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),placeholder:"Search orders...",class:"search-input",clearable:""},{prefix:l(()=>[o(s,null,{default:l(()=>[o(g(Y))]),_:1})]),_:1},8,["modelValue"])]),O("div",se,[o(Q,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),placeholder:"Filter by Status",clearable:""},{default:l(()=>[(u(),z(Z,null,ee(F,a=>o(J,{key:a,label:a,value:a},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),W((u(),C(V,{data:B.value,style:{width:"100%"},class:"orders-table",stripe:"",border:""},{default:l(()=>[o(n,{prop:"id",label:"Order ID",width:"120"}),o(n,{prop:"ordered_at",label:"Order Date",width:"180"},{default:l(a=>[i(p(I(a.row.ordered_at)),1)]),_:1}),o(n,{label:"Total",width:"150"},{default:l(a=>[i(" $"+p(a.row.total_price),1)]),_:1}),o(n,{prop:"status",label:"Status",width:"150"},{default:l(a=>[o(j,{type:P(a.row.status)},{default:l(()=>[i(p(a.row.status),1)]),_:2},1032,["type"])]),_:1}),o(n,{label:"Actions",width:"220"},{default:l(a=>[o(S,{size:"small",type:"primary",onClick:x=>A(a.row),circle:""},{default:l(()=>[o(s,null,{default:l(()=>[o(g(te))]),_:1})]),_:2},1032,["onClick"]),o(S,{size:"small",type:"danger",disabled:a.row.status!=="pending"&&a.row.status!=="processing",onClick:x=>T(a.row),circle:""},{default:l(()=>[o(s,null,{default:l(()=>[o(g(ae))]),_:1})]),_:2},1032,["disabled","onClick"]),o(S,{size:"small",type:"success",onClick:x=>U(a.row),circle:""},{default:l(()=>[o(s,null,{default:l(()=>[o(g(oe))]),_:1})]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[R,y.value]]),k.value.length>v?(u(),C(q,{key:0,class:"pagination",layout:"prev, pager, next","current-page":h.value,"page-size":v,total:k.value.length,onCurrentChange:N},null,8,["current-page","total"])):E("",!0),o(G,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=a=>w.value=a),title:"Order Details",width:"600px"},{default:l(()=>[b.value?(u(),C(V,{key:0,data:b.value.items,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[o(n,{prop:"product_id",label:"Product ID"}),o(n,{prop:"quantity",label:"Quantity"}),o(n,{prop:"price",label:"Price"},{default:l(a=>[i(" $"+p(a.row.price),1)]),_:1}),o(n,{prop:"subtotal",label:"Subtotal"},{default:l(a=>[i(" $"+p(a.row.subtotal),1)]),_:1})]),_:1},8,["data"])):E("",!0)]),_:1},8,["modelValue"])])}}},ue=X(ne,[["__scopeId","data-v-9724a79b"]]);export{ue as default};

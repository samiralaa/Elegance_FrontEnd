import{_ as K,C as Q,M as X,x as _,L as Y,D as Z,r as c,o as d,c as g,e as l,m as n,b as p,W as V,a as m,t as f,F as y,d as h,i as k,f as ee,l as ae}from"./index-01aaf835.js";const te={class:"product-edit-container"},le={class:"currency-option"},oe={class:"currency-name"},re={class:"currency-rate"},ne={key:0,class:"existing-images"},se={class:"image-list"},ue=["src"],de={class:"el-upload__text"},b="http://elegance_backend.test",ie={__name:"Edit",setup(ce){const A=Q(),w=X(),C=_(null),o=_({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_id:null,currency_id:null,country_id:null,parent_id:null}),D={name_en:[{required:!0,message:"Please input product name (EN)",trigger:"blur"}],price:[{required:!0,message:"Please input product price",trigger:"blur"}],category_id:[{required:!0,message:"Please select a category",trigger:"change"}],currency_id:[{required:!0,message:"Please select a currency",trigger:"change"}],country_id:[{required:!0,message:"Please select a country",trigger:"change"}]},v=_([]),S=_([]),I=_([]),R=_([]),U=_([]),P=_([]),E=`${b}/api/products`,F=`${b}/api/categories`,N=`${b}/api/currencies`,B=`${b}/api/countries`,O=Y(()=>I.value.filter(e=>!e.is_deleted)),T=e=>(localStorage.getItem("lang")||"en")==="ar"?e.name_ar:e.name_en,L=()=>{v.value=P.value.map(e=>({name:e.path.split("/").pop(),url:`${b}/storage/${e.path}`,status:"success",isExisting:!0,id:e.id}))},q=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const t=await p.get(F);t.data.status&&t.data.data&&(S.value=t.data.data);const s=await p.get(N);s.data.status&&s.data.currencies&&(I.value=s.data.currencies);const r=await p.get(B);r.data.status&&r.data.data&&(R.value=r.data.data);const i=await p.get(E);i.data.status&&i.data.data&&(U.value=i.data.data)}catch(e){V.error(e.message||"Failed to fetch select options")}},z=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${e.token}`;const{id:t}=w.params,s=await p.get(`${E}/${t}`);if(s.data.status)Object.assign(o.value,s.data.data),P.value=s.data.data.images||[],L();else throw new Error(s.data.message||"Failed to fetch product")}catch(e){V.error(e.message||"Failed to fetch product")}},J=(e,t)=>{v.value=t},M=(e,t)=>{v.value=t},j=async()=>{C.value.validate(async e=>{if(e)try{const t=JSON.parse(localStorage.getItem("tokenData"));if(!t||!t.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization=`Bearer ${t.token}`;const{id:s}=w.params,r=new FormData;for(const u in o.value)r.append(u,o.value[u]);v.value.forEach(u=>{!u.isExisting&&u.raw&&r.append("images[]",u.raw)}),v.value.forEach(u=>{u.isExisting&&u.id&&r.append("existing_images[]",u.id)}),r.append("_method","PUT");const i=await p.post(`${E}/${s}`,r,{headers:{"Content-Type":"multipart/form-data"}});if(i.data.status)V.success(i.data.message||"Product updated successfully"),A.push("/products");else throw new Error(i.data.message||"Failed to update product")}catch(t){V.error(t.message||"Failed to update product")}})};return Z(()=>{q(),z()}),(e,t)=>{const s=c("el-input"),r=c("el-form-item"),i=c("el-switch"),u=c("el-option"),$=c("el-select"),x=c("el-upload"),G=c("el-button"),W=c("el-form"),H=c("el-card");return d(),g("div",te,[l(H,{class:"product-card"},{default:n(()=>[m("h2",null,f(e.$t("Products.EditProduct")),1),l(W,{model:o.value,ref_key:"formRef",ref:C,rules:D,"label-width":"120px",enctype:"multipart/form-data"},{default:n(()=>[l(r,{label:e.$t("Products.NameEn"),prop:"name_en"},{default:n(()=>[l(s,{modelValue:o.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.name_en=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.NameAr"),prop:"name_ar"},{default:n(()=>[l(s,{modelValue:o.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.name_ar=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.Price"),prop:"price"},{default:n(()=>[l(s,{modelValue:o.value.price,"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.price=a),type:"number"},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.Availability"),prop:"is_available"},{default:n(()=>[l(i,{modelValue:o.value.is_available,"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.is_available=a),"active-value":"1","inactive-value":"0"},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.DescriptionEn"),prop:"description_en"},{default:n(()=>[l(s,{type:"textarea",modelValue:o.value.description_en,"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.description_en=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.DescriptionAr"),prop:"description_ar"},{default:n(()=>[l(s,{type:"textarea",modelValue:o.value.description_ar,"onUpdate:modelValue":t[5]||(t[5]=a=>o.value.description_ar=a)},null,8,["modelValue"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.Category"),prop:"category_id"},{default:n(()=>[l($,{modelValue:o.value.category_id,"onUpdate:modelValue":t[6]||(t[6]=a=>o.value.category_id=a),placeholder:e.$t("Products.SelectCategory"),filterable:"",clearable:""},{default:n(()=>[(d(!0),g(y,null,h(S.value,a=>(d(),k(u,{key:a.id,label:a.name_en||a.name_ar,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.Currency"),prop:"currency_id"},{default:n(()=>[l($,{modelValue:o.value.currency_id,"onUpdate:modelValue":t[7]||(t[7]=a=>o.value.currency_id=a),placeholder:e.$t("Products.SelectCurrency"),filterable:"",clearable:""},{default:n(()=>[(d(!0),g(y,null,h(O.value,a=>(d(),k(u,{key:a.id,label:T(a),value:a.id},{default:n(()=>[m("div",le,[m("span",oe,f(a.name_en),1),m("span",re,"("+f(parseFloat(a.exchange_rate).toFixed(2))+")",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.Country"),prop:"country_id"},{default:n(()=>[l($,{modelValue:o.value.country_id,"onUpdate:modelValue":t[8]||(t[8]=a=>o.value.country_id=a),placeholder:e.$t("Products.SelectCountry"),filterable:"",clearable:""},{default:n(()=>[(d(!0),g(y,null,h(R.value,a=>(d(),k(u,{key:a.id,label:a.name_en||a.name_ar,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("Products.ParentProduct"),prop:"parent_id"},{default:n(()=>[l($,{modelValue:o.value.parent_id,"onUpdate:modelValue":t[9]||(t[9]=a=>o.value.parent_id=a),placeholder:e.$t("Products.SelectParentProduct"),clearable:""},{default:n(()=>[l(u,{label:e.$t("Products.None"),value:null},null,8,["label"]),(d(!0),g(y,null,h(U.value,a=>(d(),k(u,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),P.value.length?(d(),g("div",ne,[m("h4",null,f(e.$t("Products.ExistingImages")),1),m("div",se,[(d(!0),g(y,null,h(P.value,(a,pe)=>(d(),g("div",{key:a.id,class:"image-item"},[m("img",{src:`${b}/public/storage/${a.path}`,alt:"Product Image"},null,8,ue)]))),128))])])):ee("",!0),l(r,{label:e.$t("Products.Images"),prop:"images"},{default:n(()=>[l(x,{class:"upload-demo",drag:"",action:"","list-type":"picture","auto-upload":!1,"file-list":v.value,"on-change":J,"on-remove":M,"before-remove":e.beforeRemove},{default:n(()=>[t[10]||(t[10]=m("i",{class:"el-icon-upload"},null,-1)),m("div",de,f(e.$t("Products.DropFiles")),1)]),_:1,__:[10]},8,["file-list","before-remove"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(G,{type:"primary",onClick:j},{default:n(()=>[ae(f(e.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},_e=K(ie,[["__scopeId","data-v-e5b9525d"]]);export{_e as default};

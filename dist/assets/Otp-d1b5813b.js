import{_ as y,b as f,r as k,o as h,c as m,a as i,t as u,F as b,d as M,j as O,f as w,g as _,e as I,k as S,l as T,w as V,v as $}from"./index-8fc7e8a4.js";const v="http://elegance_backend.test/api",N={data(){return{otp:Array(4).fill(""),user:{},token:null,timer:"03:00",countdown:null,otpMessage:""}},computed:{otpMessageColor(){return this.otpMessage==="Invalid OTP"||this.otpMessage==="Resend Invalid"?"red":this.otpMessage==="OTP resent successfully"?"green":"#333"},isOtpComplete(){return this.otp.every(t=>/^\d$/.test(t))}},created(){const t=localStorage.getItem("user"),e=localStorage.getItem("auth_token");if(!t||!e){this.$router.push("/otp");return}this.user=JSON.parse(t),this.token=e,this.startTimer()},methods:{focusNext(t){t<4&&this.otp[t-1]&&this.$el.querySelectorAll(".otp-input")[t].focus()},handleInput(t,e){const n=t.target.value;/^\d$/.test(n)?(this.otp[e-1]=n,e<4&&this.focusNext(e)):this.otp[e-1]=""},handleKeyDown(t,e){t.key==="Backspace"&&!this.otp[e-1]&&e>1&&this.$el.querySelectorAll(".otp-input")[e-2].focus()},async handleOtpVerification(){var n,c,o,a,p,r,s,l;const t=this.otp.join(""),e=this.otp.every(d=>/^\d$/.test(d));if(t.length!==4||!e){(o=(n=this.$toast)==null?void 0:n.error)==null||o.call(n,((c=this.$t)==null?void 0:c.call(this,"otp.invalidLength"))||"Please enter a valid 4-digit code");return}try{const d=await f.post(`${v}/client/verify-otp`,{otp:t,email:this.user.email},{headers:{Authorization:`Bearer ${this.token}`}});if(d.data.status===!0){const g={...this.user,...d.data.data.user};localStorage.setItem("user",JSON.stringify(g)),localStorage.setItem("auth_token",d.data.data.token),this.otpMessage="",this.$router.push("/")}}catch(d){console.error("OTP verification error:",d);const g=((p=(a=d.response)==null?void 0:a.data)==null?void 0:p.message)||((r=this.$t)==null?void 0:r.call(this,"otp.error"))||"OTP verification failed";this.otpMessage=g,(l=(s=this.$toast)==null?void 0:s.error)==null||l.call(s,g)}},startTimer(){let t=3,e=0;this.countdown=setInterval(()=>{if(e===0){if(t===0){clearInterval(this.countdown);return}t--,e=59}else e--;this.timer=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)},async resendOtp(){var t,e,n,c,o,a,p,r;try{const s=await f.post(`${v}/resend-otp`,{email:this.user.email});if(s.data.status===!0){const l=s.data.message||"OTP resent successfully.";this.otpMessage=l,(e=(t=this.$toast)==null?void 0:t.info)==null||e.call(t,l)}else{const l=s.data.message||"Resend Invalid";this.otpMessage=l,(c=(n=this.$toast)==null?void 0:n.error)==null||c.call(n,l)}this.startTimer()}catch(s){const l=((a=(o=s.response)==null?void 0:o.data)==null?void 0:a.message)||"Resend Invalid";this.otpMessage=l,(r=(p=this.$toast)==null?void 0:p.error)==null||r.call(p,l)}}}},P={class:"otp-wrapper"},C={key:0,class:"otp-container"},D={class:"otp-message"},A={class:"otp-input-group"},B=["onUpdate:modelValue","onInput","onKeydown"],K=["disabled"],L={class:"resend d-flex w-100 justify-content-between align-items-center mt-3"},R={class:"time-left"},U=["disabled"],j={key:1};function q(t,e,n,c,o,a){const p=k("fa");return h(),m("div",P,[o.user&&o.user.email?(h(),m("div",C,[e[2]||(e[2]=i("img",{src:T,alt:"Logo",height:"100"},null,-1)),i("p",D,u(t.$t("otp.message")),1),i("span",null,u(o.user.email),1),i("form",{onSubmit:e[0]||(e[0]=_((...r)=>a.handleOtpVerification&&a.handleOtpVerification(...r),["prevent"]))},[i("div",A,[(h(),m(b,null,M(4,r=>V(i("input",{key:r,type:"text",inputmode:"numeric",maxlength:"1",pattern:"[0-9]*","onUpdate:modelValue":s=>o.otp[r-1]=s,onInput:s=>a.handleInput(s,r),onKeydown:s=>a.handleKeyDown(s,r),class:"otp-input",placeholder:"_"},null,40,B),[[$,o.otp[r-1]]])),64))]),i("button",{type:"submit",disabled:!a.isOtpComplete,class:"verify-btn"},u(t.$t("otp.verify")),9,K),o.otpMessage?(h(),m("div",{key:0,class:"info-message",style:O({marginTop:"1rem",color:a.otpMessageColor})},u(o.otpMessage),5)):w("",!0)],32),i("div",L,[i("div",R,[i("span",null,u(o.timer),1)]),i("button",{class:"btn btn-link",disabled:o.timer!=="00:00",onClick:e[1]||(e[1]=_((...r)=>a.resendOtp&&a.resendOtp(...r),["prevent"]))},[I(p,{icon:"rotate-right"}),S(" "+u(t.$t("otp.resend")),1)],8,U)])])):(h(),m("div",j,e[3]||(e[3]=[i("p",null,"User information is missing. Please try again.",-1)])))])}const z=y(N,[["render",q],["__scopeId","data-v-64b350ff"]]);export{z as default};

import{_ as M,b as z,y as V,R as J,r as n,o as b,c as P,a as w,t as y,e as t,p as a,k as T,f as A,$ as O,a0 as W,a1 as G,a2 as H,S as K,D as Q,a3 as X,E as Y,m as S,g as Z,F as x,d as ee,V as C,a4 as te}from"./index-734559de.js";const k=z.create({baseURL:"https://backend.webenia.org/api",headers:{Accept:"application/json","Content-Type":"application/json"},withCredentials:!1}),I=V([]);k.interceptors.request.use(e=>{const o=JSON.parse(localStorage.getItem("tokenData"));return o!=null&&o.token&&(e.headers.Authorization=`Bearer ${o.token}`),e},e=>Promise.reject(e));k.interceptors.response.use(e=>e,e=>{var o;return((o=e.response)==null?void 0:o.status)===401&&(localStorage.removeItem("tokenData"),window.location.href="/login"),Promise.reject(e)});const oe=J({name:"CustomersView",components:{Refresh:O,Edit:W,Delete:G,Plus:H},setup(){const e=K(),o=Q(),F=V(null),E=V(!1),U=V([]),_=V(!1),$=V(null),s=localStorage.getItem("lang")||"en",u=X({name:"",email:"",phone:"",role:"user",country_id:"",password:"",password_confirmation:""}),R=async()=>{try{const l=await k.get("/countries");I.value=l.data.data}catch(l){console.error("Failed to load countries:",l)}},L={name:[{required:!0,message:s==="en"?"Please enter name":" من فضلك ادخل الاسم",trigger:"blur"},{min:3,message:s==="en"?"Name must be at least 3 characters":"الاسم يجب ان يكون على الاقل 3 حروف",trigger:"blur"}],email:[{required:!0,message:s==="en"?"Please enter email":"من فضلك ادخل البريد الالكتروني",trigger:"blur"},{type:"email",message:s==="en"?"Please enter valid email":" من فضلك ادخل بريد الكتروني صحيح",trigger:"blur"}],phone:[{required:!0,message:s==="en"?"Please enter phone number":"من فضلك ادخل رقم الهاتف",trigger:"blur"},{pattern:/^[0-9+\-\s()]*$/,message:s==="en"?"Please enter a valid phone number":"من فضلك ادخل رقم هاتف صحيح",trigger:"blur"}],role:[{required:!0,message:s==="en"?"Please select role":"من فضلك اختر الصلاحية",trigger:"change"}],country_id:[{required:!0,message:s==="en"?"Please select country":"من فضلك اختر الدولة",trigger:"change"}],password:[{required:!0,message:s==="en"?"Please enter password":"من فضلك ادخل كلمة المرور",trigger:"blur"},{min:6,message:s==="en"?"Password must be at least 6 characters":"كلمة المرور يجب ان تكون على الاقل 6 حروف",trigger:"blur"}],password_confirmation:[{required:!0,message:s==="en"?"Please confirm password":"من فضلك ادخل تاكيد كلمة المرور",trigger:"blur"},{validator:(l,i,m)=>{i!==u.password?m(new Error(s==="en"?"Passwords do not match":"كلمات المرور غير متطابقة")):m()},trigger:"blur"}]},h=l=>({admin:"danger",manager:"warning",user:"success"})[l]||"info",p=()=>{E.value=!0,u.name="",u.email="",u.phone="",u.role="user",u.country_id="",u.password="",u.password_confirmation=""},v=async()=>{if(F.value)try{await F.value.validate(),_.value=!0;const l=await k.post("/users",u);if(l.data.status)C({message:s==="en"?"User created successfully":"تم إنشاء المستخدم بنجاح",type:"success",duration:2e3}),E.value=!1,f();else throw new Error(l.data.message||"Failed to create user")}catch(l){console.error("Error creating user:",l),C({message:s==="en"?"Failed to create user":"فشل في إنشاء المستخدم",type:"error",duration:5e3})}finally{_.value=!1}},f=async()=>{var l,i,m,c,D;try{_.value=!0,$.value=null;const d=JSON.parse(localStorage.getItem("tokenData"));if(!(d!=null&&d.token)){console.error("No token found"),o.push("/login");return}await e.dispatch("fetchCustomers"),U.value=e.getters.getCustomers}catch(d){console.error("Error loading customers:",d),console.error("Error details:",{message:d.message,response:(l=d.response)==null?void 0:l.data,status:(i=d.response)==null?void 0:i.status}),$.value=((c=(m=d.response)==null?void 0:m.data)==null?void 0:c.message)||d.message||"Failed to load customers",((D=d.response)==null?void 0:D.status)===401&&(localStorage.removeItem("tokenData"),o.push("/login"))}finally{_.value=!1}},N=async l=>{var i,m;try{const c=await k.put(`/users/${l.id}`,l);if(c.data.status)C({message:"User updated successfully",type:"success",duration:2e3}),f();else throw new Error(c.data.message||"Failed to update user")}catch(c){console.error("Error updating user:",c),C({message:s==="en"?((m=(i=c.response)==null?void 0:i.data)==null?void 0:m.message)||"Failed to update user":"فشل في تحديث المستخدم",type:"error",duration:5e3})}},q=async l=>{try{await te.confirm(s==="en"?`Are you sure you want to delete user ${l.name}?`:`هل أنت متأكد من حذف المستخدم ${l.name}?`,s==="en"?"Warning":"تحذير",{confirmButtonText:s==="en"?"Delete":"حذف",cancelButtonText:s==="en"?"Cancel":"إلغاء",type:"warning"});const i=await k.delete(`/users/${l.id}`);if(i.data.status)C({message:s==="en"?"User deleted successfully":"تم حذف المستخدم بنجاح",type:"success",duration:2e3}),f();else throw new Error(i.data.message||"Failed to delete user")}catch(i){i!=="cancel"&&(console.error("Error deleting user:",i),C({message:s==="en"?"Failed to delete user":"فشل في حذف المستخدم",type:"error",duration:5e3}))}},B=l=>l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",g=()=>{$.value=null};return Y(()=>{f(),R()}),{usersList:U,isLoading:_,error:$,loadCustomers:f,handleEdit:N,handleDelete:q,formatDate:B,clearError:g,createDialogVisible:E,createForm:u,createRules:L,createFormRef:F,showCreateDialog:p,handleCreate:v,getRoleType:h,countries:I}}}),ae={class:"page-container"},re={class:"page-header"},se={class:"page-title"},le={class:"button-group"},ne={class:"form-footer"},ue={key:1,class:"card"},ie={key:2,class:"table-container"},de={class:"button-group"};function me(e,o,F,E,U,_){const $=n("Plus"),s=n("el-icon"),u=n("el-button"),R=n("Refresh"),L=n("el-alert"),h=n("el-input"),p=n("el-form-item"),v=n("el-option"),f=n("el-select"),N=n("el-form"),q=n("el-dialog"),B=n("el-skeleton"),g=n("el-table-column"),l=n("el-tag"),i=n("Edit"),m=n("el-tooltip"),c=n("Delete"),D=n("el-table"),d=n("el-empty");return b(),P("div",ae,[w("div",re,[w("h2",se,y(e.$t("customers.title")),1),w("div",le,[t(u,{type:"success",class:"action-button",onClick:e.showCreateDialog},{default:a(()=>[t(s,null,{default:a(()=>[t($)]),_:1}),w("span",null,y(e.$t("customers.addCustomer")),1)]),_:1},8,["onClick"]),t(u,{type:"primary",class:"action-button",onClick:e.loadCustomers},{default:a(()=>[t(s,null,{default:a(()=>[t(R)]),_:1}),w("span",null,y(e.$t("customers.refrech")),1)]),_:1},8,["onClick"])])]),e.error?(b(),T(L,{key:0,title:e.error,type:"error","show-icon":"",onClose:e.clearError,class:"mb-md"},null,8,["title","onClose"])):A("",!0),t(q,{modelValue:e.createDialogVisible,"onUpdate:modelValue":o[8]||(o[8]=r=>e.createDialogVisible=r),title:e.$t("customers.addCustomer"),width:"500px"},{footer:a(()=>[w("div",ne,[t(u,{onClick:o[7]||(o[7]=r=>e.createDialogVisible=!1)},{default:a(()=>[S(y(e.$t("customers.cancel")),1)]),_:1}),t(u,{type:"primary",loading:e.isLoading,onClick:e.handleCreate},{default:a(()=>[S(y(e.$t("customers.create")),1)]),_:1},8,["loading","onClick"])])]),default:a(()=>[t(N,{ref:"createFormRef",model:e.createForm,rules:e.createRules,"label-width":"120px",class:"form-container",onSubmit:Z(e.handleCreate,["prevent"])},{default:a(()=>[t(p,{label:e.$t("customers.name"),prop:"name"},{default:a(()=>[t(h,{modelValue:e.createForm.name,"onUpdate:modelValue":o[0]||(o[0]=r=>e.createForm.name=r),placeholder:e.$t("customers.Enter-name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.email"),prop:"email"},{default:a(()=>[t(h,{modelValue:e.createForm.email,"onUpdate:modelValue":o[1]||(o[1]=r=>e.createForm.email=r),placeholder:e.$t("customers.Enter-email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.phone"),prop:"phone"},{default:a(()=>[t(h,{modelValue:e.createForm.phone,"onUpdate:modelValue":o[2]||(o[2]=r=>e.createForm.phone=r),placeholder:e.$t("customers.Enter-phone")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.role"),prop:"role"},{default:a(()=>[t(f,{modelValue:e.createForm.role,"onUpdate:modelValue":o[3]||(o[3]=r=>e.createForm.role=r),placeholder:e.$t("customers.Enter-role")},{default:a(()=>[t(v,{label:e.$t("customers.admin"),value:"admin"},null,8,["label"]),t(v,{label:e.$t("customers.user"),value:"user"},null,8,["label"]),t(v,{label:e.$t("customers.manager"),value:"manager"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.country"),prop:"country_id"},{default:a(()=>[t(f,{modelValue:e.createForm.country_id,"onUpdate:modelValue":o[4]||(o[4]=r=>e.createForm.country_id=r),placeholder:e.$t("customers.Enter-address")},{default:a(()=>[(b(!0),P(x,null,ee(e.countries,r=>(b(),T(v,{key:r.id,label:r.name_en,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.password"),prop:"password"},{default:a(()=>[t(h,{modelValue:e.createForm.password,"onUpdate:modelValue":o[5]||(o[5]=r=>e.createForm.password=r),type:"password",placeholder:e.$t("customers.Enter-password"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,{label:e.$t("customers.confirmPassword"),prop:"password_confirmation"},{default:a(()=>[t(h,{modelValue:e.createForm.password_confirmation,"onUpdate:modelValue":o[6]||(o[6]=r=>e.createForm.password_confirmation=r),type:"password",placeholder:e.$t("customers.Enter-comfirmPassword"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules","onSubmit"])]),_:1},8,["modelValue","title"]),e.isLoading?(b(),P("div",ue,[t(B,{rows:5,animated:""})])):(b(),P("div",ie,[t(D,{data:e.usersList,style:{width:"100%"},border:!0},{default:a(()=>[t(g,{prop:"id",label:e.$t("customers.customer-id"),width:"80"},null,8,["label"]),t(g,{prop:"name",label:e.$t("customers.name"),"min-width":"120"},null,8,["label"]),t(g,{prop:"email",label:e.$t("customers.email"),"min-width":"180"},null,8,["label"]),t(g,{prop:"phone",label:e.$t("customers.phone"),"min-width":"120"},null,8,["label"]),t(g,{prop:"role",label:e.$t("customers.role"),width:"120"},{default:a(r=>[t(l,{type:e.getRoleType(r.row.role),class:"status-tag"},{default:a(()=>[S(y(r.row.role),1)]),_:2},1032,["type"])]),_:1},8,["label"]),t(g,{prop:"created_at",label:e.$t("customers.Created-At"),width:"150"},{default:a(r=>[S(y(e.formatDate(r.row.created_at)),1)]),_:1},8,["label"]),t(g,{label:e.$t("customers.actions"),width:"150",fixed:"right"},{default:a(r=>[w("div",de,[t(m,{content:e.$t("customers.editCustomer"),placement:"top"},{default:a(()=>[t(u,{type:"primary",size:"small",class:"action-button",onClick:j=>e.handleEdit(r.row)},{default:a(()=>[t(s,null,{default:a(()=>[t(i)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),t(m,{content:e.$t("customers.deleteCustomer"),placement:"top"},{default:a(()=>[t(u,{type:"danger",size:"small",class:"action-button",onClick:j=>e.handleDelete(r.row)},{default:a(()=>[t(s,null,{default:a(()=>[t(c)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data"]),!e.isLoading&&e.usersList.length===0?(b(),T(d,{key:0,description:"No users found"})):A("",!0)]))])}const pe=M(oe,[["render",me]]);export{pe as default};

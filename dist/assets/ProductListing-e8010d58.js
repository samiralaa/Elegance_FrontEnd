import{_ as R,C as H,y as d,z as J,D as j,J as G,r as D,o as c,c as l,e as m,a as s,t as o,w as K,N as w,F as C,d as E,g as F,i as I,f as v,b as f,H as Q,m as W,ad as X,q as V,n as Y,E as y}from"./index-d93b5fdf.js";const Z={class:"axil-breadcrumb-area mt-5"},ee={class:"container"},te={class:"row align-items-center"},se={class:"col-lg-6 col-md-8"},ae={class:"inner"},oe={class:"title"},ie=["dir"],ne={class:"container"},re={class:"filter col-12"},ce={class:"sidebar"},le={class:"sidebar-container"},de={class:"sidebar-title"},ue={class:"checkbox-container"},_e=["value"],me={class:"sidebar-title"},ve={class:"price-range"},ge=["min","max"],he=["min","max"],pe={class:"price-values"},be={class:"products-grid"},fe={class:"image-container mb-3 bg-light rounded"},ye=["src","alt"],ke={key:0,class:"sale-badge"},xe={class:"product-actions d-flex justify-content-center gap-5 w-100"},we=["onClick","title"],Ce={class:"card-body"},Fe={class:"card-title"},Pe={class:"price-container"},Se={key:0,class:"discount-badge"},$e={key:1,class:"price-old"},Le={class:"card-text card-price"},De={class:"addToCart-btn"},Ee=["disabled","onClick"],Ie={__name:"ProductListing",setup(Ve){const{t:u}=H(),A=d(document.documentElement.dir||"ltr"),P=d([]),S=d([]),N=d(!1),$=d(""),g=d([]),r=d({min:0,max:5e3}),_={min:0,max:5e3},h=d(!1),p=J(),k=()=>{h.value=!h.value;const e=document.querySelector(".sidebar"),a=document.body;e&&(e.classList.toggle("active",h.value),e.classList.contains("active")?a.classList.add("no-scroll"):a.classList.remove("no-scroll"))},T=e=>`https://backend.webenia.org/public/storage/${e}`,b=e=>p.favorites.some(a=>a.product_id===e),B=e=>{const a=p.favorites.find(i=>i.product_id===e);return a?a.id:null},M=async e=>{var a,i;try{const n=await f.post("https://backend.webenia.org/api/favorites",{product_id:e.id},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(b(e.id)){const t=B(e.id);t&&(await p.removeFromFavorites(t),$.value="Product removed from favorites")}else{const t=await p.addToFavorites(e.id);$.value=t.message}N.value=!0}catch(n){console.error("Favorite error:",n),y({title:"⚠️",message:((i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message)||"Login required to favorite product",type:"error"})}},U=async()=>{try{const e=await f.get("https://backend.webenia.org/api/website");P.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},L=async()=>{try{const e=await f.get("https://backend.webenia.org/api/all/products");S.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},q=async e=>{var a,i;try{const n=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},t=await f.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:parseFloat(e.price)},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:n.code}});t.data.status?y({title:u("success"),message:t.data.message,type:"success"}):y({title:u("error"),message:t.data.message,type:"error"})}catch(n){console.error("Error adding to cart:",n),y({title:u("error"),message:(i=(a=n.response)==null?void 0:a.data)==null?void 0:i.message,type:"error"})}};j(()=>{U(),L(),window.addEventListener("currency-changed",()=>{L()})});const z=G(()=>S.value.filter(e=>{const a=g.value.length===0||g.value.includes(e.category_id),n=r.value.min===_.min&&r.value.max===_.max?!0:e.price>=r.value.min&&e.price<=r.value.max;return a&&n})),O=e=>{if(e.discount&&e.discount.length>0){const a=parseFloat(e.discount[0].discount_value),i=parseFloat(e.price);return(i-i*(a/100)).toFixed(2)}return e.price};return(e,a)=>{const i=D("router-link"),n=D("fa");return c(),l(C,null,[m(Q),s("div",Z,[s("div",ee,[s("div",te,[s("div",se,[s("div",ae,[s("h1",oe,o(e.$t("products.title")),1)])])])])]),s("div",{class:"shop-container",dir:A.value},[s("div",ne,[s("div",re,[s("a",{href:"#",onClick:K(k,["prevent"])},o(e.$t("products.filter")),1)]),s("aside",ce,[s("div",le,[s("button",{class:"close-btn",onClick:k},"×"),s("h3",de,o(w(u)("products.categories")),1),a[4]||(a[4]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(c(!0),l(C,null,E(P.value,t=>(c(),l("div",{key:t.id,class:"filter-item"},[s("label",ue,[W(o(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),F(s("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=x=>g.value=x),value:t.id},null,8,_e),[[X,g.value]]),a[3]||(a[3]=s("span",{class:"checkmark"},null,-1))])]))),128)),s("h3",me,o(w(u)("products.price")),1),a[5]||(a[5]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),s("div",ve,[F(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=t=>r.value.min=t),min:_.min,max:_.max},null,8,ge),[[I,r.value.min,void 0,{number:!0}]]),F(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=t=>r.value.max=t),min:_.min,max:_.max},null,8,he),[[I,r.value.max,void 0,{number:!0}]]),s("div",pe,[s("span",null,o(r.value.min)+" - "+o(r.value.max)+" "+o(w(u)("AED")),1)])])])]),h.value?(c(),l("div",{key:0,class:"overlay",onClick:k})):v("",!0),s("section",be,[(c(!0),l(C,null,E(z.value,t=>(c(),l("div",{key:t.id,class:"product-card"},[s("div",fe,[m(i,{to:`/read/products/${t.id}`},{default:V(()=>[t.images&&t.images.length?(c(),l("img",{key:0,src:T(t.images[0].path),alt:t.name},null,8,ye)):v("",!0)]),_:2},1032,["to"]),t.is_available?v("",!0):(c(),l("div",ke,o(e.$t("products.outOfStock")),1)),s("div",xe,[m(i,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:V(()=>[m(n,{icon:"eye"})]),_:2},1032,["to"]),s("button",{onClick:x=>M(t),class:Y(["btn rounded-circle shadow-sm btn-light",b(t.id)?"text-danger":""]),title:b(t.id)?"Remove from favorites":"Add to favorites"},[m(n,{icon:b(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,we)])]),s("div",Ce,[s("h5",Fe,o(t.name_en),1),s("div",Pe,[t.discount&&t.discount.length>0?(c(),l("span",Se,o(t.discount[0].discount_value)+"% OFF ",1)):v("",!0),t.old_price?(c(),l("span",$e,o(t.old_price)+" "+o(t.currency_code),1)):v("",!0),s("span",Le,o(O(t))+" "+o(t.currency_code),1)])]),s("div",De,[s("button",{disabled:!t.is_available,onClick:x=>q(t),class:"btn"},o(e.$t("products.addToCart")),9,Ee)])]))),128))])])],8,ie)],64)}}},Ne=R(Ie,[["__scopeId","data-v-e57adf84"]]);export{Ne as default};

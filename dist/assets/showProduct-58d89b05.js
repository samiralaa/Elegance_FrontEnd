import{_ as de,C as ue,J as ve,K as _e,L as pe,z as me,B as ge,y as h,D as fe,M as he,r as T,o as l,c,a as o,e as d,q as w,t as r,N as I,F as z,d as R,f,b as O,x as G,H as ke,n as S,m as ye,g as be,i as we,E as m}from"./index-dcf94f18.js";import{$ as k}from"./slick-theme-bebc8048.js";const Ce=["dir"],Fe={class:"container"},Se={class:"product-details"},$e={class:"product-title"},xe=["innerHTML"],Te={class:"price-block"},Ie={class:"d-flex"},ze={key:0,class:"price-old"},qe={key:1,class:"discount-badge"},Ae={class:"price-new"},Ee={class:"product-actions"},Ne=["title"],Pe={key:0,class:"sale-badge"},Re={key:0,class:"weight"},Ve={class:"weight-container"},Be={class:"row g-4"},Le=["onClick"],Me={class:"buttons-section"},Oe={key:0,class:"quantity-section"},Ue={class:"quantity-control"},De=["src"],He={class:"slider-wrapper"},Qe=["onClick"],je=["src"],Je={key:0,class:"children-products-section"},Ke={class:"title section-header d-flex align-items-center mb-4"},We={class:"mb-0"},Ge={class:"row g-3"},Xe={class:"product-card card border-0 h-100"},Ye={class:"position-relative overflow-hidden bg-light"},Ze=["src","alt"],et={key:0,class:"sale-badge"},tt={class:"product-actions d-flex justify-content-center gap-2 w-100"},st=["onClick","disabled"],at=["onClick","disabled"],ot=["onClick","title"],it={class:"card-body"},nt={class:"card-title"},rt={class:"price-container"},lt={key:0,class:"discount-badge"},ct={key:1,class:"price-old"},dt={class:"card-text card-price"},X=1,Y=99,U="/default-image.jpg",ut={__name:"showProduct",setup(vt){const{locale:C,t:n}=ue(),Z=ve(()=>C.value==="ar"?"rtl":"ltr"),ee=_e();pe();const y=me(),D=ge(),t=h({}),g=h(1),q=h(null),F=h(!1);h(0);const $=h(null),x=h(null),V=h(3),B=h(3),A=e=>e?`https://backend.webenia.org/public/storage/${e}`:U,H=e=>{e.target.src=U},E=e=>{q.value=e,G(()=>{const s=document.querySelector(".main-image");s&&(s.src=A(e))})},Q=async()=>{var e;try{const s=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},i=await O.get(`https://backend.webenia.org/api/website/show/products/${ee.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:s.code}});i.data.status&&(t.value=i.data.data,t.value._original_price=t.value.price,(e=t.value.images)!=null&&e.length&&(q.value=t.value.images[0].path,G(()=>{J(),ce()})))}catch(s){console.error("Error fetching product:",s)}},te=async()=>{var e,s;try{let i=0;if(t.value.discount&&t.value.discount.is_active){const _=parseFloat(t.value.discount.discount_value),b=parseFloat(t.value.converted_price||t.value.price);i=b-b*(_/100)}else i=parseFloat(t.value.converted_price)||parseFloat(t.value.price);const v={product_id:t.value.id,quantity:g.value,price:i};t.value.amounts&&(v.amount_id=t.value.amount_id);const u=await O.post("https://backend.webenia.org/api/cart-items",v,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});u.data.message&&(m({title:n("success"),message:u.data.message,type:"success"}),D.incrementCount(),await D.fetchCartCount())}catch(i){m({title:"❌",message:((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.message)||n("add_to_cart_error")||"Login required to add to cart",type:"error"})}},j=async e=>{var s,i,v;try{let u=0;if(e.discount&&e.discount.is_active){const p=parseFloat(e.discount.discount_value),P=parseFloat(e.converted_price||e.price);u=P-P*(p/100)}else u=parseFloat(e.converted_price)||parseFloat(e.price);const _={product_id:e.id,quantity:1,price:u},b=(s=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:s.id;b&&(_.user_id=b),e.amounts&&(_.amount_id=e.amount_id);const a=await O.post("https://backend.webenia.org/api/cart-items",_,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&m({title:n("success"),message:a.data.message,type:"success"})}catch(u){console.error("Error adding child product to cart:",u),m({title:"❌",message:((v=(i=u.response)==null?void 0:i.data)==null?void 0:v.message)||n("add_to_cart_error")||"Login required to add to cart",type:"error"})}},L=h(0),M=(e,s)=>{L.value=e,t.value.amount_id=s.id,t.value.price=s.price,s.converted_price!==void 0?t.value.converted_price=s.converted_price:t.value.converted_price=s.price},se=()=>{var e,s;(s=(e=t.value)==null?void 0:e.amounts)!=null&&s.length?M(0,t.value.amounts[0]):(L.value=null,t.value.amount_id=null,t.value._original_price!==void 0&&(t.value.price=t.value._original_price))},J=()=>{var v;const e=k($.value),s=k(x.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick");const i=((v=t.value.images)==null?void 0:v.length)||0;B.value=i,V.value=i>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:V.value,slidesToScroll:1,infinite:i>1,focusOnSelect:!0,rtl:C.value==="ar",asNavFor:s,afterChange:function(u){const _=t.value.images[u];_&&E(_.path)}}),s.slick({slidesToShow:1,slidesToScroll:1,infinite:i>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:C.value==="ar",asNavFor:e,afterChange:function(u){const _=t.value.images[u];_&&E(_.path)}})},ae=()=>{const e=k($.value),s=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),s.slick("slickPrev"),K())},oe=()=>{const e=k($.value),s=k(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),s.slick("slickNext"),K())},K=()=>{const e=k($.value);if(e.length&&e.hasClass("slick-initialized")){const i=e.find(".slick-current").find("img").attr("src").replace("https://backend.webenia.org/public/storage/","");E(i)}};fe(()=>{var e,s;Q().then(J),window.addEventListener("currency-changed",()=>{Q()}),(s=(e=t.value)==null?void 0:e.amounts)!=null&&s.length&&M(0,t.value.amounts[0])}),he(()=>{const e=k(x.value),s=k($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick")});const N=e=>y.isInFavorites(e.id),ie=async e=>{try{if(N(e)){const s=y.favorites.find(i=>i.product_id===e.id);s&&(await y.removeFromFavorites(s.id),m({title:n("Removed From Favorites"),message:n("Product Removed From Favorites"),type:"success"}))}else await y.addToFavorites(e.id)&&m({title:n("Added To Favorites"),message:n("Product Added To Favorites"),type:"success"})}catch(s){console.error("Error toggling child favorites:",s),m({title:n("error"),message:s.message||n("failed_to_toggle_favorite"),type:"error"})}},ne=()=>{g.value<Y?g.value++:m({title:n("warning"),message:n("max_quantity_reached"),type:"warning"})},re=()=>{g.value>X?g.value--:m({title:n("warning"),message:n("min_quantity_reached"),type:"warning"})},le=async()=>{try{if(F.value){const e=y.favorites.find(s=>s.product_id===t.value.id);e&&(await y.removeFromFavorites(e.id),F.value=!1,m({title:n("Removed From Favorites"),message:n("Product Removed From Favorites"),type:"success"}))}else await y.addToFavorites(t.value.id)&&(F.value=!0,m({title:n("Added To Favorites"),message:n("Product Added To Favorites"),type:"success"}))}catch(e){console.error("Error toggling favorites:",e),m({title:n("error"),message:e.message||n("failed_to_toggle_favorite"),type:"error"})}},ce=()=>{F.value=y.isInFavorites(t.value.id)},W=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price||e.price);return(i-i*(s/100)).toFixed(2)}return e.converted_price||e.price};return(e,s)=>{const i=T("fa"),v=T("el-button"),u=T("el-col"),_=T("el-row"),b=T("router-link");return l(),c(z,null,[s[5]||(s[5]=o("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap",rel:"stylesheet"},null,-1)),d(ke),o("div",{class:"product-show",dir:Z.value},[o("div",Fe,[d(_,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:w(()=>[d(u,{xs:24,sm:24,md:12,lg:14},{default:w(()=>[o("div",Se,[o("h1",$e,r(I(C)==="ar"?t.value.name_ar:t.value.name_en),1),o("div",{innerHTML:I(C)==="ar"?t.value.description_ar:t.value.description_en,class:"description"},null,8,xe),o("div",Te,[o("div",Ie,[t.value.discount&&t.value.discount.is_active?(l(),c("span",ze,r(t.value.converted_price||t.value.price)+" "+r(t.value.currency_code),1)):f("",!0),t.value.discount&&t.value.discount.is_active?(l(),c("span",qe,"-"+r(t.value.discount.discount_value)+"%",1)):f("",!0)]),o("span",Ae,r(W(t.value))+" "+r(t.value.currency_code),1)]),o("div",Ee,[o("button",{onClick:s[0]||(s[0]=a=>le(t.value)),class:S(["btn rounded-circle shadow-sm btn-light",F.value?"text-danger":""]),title:F.value?"Remove from favorites":"Add to favorites"},[d(i,{icon:F.value?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Ne),t.value.is_available?f("",!0):(l(),c("div",Pe,r(e.$t("products.outOfStock")),1))]),t.value.amounts&&t.value.amounts.length>0?(l(),c("div",Re,[s[4]||(s[4]=o("h1",{class:"weight-title"},"Select Weight",-1)),o("div",{class:"reset",onClick:se},[d(i,{icon:"rotate-right"}),s[3]||(s[3]=o("a",null,"reset",-1))]),o("div",Ve,[o("div",Be,[(l(!0),c(z,null,R(t.value.amounts,(a,p)=>(l(),c("div",{key:a.id,class:S(["weight-item",{active:L.value===p}]),onClick:P=>M(p,a)},[o("p",null,r(a.weight)+" "+r(a.unit.name_en)+" For "+r(a.price)+" "+r(t.value.currency_code),1)],10,Le))),128))])])])):f("",!0),o("div",Me,[d(v,{class:"add-to-cart btn",disabled:!t.value.is_available,type:"primary",size:"large",round:"",onClick:te},{default:w(()=>[ye(r(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),t.value.is_available?(l(),c("div",Oe,[o("div",Ue,[d(v,{size:"small",onClick:re,disabled:g.value<=X,class:"qty-btn"},{default:w(()=>[d(i,{icon:"minus"})]),_:1},8,["disabled"]),be(o("input",{class:"qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":s[1]||(s[1]=a=>g.value=a),onInput:s[2]||(s[2]=a=>g.value=Math.min(g.value))},null,544),[[we,g.value,void 0,{number:!0}]]),d(v,{size:"small",onClick:ne,disabled:g.value>=Y,class:"qty-btn"},{default:w(()=>[d(i,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),d(u,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:w(()=>[o("div",{class:"image-wrapper",ref_key:"main",ref:x},[(l(!0),c(z,null,R(t.value.images,(a,p)=>(l(),c("div",{key:a.id,class:"slide"},[o("img",{src:A(q.value),class:"main-image",onError:H},null,40,De)]))),128))],512),o("div",He,[B.value>1?(l(),c("button",{key:0,class:"btn nav-button left",onClick:ae},[d(i,{icon:"arrow-left"})])):f("",!0),o("div",{class:S(["slider-container",{"centered-slides":V.value<3}])},[o("div",{class:"slider",ref_key:"slider",ref:$},[(l(!0),c(z,null,R(t.value.images,(a,p)=>(l(),c("div",{key:a.id,class:"slide",onClick:P=>E(a.path)},[o("img",{src:A(a.path),class:S({active:q.value===a.path}),onError:H},null,42,je)],8,Qe))),128))],512)],2),B.value>1?(l(),c("button",{key:1,class:"btn nav-button right",onClick:oe},[d(i,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),t.value.children&&t.value.children.length>0?(l(),c("div",Je,[o("div",Ke,[d(i,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),o("h2",We,r(I(n)("products.relatedProducts")),1)]),o("div",Ge,[(l(!0),c(z,null,R(t.value.children,a=>(l(),c("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[o("div",Xe,[o("div",Ye,[d(b,{to:`/read/products/${t.value.id}`},{default:w(()=>{var p;return[o("img",{src:(p=a.images)!=null&&p.length?A(a.images[0].path):U,alt:I(C)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,Ze)]}),_:2},1032,["to"]),a.is_available?f("",!0):(l(),c("div",et,r(e.$t("products.outOfStock")),1)),o("div",tt,[d(b,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:w(()=>[d(i,{icon:"eye"})]),_:2},1032,["to"]),o("button",{onClick:p=>j(a),class:S(["btn btn-light shadow-sm",{disabled:!a.is_available}]),disabled:!a.is_available},r(e.$t("home.add-to-cart")),11,st),o("button",{onClick:p=>j(a),class:S(["d-none btn rounded-circle btn-light shadow-sm",{disabled:!a.is_available}]),disabled:!a.is_available},[d(i,{icon:"cart-plus"})],10,at),o("button",{onClick:p=>ie(a),class:S(["btn rounded-circle shadow-sm btn-light",N(a)?"text-danger":""]),title:N(a)?"Remove from favorites":"Add to favorites"},[d(i,{icon:N(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,ot)])]),o("div",it,[o("h5",nt,r(I(C)==="ar"?a.name_ar:a.name_en),1),o("div",rt,[a.discount&&a.discount.is_active?(l(),c("span",lt," -"+r(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(l(),c("span",ct,r(a.converted_price||a.price)+" "+r(a.currency_code||"UAE"),1)):f("",!0),o("span",dt,r(W(a))+" "+r(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,Ce)],64)}}},mt=de(ut,[["__scopeId","data-v-05817b80"]]);export{mt as default};

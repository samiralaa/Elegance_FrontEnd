import{_ as M,b as O,P as J,r as i,a3 as K,o as f,c as q,a as c,t as V,e as a,l as o,g as Q,j as B,f as Y,Z as G,$ as H,a0 as W,a4 as X,a5 as x,Y as ee,Q as ae,K as oe,u as g,a1 as ne,B as te,m as F,V as E}from"./index-1a54cba5.js";const P=O.create({baseURL:"https://backend.webenia.org/api",headers:{Accept:"application/json","Content-Type":"application/json"}});P.interceptors.request.use(e=>{const n=JSON.parse(localStorage.getItem("tokenData"));return n!=null&&n.token&&(e.headers.Authorization=`Bearer ${n.token}`),e},e=>Promise.reject(e));P.interceptors.response.use(e=>e,e=>{var n;return((n=e.response)==null?void 0:n.status)===401&&(localStorage.removeItem("tokenData"),window.location.href="/login"),Promise.reject(e)});const le=J({name:"BrandsView",components:{Edit:G,Delete:H,Plus:W,Picture:X,ZoomIn:x,Refresh:ee},setup(){const e=ae(),n=oe(),$=g(null),C=g(!1),A=g(!1),v=g("create"),w=g([]),m=g(!1),p=g(!1),D=g(!1),b=g(null),h=g(null),r=ne({logo:"",name_en:"",name_ar:"",description_en:"",description_ar:""}),z={name_en:[{required:!0,message:"Please enter brand name in English",trigger:"blur"}],name_ar:[{required:!0,message:"Please enter brand name in Arabic",trigger:"blur"}],description_en:[{required:!0,message:"Please enter brand description in English",trigger:"blur"}],description_ar:[{required:!0,message:"Please enter brand description in Arabic",trigger:"blur"}]},_=async()=>{var l,d,s;try{m.value=!0,h.value=null;const u=JSON.parse(localStorage.getItem("tokenData"));if(!(u!=null&&u.token)){console.error("No token found"),n.push("/login");return}await e.dispatch("fetchBrands"),w.value=e.getters.getBrands,console.log("Brands loaded:",w.value)}catch(u){console.error("Error loading brands:",u),h.value=((d=(l=u.response)==null?void 0:l.data)==null?void 0:d.message)||u.message||"Failed to load brands",((s=u.response)==null?void 0:s.status)===401&&(localStorage.removeItem("tokenData"),n.push("/login"))}finally{m.value=!1}},U=()=>{v.value="create",r.logo="",r.name_en="",r.name_ar="",r.description_en="",r.description_ar="",C.value=!0},N=l=>{var d,s;v.value="edit",b.value=l,r.logo=((s=(d=l.media)==null?void 0:d[0])==null?void 0:s.original_url)||"",r.name_en=l.name_en,r.name_ar=l.name_ar,r.description_en=l.description_en,r.description_ar=l.description_ar,C.value=!0},R=l=>{b.value=l,A.value=!0},S=l=>{if(l){const d=new FileReader;d.onload=s=>{r.logo=s.target.result},d.readAsDataURL(l.raw)}},T=async()=>{var l,d;try{if(!$.value){console.error("Form reference is not available");return}await $.value.validate(),p.value=!0;const s=new FormData;if(s.append("name_en",r.name_en),s.append("name_ar",r.name_ar),s.append("description_en",r.description_en||""),s.append("description_ar",r.description_ar||""),r.logo instanceof File)s.append("logo",r.logo);else if(r.logo&&typeof r.logo=="string"){const I=await(await fetch(r.logo)).blob(),Z=new File([I],"logo.png",{type:"image/png"});s.append("logo",Z)}const u=v.value==="create"?"/brands":`/brands/${b.value.id}`,L=v.value==="create"?"post":"put";await P[L](u,s,{headers:{"Content-Type":"multipart/form-data"}}),E({message:`Brand ${v.value==="create"?"created":"updated"} successfully`,type:"success",duration:2e3}),C.value=!1,_()}catch(s){console.error("Error saving brand:",s),(d=(l=s.response)==null?void 0:l.data)!=null&&d.errors?Object.values(s.response.data.errors).forEach(u=>{E({message:u[0],type:"error",duration:5e3})}):E({message:"Failed to save brand",type:"error",duration:5e3})}finally{p.value=!1}},j=async()=>{try{D.value=!0,await P.delete(`/brands/${b.value.id}`),E({message:"Brand deleted successfully",type:"success",duration:2e3}),A.value=!1,_()}catch(l){console.error("Error deleting brand:",l),E({message:"Failed to delete brand",type:"error",duration:5e3})}finally{D.value=!1}},y=l=>{if(l.media&&l.media.length>0){const d=l.media[0].original_url;window.open(d,"_blank")}},k=()=>{h.value=null};return te(()=>{_()}),{brands:w,loading:m,error:h,dialogVisible:C,deleteDialogVisible:A,dialogType:v,submitting:p,deleting:D,selectedBrand:b,brandForm:r,formRules:z,brandFormRef:$,fetchBrands:_,openCreateDialog:U,editItem:N,deleteItem:R,handleLogoChange:S,submitForm:T,confirmDelete:j,previewImage:y,clearError:k}}}),re={class:"brands-container"},se={class:"header"},ie={class:"text-2xl font-bold text-gray-800"},de={key:0,class:"loading-state"},ue={key:1,class:"table-container"},ce={class:"d-flex align-center brand-name"},pe=["onClick"],me={class:"logo-overlay"},_e={class:"text-right arabic-text",dir:"rtl"},ge={class:"description-cell"},fe={class:"text-right arabic-text",dir:"rtl"},be={class:"button-group"},ve={class:"dialog-footer"},ye={class:"dialog-footer"};function we(e,n,$,C,A,v){const w=i("Plus"),m=i("el-icon"),p=i("el-button"),D=i("el-skeleton"),b=i("el-image"),h=i("Picture"),r=i("el-avatar"),z=i("ZoomIn"),_=i("el-table-column"),U=i("Edit"),N=i("el-tooltip"),R=i("Delete"),S=i("el-table"),T=i("el-empty"),j=i("el-upload"),y=i("el-form-item"),k=i("el-input"),l=i("el-col"),d=i("el-row"),s=i("el-form"),u=i("el-dialog"),L=K("loading");return f(),q("div",re,[c("div",se,[c("h1",ie,V(e.$t("Brands.Management")),1),a(p,{type:"primary",onClick:e.openCreateDialog,class:"add-brand-btn"},{default:o(()=>[a(m,{class:"mr-2"},{default:o(()=>[a(w)]),_:1}),F(" "+V(e.$t("Brands.AddBrands")),1)]),_:1},8,["onClick"])]),e.loading?(f(),q("div",de,[a(D,{rows:5,animated:""})])):(f(),q("div",ue,[Q((f(),B(S,{data:e.brands,style:{width:"100%"},border:!0},{default:o(()=>[a(_,{label:e.$t("Brands.Logo"),"min-width":"200",resizable:!0},{default:o(t=>[c("div",ce,[c("div",{class:"brand-logo-container",onClick:I=>e.previewImage(t.row)},[a(r,{size:120,class:"brand-logo"},{default:o(()=>[t.row.media&&t.row.media.length>0?(f(),B(b,{key:0,src:t.row.media[0].original_url,class:"logo-img","preview-src-list":[t.row.media[0].original_url]},null,8,["src","preview-src-list"])):(f(),B(m,{key:1,size:"24",color:"#909399"},{default:o(()=>[a(h)]),_:1}))]),_:2},1024),c("div",me,[a(m,null,{default:o(()=>[a(z)]),_:1})])],8,pe)])]),_:1},8,["label"]),a(_,{prop:"name_ar",label:e.$t("Brands.NameAr"),"min-width":"150",resizable:!0},{default:o(t=>[c("div",_e,V(t.row.name_ar||"N/A"),1)]),_:1},8,["label"]),a(_,{prop:"description_en",label:e.$t("Brands.DescriptionEn"),"min-width":"200",resizable:!0},{default:o(t=>[c("div",ge,V(t.row.description_en||"N/A"),1)]),_:1},8,["label"]),a(_,{prop:"description_ar",label:e.$t("Brands.DescriptionAr"),"min-width":"200",resizable:!0},{default:o(t=>[c("div",fe,V(t.row.description_ar||"N/A"),1)]),_:1},8,["label"]),a(_,{label:e.$t("Brands.Actions"),width:"100",fixed:"right"},{default:o(t=>[c("div",be,[a(N,{content:"Edit Brand",placement:"top"},{default:o(()=>[a(p,{type:"primary",size:"small",class:"action-button",onClick:I=>e.editItem(t.row)},{default:o(()=>[a(m,null,{default:o(()=>[a(U)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),a(N,{content:"Delete Brand",placement:"top"},{default:o(()=>[a(p,{type:"danger",size:"small",class:"action-button",onClick:I=>e.deleteItem(t.row)},{default:o(()=>[a(m,null,{default:o(()=>[a(R)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[L,e.loading]]),!e.loading&&e.brands.length===0?(f(),B(T,{key:0,description:"No brands found"})):Y("",!0)])),a(u,{modelValue:e.dialogVisible,"onUpdate:modelValue":n[5]||(n[5]=t=>e.dialogVisible=t),title:e.dialogType==="create"?"Create New Brand":"Edit Brand",width:"600px","close-on-click-modal":!1},{footer:o(()=>[c("span",ve,[a(p,{onClick:n[4]||(n[4]=t=>e.dialogVisible=!1)},{default:o(()=>n[8]||(n[8]=[F("Cancel")])),_:1,__:[8]}),a(p,{type:"primary",onClick:e.submitForm,loading:e.submitting},{default:o(()=>[F(V(e.dialogType==="create"?"Create":"Update"),1)]),_:1},8,["onClick","loading"])])]),default:o(()=>[a(s,{ref:"brandFormRef",model:e.brandForm,rules:e.formRules,"label-position":"top"},{default:o(()=>[a(y,{label:"Brand Logo",prop:"logo"},{default:o(()=>[a(j,{class:"logo-uploader",action:"#","show-file-list":!1,"auto-upload":!1,"on-change":e.handleLogoChange},{default:o(()=>[e.brandForm.logo?(f(),B(b,{key:0,src:e.brandForm.logo,class:"logo-preview"},null,8,["src"])):(f(),B(m,{key:1,class:"logo-uploader-icon"},{default:o(()=>[a(w)]),_:1}))]),_:1},8,["on-change"])]),_:1}),a(d,{gutter:20},{default:o(()=>[a(l,{span:12},{default:o(()=>[a(y,{label:"Name (English)",prop:"name_en"},{default:o(()=>[a(k,{modelValue:e.brandForm.name_en,"onUpdate:modelValue":n[0]||(n[0]=t=>e.brandForm.name_en=t),placeholder:"Enter brand name in English"},null,8,["modelValue"])]),_:1})]),_:1}),a(l,{span:12},{default:o(()=>[a(y,{label:"Name (Arabic)",prop:"name_ar"},{default:o(()=>[a(k,{modelValue:e.brandForm.name_ar,"onUpdate:modelValue":n[1]||(n[1]=t=>e.brandForm.name_ar=t),placeholder:"Enter brand name in Arabic",dir:"rtl"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(d,{gutter:20},{default:o(()=>[a(l,{span:12},{default:o(()=>[a(y,{label:"Description (English)",prop:"description_en"},{default:o(()=>[a(k,{modelValue:e.brandForm.description_en,"onUpdate:modelValue":n[2]||(n[2]=t=>e.brandForm.description_en=t),type:"textarea",rows:3,placeholder:"Enter brand description in English"},null,8,["modelValue"])]),_:1})]),_:1}),a(l,{span:12},{default:o(()=>[a(y,{label:"Description (Arabic)",prop:"description_ar"},{default:o(()=>[a(k,{modelValue:e.brandForm.description_ar,"onUpdate:modelValue":n[3]||(n[3]=t=>e.brandForm.description_ar=t),type:"textarea",rows:3,placeholder:"Enter brand description in Arabic",dir:"rtl"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),a(u,{modelValue:e.deleteDialogVisible,"onUpdate:modelValue":n[7]||(n[7]=t=>e.deleteDialogVisible=t),title:"Delete Brand",width:"400px","close-on-click-modal":!1},{footer:o(()=>[c("span",ye,[a(p,{onClick:n[6]||(n[6]=t=>e.deleteDialogVisible=!1)},{default:o(()=>n[9]||(n[9]=[F("Cancel")])),_:1,__:[9]}),a(p,{type:"danger",onClick:e.confirmDelete,loading:e.deleting},{default:o(()=>n[10]||(n[10]=[F(" Delete ")])),_:1,__:[10]},8,["onClick","loading"])])]),default:o(()=>[n[11]||(n[11]=c("p",null,"Are you sure you want to delete this brand? This action cannot be undone.",-1))]),_:1,__:[11]},8,["modelValue"])])}const ke=M(le,[["render",we],["__scopeId","data-v-1b1e14a9"]]);export{ke as default};

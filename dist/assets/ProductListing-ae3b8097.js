import{_ as G,C as K,y as d,z as Q,K as L,D as W,N as D,r as I,o as c,c as l,e as m,a as s,t as i,w as X,E,F as w,d as V,g as C,i as N,f as _,b as f,H as Y,m as Z,ae as ee,q as A,n as te,G as y}from"./index-e527976a.js";const se={class:"axil-breadcrumb-area mt-5"},ae={class:"container"},oe={class:"row align-items-center"},ie={class:"col-lg-6 col-md-8"},ne={class:"inner"},re={class:"title"},ce=["dir"],le={class:"container"},de={class:"filter col-12"},ue={class:"sidebar"},ve={class:"sidebar-container"},me={class:"sidebar-title"},_e={class:"checkbox-container"},ge=["value"],he={class:"sidebar-title"},pe={class:"price-range"},be=["min","max"],fe=["min","max"],ye={class:"price-values"},ke={class:"products-grid"},xe={class:"image-container mb-3 bg-light rounded"},we=["src","alt"],Ce={key:0,class:"sale-badge"},Fe={class:"product-actions d-flex justify-content-center gap-5 w-100"},Se=["onClick","title"],Pe={class:"card-body"},$e={class:"card-title"},Le={class:"price-container"},De={key:0,class:"price-old"},Ie={key:1,class:"discount-badge"},Ee={class:"card-text card-price"},Ve={class:"addToCart-btn"},Ne=["disabled","onClick"],Ae={__name:"ProductListing",setup(Te){const{t:v}=K(),T=d(document.documentElement.dir||"ltr"),F=d([]),S=d([]),M=d(!1),P=d(""),g=d([]),o=d({min:0,max:2e3}),u={min:0,max:2e3},h=d(!1),p=Q(),B=L(()=>{const e=localStorage.getItem("selectedCurrency");return e?JSON.parse(e).code:"AED"}),k=()=>{h.value=!h.value;const e=document.querySelector(".sidebar"),a=document.body;e&&(e.classList.toggle("active",h.value),e.classList.contains("active")?a.classList.add("no-scroll"):a.classList.remove("no-scroll"))},U=e=>`https://backend.webenia.org/public/storage/${e}`,b=e=>p.favorites.some(a=>a.product_id===e),q=e=>{const a=p.favorites.find(n=>n.product_id===e);return a?a.id:null},z=async e=>{var a,n;try{const r=await f.post("https://backend.webenia.org/api/favorites",{product_id:e.id},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});if(b(e.id)){const t=q(e.id);t&&(await p.removeFromFavorites(t),P.value="Product removed from favorites")}else{const t=await p.addToFavorites(e.id);P.value=t.message}M.value=!0}catch(r){console.error("Favorite error:",r),y({title:"⚠️",message:((n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message)||"Login required to favorite product",type:"error"})}},O=async()=>{try{const e=await f.get("https://backend.webenia.org/api/website");F.value=e.data.data||[]}catch(e){console.error("Error loading categories",e)}},$=async()=>{try{const e=await f.get("https://backend.webenia.org/api/all/products");S.value=e.data.data||[]}catch(e){console.error("Error loading products",e)}},R=async e=>{var a,n;try{const r=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},t=await f.post("https://backend.webenia.org/api/cart-items",{product_id:e.id,quantity:1,price:parseFloat(e.price)},{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:r.code}});t.data.status?y({title:v("success"),message:t.data.message,type:"success"}):y({title:v("error"),message:t.data.message,type:"error"})}catch(r){console.error("Error adding to cart:",r),y({title:v("error"),message:(n=(a=r.response)==null?void 0:a.data)==null?void 0:n.message,type:"error"})}};W(()=>{O(),$(),window.addEventListener("currency-changed",()=>{$()})});const H=L(()=>S.value.filter(e=>{const a=g.value.length===0||g.value.includes(e.category_id),r=o.value.min===u.min&&o.value.max===u.max?!0:e.price>=o.value.min&&e.price<=o.value.max;return a&&r})),J=e=>{if(e.discount&&e.discount.is_active){const a=parseFloat(e.discount.discount_value),n=parseFloat(e.converted_price||e.price);return(n-n*(a/100)).toFixed(2)}return e.converted_price||e.price},j=e=>e.discount&&e.discount.is_active?Math.round(parseFloat(e.discount.discount_value)):0;return D(()=>o.value.min,e=>{e>o.value.max&&(o.value.min=o.value.max)}),D(()=>o.value.max,e=>{e<o.value.min&&(o.value.max=o.value.min)}),(e,a)=>{const n=I("router-link"),r=I("fa");return c(),l(w,null,[m(Y),s("div",se,[s("div",ae,[s("div",oe,[s("div",ie,[s("div",ne,[s("h1",re,i(e.$t("products.title")),1)])])])])]),s("div",{class:"shop-container",dir:T.value},[s("div",le,[s("div",de,[s("a",{href:"#",onClick:X(k,["prevent"])},i(e.$t("products.filter")),1)]),s("aside",ue,[s("div",ve,[s("button",{class:"close-btn",onClick:k},"×"),s("h3",me,i(E(v)("products.categories")),1),a[4]||(a[4]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),(c(!0),l(w,null,V(F.value,t=>(c(),l("div",{key:t.id,class:"filter-item"},[s("label",_e,[Z(i(e.$i18n.locale==="ar"?t.name_ar:t.name_en)+" ",1),C(s("input",{type:"checkbox","onUpdate:modelValue":a[0]||(a[0]=x=>g.value=x),value:t.id},null,8,ge),[[ee,g.value]]),a[3]||(a[3]=s("span",{class:"checkmark"},null,-1))])]))),128)),s("h3",he,i(E(v)("products.price")),1),a[5]||(a[5]=s("hr",{style:{color:"#8b6b3d",opacity:"1","border-top":"3px solid"}},null,-1)),s("div",pe,[C(s("input",{type:"range","onUpdate:modelValue":a[1]||(a[1]=t=>o.value.min=t),min:u.min,max:u.max},null,8,be),[[N,o.value.min,void 0,{number:!0}]]),C(s("input",{type:"range","onUpdate:modelValue":a[2]||(a[2]=t=>o.value.max=t),min:u.min,max:u.max},null,8,fe),[[N,o.value.max,void 0,{number:!0}]]),s("div",ye,[s("span",null,i(o.value.min)+" - "+i(o.value.max)+" "+i(B.value),1)])])])]),h.value?(c(),l("div",{key:0,class:"overlay",onClick:k})):_("",!0),s("section",ke,[(c(!0),l(w,null,V(H.value,t=>(c(),l("div",{key:t.id,class:"product-card"},[s("div",xe,[m(n,{to:`/read/products/${t.id}`},{default:A(()=>[t.images&&t.images.length?(c(),l("img",{key:0,src:U(t.images[0].path),alt:t.name},null,8,we)):_("",!0)]),_:2},1032,["to"]),t.is_available?_("",!0):(c(),l("div",Ce,i(e.$t("products.outOfStock")),1)),s("div",Fe,[m(n,{to:`/read/products/${t.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:A(()=>[m(r,{icon:"eye"})]),_:2},1032,["to"]),s("button",{onClick:x=>z(t),class:te(["btn rounded-circle shadow-sm btn-light",b(t.id)?"text-danger":""]),title:b(t.id)?"Remove from favorites":"Add to favorites"},[m(r,{icon:b(t.id)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,Se)])]),s("div",Pe,[s("h5",$e,i(t.name_en),1),s("div",Le,[t.discount&&t.discount.is_active?(c(),l("span",De,i(t.converted_price)+" "+i(t.currency_code),1)):_("",!0),t.discount&&t.discount.is_active?(c(),l("span",Ie,i(j(t))+"% OFF ",1)):_("",!0),s("span",Ee,i(J(t))+" "+i(t.currency_code),1)])]),s("div",Ve,[s("button",{disabled:!t.is_available,onClick:x=>R(t),class:"btn"},i(e.$t("products.addToCart")),9,Ne)])]))),128))])])],8,ce)],64)}}},Be=G(Ae,[["__scopeId","data-v-f66b5a3f"]]);export{Be as default};

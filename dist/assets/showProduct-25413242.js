import{_ as ge,B as fe,K as B,L as he,M as ke,y as ye,z as be,x as k,C as we,u as M,N as Ce,O as Fe,r as z,o as c,c as l,a as o,e as v,p as C,t as r,D as q,F as E,d as U,f,b as K,H as Se,n as S,k as te,w as $e,v as xe,E as p}from"./index-8fc7e8a4.js";import{$ as y}from"./slick-theme-f39f0158.js";const Ie=["dir"],Te={class:"container"},ze={class:"product-details"},qe={class:"product-title"},Ee=["innerHTML"],Ne={class:"price-block"},Pe={class:"d-flex"},Ae={key:0,class:"price-old"},Ve={key:1,class:"discount-badge"},Le={class:"price-new"},Be=["title"],Me={class:"product-actions"},Ue={key:0,class:"sale-badge"},De={key:0,class:"weight"},Oe={class:"weight-container"},Re={class:"row g-4"},He=["onClick"],Qe={key:0,class:"amount-details",style:{"margin-top":"1rem"}},Je={key:1},je={class:"buttons-section"},Ke={key:0,class:"quantity-section"},We={class:"quantity-control"},Ge=["src"],Xe={class:"slider-wrapper"},Ye=["onClick"],Ze=["src"],et={key:0,class:"children-products-section"},tt={class:"title section-header d-flex align-items-center mb-4"},st={class:"mb-0"},at={class:"row g-3"},it={class:"product-card card border-0 h-100"},ot={class:"position-relative overflow-hidden bg-light"},nt=["src","alt"],rt={key:0,class:"sale-badge"},ct={class:"product-actions d-flex justify-content-center gap-2 w-100"},lt=["onClick","disabled"],dt=["onClick","disabled"],ut=["onClick","title"],vt={class:"card-body"},_t={class:"card-title"},pt={class:"price-container"},mt={key:0,class:"discount-badge"},gt={key:1,class:"price-old"},ft={class:"card-text card-price"},se=1,ae=99,W="/default-image.jpg",ht={__name:"showProduct",setup(kt){const{locale:F,t:u}=fe(),ie=B(()=>F.value==="ar"?"rtl":"ltr"),G=he();ke();const h=ye(),X=be(),t=k({}),g=k(1),N=k(null);k(0);const $=k(null),x=k(null),D=k(3),O=k(3),I=e=>h.favorites.some(s=>s.product_id===e),oe=e=>{var s,i;return((s=h.favorites.find(n=>n.product_id===e))==null?void 0:s.favorite_id)||((i=h.favorites.find(n=>n.product_id===e))==null?void 0:i.id)},ne=async e=>{var s,i;try{if(I(e.id)){const n=oe(e.id);n&&(await h.removeFromFavorites(n),p({title:u("success"),message:u("favorite_removed")||"Product removed from favorites",type:"success"}))}else{const n=await h.addToFavorites(e.id);p({title:u("success"),message:n.message||u("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Favorite error:",n),p({title:u("error"),message:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||u("login_required_favorite")||"Login required to favorite product",type:"error"})}},re=async()=>{var e,s;try{let i=0;if(t.value.discount&&t.value.discount.is_active){const _=parseFloat(t.value.discount.discount_value),w=parseFloat(t.value.converted_price||t.value.price);i=w-w*(_/100)}else i=parseFloat(t.value.converted_price)||parseFloat(t.value.price);const n={product_id:t.value.id,quantity:g.value,price:i};t.value.amounts&&(n.amount_id=t.value.amount_id);const d=await K.post("http://elegance_backend.test/api/cart-items",n,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});d.data.status?(p.success(d.data.message),X.incrementCount(),await X.fetchCartCount()):p.error(d.data.message)}catch(i){p.error(((s=(e=i.response)==null?void 0:e.data)==null?void 0:s.message)||u("Error adding product to cart"))}},P=e=>e?`http://elegance_backend.test/public/storage/${e}`:W,Y=e=>{e.target.src=W},A=e=>{N.value=e,M(()=>{const s=document.querySelector(".main-image");s&&(s.src=P(e))})},R=async()=>{var e;try{const s=JSON.parse(localStorage.getItem("selectedCurrency"))||{code:"USD"},i=await K.get(`http://elegance_backend.test/api/website/show/products/${G.params.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`,Currency:s.code}});i.data.status&&(t.value=i.data.data,t.value._original_price=t.value.price,(e=t.value.images)!=null&&e.length&&(N.value=t.value.images[0].path,M(()=>{Q(),J()})))}catch(s){console.error("Error fetching product:",s)}},Z=async e=>{var s,i,n;try{let d=0;if(e.discount&&e.discount.is_active){const m=parseFloat(e.discount.discount_value),L=parseFloat(e.converted_price||e.price);d=L-L*(m/100)}else d=parseFloat(e.converted_price)||parseFloat(e.price);const _={product_id:e.id,quantity:1,price:d},w=(s=JSON.parse(localStorage.getItem("auth_user")))==null?void 0:s.id;w&&(_.user_id=w),e.amounts&&(_.amount_id=e.amount_id);const a=await K.post("http://elegance_backend.test/api/cart-items",_,{headers:{Authorization:`Bearer ${localStorage.getItem("auth_token")}`}});a.data.message&&p({title:u("success"),message:a.data.message,type:"success"})}catch(d){console.error("Error adding child product to cart:",d),p({title:"❌",message:((n=(i=d.response)==null?void 0:i.data)==null?void 0:n.message)||u("add_to_cart_error")||"Login required to add to cart",type:"error"})}},T=k(null),H=(e,s)=>{T.value=e,t.value.amount_id=s.id,t.value.price=s.price,s.converted_price!==void 0?t.value.converted_price=s.converted_price:t.value.converted_price=s.price},ce=()=>{T.value=null,t.value.amount_id=null,t.value.price=t.value._original_price!==void 0?t.value._original_price:t.value.price,t.value.converted_price=void 0},Q=()=>{var n;const e=y($.value),s=y(x.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick");const i=((n=t.value.images)==null?void 0:n.length)||0;O.value=i,D.value=i>=4?3:1,e.slick({dots:!1,centerMode:!0,centerPadding:"0px",slidesToShow:D.value,slidesToScroll:1,infinite:i>1,focusOnSelect:!0,rtl:F.value==="ar",asNavFor:s,afterChange:function(d){const _=t.value.images[d];_&&A(_.path)}}),s.slick({slidesToShow:1,slidesToScroll:1,infinite:i>1,fade:!0,arrows:!1,dots:!1,centerMode:!0,rtl:F.value==="ar",asNavFor:e,afterChange:function(d){const _=t.value.images[d];_&&A(_.path)}})},le=()=>{const e=y($.value),s=y(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickPrev"),s.slick("slickPrev"),ee())},de=()=>{const e=y($.value),s=y(x.value);e.length&&e.hasClass("slick-initialized")&&(e.slick("slickNext"),s.slick("slickNext"),ee())},ee=()=>{const e=y($.value);if(e.length&&e.hasClass("slick-initialized")){const i=e.find(".slick-current").find("img").attr("src").replace("http://elegance_backend.test/public/storage/","");A(i)}};we(async()=>{var e,s;await R(),(s=(e=t.value)==null?void 0:e.amounts)!=null&&s.length&&H(0,t.value.amounts[0]),M(()=>{Q(),J()}),window.addEventListener("currency-changed",R)}),Ce(()=>G.params.id,async e=>{var s,i;await R(),(i=(s=t.value)==null?void 0:s.amounts)!=null&&i.length&&H(0,t.value.amounts[0]),M(()=>{Q(),J()})}),Fe(()=>{const e=y(x.value),s=y($.value);e.hasClass("slick-initialized")&&e.slick("unslick"),s.hasClass("slick-initialized")&&s.slick("unslick")});const V=e=>h.isInFavorites(e.id),ue=async e=>{var s,i;try{if(V(e)){const n=h.favorites.find(d=>d.product_id===e.id);if(n){const d=n.favorite_id||n.id;await h.removeFromFavorites(d),p({title:u("success"),message:u("favorite_removed")||"Product removed from favorites",type:"success"})}}else{const n=await h.addToFavorites(e.id);n&&p({title:u("success"),message:n.message||u("favorite_added")||"Product added to favorites",type:"success"})}}catch(n){console.error("Error toggling child favorites:",n),p({title:u("error"),message:((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||u("login_required_favorite")||"Login required to favorite product",type:"error"})}},ve=()=>{g.value<ae?g.value++:p({title:u("warning"),message:u("max_quantity_reached"),type:"warning"})},_e=()=>{g.value>se?g.value--:p({title:u("warning"),message:u("min_quantity_reached"),type:"warning"})},J=()=>{I(t.value.id)},pe=e=>{if(e.discount&&e.discount.is_active){const s=parseFloat(e.discount.discount_value),i=parseFloat(e.converted_price);return(i-i*(s/100)).toFixed(2)}return e.converted_price},j=B(()=>b.value?b.value.converted_price!==void 0?b.value.converted_price:b.value.price:t.value.converted_price!==void 0?t.value.converted_price:t.value.price),me=B(()=>{if(t.value.discount&&t.value.discount.is_active){const e=parseFloat(t.value.discount.discount_value),s=parseFloat(j.value);return(s-s*(e/100)).toFixed(2)}return j.value}),b=B(()=>t.value.amounts&&t.value.amounts.length>0&&T.value!==null?t.value.amounts[T.value]:null);return(e,s)=>{const i=z("fa"),n=z("el-button"),d=z("el-col"),_=z("el-row"),w=z("router-link");return c(),l(E,null,[s[7]||(s[7]=o("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap",rel:"stylesheet"},null,-1)),v(Se),o("div",{class:"product-show",dir:ie.value},[o("div",Te,[v(_,{gutter:20,class:"product-container full-height-row flex-md-row flex-column-reverse"},{default:C(()=>[v(d,{xs:24,sm:24,md:12,lg:14},{default:C(()=>[o("div",ze,[o("h1",qe,r(q(F)==="ar"?t.value.name_ar:t.value.name_en),1),o("div",{innerHTML:q(F)==="ar"?t.value.description_ar:t.value.description_en,class:"description"},null,8,Ee),o("div",Ne,[o("div",Pe,[t.value.discount&&t.value.discount.is_active?(c(),l("span",Ae,r(j.value)+" "+r(t.value.currency_code),1)):f("",!0),t.value.discount&&t.value.discount.is_active?(c(),l("span",Ve," -"+r(t.value.discount.discount_value)+"% ",1)):f("",!0)]),o("span",Le,r(me.value)+" "+r(t.value.currency_code),1)]),o("button",{onClick:s[0]||(s[0]=a=>ne(t.value)),class:S(["btn rounded-circle shadow-sm btn-light",I(t.value.id)?"text-danger":""]),title:I(t.value.id)?"Remove from favorites":"Add to favorites"},[v(i,{icon:I(t.value.id)?"fas fa-heart":"far fa-heart",size:"xl"},null,8,["icon"])],10,Be),o("div",Me,[t.value.is_available?f("",!0):(c(),l("div",Ue,r(e.$t("products.outOfStock")),1))]),t.value.amounts&&t.value.amounts.length>0?(c(),l("div",De,[s[6]||(s[6]=o("h1",{class:"weight-title"},"Select Weight",-1)),o("div",{class:"reset",onClick:ce},[v(i,{icon:"rotate-right"}),s[3]||(s[3]=o("a",null,"reset",-1))]),o("div",Oe,[o("div",Re,[(c(!0),l(E,null,U(t.value.amounts,(a,m)=>(c(),l("div",{key:a.id,class:S(["weight-item",{active:T.value===m}]),onClick:L=>H(m,a)},[o("p",null,r(a.weight)+" "+r(a.unit.name_en)+" For "+r(a.price)+" "+r(t.value.currency_code),1)],10,He))),128))])]),b.value?(c(),l("div",Qe,[o("p",null,[s[4]||(s[4]=o("strong",null,"Selected:",-1)),te(" "+r(b.value.weight)+" "+r(b.value.unit.name_en)+" - "+r(b.value.price)+" "+r(t.value.currency_code),1)])])):(c(),l("div",Je,s[5]||(s[5]=[o("p",null,"No amount selected.",-1)])))])):f("",!0),o("div",je,[v(n,{class:"add-to-cart btn",disabled:!t.value.is_available,type:"primary",size:"large",round:"",onClick:re},{default:C(()=>[te(r(e.$t("products.addToCart")),1)]),_:1},8,["disabled"]),t.value.is_available?(c(),l("div",Ke,[o("div",We,[v(n,{size:"small",onClick:_e,disabled:g.value<=se,class:"qty-btn"},{default:C(()=>[v(i,{icon:"minus"})]),_:1},8,["disabled"]),$e(o("input",{class:"qty-number",type:"number",min:"1",max:"99","onUpdate:modelValue":s[1]||(s[1]=a=>g.value=a),onInput:s[2]||(s[2]=a=>g.value=Math.min(g.value))},null,544),[[xe,g.value,void 0,{number:!0}]]),v(n,{size:"small",onClick:ve,disabled:g.value>=ae,class:"qty-btn"},{default:C(()=>[v(i,{icon:"plus"})]),_:1},8,["disabled"])])])):f("",!0)])])]),_:1}),v(d,{xs:24,sm:24,md:12,lg:10,class:"image-col"},{default:C(()=>[o("div",{class:"image-wrapper",ref_key:"main",ref:x},[(c(!0),l(E,null,U(t.value.images,(a,m)=>(c(),l("div",{key:a.id,class:"slide"},[o("img",{src:P(N.value),class:"main-image",onError:Y},null,40,Ge)]))),128))],512),o("div",Xe,[O.value>1?(c(),l("button",{key:0,class:"btn nav-button left",onClick:le},[v(i,{icon:"arrow-left"})])):f("",!0),o("div",{class:S(["slider-container",{"centered-slides":D.value<3}])},[o("div",{class:"slider",ref_key:"slider",ref:$},[(c(!0),l(E,null,U(t.value.images,(a,m)=>(c(),l("div",{key:a.id,class:"slide",onClick:L=>A(a.path)},[o("img",{src:P(a.path),class:S({active:N.value===a.path}),onError:Y},null,42,Ze)],8,Ye))),128))],512)],2),O.value>1?(c(),l("button",{key:1,class:"btn nav-button right",onClick:de},[v(i,{icon:"arrow-right"})])):f("",!0)])]),_:1})]),_:1}),t.value.children&&t.value.children.length>0?(c(),l("div",et,[o("div",tt,[v(i,{class:"fa-icon me-2",icon:["fas","shopping-basket"]}),o("h2",st,r(q(u)("products.relatedProducts")),1)]),o("div",at,[(c(!0),l(E,null,U(t.value.children,a=>(c(),l("div",{class:"col-6 col-md-4 col-lg-3",key:a.id},[o("div",it,[o("div",ot,[v(w,{to:`/read/products/${a.id}`},{default:C(()=>{var m;return[o("img",{src:(m=a.images)!=null&&m.length?P(a.images[0].path):W,alt:q(F)==="ar"?a.name_ar:a.name_en,class:"card-img-top product-img"},null,8,nt)]}),_:2},1032,["to"]),a.is_available?f("",!0):(c(),l("div",rt,r(e.$t("products.outOfStock")),1)),o("div",ct,[v(w,{to:`/read/products/${a.id}`,class:"btn btn-light rounded-circle shadow-sm",title:"View"},{default:C(()=>[v(i,{icon:"eye"})]),_:2},1032,["to"]),o("button",{onClick:m=>Z(a),class:S(["btn btn-light shadow-sm disable",{disabled:!a.is_available}]),disabled:!a.is_available},r(e.$t("home.add-to-cart")),11,lt),o("button",{onClick:m=>Z(a),class:S(["d-none btn rounded-circle btn-light shadow-sm enable",{disabled:!a.is_available}]),disabled:!a.is_available},[v(i,{icon:"cart-plus"})],10,dt),o("button",{onClick:m=>ue(a),class:S(["btn rounded-circle shadow-sm btn-light",V(a)?"text-danger":""]),title:V(a)?"Remove from favorites":"Add to favorites"},[v(i,{icon:V(a)?"fas fa-heart":"far fa-heart"},null,8,["icon"])],10,ut)])]),o("div",vt,[o("h5",_t,r(q(F)==="ar"?a.name_ar:a.name_en),1),o("div",pt,[a.discount&&a.discount.is_active?(c(),l("span",mt," -"+r(a.discount.discount_value)+"% ",1)):f("",!0),a.discount&&a.discount.is_active?(c(),l("span",gt,r(a.converted_price||a.price)+" "+r(a.currency_code||"UAE"),1)):f("",!0),o("span",ft,r(pe(a))+" "+r(a.currency_code||"UAE"),1)])])])]))),128))])])):f("",!0)])],8,Ie)],64)}}},wt=ge(ht,[["__scopeId","data-v-bae581b1"]]);export{wt as default};

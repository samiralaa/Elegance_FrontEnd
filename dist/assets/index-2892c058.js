import{_ as de,D as ue,C as ie,y as _,L as O,E as ce,r,V as pe,o as g,c as B,a as s,t as c,e as o,G as S,p as l,b as p,W as m,a9 as me,m as V,a3 as _e,w as F,k as N,a6 as T,F as ve,d as fe,v as W,a5 as be}from"./index-3d2ca9dc.js";const ge={class:"products-container"},he={class:"header"},ye={class:"image-error"},we={key:1,class:"image-error"},Pe={dir:"rtl"},ke={class:"d-flex flex-column gap-1 align-items-center",dir:"ltr"},Ve={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},$e=["onClick"],De=["onClick"],Ce=["onClick"],Ae={class:"btn-group",role:"group","aria-label":"Basic mixed styles example"},Se=["onClick"],Ee=["onClick"],Ue={class:"dialog-footer"},h="https://backend.webenia.org",Be={__name:"index",setup(Fe){const E=ue(),{t:$}=ie(),y=_([]),w=_(!1),D=_(""),x=O(()=>{if(!D.value)return y.value;const e=D.value.toLowerCase();return y.value.filter(t=>t.name_en&&t.name_en.toLowerCase().includes(e)||t.name_ar&&t.name_ar.toLowerCase().includes(e))}),i=localStorage.getItem("lang")||"en",I=h+"/api/dashboard/products",R=async()=>{w.value=!0;try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization="Bearer "+e.token;const t=await p.get(I);if(t.data.status)y.value=t.data.data;else throw new Error(t.data.message||"Failed to fetch products")}catch(e){console.error("Fetch products error:",e),m.error(i==="ar"?"فشل في تحميل المنتجات":"Failed to load products")}finally{w.value=!1}},q=()=>{E.push("/products/create")},G=e=>{E.push(`/products/${e}`)},Q=e=>{E.push(`/products/${e.id}/edit`)},Y=async e=>{try{if(await be.confirm($("Products.DeleteConfirmation"),$("Products.Warning"),{confirmButtonText:$("Products.Yes"),cancelButtonText:$("Products.No"),type:"warning"})==="confirm"){w.value=!0;const u=JSON.parse(localStorage.getItem("tokenData"));if(!u||!u.token)throw new Error("Authentication token not found");p.defaults.headers.common.Authorization="Bearer "+u.token;const v=await p.delete(I+"/"+e.id);if(v.data.status)m.success(i==="ar"?"تم حذف المنتج بنجاح":"Product deleted successfully"),y.value=y.value.filter(C=>C.id!==e.id);else throw new Error(v.data.message||"Failed to delete product")}}catch(t){t!=="cancel"&&(console.error("Delete product error:",t),m.error(i==="ar"?"فشل في حذف المنتج":"Failed to delete product"))}finally{w.value=!1}},P=_(!1),U=_(null),L=_([]),d=_({unit_id:"",weight:"",price:""}),j=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization="Bearer "+e.token;const t=await p.get(h+"/api/units");L.value=t.data.data}catch(e){console.error("Failed to fetch units:",e),m.error(i==="ar"?"فشل في تحميل الوحدات":"Failed to load units")}},H=e=>{U.value=e,d.value={unit_id:"",weight:"",price:""},j(),P.value=!0},K=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization="Bearer "+e.token;const t={product_id:U.value.id,unit_id:d.value.unit_id,weight:d.value.weight,price:d.value.price};(await p.post(h+"/api/amounts",t)).data.status?(m.success(i==="ar"?"تم إضافة الكمية بنجاح":"Amount added successfully"),P.value=!1):m.error(i==="ar"?"فشل في إضافة الكمية":"Failed to add amount")}catch(e){console.error(e),m.error(i==="ar"?"حدث خطأ أثناء حفظ الكمية":"Error occurred while saving amount")}},k=_(!1),n=_({start_date:"",duration:"",discount_value:"",is_active:!1,product_id:"",category_id:"",end_date:""}),X=e=>{U.value=e,n.value={start_date:"",duration:"",discount_value:"",is_active:!1,product_id:e.id,category_id:e.category_id||"",end_date:""},k.value=!0},Z=async()=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));p.defaults.headers.common.Authorization="Bearer "+e.token;const t={start_date:n.value.start_date,duration:n.value.duration,discount_value:n.value.discount_value,is_active:n.value.is_active,product_id:n.value.product_id,category_id:n.value.category_id,end_date:n.value.end_date};(await p.post(h+"/api/discounts",t)).data?(m.success(i==="ar"?"تم إضافة الخصم بنجاح":"Discount added successfully"),k.value=!1):m.error(i==="ar"?"فشل في إضافة الخصم":"Failed to add discount")}catch(e){console.error(e),m.error(i==="ar"?"حدث خطأ أثناء حفظ الخصم":"Error occurred while saving discount")}},ee=O(()=>window.innerWidth<=768);return ce(()=>{R()}),(e,t)=>{const u=r("el-input"),v=r("el-button"),C=r("el-icon"),te=r("el-image"),b=r("el-table-column"),ae=r("el-table"),oe=r("el-card"),le=r("el-option"),ne=r("el-select"),f=r("el-form-item"),z=r("el-form"),J=r("el-dialog"),M=r("el-date-picker"),se=r("el-switch"),re=pe("loading");return g(),B("div",ge,[s("div",he,[s("h2",null,c(e.$t("Products.Products")),1),o(u,{modelValue:D.value,"onUpdate:modelValue":t[0]||(t[0]=a=>D.value=a),placeholder:e.$t("Products.SearchPlaceholder"),"prefix-icon":S(me),clearable:"",class:"search-input",style:{"max-width":"250px","margin-right":"16px"}},null,8,["modelValue","placeholder","prefix-icon"]),o(v,{type:"primary",icon:S(_e),onClick:q},{default:l(()=>[V(c(e.$t("Products.AddProduct")),1)]),_:1},8,["icon"])]),o(oe,{class:"products-table"},{default:l(()=>[F((g(),N(ae,{data:x.value,class:"table-responsivew",style:{height:"70vh"},dir:"ltr"},{default:l(()=>[o(b,{label:e.$t("Products.Image"),width:"120"},{default:l(({row:a})=>[a.images&&a.images.length>0?(g(),N(te,{key:0,src:h+"/"+a.images[0].path,fit:"cover",class:"product-image","preview-src-list":[h+"/public/storage/"+a.images[0].path],"initial-index":0,"preview-teleported":""},{error:l(()=>[s("div",ye,[o(C,null,{default:l(()=>[o(S(T))]),_:1})])]),_:2},1032,["src","preview-src-list"])):(g(),B("div",we,[o(C,null,{default:l(()=>[o(S(T))]),_:1})]))]),_:1},8,["label"]),o(b,{prop:"name_en",label:e.$t("Products.NameEn")},null,8,["label"]),o(b,{prop:"name_ar",label:e.$t("Products.NameAr")},{default:l(({row:a})=>[s("div",Pe,c(a.name_ar||e.$t("Products.NA")),1)]),_:1},8,["label"]),o(b,{prop:"price",label:e.$t("Products.Price")},null,8,["label"]),o(b,{prop:"currency.name_en",label:e.$t("Products.Currency")},null,8,["label"]),o(b,{label:e.$t("Products.Actions"),width:"250"},{default:l(({row:a})=>[s("div",ke,[s("div",Ve,[s("button",{type:"button",class:"btn btn-success btn-sm",onClick:A=>G(a.id)},c(e.$t("Products.View")),9,$e),s("button",{type:"button",class:"btn btn-warning btn-sm",onClick:A=>Q(a)},c(e.$t("Products.Edit")),9,De),s("button",{type:"button",class:"btn btn-danger btn-sm",onClick:A=>Y(a)},c(e.$t("Products.Delete")),9,Ce)]),s("div",Ae,[s("button",{type:"button",class:"btn btn-secondary btn-sm",onClick:A=>H(a)},c(e.$t("Products.addAmount")),9,Se),s("button",{type:"button",class:"btn btn-info btn-sm",onClick:A=>X(a)},c(e.$t("Products.addDiscount")),9,Ee)])])]),_:1},8,["label"])]),_:1},8,["data"])),[[re,w.value]])]),_:1}),o(J,{modelValue:P.value,"onUpdate:modelValue":t[5]||(t[5]=a=>P.value=a),title:"Add Product Amount",width:"500px"},{footer:l(()=>[o(v,{onClick:t[4]||(t[4]=a=>P.value=!1)},{default:l(()=>t[15]||(t[15]=[V("Cancel")])),_:1,__:[15]}),o(v,{type:"primary",onClick:K},{default:l(()=>t[16]||(t[16]=[V("Submit")])),_:1,__:[16]})]),default:l(()=>[o(z,{model:d.value,"label-width":"100px"},{default:l(()=>[o(f,{label:"Unit"},{default:l(()=>[o(ne,{modelValue:d.value.unit_id,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value.unit_id=a),placeholder:"Select Unit"},{default:l(()=>[(g(!0),B(ve,null,fe(L.value,a=>(g(),N(le,{key:a.id,label:a.name_en,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"Weight"},{default:l(()=>[o(u,{modelValue:d.value.weight,"onUpdate:modelValue":t[2]||(t[2]=a=>d.value.weight=a),type:"number",placeholder:"Enter weight"},null,8,["modelValue"])]),_:1}),o(f,{label:"Price"},{default:l(()=>[o(u,{modelValue:d.value.price,"onUpdate:modelValue":t[3]||(t[3]=a=>d.value.price=a),type:"number",placeholder:"Enter price"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(J,{modelValue:k.value,"onUpdate:modelValue":t[14]||(t[14]=a=>k.value=a),title:e.$t("Products.addDiscount"),width:ee.value?"90%":"500px",class:"discount-dialog"},{footer:l(()=>[s("div",Ue,[o(v,{onClick:t[13]||(t[13]=a=>k.value=!1)},{default:l(()=>[V(c(e.$t("Products.cancel")),1)]),_:1}),o(v,{type:"primary",onClick:Z},{default:l(()=>[V(c(e.$t("Products.submit")),1)]),_:1})])]),default:l(()=>[o(z,{model:n.value,"label-width":"100px",class:"discount-form"},{default:l(()=>[o(f,{label:e.$t("Products.Start-Date")},{default:l(()=>[o(M,{modelValue:n.value.start_date,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.start_date=a),type:"date",placeholder:e.$t("Products.Select-start-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("Products.Duration-days")},{default:l(()=>[o(u,{modelValue:n.value.duration,"onUpdate:modelValue":t[7]||(t[7]=a=>n.value.duration=a),type:"number",placeholder:e.$t("Products.Enter-duration-days"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("Products.Discount-Value")},{default:l(()=>[o(u,{modelValue:n.value.discount_value,"onUpdate:modelValue":t[8]||(t[8]=a=>n.value.discount_value=a),type:"number",placeholder:e.$t("Products.Enter-discount-percentage"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("Products.Is-Active")},{default:l(()=>[o(se,{modelValue:n.value.is_active,"onUpdate:modelValue":t[9]||(t[9]=a=>n.value.is_active=a)},null,8,["modelValue"])]),_:1},8,["label"]),F(s("input",{type:"hidden","onUpdate:modelValue":t[10]||(t[10]=a=>n.value.product_id=a)},null,512),[[W,n.value.product_id]]),F(s("input",{type:"hidden","onUpdate:modelValue":t[11]||(t[11]=a=>n.value.category_id=a)},null,512),[[W,n.value.category_id]]),o(f,{label:e.$t("Products.End-Date")},{default:l(()=>[o(M,{modelValue:n.value.end_date,"onUpdate:modelValue":t[12]||(t[12]=a=>n.value.end_date=a),type:"date",placeholder:e.$t("Products.Select-end-date"),class:"w-100"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title","width"])])}}},Ie=de(Be,[["__scopeId","data-v-ff877909"]]);export{Ie as default};

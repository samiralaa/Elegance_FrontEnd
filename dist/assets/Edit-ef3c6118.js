import{_ as x,D as ee,M as le,y,L as ae,E as te,r as v,o as d,c as p,e as u,p as o,b as c,a as S,t as P,F as m,m as w,d as g,k as b,f as k,V as F}from"./index-e6d81d92.js";const ue={class:"product-edit-container"},oe={key:3,class:"image-preview-list",style:{"margin-bottom":"1em"}},re=["src"],ne={class:"el-upload__text"},V="https://backend.webenia.org",de={__name:"Edit",setup(ie){const L=ee(),T=le(),E=y(null),R=T.params.id,e=y({name_en:"",name_ar:"",price:"",is_available:1,description_en:"",description_ar:"",category_id:null,currency_id:null,country_id:null,parent_id:null,brand_id:null,images:[],amount_required:!1,amounts:[],unit_id:null,weight:null,amount_price:null}),M=()=>{e.value.amounts.push({unit_id:null,weight:null,price:null})},O=a=>{if(e.value.amounts.length<=1){F.warning(localStorage.getItem("lang")==="ar"?"يجب عليك حفظ كمية واحدة على الاقل":"At least one amount entry is required.");return}if(confirm(localStorage.getItem("lang")==="ar"?"سيتم حذف الكمية":"The amount will be deleted"))e.value.amounts.splice(a,1);else return},W={name_en:[{required:!0,message:"Required",trigger:"blur"}],price:[{required:!0,message:"Required",trigger:"blur"}]},U=y([]),C=y([]),q=y([]),I=y([]),N=y([]),A=y([]),z=a=>(localStorage.getItem("lang")||"en")==="ar"?a.name_ar:a.name_en,J=ae(()=>C.value.filter(a=>!a.is_deleted)),B=a=>a?typeof a=="object"&&a.url?a.url:a.startsWith("http")?a:`${V}/public/storage/${a}`:"",j=async()=>{var h;const a=(h=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:h.token;c.defaults.headers.common.Authorization=`Bearer ${a}`;const[t,r,n,s,i,f]=await Promise.all([c.get(`${V}/api/categories`),c.get(`${V}/api/currencies`),c.get(`${V}/api/countries`),c.get(`${V}/api/products`),c.get(`${V}/api/brands`),c.get(`${V}/api/units`)]);U.value=t.data.data,C.value=r.data,q.value=n.data.data,I.value=s.data.data,N.value=i.data.data,A.value=f.data.data},Y=async()=>{var a;try{const r=(await c.get(`/api/products/${R}`)).data.data;e.value.name_ar=r.name_ar,e.value.name_en=r.name_en,e.value.description_ar=r.description_ar,e.value.description_en=r.description_en,e.value.price=r.price,e.value.currency_id=r.currency_id,e.value.country_id=r.country_id,e.value.brand_id=r.brand_id,e.value.parent_id=r.parent_id,e.value.quantity=r.quantity??1,e.value.amounts=((a=r.amounts)==null?void 0:a.map(i=>({unit_id:i.unit_id,weight:i.weight,price:i.price,id:i.id})))||[],e.value.type=r.type??"product",e.value.offer=r.discount?"1":"0",e.value.offer_price=r.discount?r.discounted_price:"",e.value.category_id=r.category_id,e.value.images=r.images.map(i=>({id:i.id,path:i.path,url:B(i.path)}));const[n,s]=await Promise.all([c.get("/api/categories"),c.get("/api/currencies")]);U.value=n.data,C.value=s.data}catch(t){console.error("Error loading product data",t)}},G=(a,t)=>e.value.images=t,H=(a,t)=>e.value.images=t,K=()=>{E.value.validate(async a=>{var n;if(!a)return;const t=new FormData;for(const s in e.value)s!=="images"&&e.value[s]!==null&&t.append(s,e.value[s]);e.value.amounts.forEach((s,i)=>{t.append(`amounts[${i}][unit_id]`,s.unit_id),t.append(`amounts[${i}][weight]`,s.weight),t.append(`amounts[${i}][price]`,s.price),s.id&&t.append(`amounts[${i}][id]`,s.id)}),e.value.images.forEach(s=>{s.raw?t.append("images[]",s.raw):s.id&&t.append("existing_images[]",s.id)});const r=(n=JSON.parse(localStorage.getItem("tokenData")))==null?void 0:n.token;c.defaults.headers.common.Authorization=`Bearer ${r}`,await c.post(`${V}/api/products/${R}?_method=PUT`,t,{headers:{"Content-Type":"multipart/form-data"}}),F.success("Product updated successfully"),L.push("/products")})};return te(()=>{j(),Y()}),(a,t)=>{const r=v("el-input"),n=v("el-form-item"),s=v("el-divider"),i=v("el-option"),f=v("el-select"),h=v("el-button"),D=v("el-switch"),Q=v("el-upload"),X=v("el-form"),Z=v("el-card");return d(),p("div",ue,[u(Z,{class:"product-card"},{default:o(()=>[S("h2",null,P(a.$t("Products.EditProduct")),1),u(X,{model:e.value,ref_key:"formRef",ref:E,rules:W,"label-width":"120px",enctype:"multipart/form-data"},{default:o(()=>[u(n,{label:a.$t("Products.NameEn"),prop:"name_en"},{default:o(()=>[u(r,{modelValue:e.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=l=>e.value.name_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.NameAr"),prop:"name_ar"},{default:o(()=>[u(r,{modelValue:e.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=l=>e.value.name_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),e.value.amounts?(d(),p(m,{key:0},[u(s,{"content-position":"left"},{default:o(()=>[w(P(a.$t("Products.Amount-Info")),1)]),_:1}),(d(!0),p(m,null,g(e.value.amounts,(l,$)=>(d(),p("div",{key:$,class:"amount-entry mb-3"},[u(n,{label:a.$t("Products.Unit"),prop:`amounts.${$}.unit_id`},{default:o(()=>[u(f,{modelValue:l.unit_id,"onUpdate:modelValue":_=>l.unit_id=_,placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:o(()=>[(d(!0),p(m,null,g(A.value,_=>(d(),b(i,{key:_.id,label:_.name_en,value:_.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label","prop"]),u(n,{label:a.$t("Products.Weight"),prop:`amounts.${$}.weight`},{default:o(()=>[u(r,{modelValue:l.weight,"onUpdate:modelValue":_=>l.weight=_,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),u(n,{label:a.$t("Products.amount-Price"),prop:`amounts.${$}.price`},{default:o(()=>[u(r,{modelValue:l.price,"onUpdate:modelValue":_=>l.price=_,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label","prop"]),e.value.amounts.length>0?(d(),b(h,{key:0,type:"danger",onClick:_=>O($),icon:"el-icon-delete"},{default:o(()=>[w(P(a.$t("Products.RemoveAmount")),1)]),_:2},1032,["onClick"])):k("",!0),u(s)]))),128)),e.value.amounts.length>0?(d(),b(h,{key:0,type:"success",plain:"",onClick:M,icon:"el-icon-plus"},{default:o(()=>[w(P(a.$t("Products.AddAmount")),1)]),_:1})):k("",!0)],64)):k("",!0),u(n,{label:a.$t("Products.Needs-Amount")},{default:o(()=>[u(D,{modelValue:e.value.amount_required,"onUpdate:modelValue":t[2]||(t[2]=l=>e.value.amount_required=l),"active-text":"Yes","inactive-text":"No",dir:"ltr",class:"mx-3"},null,8,["modelValue"])]),_:1},8,["label"]),e.value.amount_required?(d(),p(m,{key:1},[u(s,{"content-position":"left"},{default:o(()=>[w(P(a.$t("Products.Amount-Info")),1)]),_:1}),u(n,{label:a.$t("Products.Unit"),prop:"unit_id"},{default:o(()=>[u(f,{modelValue:e.value.unit_id,"onUpdate:modelValue":t[3]||(t[3]=l=>e.value.unit_id=l),placeholder:a.$t("Products.select-unit"),filterable:"",clearable:""},{default:o(()=>[(d(!0),p(m,null,g(A.value,l=>(d(),b(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.Weight"),prop:"weight"},{default:o(()=>[u(r,{modelValue:e.value.weight,"onUpdate:modelValue":t[4]||(t[4]=l=>e.value.weight=l),type:"number",placeholder:a.$t("Products.select-weight")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.amount-Price"),prop:"amount_price"},{default:o(()=>[u(r,{modelValue:e.value.amount_price,"onUpdate:modelValue":t[5]||(t[5]=l=>e.value.amount_price=l),type:"number",placeholder:a.$t("Products.select-price")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])],64)):k("",!0),e.value.amount_required?k("",!0):(d(),b(n,{key:2,label:a.$t("Products.Price"),prop:"price"},{default:o(()=>[u(r,{modelValue:e.value.price,"onUpdate:modelValue":t[6]||(t[6]=l=>e.value.price=l),type:"number"},null,8,["modelValue"])]),_:1},8,["label"])),u(n,{label:a.$t("Products.Availability"),prop:"is_available"},{default:o(()=>[u(D,{modelValue:e.value.is_available,"onUpdate:modelValue":t[7]||(t[7]=l=>e.value.is_available=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.DescriptionEn"),prop:"description_en"},{default:o(()=>[u(r,{type:"textarea",modelValue:e.value.description_en,"onUpdate:modelValue":t[8]||(t[8]=l=>e.value.description_en=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.DescriptionAr"),prop:"description_ar"},{default:o(()=>[u(r,{type:"textarea",modelValue:e.value.description_ar,"onUpdate:modelValue":t[9]||(t[9]=l=>e.value.description_ar=l)},null,8,["modelValue"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.Category"),prop:"category_id"},{default:o(()=>[u(f,{modelValue:e.value.category_id,"onUpdate:modelValue":t[10]||(t[10]=l=>e.value.category_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCategory")},{default:o(()=>[(d(!0),p(m,null,g(U.value,l=>(d(),b(i,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.brand"),prop:"brand_id"},{default:o(()=>[u(f,{modelValue:e.value.brand_id,"onUpdate:modelValue":t[11]||(t[11]=l=>e.value.brand_id=l),filterable:"",clearable:"",placeholder:"Select Brand"},{default:o(()=>[(d(!0),p(m,null,g(N.value,l=>(d(),b(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.Currency"),prop:"currency_id"},{default:o(()=>[u(f,{modelValue:e.value.currency_id,"onUpdate:modelValue":t[12]||(t[12]=l=>e.value.currency_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCurrency")},{default:o(()=>[(d(!0),p(m,null,g(J.value,l=>(d(),b(i,{key:l.id,label:z(l),value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.Country"),prop:"country_id"},{default:o(()=>[u(f,{modelValue:e.value.country_id,"onUpdate:modelValue":t[13]||(t[13]=l=>e.value.country_id=l),filterable:"",clearable:"",placeholder:a.$t("Products.SelectCountry")},{default:o(()=>[(d(!0),p(m,null,g(q.value,l=>(d(),b(i,{key:l.id,label:l.name_en||l.name_ar,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),u(n,{label:a.$t("Products.ParentProduct"),prop:"parent_id"},{default:o(()=>[u(f,{modelValue:e.value.parent_id,"onUpdate:modelValue":t[14]||(t[14]=l=>e.value.parent_id=l),clearable:"",placeholder:a.$t("Products.SelectParentProduct")},{default:o(()=>[u(i,{label:a.$t("Products.None"),value:null},null,8,["label"]),(d(!0),p(m,null,g(I.value,l=>(d(),b(i,{key:l.id,label:l.name_en,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e.value.images&&e.value.images.length?(d(),p("div",oe,[(d(!0),p(m,null,g(e.value.images,(l,$)=>(d(),p("img",{key:$,src:l.url?l.url:B(l.path),alt:"Product Image",style:{"max-width":"120px","max-height":"120px","margin-right":"10px","border-radius":"8px"}},null,8,re))),128))])):k("",!0),u(n,{label:a.$t("Products.Images"),prop:"images"},{default:o(()=>[u(Q,{class:"upload-demo",drag:"",action:"","auto-upload":!1,limit:5,"file-list":e.value.images,"list-type":"picture","on-change":G,"on-remove":H},{default:o(()=>[t[15]||(t[15]=S("i",{class:"el-icon-upload"},null,-1)),S("div",ne,P(a.$t("Products.DropFiles")),1)]),_:1,__:[15]},8,["file-list"])]),_:1},8,["label"]),u(n,null,{default:o(()=>[u(h,{type:"primary",onClick:K},{default:o(()=>[w(P(a.$t("Products.UpdateButton")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},pe=x(de,[["__scopeId","data-v-0c9dd9c9"]]);export{pe as default};

import{_ as Y,y as c,L as I,E as Z,r as d,a5 as ee,o as u,c as h,a as t,t as a,e as s,p as n,w as te,k as C,f as B,b as g,V as f,G as b,a9 as le,F,d as L,m as y,aa as oe,ab as ae,$ as se}from"./index-677ab39b.js";const ne={class:"orders-page"},re={class:"orders-header"},de={class:"orders-filters"},ie={class:"",id:"invoice-print"},ce={class:"card p-4"},ue={class:"d-flex justify-content-between"},pe=["src"],_e={class:"row mb-4"},me={class:"col-md-6"},ve={class:"mb-0"},he={class:"mb-0"},ge={class:"mb-0"},fe={class:"col-md-6 text-md-end"},be={class:"mb-0"},ye={class:"mb-0"},we={class:"table table-hover table-bordered"},ke={class:"text-end"},De={class:"text-end"},w=5,Se={__name:"Orders",setup($e){const O=c([]),p=c(""),m=c(""),k=c(1),D=c(!1),r=c(null),S=c(!1),x=c("assets/logo.png"),z=["pending","processing","cancelled"],E=async()=>{S.value=!0;try{const l=JSON.parse(localStorage.getItem("tokenData"));if(!l||!l.token)throw new Error("Authentication token not found");g.defaults.headers.common.Authorization=`Bearer ${l.token}`;const e=await g.get("https://backend.webenia.org/api/orders");if(e.data.status===!0)O.value=e.data.data;else throw new Error(e.data.message||"Failed to fetch orders")}catch(l){console.error("Error fetching orders:",l),f.error(l.message||"Failed to fetch orders")}finally{S.value=!1}},$=I(()=>O.value.filter(l=>{const e=p.value===""||l.id.toString().includes(p.value.toLowerCase())||l.total_price.includes(p.value.toLowerCase()),i=!m.value||l.status===m.value;return e&&i})),U=I(()=>{const l=(k.value-1)*w,e=l+w;return $.value.slice(l,e)}),N=l=>{k.value=l},T=l=>{r.value=l,D.value=!0,console.log("Selected Order:",r.value)},A=()=>{const l=document.getElementById("invoice-print");l.style.display="block";const e=window.open("","","width=800,height=600");e.document.write(`
  <html>
    <head>
      <title>Invoice</title>
      
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    </head>
    <body>
      ${l.innerHTML}
    </body>
  </html>
`),e.document.close(),e.focus(),e.print(),e.close()},P=l=>{const e=new Date(l);return e.toLocaleDateString()+" "+e.toLocaleTimeString()},j=l=>({pending:"info",processing:"warning",cancelled:"danger"})[l.toLowerCase()]||"info",M=async l=>{try{const e=JSON.parse(localStorage.getItem("tokenData"));if(!e||!e.token)throw new Error("Authentication token not found");g.defaults.headers.common.Authorization=`Bearer ${e.token}`;const i=await g.post(`https://backend.webenia.org/api/orders/${l.id}/cancel`);if(i.data.status===!0)f.success("Order cancelled successfully"),await E();else throw new Error(i.data.message||"Failed to cancel order")}catch(e){console.error("Error cancelling order:",e),f.error(e.message||"Failed to cancel order")}},J=l=>{f.info("Reordered items from order #"+l.id)};return Z(()=>{E()}),(l,e)=>{const i=d("el-icon"),Q=d("el-input"),q=d("el-option"),G=d("el-select"),_=d("el-table-column"),H=d("el-tag"),v=d("el-button"),R=d("el-table"),W=d("el-pagination"),K=d("el-dialog"),X=ee("loading");return u(),h("div",ne,[t("div",re,[t("h2",null,a(l.$t("orders.myOrders")),1),s(Q,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),placeholder:l.$t("orders.Search-orders"),class:"search-input",clearable:""},{prefix:n(()=>[s(i,null,{default:n(()=>[s(b(le))]),_:1})]),_:1},8,["modelValue","placeholder"])]),t("div",de,[s(G,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),placeholder:l.$t("orders.Filter-by-Status"),clearable:""},{default:n(()=>[(u(),h(F,null,L(z,o=>s(q,{key:o,label:o,value:o},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),te((u(),C(R,{data:U.value,id:"orders-table",style:{width:"100%"},class:"orders-table",stripe:"",border:""},{default:n(()=>[s(_,{prop:"id",label:l.$t("orders.orderId"),width:"120"},null,8,["label"]),s(_,{prop:"ordered_at",label:l.$t("orders.orderDate"),width:"180"},{default:n(o=>[y(a(P(o.row.ordered_at)),1)]),_:1},8,["label"]),s(_,{label:l.$t("orders.total"),width:"150"},{default:n(o=>[y(a(o.row.currency)+" "+a(o.row.total_price),1)]),_:1},8,["label"]),s(_,{prop:"status",label:l.$t("orders.status"),width:"150"},{default:n(o=>[s(H,{type:j(o.row.status)},{default:n(()=>[y(a(o.row.status),1)]),_:2},1032,["type"])]),_:1},8,["label"]),s(_,{label:l.$t("orders.actions"),width:"220"},{default:n(o=>[s(v,{size:"small",type:"primary",onClick:V=>T(o.row),circle:""},{default:n(()=>[s(i,null,{default:n(()=>[s(b(oe))]),_:1})]),_:2},1032,["onClick"]),s(v,{size:"small",type:"danger",disabled:o.row.status!=="pending"&&o.row.status!=="processing",onClick:V=>M(o.row),circle:""},{default:n(()=>[s(i,null,{default:n(()=>[s(b(ae))]),_:1})]),_:2},1032,["disabled","onClick"]),s(v,{size:"small",type:"success",onClick:V=>J(o.row),circle:""},{default:n(()=>[s(i,null,{default:n(()=>[s(b(se))]),_:1})]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[X,S.value]]),$.value.length>w?(u(),C(W,{key:0,class:"pagination",layout:"prev, pager, next","current-page":k.value,"page-size":w,total:$.value.length,onCurrentChange:N},null,8,["current-page","total"])):B("",!0),s(K,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=o=>D.value=o),id:"order-details-dialog",title:l.$t("orders.orderDetails"),width:"600px"},{footer:n(()=>[r.value?(u(),C(v,{key:0,type:"primary",onClick:A},{default:n(()=>[y(a(l.$t("orders.printInvoice")||"Print Invoice"),1)]),_:1})):B("",!0)]),default:n(()=>[t("div",ie,[t("div",ce,[t("div",ue,[t("img",{src:x.value,class:"rounded object-fit-contain",width:"200",height:"100",alt:"hi"},null,8,pe),e[3]||(e[3]=t("div",null,[t("h5",null,"Elegance OUD"),t("p",{class:"mb-0"},"company's Country"),t("p",null,"Elegance@gmail.com")],-1))]),e[10]||(e[10]=t("hr",null,null,-1)),t("div",_e,[t("div",me,[e[4]||(e[4]=t("h6",null,"Billed To:",-1)),t("p",ve,a(r.value.user.name),1),t("p",he,a(r.value.address.country.name_en),1),t("p",ge,a(r.value.user.email),1),t("p",null,a(r.value.user.phone),1)]),t("div",fe,[e[5]||(e[5]=t("h6",null,"Invoice Details:",-1)),t("p",be,"Invoice ID : "+a(r.value.invoice_number),1),t("p",ye,"Date: "+a(r.value.ordered_at),1)])]),t("table",we,[e[9]||(e[9]=t("thead",{class:"table-light"},[t("tr",null,[t("th",null,"#"),t("th",null,"Description"),t("th",null,"Unit Price"),t("th",null,"Quantity"),t("th",null,"Subtotal")])],-1)),t("tbody",null,[(u(!0),h(F,null,L(r.value.items,o=>(u(),h("tr",{key:o.id},[t("td",null,a(o.product_id),1),e[6]||(e[6]=t("td",null,"name product",-1)),t("td",null,a(o.price)+" "+a(r.value.currency),1),t("td",null,a(o.quantity),1),t("td",null,a(o.subtotal),1)]))),128))]),t("tfoot",null,[t("tr",null,[e[7]||(e[7]=t("th",{colspan:"4",class:"text-end"},"Delivery",-1)),t("th",ke,a(r.value.currency==="USD"?"USD":"AED")+" "+a(r.value.address.country.id===57?10:20),1)]),t("tr",null,[e[8]||(e[8]=t("th",{colspan:"4",class:"text-end"},"Total",-1)),t("th",De,a(r.value.currency)+" "+a(r.value.total_price),1)])])]),e[11]||(e[11]=t("p",{class:"mt-4 text-center fw-bold"},"Elegance happy to see you again",-1))])])]),_:1},8,["modelValue","title"])])}}},Oe=Y(Se,[["__scopeId","data-v-88f7dbb0"]]);export{Oe as default};
